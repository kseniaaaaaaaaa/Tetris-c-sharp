/*! For license information please see 68307272.a5f2c733.js.LICENSE.txt */
(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[17509],{161183:(e,t,s)=>{"use strict";s.d(t,{Icon16Attach:()=>n});var n=(0,s(28178).makeIcon)("Icon16Attach","attach_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="attach_16"><path fill="currentColor" fill-rule="evenodd" d="M7.968 2.038a3.53 3.53 0 0 1 4.998 0 3.545 3.545 0 0 1 0 5.005L8.66 11.359a2.14 2.14 0 0 1-3.03 0 2.15 2.15 0 0 1 0-3.031l2.09-2.106a.75.75 0 1 1 1.065 1.056L6.693 9.386a.65.65 0 0 0 0 .914.64.64 0 0 0 .906 0l4.305-4.317a2.045 2.045 0 0 0 0-2.886 2.03 2.03 0 0 0-2.874 0L4.603 7.536a9 9 0 0 0-.274.28 3.203 3.203 0 0 0 0 4.3c.174.192.36.38.552.554.594.54 1.421.824 2.252.827.836.003 1.591-.278 2.068-.755q.152-.149.304-.298l2.214-2.22a.75.75 0 0 1 1.062 1.06l-2.23 2.235c-.134.135-.222.223-.301.296-.818.81-1.984 1.186-3.121 1.182-1.148-.004-2.35-.392-3.258-1.219a10 10 0 0 1-.653-.655 4.703 4.703 0 0 1 0-6.315c.075-.083.165-.173.306-.315z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},689826:(e,t,s)=>{"use strict";s.d(t,{Icon28AdvertisingCircleFillRed:()=>n});var n=(0,s(28178).makeIcon)("Icon28AdvertisingCircleFillRed","advertising_circle_fill_red_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="advertising_circle_fill_red_28"><linearGradient id="advertising_circle_fill_red_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff5263" /><stop offset="1" stop-color="#ff3347" /></linearGradient><path fill="url(#advertising_circle_fill_red_28_a)" d="M14 28c7.732 0 14-6.268 14-14S21.732 0 14 0 0 6.268 0 14s6.268 14 14 14" /><g fill="#fff"><path d="M19.7 19c-.169 0-.388-.05-.529-.149L16.732 16.7s-.123-.11-.152-.146a.4.4 0 0 1-.062-.122.5.5 0 0 1-.018-.143v-5.523a.7.7 0 0 1 .019-.205.4.4 0 0 1 .062-.122c.029-.037.152-.149.152-.149l2.438-2.135c.141-.1.371-.152.529-.155a.8.8 0 0 1 .8.8v9.4a.8.8 0 0 1-.8.8M14.7 10.5a.3.3 0 0 1 .3.3v5.4a.3.3 0 0 1-.3.3l-2.2.003c0 .606.326 1.372.583 1.697.391.493.286 1.12-.182 1.53-.47.412-1.344.345-1.734-.148-.59-.743-1.167-1.93-1.167-3.08l-.5-.002a3 3 0 1 1 0-6z" /></g></symbol>',28,28,!1,void 0)},439561:(e,t,s)=>{"use strict";s.d(t,{Icon28MoreHorizontalCircleFillGray:()=>n});var n=(0,s(28178).makeIcon)("Icon28MoreHorizontalCircleFillGray","more_horizontal_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="more_horizontal_circle_fill_gray_28"><linearGradient id="more_horizontal_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#more_horizontal_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" d="M15 6.667c.18.6.306 1.201 1.305 1.777 1.118.304 1.665.003 2.173-.337.53-.353.688-.25.9-.043l.515.515c.235.236.33.33 0 .943-.298.552-.633 1.066-.335 2.18.577 1.004 1.176 1.178 1.775 1.298.625.125.664.309.667.606v.727c0 .334 0 .467-.667.667-.6.18-1.201.306-1.777 1.305-.303 1.118-.002 1.665.337 2.173.353.53.25.688.043.9l-.515.515c-.236.235-.33.33-.943 0-.552-.298-1.066-.633-2.18-.335-1.004.577-1.178 1.176-1.298 1.775-.125.625-.309.664-.606.667h-.727c-.334 0-.467 0-.667-.667-.18-.6-.306-1.201-1.305-1.777-1.118-.303-1.665-.002-2.173.337-.53.353-.688.25-.9.043l-.515-.515c-.235-.236-.33-.33 0-.943.298-.552.634-1.066.335-2.18C7.865 15.294 7.266 15.12 6.667 15c-.625-.125-.664-.309-.667-.606v-.727c0-.334 0-.467.667-.667.6-.18 1.201-.306 1.777-1.305.304-1.118.003-1.665-.337-2.173-.353-.53-.25-.688-.043-.9l.515-.515c.236-.235.33-.33.943 0 .552.298 1.066.634 2.18.335C12.706 7.865 12.88 7.266 13 6.667c.125-.625.309-.664.606-.667h.727c.334 0 .467 0 .667.667M14 10.2a3.8 3.8 0 1 0 0 7.6 3.8 3.8 0 0 0 0-7.6" /></symbol>',28,28,!1,void 0)},304900:(e,t,s)=>{"use strict";s.d(t,{Icon28PopUpStickerCircleFillRaspberryPink:()=>n});var n=(0,s(28178).makeIcon)("Icon28PopUpStickerCircleFillRaspberryPink","pop_up_sticker_circle_fill_raspberry_pink_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="pop_up_sticker_circle_fill_raspberry_pink_28"><g fill-rule="evenodd" clip-path="url(#pop_up_sticker_circle_fill_raspberry_pink_28_a)" clip-rule="evenodd"><path fill="url(#pop_up_sticker_circle_fill_raspberry_pink_28_b)" d="M14 28c7.732 0 14-6.268 14-14S21.732 0 14 0 0 6.268 0 14s6.268 14 14 14" /><path fill="#fff" d="M15.504 7.003a1 1 0 0 1-1 1H9.002a1 1 0 0 0-1 1v5.5a1 1 0 0 1-2.002 0v-5.5a3 3 0 0 1 3.002-3h5.502a1 1 0 0 1 1 1M12.49 21a1 1 0 0 1 1.001-1h5.507a1 1 0 0 0 1-1v-5.5a1 1 0 0 1 2.002 0V19a3 3 0 0 1-3.002 3h-5.507a1 1 0 0 1-1-1Z" /></g><defs><linearGradient id="pop_up_sticker_circle_fill_raspberry_pink_28_b" x1="0" x2="28" y1="0" y2="28" gradientUnits="userSpaceOnUse"><stop stop-color="#FF80D5" /><stop offset="1" stop-color="#E645B1" /></linearGradient><clipPath id="pop_up_sticker_circle_fill_raspberry_pink_28_a"><path fill="#fff" d="M0 0h28v28H0z" /></clipPath></defs></symbol>',28,28,!1,void 0)},685446:(e,t,s)=>{"use strict";s.d(t,{Icon28UgcChatStickerCircleFillBlue:()=>n});var n=(0,s(28178).makeIcon)("Icon28UgcChatStickerCircleFillBlue","ugc_chat_sticker_circle_fill_blue_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="ugc_chat_sticker_circle_fill_blue_28"><rect width="28" height="28" fill="url(#ugc_chat_sticker_circle_fill_blue_28_a)" rx="14" /><path fill="#fff" d="M13.47 8v2.286c0 2.612 2.105 4.728 4.702 4.728h1.986c-.832 1.797-3.026 3.515-5.655 3.515a6.8 6.8 0 0 1-1.703-.216 12 12 0 0 1-1.896 1.34 8 8 0 0 1-.401.21l-.159.078a.604.604 0 0 1-.802-.275.58.58 0 0 1-.017-.477 9 9 0 0 0 .225-.61q.264-.825.404-1.699C9.128 15.93 8.5 14.644 8.5 13.23c0-2.63 2.132-4.813 4.97-5.229Zm1.4.318v1.968a3.31 3.31 0 0 0 3.302 3.32H20.5z" /><defs><linearGradient id="ugc_chat_sticker_circle_fill_blue_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#70B2FF" /><stop offset="1" stop-color="#5C9CE6" /></linearGradient></defs></symbol>',28,28,!1,void 0)},294184:(e,t)=>{var s;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var s=arguments[t];if(s){var a=typeof s;if("string"===a||"number"===a)e.push(s);else if(Array.isArray(s)){if(s.length){var o=i.apply(null,s);o&&e.push(o)}}else if("object"===a)if(s.toString===Object.prototype.toString)for(var r in s)n.call(s,r)&&s[r]&&e.push(r);else e.push(s.toString())}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(s=function(){return i}.apply(t,[]))||(e.exports=s)}()},651656:(e,t,s)=>{"use strict";s.d(t,{default:()=>n});const n={ugcBadge:"ChatSettingsUGCStickers-module__ugcBadge--Fxi7u",ugcIcon:"ChatSettingsUGCStickers-module__ugcIcon--wa31g",listItem:"ChatSettingsUGCStickers-module__listItem--hWpWE",textWrapper:"ChatSettingsUGCStickers-module__textWrapper--eae7m",secondaryText:"ChatSettingsUGCStickers-module__secondaryText--pu1YU",infoIcon:"ChatSettingsUGCStickers-module__infoIcon--RUa0q",userAside:"ChatSettingsUGCStickers-module__userAside--NvIXj"}},149103:(e,t,s)=>{"use strict";s.d(t,{ConvoAttachmentsApp:()=>l});var n=s(667294),i=s(437701),a=s(207739),o=s(660855),r=s(273313);const l=({store:e,env:t,peerId:s,goToMessage:l})=>{const[c,d]=(0,n.useState)(e.getState());(0,n.useEffect)((()=>e.subscribe(d)),[e]);const h=a.safeGet(c.peers,c.ownerId);return n.createElement(r.ErrorBoundary,{fallbackRender:()=>null,onError:e=>t.logger.error("[ConvoAttachmentsApp] Error",e)},n.createElement("div",{className:"ConvoAttachmentsApp MEConfig"},n.createElement(i.Provider,{env:t,state:c,dispatch:e.dispatch,featureFlags:e.featureFlags,owner:h},n.createElement(o.ConvoAttachments,{peerId:s,goToMessage:l}))))}},758390:(e,t,s)=>{"use strict";s.d(t,{DAY:()=>a,HOUR:()=>i,MONTH:()=>r,SECOND:()=>n,WEEK:()=>o,ruLocale:()=>l});const n=1e3,i=60*(60*n),a=24*i,o=7*a,r=30*a,l="ru-RU"},798664:(e,t,s)=>{"use strict";s.d(t,{default:()=>v});var n=s(785893),i=s(667294),a=s(902947),o=s(471828),r=s(659397),l=s(266767),c=s(798738),d=s(429020),h=s(764063),_=s(416218),u=s(441430),g=s(259982),p=s(159663),m=s(433648),C=s(922749);const f=()=>{};class v extends i.Component{resetSearch(e,t){const s=this.props.store.get(),n=(0,l.getTab)(s,s.peer);return(n.customChatMemberSearch?n.customChatMemberSearch(""):(0,c.searchLocalHints)("",this.props.store.get())).then((s=>this.setSearchResults(e,t,"",s)))}componentDidMount(){this.resetSearch()}render(){const e=Object.keys(this.state.selected).length,t="ChatSettingsMembers__entity";return(0,n.jsxs)("div",{className:"ChatSettingsMembers",children:[(0,n.jsx)(h.default,{className:"ChatSettingsMembers__multiSelect",tokens:this.state.selected.map((e=>({text:(0,a.unclean)(this.data[e].name),id:e}))),removeTokenPlaceholder:o.getLang("mail_create_chat_remove_user"),onRemoveToken:this.onRemoveToken,placeholder:o.getLang("mail_search_creation"),value:this.state.value,onChange:this.onChange,onSelect:this.onSelect,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:()=>{},notFoundText:o.getLang("mail_not_found"),autoFocus:!0,isSearching:this.isSearching,badge:this.getBadge(),children:this.state.found.map((e=>(0,n.jsx)("div",{className:(0,r.classNames)(t,{[`${t}--selected`]:this.selected[e]}),"data-id":e,children:(0,n.jsx)(d.default,{size:"34",title:this.data[e].name,photo:this.data[e].photo})},e)))}),(0,n.jsxs)(g.default,{alignment:"right",className:"ChatSettingsMembers__submitArea",children:[(0,n.jsx)(_.Checkbox,{noPadding:!0,stretched:!1,checked:this.state.isShowHistoryChecked,onChange:this.onShowHistoryToggle,className:"ChatSettingsMembers__showHistory",children:o.getLang("mail_im_chat_add_members_show_history")}),(0,n.jsx)(u.Button,{size:"m",disabled:0===e,onClick:this.onAddPeople,loading:this.state.loading,className:"ChatSettingsMembers__confirm",children:e<2?o.getLang("mail_append_chat"):o.getLang("mail_im_create_chat_with")})]})]})}constructor(e){super(e),this.onChange=e=>{const t=this.props.store.get(),s=e.target.value,n=(0,l.getTab)(t,t.peer);n.customChatMemberSearch?n.customChatMemberSearch(s).then((e=>(this.setSearchResults({},!1,s,e),s&&n.customChatMemberServerSearch?(this.isSearching=!0,n.customChatMemberServerSearch(s).catch((e=>{if("debounce"!==e)throw e}))):Promise.resolve([])))).then(this.appendSearchResults):(0,c.searchLocalHints)(s,t).then((e=>(this.setSearchResults({},!1,s,e),s?(this.isSearching=!0,this.serverSearch(s,e.map((e=>e.peerId)))):Promise.resolve([])))).then(this.appendSearchResults).catch((()=>{}))},this.serverSearch=(0,m.debouncedPromise)(((e,t)=>{const s=this.props.store;return(0,c.searchHints)(e,t,"friends",s.get())}),300),this.onRemoveToken=e=>new Promise((t=>{const s=this.state.selected.filter((t=>t!==e));this.selected=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.setState({selected:s},t)})),this.onSelect=e=>new Promise((t=>{const s=this.selected[e]?this.state.selected.filter((t=>t!==e)):[].concat(this.state.selected,e).filter(((e,t,s)=>s.indexOf(e)===t));this.selected=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.resetSearch({selected:s,value:""},t)})),this.onShowHistoryToggle=()=>{this.setState({isShowHistoryChecked:!this.state.isShowHistoryChecked})},this.onAddPeople=()=>{const e=this.props.store,t=e.get().peer,s=this.state.selected.map((e=>parseInt(e))),n=this.state.isShowHistoryChecked;this.setState({loading:!0}),e.set(c.addNewMember.bind(null,t,s,n)).then((()=>e.set(c.getChatDetails.bind(null,t)).then((()=>{this.selected={},this.resetSearch({selected:[],loading:!1},(()=>{this.props.afterSave(s.length)}))})))).catch((e=>{this.selected={},this.resetSearch({selected:[],loading:!1}),(0,p.showFastBox)(o.getLang("global_error"),e)}))},this.setSearchResults=(e,t,s,n)=>{const i=this.props.store.get(),a=(0,l.getTab)(i,i.peer);let o=[];n.forEach((e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===a.memberIds.indexOf(e.peerId)&&o.push(e.peerId)})),this.setState(Object.assign({},e,{found:o,value:s}),t||f)},this.appendSearchResults=e=>{const t=this.props.store.get(),s=(0,l.getTab)(t,t.peer);let n=this.state.found;e.forEach((e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===s.memberIds.indexOf(e.peerId)&&-1===n.indexOf(e.peerId)&&n.push(e.peerId)})),this.isSearching=!1,this.setState({found:n})},this.getBadge=()=>(0,C.getCurrentTab)(this.props.store).isDonutChat?(0,n.jsx)("div",{className:"BannerInfo ChatSettingsMembers__donutBadge",children:o.getLang("mail_dons_only_search")}):null,this.state={selected:[],value:"",loading:!1,found:[],isShowHistoryChecked:!0},this.data={},this.selected={}}}},539364:(e,t,s)=>{"use strict";s.d(t,{default:()=>p});var n=s(785893),i=s(667294),a=s(659397),o=s(45697),r=s.n(o),l=s(471828),c=s(9752),d=s(735347),h=s(839123);const _=149946368,u=33554432,g={regular:(0,n.jsx)(c.Icon56UsersOutline,{}),closed:(0,n.jsx)(d.Icon56LockOutline,{}),custom:(0,n.jsx)(h.Icon56SettingsOutline,{})};class p extends i.Component{componentWillReceiveProps(e){![u,_].includes(e.flags)&&this.setState({customFlags:e.flags,selectedPresetId:3})}render(){const e=this.state.customFlags?this.state.customFlags:this.props.flags,t=this.state.selectedPresetId,s="ChatSettingsPresetPanel__preset",i=[{id:1,title:l.getLang("mail_chat_creation_preset_regular"),icon:"regular",flags:u},{id:2,title:l.getLang("mail_chat_creation_preset_closed"),icon:"closed",flags:_},{id:3,title:l.getLang("mail_chat_creation_preset_custom"),icon:"custom",flags:e}];return(0,n.jsx)("div",{className:"ChatSettingsPresetPanel",children:i.map(((e,i)=>(0,n.jsxs)("div",{className:(0,a.classNames)(s,{[`${s}--selected`]:e.id===t}),onClick:this.selectPreset.bind(null,e.flags,e.id),children:[(0,n.jsx)("div",{className:"ChatSettingsPresetPanel__presetIcon",children:g[e.icon]}),(0,n.jsx)("div",{className:"ChatSettingsPresetPanel__presetTitle",children:e.title})]},i)))})}constructor(e){super(e),this.selectPreset=(e,t)=>{const s=3===this.state.selectedPresetId&&null!==this.state.customFlags;this.setState((e=>({selectedPresetId:t,customFlags:s?this.props.flags:e.customFlags}))),this.props.onSelectPreset(e)};const t=this.props.flags===_?2:this.props.flags===u?1:3;this.state={customFlags:3===t?this.props.flags:null,selectedPresetId:t}}}p.propTypes={flags:r().number,onSelectPreset:r().func}},682715:(e,t,s)=>{"use strict";s.d(t,{mount:()=>x});var n=s(785893),i=s(646952),a=s(70689),o=s(251087),r=(s(667294),s(973935)),l=s(904088),c=s(798738),d=s(266767),h=s(658010),_=s(199015),u=s(159663),g=s(846138),p=s(184132),m=s(780891);let C,f;function v(e,t){const s=ls.get("im_chats_no_invite_link_history")||[],n=p.Ranges.convertChatPeerIdToChatId(e),i=t?s.filter((e=>e!==n)):s.concat(n);ls.set("im_chats_no_invite_link_history",i)}function S(e,t){const s=b(),i=function(e){const t=(0,_.getPeer)(e),s=p.Ranges.convertChatPeerIdToChatId(t);return!(ls.get("im_chats_no_invite_link_history")||[]).includes(s)}(e);s&&r.render((0,n.jsx)(m.AppRootProvider,{children:(0,n.jsx)(l.ChatSettings,{store:e,closePopup:I.bind(null,e),updatePopup:A,isLinkWithHistorySelected:i,updateHistoryLinkState:v,parentMutations:t,convoAttaches:f})}),s)}function I(e){C&&C.hide();const t=e.get();t.hasOwnProperty("onClose")&&t.onClose()}function A(){C&&C.updateBoxCoords()}function b(){return document.querySelector("#ChatSettings")}function L(e){const t=document.querySelector("#box_layer_wrap"),s=document.querySelector("#box_loader"),n=(0,a.isVisible)(t);return{unmount(){const t=b();t&&r.unmountComponentAtNode(t),(0,i.destroyModule)(e)},showLoader(){(0,o.boxRefreshCoords)(s),(0,a.show)(s),n||(0,a.show)(t)},hideLoader(){(0,a.hide)(s),n||(0,a.hide)(t)}}}function x(e,t,s){const{bindMutations:n}=(0,i.createMutations)(L),a=t.get(),o=(0,i.createModule)({handlers:(e,t)=>{}}),r=a.peer,l=n(o);f=new g.ConvoAttaches(t,s);const _=function(e,t){t.get().peer===r?function(e,t){const s=(0,d.getTab)(e,e.get().peer);s&&s.data&&(0,d.isChatActive)(s)?S(e,t):I(e)}(t,s):e.unmount()}.bind(null,l),p={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:560,onShow(){S(t,s),t.subscribe(_),requestAnimationFrame((()=>C.updateBoxCoords()))},onHideAttempt:()=>(t.unsubscribe(_),l.unmount(),!0)};return l.showLoader(),t.set(c.getChatDetails.bind(null,r)).then((e=>{l.hideLoader();const t=(0,h.unpackStore)(e).peer;t&&t===r?C=new u.MessageBox(p).content('<div id="ChatSettings" class="ChatSettingsWrapper"></div>').show():l.unmount()})).catch((()=>{l.hideLoader(),l.unmount()})),l}},308959:(e,t,s)=>{"use strict";s.d(t,{PackContext:()=>c});var n=s(570912),i=s(615816),a=(0,i._)("_options"),o=(0,i._)("_pack"),r=(0,i._)("_product"),l=(0,i._)("_stockItem");class c{get rawData(){return(0,n._)(this,o)[o]||(0,n._)(this,l)[l]||(0,n._)(this,r)[r]}get isPack(){return Boolean((0,n._)(this,o)[o])}get isProduct(){return Boolean((0,n._)(this,r)[r])}get isStockItem(){return Boolean((0,n._)(this,l)[l])}get isStoreItem(){return this.isProduct||this.isStockItem}get stockItem(){return(0,n._)(this,l)[l]}get id(){const e=(0,n._)(this,a)[a]?.redefine?.id;if(void 0!==e)return e;const t=(0,n._)(this,r)[r]?.id;return void 0!==t?t:(0,n._)(this,o)[o]?.id}setHint(e){return(0,n._)(this,a)[a]?((0,n._)(this,a)[a].hint=e,this):this}get hintId(){return(0,n._)(this,a)[a]?.hint?.id}get hintWidth(){return(0,n._)(this,a)[a]?.hint?.width}get index(){return(0,n._)(this,a)[a]?.index}get referrer(){return(0,n._)(this,a)[a]?.referrer}get tooltip(){return(0,n._)(this,a)[a]?.tooltip}get title(){return(0,n._)(this,a)[a]?.redefine?.title||(0,n._)(this,r)[r]?.title||""}get stickers(){return(0,n._)(this,a)[a]?.redefine?.stickers||(0,n._)(this,o)[o]?.stickers||(0,n._)(this,r)[r]?.stickers}get baseId(){return(0,n._)(this,r)[r]?.base_id}get isStyle(){return void 0!==this.baseId}get hasStyles(){return Boolean(this.styleIds?.length)}get styleIds(){return(0,n._)(this,r)[r]?.style_ids}get canGift(){return Boolean((0,n._)(this,l)[l]?.can_gift)}get vmojiAvatar(){return(0,n._)(this,r)[r]?.vmoji_avatar}get isVmoji(){return Boolean(this.vmojiAvatar||(0,n._)(this,r)[r]?.is_vmoji)}get isPopup(){return(0,n._)(this,r)[r]?.is_popup}get isNew(){return(0,n._)(this,r)[r]?.is_new}get previews(){return(0,n._)(this,r)[r]?.previews}constructor({pack:e,...t}){Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,r,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),(0,n._)(this,a)[a]=t,e&&("product"in e?((0,n._)(this,l)[l]=e,(0,n._)(this,r)[r]=e.product):"id"in e&&"type"in e?(0,n._)(this,r)[r]=e:(0,n._)(this,o)[o]=e)}}},546719:(e,t,s)=>{"use strict";s.d(t,{$favoriteStickers:()=>a,setFavoriteStickers:()=>i});var n=s(643060);const i=n.stickersEmojiKeyboard.createEvent(),a=n.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},418098:(e,t,s)=>{"use strict";s.d(t,{$hasAvatar:()=>a,setHasAvatar:()=>i});var n=s(643060);const i=n.stickersEmojiKeyboard.createEvent(),a=n.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},90975:(e,t,s)=>{"use strict";s.d(t,{$packs:()=>u,ServicePackKey:()=>n});var n,i,a=s(798116),o=s(229634),r=s(829010),l=s(418098),c=s(649136),d=s(702594),h=s(546719),_=s(308959);!function(e){e[e.FAVORITE=-1]="FAVORITE",e[e.RECENT=-2]="RECENT",e[e.VMOJI=-3]="VMOJI",e[e.UGC=-4]="UGC"}(n||(n={})),function(e){e.RECENT="recent",e.FAVORITE="favourite",e.KEYBOARD="keyboard"}(i||(i={}));const u=(0,a.combine)(o.$ugcInfo,r.$ugcPacks,c.$stockItems,d.$recentStickers,h.$favoriteStickers,l.$hasAvatar,((e,t,s,a,o,r)=>{const l=new Map;let c=[];const d=new Map;let h=0;if(!s||!a||!o)return{};o.length&&(l.set(n.FAVORITE,new _.PackContext({index:h,referrer:i.FAVORITE,redefine:{id:n.FAVORITE,title:"stickers_picker_favorite",stickers:o}})),c.push(n.FAVORITE),h++),a.length&&(l.set(n.RECENT,new _.PackContext({index:h,referrer:i.RECENT,redefine:{id:n.RECENT,title:"stickers_picker_recently_used",stickers:a}})),c.push(n.RECENT),h++);-1!==s?.findIndex((({product:{vmoji_avatar:e}})=>void 0!==e))||r||(l.set(n.VMOJI,new _.PackContext({index:h,referrer:i.KEYBOARD,redefine:{id:n.VMOJI,title:"stickers_picker_vmoji"}})),c.push(n.VMOJI),h++);const u=t?.[0],g=e?.can_edit,p=u?.stickers?.length,m=e?.show_keyboard_onboarding&&g;if(!e?.is_keyboard_hidden&&(p||m)){const e=new _.PackContext({pack:u,index:h,referrer:i.KEYBOARD,tooltip:{header:"stickers_picker_ugc_tooltip_title",text:"stickers_picker_ugc_tooltip_description"},redefine:{id:n.UGC,title:"stickers_picker_ugc"}});g&&e.setHint({id:"stickers:ugc_keyboard_onboarding_tooltip",width:176}),l.set(n.UGC,e),c.push(n.UGC),h++}return s.forEach((e=>{const{product:{id:t,vmoji_avatar:s}}=e;if(l.set(t,new _.PackContext({index:h,referrer:i.KEYBOARD,pack:e})),s){let e=d.get(s.id);e||(e=c.push([])-1,d.set(s.id,e));const n=c[e];Array.isArray(n)&&n.push(t)}else c.push(t);h++})),{packs:l,packsGroups:c}}))},649136:(e,t,s)=>{"use strict";s.d(t,{$stockItems:()=>a,setStockItems:()=>i});var n=s(643060);const i=n.stickersEmojiKeyboard.createEvent(),a=n.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},702594:(e,t,s)=>{"use strict";s.d(t,{$recentStickers:()=>a,setRecentStickers:()=>i});var n=s(643060);const i=n.stickersEmojiKeyboard.createEvent(),a=n.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},229634:(e,t,s)=>{"use strict";s.d(t,{$ugcInfo:()=>d,reloadUGCInfo:()=>l,setUGCInfo:()=>r});var n=s(798116),i=s(779434),a=s(643060),o=s(609633);const r=a.stickersEmojiKeyboard.createEvent(),l=a.stickersEmojiKeyboard.createEvent(),c=a.stickersEmojiKeyboard.createEffect((e=>e.cache.ugcInfo.get().catch((()=>null)))),d=a.stickersEmojiKeyboard.createStore(null).on(r,((e,t)=>t)).on(c.doneData,((e,t)=>t)).on(o.submitUGCReportFx.doneData,(()=>null));(0,n.sample)({clock:l,source:i.$api,target:c})},829010:(e,t,s)=>{"use strict";s.d(t,{$ugcPacks:()=>o,setUGCPacks:()=>a});var n=s(643060),i=s(609633);const a=n.stickersEmojiKeyboard.createEvent(),o=n.stickersEmojiKeyboard.createStore(null).on(a,((e,t)=>t)).on(i.submitUGCReportFx.doneData,(()=>null))},609633:(e,t,s)=>{"use strict";s.d(t,{submitUGCReport:()=>o,submitUGCReportFx:()=>r});var n=s(798116),i=s(779434),a=s(643060);const o=a.stickersEmojiKeyboard.createEvent(),r=a.stickersEmojiKeyboard.createEffect((e=>{e.cache.clearUGC()}));(0,n.sample)({clock:o,source:i.$api,target:r})},513633:(e,t,s)=>{"use strict";function n(e){return new URLSearchParams(e).toString()}s.d(t,{getUGCAppHash:()=>n})},844092:(e,t,s)=>{"use strict";s.d(t,{AvatarDropdown:()=>d});var n=s(785893),i=s(249600),a=s(77199),o=s(30655),r=s(471828),l=s(598955),c=s(185500);const d=({peerId:e,onPhotoUpload:t,children:s})=>{const d=[{text:(0,n.jsx)(c.AvatarDropdownItem,{icon:(0,n.jsx)(i.Icon20PictureOutline,{}),text:r.getLang("mail_upload_photo")}),onClick:t},{text:(0,n.jsx)(c.AvatarDropdownItem,{icon:(0,n.jsx)(a.Icon20Stars,{}),text:r.getLang("mail_create_photo_from_emoji")}),onClick:()=>{(0,o.showWiki)({w:`app7754294#peer=${e}`})}}];return(0,n.jsx)(l.default,{position:"b",appearance:"fancy",trigger:"hover",marginTop:2,marginLeft:5,align:"left",horizontalPosition:"left",data:d,children:s})}},185500:(e,t,s)=>{"use strict";s.d(t,{AvatarDropdownItem:()=>i});var n=s(785893);const i=({icon:e,text:t})=>(0,n.jsxs)("div",{className:"AvatarDropdownItem",children:[(0,n.jsx)("div",{className:"AvatarDropdownItem__icon",children:e}),t]})},904088:(e,t,s)=>{"use strict";s.d(t,{ChatSettings:()=>M});var n=s(785893),i=s(667294),a=s(30655),o=s(790513),r=s(798738),l=s(67427),c=s(471828),d=s(43129),h=s(242453),_=s(473600),u=s(441430),g=s(20966),p=s(890860),m=s(552419),C=s(316887),f=s(150392),v=s(798664),S=s(571175),I=s(535946),A=s(159663),b=s(266767),L=s(199015),x=s(922749),N=s(977053),k=s(923125);class M extends i.Component{go(e,t){this.setState({section:e},(()=>{this.props.updatePopup(),t&&t()}))}getPopupTitle(){switch(this.state.section){case 1:return c.getLang("mail_settings_add_members");case 2:case 3:return c.getLang("mail_chat_invite_link");case 6:return c.getLang("mail_settings_options");default:return c.getLang("mail_settings_title")}}componentWillReceiveProps(e){const t=e.store.get(),s=t.peer,n=t.tabs[s];n.photoLarge||n.photoGrid||this.resync||(this.resync=!0,e.store.set(r.getChatDetails.bind(null,s)).then((()=>{this.resync=!0})))}componentDidMount(){this.props.updatePopup()}componentWillUnmount(){this.timers.forEach(clearTimeout)}render(){const{store:e,closePopup:t}=this.props,s=e.get(),i=s.peer,a=s.tabs[i],r=(0,o.isFvkcomgroup)(e,i),l=(0,b.isCasperChat)(e,i),d=(0,b.isCommunityChat)(e,i),A=!r&&!d||!e.get().gid,L=(0,I.canCloseChat)(e,i,s.id),N=(0,x.isClosedChat)(a),k=s.isChatTypeEditAllowed,M=r?c.getLang("mail_im_n_vkcomgroup_members",(0,o.getAliveMembersCount)(a)):c.getLang("mail_im_n_chat_members",(0,o.getAliveMembersCount)(a));return(0,n.jsxs)("section",{className:"ChatSettings",children:[(0,n.jsx)(h.ModalHeader,{onBack:()=>this.go(0),backLabel:0!==this.state.section?c.getLang("global_back"):void 0,onClose:t,closeAriaLabel:c.getLang("global_close"),children:this.getPopupTitle()}),0===this.state.section&&(0,n.jsxs)("div",{className:"ChatSettings__content",children:[(0,n.jsx)(g.ChatSettingsInfo,{peerId:i,store:e,photo:a.photoLarge,grid:a.photoGrid,title:a.name,flags:a.data.flags,isDefaultPhotoOwner:a.isDefaultPhotoOwner,isCasper:l,isDonutChat:a.isDonutChat,meta:M,description:""}),(0,n.jsx)(C.default,{store:e,showMembersSettings:()=>this.go(1),showAttachments:this.onShowAttachments,showInvitationLink:this.showInvitationLink,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks,showSettings:()=>this.go(6),notificationSettingsUpdated:this.state.notificationSettingsUpdated,disableUntilUpdated:this.state.disableUntilUpdated,flagsUpdated:this.state.flagsUpdated,onHideStatus:this.onHideStatus,onUpdateNotificationSettings:this.onUpdateNotificationSettings,onUpdateMentionNotificationSettings:this.onUpdateMentionNotificationSettings,afterNotificationSettingsUpdated:this.afterNotificationSettingsUpdated,afterDisableUntilUpdated:this.afterDisableUntilUpdated}),r?null:(0,n.jsx)("div",{className:"ChatSettings__pane",children:(0,n.jsx)(f.default,{store:e,onLeave:this.onLeave,showMembersSettings:()=>this.go(1),membersAdded:this.state.membersAdded,onHideStatus:this.onHideStatus,membersCount:this.state.membersCount})}),A&&(0,n.jsxs)("div",{className:"ChatSettings__pane",children:[(0,n.jsx)(_.Separator,{}),(0,n.jsx)(u.Button,{size:"m",appearance:"negative",mode:"link",className:"ChatSettings__criticalAction",onClick:this.onLeave,stretched:!0,children:r?c.getLang("mail_leave_channel"):c.getLang("mail_settings_leave")}),(0,n.jsx)(_.Separator,{})]}),L&&!N&&(0,n.jsxs)("div",{className:"ChatSettings__pane",children:[(0,n.jsx)(_.Separator,{}),(0,n.jsx)(u.Button,{size:"m",appearance:"negative",mode:"link",className:"ChatSettings__criticalAction",onClick:this.onChatClose,stretched:!0,children:c.getLang("mail_settings_close")}),(0,n.jsx)(_.Separator,{})]}),L&&N&&a.canRestore&&(0,n.jsxs)("div",{className:"ChatSettings__pane",children:[(0,n.jsx)(_.Separator,{}),(0,n.jsx)(u.Button,{size:"m",appearance:"negative",mode:"link",className:"ChatSettings__criticalAction",onClick:this.onChatRestore,stretched:!0,children:c.getLang("mail_settings_restore")}),(0,n.jsx)(_.Separator,{})]})]}),1===this.state.section&&(0,n.jsx)(v.default,{store:e,afterSave:this.afterMembersAdded}),6===this.state.section&&(0,n.jsx)(S.ChatSettingsOptions,{isChatTypeEditAllowed:k,flags:a.data.flags,isCasperChatTab:l,isCommunityChat:d,allowedUpdateFlags:a.allowedUpdateFlags,back:()=>this.go(0),onSave:this.onUpdateFlags,afterSave:this.afterFlagsUpdated}),2===this.state.section&&(0,n.jsx)(p.default,{store:e,onReset:()=>this.go(3),onLinkHistoryOptionToggle:this.onLinkHistoryOptionToggle,reseted:this.state.invitationLinksReseted,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks}),3===this.state.section&&(0,n.jsx)(m.default,{onConfirm:this.onResetLink,onCancel:()=>this.go(2)})]})}constructor(e){super(e),this.showInvitationLink=()=>{const{store:e}=this.props,t=(0,d.unpackStore)(e),s=t.peer;return this.setState({invitationLoading:!0}),(0,r.getInviteLink)(s-2e9,t).then((([e])=>{this.setState({section:2,invitationLoading:!1,invitationLinks:e})}))},this.onUpdateNotificationSettings=(e,t)=>{const{store:s,parentMutations:n}=this.props,i=s.get().peer;return s.set(r.toggleMutePeer.bind(null,i,e,t)).then(n().updateState.bind(null,i))},this.onUpdateMentionNotificationSettings=e=>{const{store:t,parentMutations:s}=this.props,n=t.get().peer;return t.set(r.toggleMuteMentionsPeer.bind(null,n,e)).then(s().updateState.bind(null,n))},this.onUpdateFlags=e=>{const{store:t}=this.props,s=t.get(),n=s.peer,i=s.onUpdateFlags?s.onUpdateFlags.bind(null,n,e):e=>Promise.resolve(e);return(0,r.updateFlags)(n,e,s).then(i)},this.afterFlagsUpdated=()=>{this.go(0,(()=>this.setBlinkStatus({flagsUpdated:!0})))},this.afterMembersAdded=e=>{this.go(0,(()=>this.setBlinkStatus({membersAdded:!0,membersCount:e})))},this.afterNotificationSettingsUpdated=()=>{this.setBlinkStatus({notificationSettingsUpdated:!0})},this.afterDisableUntilUpdated=()=>{this.setBlinkStatus({disableUntilUpdated:!0})},this.setBlinkStatus=e=>{this.timers.push(setTimeout((()=>this.setState(e)),300))},this.onHideStatus=()=>{this.setState({membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1})},this.onLeave=()=>{const{store:e,closePopup:t}=this.props,s=e.get().peer,n=(0,o.isFvkcomgroup)(e,s),i=(0,A.showFastBox)({title:n?c.getLang("mail_leave_channel"):c.getLang("mail_chat_leave_title")},n?c.getLang("mail_vkcomgroup_leave_confirm"):c.getLang("mail_chat_leave_confirm"),n?c.getLang("mail_leave_channel"):c.getLang("mail_leave_chat"),(function(){e.set(r.unpinMessageOptimistic.bind(null,s)),e.set(r.leaveChat.bind(null,s)),i.hide(),t(),e.get().longpoll?.push([(0,l.resetPeer)()])}),c.getLang("global_cancel"),(function(){i.hide()}))},this.onChatClose=()=>{const{store:e,closePopup:t}=this.props,{peer:s}=e.get(),n=(0,b.getTab)(e,s);(0,k.assertNotNull)(n);const i=n.data.flags,a=i&I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?i&~I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:i|I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE,o=(0,A.showFastBox)({title:c.getLang("global_warning")},c.getLang("mail_chat_close_confirm"),c.getLang("mail_close_chat"),(()=>{this.onUpdateFlags(a).then((()=>{o.hide(),t(),e.get().longpoll?.push([(0,l.resetPeer)()])}))}),c.getLang("global_cancel"),(function(){o.hide()}))},this.onChatRestore=()=>{const{store:e,closePopup:t}=this.props,{peer:s}=e.get(),n=(0,b.getTab)(e,s);(0,k.assertNotNull)(n);const i=n.data.flags,a=i&I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?i&~I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:i|I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE;this.onUpdateFlags(a).then(t)},this.onResetLink=()=>{const{store:e}=this.props,t=(0,d.unpackStore)(e),s=t.peer;return(0,r.resetInviteLink)(s,t).then((([e])=>{this.setState({invitationLinksReseted:!0,invitationLinks:e})}))},this.onShowAttachments=()=>{const e=(0,L.getPeer)(this.props.store);this.props.closePopup(),(0,N.partConfigEnabled)("me_fc_attaches_new_modal")?this.props.convoAttaches.show(e):(0,a.showWiki)({w:"history"+(0,o.convertPeerToUrl)(e)+"_photo"},null,{})},this.onLinkHistoryOptionToggle=()=>{const e=(0,L.getPeer)(this.props.store);this.setState((e=>({isInvitationLinkWithHistory:!e.isInvitationLinkWithHistory})),(()=>{this.props.updateHistoryLinkState(e,this.state.isInvitationLinkWithHistory)}))},this.state={section:0,invitationLinks:null,invitationLinksReseted:!1,isInvitationLinkWithHistory:this.props.isLinkWithHistorySelected,membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1},this.timers=[]}}},20966:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsInfo:()=>C});var n=s(785893),i=s(667294),a=s(659397),o=s(255465),r=s(152827),l=s(902947),c=s(471828),d=s(201508),h=s(513698),_=s(736846),u=s(535946),g=s(798738),p=s(844092),m=s(854761);class C extends i.PureComponent{getCasperInfo(){const e=c.getLang("mail_casper_chat_info");return(0,n.jsxs)(n.Fragment,{children:[c.getLang("mail_casper_chat_label"),(0,n.jsx)(o.HintIcon,{"aria-label":e,tooltip:{maxWidth:280,placement:"top",text:e}})]})}render(){const{store:e,photo:t,title:s,description:i,grid:o,meta:g,isDonutChat:m,isDefaultPhotoOwner:C=!1,isCasper:f=!1,peerId:v}=this.props,S=(0,l.unclean)(s),I=(0,u.canChangeTitle)(e),A=(0,a.classNames)("ChatSettingsInfo",{"ChatSettingsInfo--editable":I}),b=e.get().isAvatarBuilderEntryPointEnabled,L=(0,a.classNames)("ChatSettingsInfo__title",{"ChatSettingsInfo__title-service":Boolean(64&this.props.flags)}),x=t?(0,n.jsx)("img",{src:t,width:"80",height:"80",alt:S,className:"ChatSettingsInfo__photoSelf"}):(0,n.jsx)("div",{className:"nim-peer--photo-w",children:(0,n.jsx)("div",{className:"ChatSettingsInfo__photoGrid nim-peer--photo",dangerouslySetInnerHTML:{__html:o}})});return(0,n.jsxs)("div",{className:A,children:[(0,n.jsxs)("header",{className:"ChatSettingsInfo__header",children:[(0,n.jsxs)("div",{className:"ChatSettingsInfo__photo",children:[b&&I?(0,n.jsx)(p.AvatarDropdown,{peerId:v,onPhotoUpload:this.onPhotoUpload,children:(0,n.jsx)("div",{className:"ChatSettingsInfo__avatar nim-peer nim-peer_larger",children:x})}):(0,n.jsx)("div",{className:"ChatSettingsInfo__attach nim-peer nim-peer_larger","data-tip":c.getLang("mail_settings_photo"),onClick:this.onPhotoUpload,children:x}),t&&I&&!C&&(0,n.jsx)(r.TextTooltip,{text:c.getLang("mail_settings_remove_photo"),placement:"top-start",children:(0,n.jsx)("button",{onClick:this.onPhotoRemove,className:"ChatSettingsInfo__photoRemove",children:(0,n.jsx)(h.Icon12Cancel,{})})})]}),(0,n.jsx)("h3",{className:L,children:I?(0,n.jsx)(d.EditableLabel,{value:this.state.title,changed:this.state.titleChanged,useEnter:!0,onSave:this.onSaveTitle,onChange:this.onChangeTitle,onCancel:this.onCancelTitle,validate:this.onValidateTitle}):S}),(0,n.jsxs)("div",{className:"ChatSettingsInfo__meta",children:[(0,n.jsx)("span",{className:"ChatSettingsInfo__metaItem",children:g}),m&&(0,n.jsxs)("span",{className:"ChatSettingsInfo__metaItem",children:[c.getLang("groups_donut_is_dons_chat")," ",(0,n.jsx)(_.Icon12StarCircleFillYellow,{})]}),f&&(0,n.jsx)("span",{className:"ChatSettingsInfo__metaItem",children:this.getCasperInfo()})]})]}),i&&(0,n.jsx)("div",{className:"ChatSettingsInfo__description",children:I?(0,n.jsx)(d.EditableLabel,{value:i,onSave:this.onSaveDescription}):i})]})}constructor(e){super(e),this.onSaveTitle=e=>{const t=this.props.store,s=t.get(),n=e.value.trim().replace("\n","");n&&n!==(0,l.unclean)(this.props.title)&&(this.setState({titleChanged:!1}),t.set(g.updateChatTopic.bind(null,s.peer,n)))},this.onChangeTitle=e=>{if(this.state.title!==e.target.value){const t=e.target.value.replace("\n","");this.setState({title:t,titleChanged:(0,l.unclean)(this.props.title)!==t})}},this.onValidateTitle=e=>!!e.trim().replace("\n",""),this.onCancelTitle=()=>{this.setState({title:(0,l.unclean)(this.props.title),titleChanged:!1})},this.onSaveDescription=()=>{},this.onPhotoUpload=()=>{const e=this.props.store,t=e.get().peer;(0,u.canChangeTitle)(e)&&(window.cur.recieveCropResult=void 0,window.Page.ownerPhoto(t,{gid:e.get().gid}))},this.onPhotoRemove=()=>{const e=this.props.store,t=e.get().peer;(0,u.canChangeTitle)(e)&&e.set(g.removeChatPhoto.bind(null,t)).then((()=>e.set(g.getChatDetails.bind(null,t)))).catch(m.dummyCatch)},this.state={title:(0,l.unclean)(e.title),titleChanged:!1}}}},890860:(e,t,s)=>{"use strict";s.d(t,{default:()=>m});var n=s(785893),i=s(667294),a=s(70689),o=s(471828),r=s(840915),l=s(441430),c=s(990460),d=s(130593),h=s(229272),_=s(533566),u=s(790513),g=s(355116),p=s(659397);class m extends i.Component{componentDidMount(){this.input&&(0,a.elfocus)(this.input,0,this.input.value.length)}render(){const{onReset:e,invitationLinks:t,store:s}=this.props,i=o.getLang("mail_invite_link_reset_explainer").split("{reset_link}"),a=!(0,u.isFvkcomgroup)(s,s.get().peer),{linkWithHistory:m,linkWithoutHistory:C}=t,f=this.props.isInvitationLinkWithHistory?m:C;return(0,n.jsxs)("div",{className:"ChatSettingsInvitationLink",children:[this.props.reseted&&(0,n.jsx)("div",{className:"ChatSettingsInvitationLink__reseted",children:o.getLang("mail_invite_link_reseted_explainer")}),(0,n.jsx)("p",{children:o.getLang("mail_invite_link_explainer")}),(0,n.jsx)("div",{className:"ChatSettingsInvitationLink__switch",children:(0,n.jsx)(g.default,{checked:this.props.isInvitationLinkWithHistory,onChange:this.props.onLinkHistoryOptionToggle,children:o.getLang("mail_im_chat_add_members_show_history")})}),(0,n.jsxs)("div",{className:"ChatSettingsInvitationLink__main",children:[(0,n.jsx)(r.default,{getRef:this.getInputRef,readOnly:!0,className:"ChatSettingsInvitationLink__input",value:f}),(0,n.jsx)(l.Button,{size:"m",onClick:this.onCopy,children:o.getLang("mail_get_invite_link_copy")}),(0,n.jsx)(c.Text,{weight:"3",className:(0,p.classNames)("ChatSettingsInvitationLink__copied",(0,d.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,n.jsx)(h.BlinkText,{shown:this.state.copied,onHide:this.onBlinkTextHide,children:o.getLang("mail_invite_link_copied")})})]}),a&&(0,n.jsxs)("p",{children:[i[0],(0,n.jsx)(_.default,{className:"ChatSettingsInvitationLink__reset",onClick:e,children:o.getLang("mail_invite_reset_link")}),i[1]]})]})}constructor(e){super(e),this.onCopy=()=>{this.input&&((0,a.elfocus)(this.input,0,this.input.value.length),document.execCommand("copy"),this.setState({copied:!0}))},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getInputRef=e=>{e&&(this.input=e)},this.state={copied:!1}}}},176954:(e,t,s)=>{"use strict";s.d(t,{default:()=>C});var n=s(785893),i=s(667294),a=s(471828),o=s(598955),r=s(46885),l=s(535946),c=s(798738),d=s(266767),h=s(183341),_=s(704045),u=s(43129),g=s(854761),p=s(184132),m=s(808265);class C extends i.Component{getMemberRole(e,t){const{storeData:s}=this.props,n=s.peer;return t===s.tabs[n].ownerId?a.getLang("mail_settings_owner"):e[t]?a.getLang("mail_settings_admin"):null}getActions(e){const{store:t,mid:s}=this.props,{id:n,peer:i}=(0,u.unpackStore)(t),o=n===s,r=(0,m.isMarusiaPeer)(s),c=[],h=(0,d.isCommunityChat)(t,i);if(r)return(0,l.canKickUser)(t,s)?[{text:a.getLang("mail_settings_kick"),onClick:this.kick}]:[];if(o)return h&&(0,d.isCommunityInterface)(t)?[]:[{text:a.getLang("mail_leave_chat"),onClick:this.props.onLeave}];if((0,l.canAddAdmin)(t,s)&&c.push({text:e[s]?a.getLang("mail_chat_remove_admin"):a.getLang("mail_settings_appoint_admin"),onClick:this.toggleAdmin}),(0,l.canKickUser)(t,s)&&c.push({text:a.getLang("mail_settings_kick"),onClick:this.kick}),p.Ranges.isGroupId(s)&&!e[s]){const e=(0,l.canSeeAllMessages)(t,t.get().peer,s),n=e?a.getLang("mail_settings_community_mentions_only"):a.getLang("mail_settings_community_full_access");c.push({text:n,onClick:this.changeAccess.bind(this,e)})}return c}render(){const{adminMap:e,storeData:t,mid:s,isMR:i}=this.props,{id:c}=t,d=!!e[c],h=this.getMemberRole(e,s),_=c===s,u=d&&this.getActions(e);return i?(0,n.jsx)(r.default,{text:a.getLang("mail_cancel_invitation"),position:"t",align:"right",children:(0,n.jsx)("span",{onClick:this.cancelMessageRequest,className:"ChatSettingsMembersEdit__kick"})}):(0,n.jsxs)(n.Fragment,{children:[h&&(0,n.jsx)("span",{className:"ChatSettingsMembersEdit__role",children:h}),u&&u.length>0&&(0,n.jsx)(o.default,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,data:this.getActions(e),children:(0,n.jsx)("span",{className:"ChatSettingsMembersEdit__actions"})}),!d&&!_&&(0,l.canKickUser)(t,s)&&(0,n.jsx)(r.default,{text:a.getLang("mail_settings_kick"),position:"t",align:"right",children:(0,n.jsx)("span",{onClick:this.kick,className:"ChatSettingsMembersEdit__kick"})}),!d&&_&&(0,n.jsx)(r.default,{text:a.getLang("mail_leave_chat"),position:"t",align:"right",children:(0,n.jsx)("span",{onClick:this.props.onLeave,className:"ChatSettingsMembersEdit__kick"})})]})}constructor(...e){super(...e),this.toggleAdmin=()=>{const{store:e,mid:t,adminMap:s}=this.props,n=e.get().peer,i=!s[t];e.set(c.toggleAdminOptimisticly.bind(null,n,t,i)),e.set(c.toggleAdmin.bind(null,n,t,i))},this.kick=()=>{const e=this.props.store,t=e.get().peer,s=this.props.mid;e.set((e=>(0,_.kickUserOptimistically)(e,t,s))),e.set((e=>(0,h.kickUserAction)(e,t,s))).catch(g.dummyCatch)},this.cancelMessageRequest=()=>{const e=this.props.store,t=e.get().peer,s=this.props.mid;e.set((e=>(0,h.cancelMessageRequestAction)(e,t,s))).catch(g.dummyCatch)},this.changeAccess=e=>{const t=this.props.store,s=t.get().peer,n=this.props.mid;t.set(c.changeCommunityAccess.bind(null,s,n,!e)).catch(g.dummyCatch)}}}},150392:(e,t,s)=>{"use strict";s.d(t,{default:()=>M});var n=s(785893),i=s(667294),a=s(902947),o=s(471828),r=s(659397),l=s(877926),c=s(790513),d=s(535946),h=s(381616),_=s(358375),u=s(32573),g=s(429020),p=s(176954),m=s(990460),C=s(130593),f=s(229272),v=s(43129),S=s(737081),I=s(790932),A=s(195192),b=s(407729),L=s(184132);const x=50,N={appendParentCls:"ChatSettingsWrapper"},k={all:"allShowMore",admins:"adminsShowMore",invitedByMRShowMore:"invitedByMRShowMore",invitedByMR:"invitedByMRShowMore"};class M extends i.Component{componentWillReceiveProps(e){const t=e.store.get(),s=this.getMembers(t),n=this.getAdmins(t),i=this.getInvitedByMessageRequests(t),a={removes:[],additions:[]},o=s.reduce(((e,t)=>(e[t]=!0,e)),{});s.forEach((e=>{this.membersMap[e]||a.additions.push(e)})),Object.keys(this.membersMap).forEach((e=>{o[e]||a.removes.push(e)})),(a.removes.length||a.additions.length)&&(this.updateSearchIndex(t,a),this.membersMap=o);let r={all:s,allShowMore:this.state.allShowMore&&s.length>x,admins:n,adminsShowMore:this.state.adminsShowMore&&n.length>x,invitedByMR:i,invitedByMRShowMore:this.state.invitedByMRShowMore&&i.length>x,current:"all",showSearch:this.state.showSearch,searchQuery:this.state.searchQuery};this.state.current&&(r.current=this.state.current),this.setState(r)}getMembers(e){const t=e.peer,s=e.tabs[t],n=-1!==(s.memberIds||[]).indexOf(s.ownerId),i=(s.adminIds||[]).reduce(((e,t)=>(e[t]=!0,e)),{});return(n?[s.ownerId]:[]).concat((s.adminIds||[]).filter((e=>e!==s.ownerId)),(s.memberIds||[]).filter((e=>e!==s.ownerId&&!i[e])))}getAdmins(e){const t=e.peer,s=e.tabs[t];return(-1!==(s.memberIds||[]).indexOf(s.ownerId)?[s.ownerId]:[]).concat((s.adminIds||[]).filter((e=>e!==s.ownerId)))}getInvitedByMessageRequests(e){const t=e.peer;return e.tabs[t].invitedByMessageRequest.sort((function(e,t){return e.date-t.date}))}getCurrentList(){const{store:e}=this.props,{current:t,showSearch:s,searchQuery:n,invitedByMR:i}=this.state;if(s&&n&&this.searchIndex){const e=i.filter((e=>!!e.name.toLowerCase().trim().split(/\s+/).find((e=>e.startsWith(n.toLowerCase())))));return this.searchIndex.search(n).concat(e)}const a=this.state[t],o="invitedByMR"===t?a:(0,c.getChatMembersByIds)(e.get(),a),r=`${t}ShowMore`;return this.state[r]?o.slice(0,x):o}getSearchIndex(e){const{vkIndexer:t}=window,s=(0,c.getChatMembersByIds)(this.props.store.get(),e);return this.membersMap=s.reduce(((e,t)=>(e[t.id]=!0,e)),{}),new Promise((e=>{const n=new t(s,(e=>e.name),(()=>{e(n)}))}))}updateSearchIndex(e,t){const s=(0,c.getChatMembersByIds)(e,t.removes),n=(0,c.getChatMembersByIds)(e,t.additions);(this.searchIndex?Promise.resolve(this.searchIndex):this.searchIndexPromise).then((e=>{s.forEach((t=>{e.remove(t)})),n.forEach((t=>{e.add(t)}))}))}componentDidMount(){this.searchInput.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.searchInput.removeEventListener("keydown",this.onKeydown)}render(){const{store:e,membersCount:t,membersAdded:s,onHideStatus:i}=this.props,{current:a,showSearch:d,searchQuery:v,admins:x,invitedByMR:N}=this.state,M=e.get(),w=M.peer,T=M.tabs[w],y=this.getCurrentList(),E=this.isAddMemberWidgetShown()?["add"].concat(y):y,j=k[a],O=this.state[j],H={"ChatSettingsMembersWidget--search":Boolean(d)},R=T.adminIds.reduce(((e,t)=>(e[t]=!0,e)),{});return(0,n.jsxs)("div",{className:(0,r.classNames)("ChatSettingsMembersWidget",H),children:[(0,n.jsxs)("header",{className:"ChatSettingsMembersWidget__header",children:[(0,n.jsx)("input",{placeholder:o.getLang("mail_members_search"),className:"ChatSettingsMembersWidget__search",onChange:this.onSearchChange,onInput:this.onSearchChange,onPaste:e=>this.onSearchChange(e),value:this.state.searchQuery,ref:this.searchInputRef}),(0,n.jsx)("button",{className:"ChatSettingsMembersWidget__searchIcon",onClick:this.onToggleSearch,children:this.state.showSearch?(0,n.jsx)(I.Icon16Cancel,{}):(0,n.jsx)(A.Icon16SearchOutline,{})}),(0,n.jsxs)(h.default,{className:"ChatSettingsMembersWidget__tabs",onTabClick:this.onTabClick,children:[(0,n.jsxs)("span",{children:[o.getLang("mail_settings_everyone")+" ",(0,n.jsx)("span",{className:"Tabs__desc",children:(0,c.getAliveMembersCount)(T)})]},"all"),x.length>0&&(0,n.jsxs)("span",{children:[o.getLang("mail_settings_admins")+" ",(0,n.jsx)("span",{className:"Tabs__desc",children:x.length})]},"admins"),N.length>0&&(0,n.jsxs)("span",{children:[o.getLang("mail_invited_members")+" ",(0,n.jsx)("span",{className:"Tabs__desc",children:N.length})]},"invitedByMR")]})]}),(0,n.jsx)("div",{className:"ChatSettingsMembersWidget__list",children:(0,n.jsxs)(_.default,{border:!1,children:[E.length>0&&E.map((d=>{if("add"===d)return(0,n.jsx)(u.default,{selectable:!1,border:!1,onClick:this.props.showMembersSettings,aside:(0,n.jsx)(m.Text,{weight:"3",className:(0,r.classNames)("ChatSettingsMembersWidget__blink",(0,C.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,n.jsx)(f.BlinkText,{shown:s,onHide:i,children:(0,l.langNumeric)(t||0,o.getLang("mail_settings_members_added","raw"))})}),children:(0,n.jsxs)("span",{className:"ChatSettingsMembersWidget__add",children:[(0,n.jsx)("span",{className:"ChatSettingsMembersWidget__addIcon",children:(0,n.jsx)(b.Icon24Add,{})}),(0,n.jsx)("span",{children:o.getLang("mail_settings_add_members")})]})},"add");const h=this.getInviter(d.id),_="invitedByMR"===a,v=d.image_status?d.name+`<span class="ChatSettingsMembersWidget__imageStatus">${d.image_status}</span>`:d.name,I=this.getMemberDescriptionText(d,M,_);return(0,n.jsx)(u.default,{selectable:!1,border:!1,aside:(0,n.jsx)(p.default,{adminMap:R,store:e,storeData:M,mid:d.id,onLeave:this.props.onLeave,isMR:_}),children:(0,n.jsx)(g.default,{ignoreDecodeHTML:!0,photo:L.Ranges.isContactId(d.id)?(0,n.jsx)(S.ConversationNoPhoto,{id:w,text:(0,c.getUserInitials)(d.name),size:"xxxs",specificType:7}):d.photo,title:(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:v}}),description:I?(0,n.jsx)("span",{title:h,dangerouslySetInnerHTML:{__html:I}}):void 0,href:d.link,onLinkClick:e=>{e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),window.nav.go(d.link,e.nativeEvent))}})},d.id)})),!E.length&&d&&v&&(0,n.jsx)("div",{className:"ChatSettingsMembersWidget__empty",children:o.getLang("mail_settings_not_found")}),!(d&&v)&&O&&(0,n.jsx)("div",{className:"ChatSettingsMembersWidget__more",onClick:this.onShowMore,children:o.getLang("mail_settings_show_all_members")})]})})]})}constructor(e){super(e),this.onToggleSearch=()=>{this.state.showSearch?this.setState({showSearch:!1,searchQuery:""}):(this.setState({showSearch:!0}),requestAnimationFrame((()=>{this.searchInput.focus()})))},this.onSearchChange=e=>{const t=e.target;t.value!==this.state.searchQuery&&this.setState({searchQuery:t.value})},this.onShowMore=()=>{const e=k[this.state.current];if(this.state[e]){const t={[e]:!1};this.setState(t)}},this.onTabClick=(e,t)=>{e.preventDefault(),this.state.current!==t&&this.setState({current:t})},this.onKeydown=e=>{this.state.showSearch&&27===e.keyCode&&(this.searchInput.blur(),this.setState({showSearch:!1,searchQuery:""}),e.preventDefault(),e.stopPropagation())},this.getInviter=e=>{if(this.invitersCache[e])return this.invitersCache[e];const{store:t}=this.props,s=t.get(),n=s.peer,i=s.tabs[n],r=i.inviters;if(!r[e])return"";const h=(0,c.getChatMembersByIds)(s,[r[e][0]])[0],_=(0,l.getSmDate)(r[e][2],s.timeshift,!0);if((0,d.isUserOwnerInChat)(i,e))return this.invitersCache[e]=o.getLang("mail_settings_owner"),o.getLang("mail_settings_owner");if(!h)return this.invitersCache[e]=_,_;const u=(0,l.langSex)(r[e][1],o.getLang("mail_chat_member_invited_by_X","raw")).replace(/{inviter}/,(0,a.replaceEntities)(h.name))+" "+_;return this.invitersCache[e]=u,u},this.isAddMemberWidgetShown=()=>{const e=this.props.store,{id:t,peer:s}=(0,v.unpackStore)(e),{current:n,showSearch:i,searchQuery:a}=this.state;return"all"===n&&!(i&&""!==a)&&(0,d.canInviteUser)(e,s,t)},this.getCommunityDescriptionText=e=>e?o.getLang("mail_settings_community"):o.getLang("mail_settings_bot"),this.getMemberDescriptionText=(e,t,s)=>{const n=t.tabs[t.peer];if(L.Ranges.isGroupId(e.id))return this.getCommunityDescriptionText(e.id===n.ownerId);if(s)return(0,c.getMessageRequestDateText)(e.date,t.timeshift);const i=n.membersLastSeen;return i&&i[e.id]?(0,c.getLastSeenText)(t,e.id,i[e.id],N):void 0},this.searchInputRef=e=>{this.searchInput=e};const t=e.store.get(),s=this.getMembers(t),n=this.getAdmins(t),i=this.getInvitedByMessageRequests(t);this.state={showSearch:!1,searchQuery:"",current:"all",all:s,allShowMore:s.length>x,admins:n,adminsShowMore:n.length>x,invitedByMR:i,invitedByMRShowMore:i.length>x},this.membersMap=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.searchIndexPromise=this.getSearchIndex(s).then((e=>{this.searchIndex=e})),this.invitersCache={}}}},316887:(e,t,s)=>{"use strict";s.d(t,{default:()=>M});var n=s(785893),i=s(667294),a=s(659397),o=s(877926),r=s(471828),l=s(533566),c=s(358375),d=s(32573),h=s(990460),_=s(130593),u=s(229272),g=s(429020),p=s(823649),m=s(758390),C=s(253543),f=s(161183),v=s(287865),S=s(689826),I=s(62340),A=s(439561),b=s(535946),L=s(790513),x=s(266767),N=s(781476),k=s(681482);class M extends i.Component{getPushSettingsFromProps(e){const t=e.store.get();return t.tabs[t.peer].notifications}getPushDisabledFromProps(e){const t=e.store.get();return t.tabs[t.peer].notifications.push_disabled}getDisabledPlaceholder(e){if(!e||0===e)return r.getLang("mail_settings_configure");if(-1===e)return r.getLang("mail_settings_time_forever");const t=(0,o.getShortDateWithTime)(e,0,!1);return`${r.getLang("mail_settings_until")} ${t}`}getDisabledOptions(){const e=[{label:r.getLang("mail_settings_time_one_hour"),value:m.HOUR},{label:r.getLang("mail_settings_time_eight_hours"),value:8*m.HOUR},{label:r.getLang("mail_settings_time_day"),value:m.DAY},{label:r.getLang("mail_settings_time_week"),value:m.WEEK},{label:r.getLang("mail_settings_time_forever"),value:-1}];return this.state.push_disabled_until?[...e,{label:r.getLang("mail_settings_time_cancel"),value:0}]:e}render(){const{store:e,flagsUpdated:t,notificationSettingsUpdated:s,disableUntilUpdated:i,onHideStatus:o,invitationLinks:m,isInvitationLinkWithHistory:M}=this.props,w=e.get(),T=w.tabs[w.peer],y=(0,L.isFvkcomgroup)(w,w.peer),E=(0,x.isCommunityChat)(w,w.peer),j=T.inviteLinks&&(0,b.canSeeInviteLink)(e)||(0,b.canChangeInviteLink)(e),O=m||T.inviteLinks,H=O&&(M?O.linkWithHistory:O.linkWithoutHistory),R=(0,b.canSeeSettingsItem)(e,w.peer,w.id),P=(0,a.classNames)("ChatSettingsMenu",{"ChatSettingsMenu--copied":this.state.copied}),U=w.isMassMentionsMessageAllowed,G=M?r.getLang("mail_get_invite_link_copy_with_history"):r.getLang("mail_get_invite_link_copy_without_history");return(0,n.jsxs)("div",{className:"ChatSettings__pane",children:[E&&(0,n.jsx)(c.default,{className:P,children:(0,n.jsx)(d.default,{onClick:e=>window.nav.go(T.owner.link,e.nativeEvent),chevron:!0,className:"ChatSettingsMenu__owner",children:(0,n.jsx)(g.default,{size:"28",title:T.owner.title,photo:T.owner.photo,href:T.owner.link,description:T.owner.description})})}),(0,n.jsx)(c.default,{className:P,children:(0,n.jsxs)(d.default,{onClick:this.props.showAttachments,chevron:!0,children:[(0,n.jsx)(C.ChatSettingsRoundedIcon,{backgroundColor:"blue",children:(0,n.jsx)(f.Icon16Attach,{})}),r.getLang("mail_im_show_media_history")]})}),(0,k.isUGCStickersEnabled)()&&(0,n.jsx)(c.default,{className:P,children:(0,n.jsx)(N.ChatSettingsUGCStickers,{peerId:w.peer})}),(0,n.jsxs)(c.default,{className:P,children:[U&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.default,{selectable:!1,chevron:!1,aside:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Text,{weight:"3",className:(0,a.classNames)("ChatSettingsMenu__saved",(0,_.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,n.jsx)(u.BlinkText,{shown:s,onHide:o,children:r.getLang("global_changes_saved_short")})}),(0,n.jsx)(p.default,{className:"ChatSettingsMenu__select",onChange:this.onMentionSettingsChange,options:[{label:r.getLang("mail_settings_mentions_all"),value:0},{label:r.getLang("mail_settings_mentions_except"),value:1},{label:r.getLang("mail_settings_mentions_disable"),value:2}],value:this.state.mentions_push_disabled})]}),children:[(0,n.jsx)(C.ChatSettingsRoundedIcon,{children:(0,n.jsx)(v.Icon28MentionCircleFillBlue,{})}),r.getLang("mail_settings_mentions")]}),(0,n.jsxs)(d.default,{selectable:!1,aside:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Text,{weight:"3",className:(0,a.classNames)("ChatSettingsMenu__saved",(0,_.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,n.jsx)(u.BlinkText,{shown:i,onHide:o,children:r.getLang("global_changes_saved_short")})}),(0,n.jsx)(p.default,{className:"ChatSettingsMenu__select",onChange:this.onDisabledSettingsChange,options:this.getDisabledOptions(),placeholder:this.state.disabledPlaceholder})]}),children:[(0,n.jsx)(C.ChatSettingsRoundedIcon,{children:(0,n.jsx)(S.Icon28AdvertisingCircleFillRed,{})}),r.getLang("mail_settings_notices")]})]}),(j||R)&&(0,n.jsxs)(n.Fragment,{children:[j&&(0,n.jsxs)(d.default,{onClick:this.onShowInviteLink,chevron:(0,b.canChangeInviteLink)(e),children:[(0,n.jsx)(C.ChatSettingsRoundedIcon,{children:(0,n.jsx)(I.Icon28ChainCircleFillBlue,{})}),y?r.getLang("mail_vkcomgroup_invite_link"):r.getLang("mail_chat_invite_link"),H&&(0,n.jsxs)("span",{className:"ChatSettingsMenu__invite",children:[(0,n.jsx)("span",{className:"ChatSettingsMenu__hidden",children:(0,n.jsx)("input",{type:"text",readOnly:!0,value:H,ref:this.getHiddenInput})}),(0,n.jsx)(h.Text,{weight:"3",className:(0,a.classNames)("ChatSettingsMenu__copied",(0,_.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,n.jsx)(u.BlinkText,{shown:this.state.copied,onHide:this.onBlinkTextHide,children:r.getLang("mail_invite_link_copied")})}),(0,n.jsx)(l.default,{className:"ChatSettingsMenu__copy",onClick:this.onCopyInviteLink,children:G})]})]}),R&&(0,n.jsxs)(d.default,{onClick:this.props.showSettings,chevron:!0,aside:(0,n.jsx)(h.Text,{weight:"3",className:(0,_.getColorClass)("color_text_secondary"),Component:"span",normalize:!1,children:(0,n.jsx)(u.BlinkText,{shown:t,onHide:o,children:r.getLang("global_changes_saved")})}),children:[(0,n.jsx)(C.ChatSettingsRoundedIcon,{children:(0,n.jsx)(A.Icon28MoreHorizontalCircleFillGray,{})}),r.getLang("mail_settings_options")]})]})]})]})}constructor(e){super(e),this.onCopyInviteLink=e=>{this.input&&(this.input.focus(),this.input.select(),document.execCommand("copy"),this.setState({copied:!0})),e.preventDefault(),e.stopPropagation()},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getHiddenInput=e=>{this.input=e},this.onDisabledSettingsChange=e=>{const t=Number(e.selected.value),s=t>0?Math.floor((Date.now()+t)/1e3):t,n=0!==s;this.setState({push_disabled_until:s?1:0,push_disabled:n?1:0,disabledPlaceholder:this.getDisabledPlaceholder(s)},(()=>{this.props.onUpdateNotificationSettings(n,Math.floor(t/1e3)).then((()=>{this.props.afterDisableUntilUpdated()}))}))},this.onMentionSettingsChange=e=>{const t=e.selected.value;this.setState({mentions_push_disabled:t},(()=>{this.props.onUpdateMentionNotificationSettings(t).then((()=>{this.props.afterNotificationSettingsUpdated()}))}))},this.onShowInviteLink=()=>{(0,b.canChangeInviteLink)(this.props.store)&&this.props.showInvitationLink()};const t=this.getPushSettingsFromProps(e),s=t.push_disabled_until,n=s>0?+new Date(s):s;this.state=Object.assign({pushDisabled:s,mentions_push_disabled:0,disabledPlaceholder:this.getDisabledPlaceholder(n),copied:!1,push_disabled_until:null,push_disabled:0},t)}}},571175:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsOptions:()=>k});var n=s(785893),i=s(667294),a=s(471828),o=s(982721),r=s(358375),l=s(32573),c=s(823649),d=s(441430),h=s(259982),_=s(253543),u=s(539364),g=s(366582),p=s(469531),m=s(957228),C=s(287865),f=s(62340),v=s(776076),S=s(691324),I=s(413947),A=s(304900),b=s(535505),L=s(535946),x=s(86894),N=s(527294);class k extends i.Component{render(){const{flags:e}=this.state,{isChatTypeEditAllowed:t,isCasperChatTab:s,isCommunityChat:i}=this.props,k=(e,t,s=0)=>[!i&&{value:e,label:a.getLang("mail_settings_only_owner")},{value:t,label:i?a.getLang("mail_settings_only_admins"):a.getLang("mail_settings_owner_and_admins")},{value:s,label:a.getLang("mail_settings_all_members")}].filter(Boolean);return(0,n.jsxs)("div",{className:"ChatSettingsOptions",children:[this.props.isChatCreation&&(0,n.jsx)(u.default,{flags:e,onSelectPreset:this.setFlags}),(0,n.jsxs)(r.default,{children:[(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE))&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE),options:k(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE),value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(g.Icon28AddCircleFillBlue,{})}),a.getLang("mail_settings_can_invite")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE))&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE),options:k(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE),value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(p.Icon28EditCircleFillBlue,{})}),a.getLang("mail_settings_can_edit_info")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN))&&!s&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN),options:k(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN),value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(m.Icon28PinCircleFillBlue,{})}),a.getLang("mail_settings_can_pin")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION))&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION),options:k(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION),value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(C.Icon28MentionCircleFillBlue,{})}),a.getLang("mail_settings_can_use_mass_mention")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK))&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK),options:k(0,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK),value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(f.Icon28ChainCircleFillBlue,{})}),a.getLang("mail_settings_can_see_invitation_link")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL))&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL),options:k(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL),value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(v.Icon28PhoneCircleFillGreen,{})}),a.getLang("mail_settings_can_start_group_call")]}),this.isAllowed(L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS)&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS),options:[{value:0,label:a.getLang("mail_settings_only_owner")},{value:L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS,label:a.getLang("mail_settings_owner_and_admins")}],value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(S.Icon28UserCircleFillBlue,{})}),a.getLang("mail_settings_admins_can_add_admins")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE))&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE),options:k(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE),value:(0,N.and)(e,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(I.Icon28PaletteFillBlue,{})}),a.getLang("mail_settings_can_change_style")]}),this.isAllowed(L.MAIL_CHAT_FLAG_DISABLE_STICKERS_POPUP_AUTOPLAY)&&(0,o.isPopUpStickersEnabled)()&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_DISABLE_STICKERS_POPUP_AUTOPLAY),options:[{value:0,label:a.getLang("mail_settings_stickers_popup_autoplay_enabled")},{value:L.MAIL_CHAT_FLAG_DISABLE_STICKERS_POPUP_AUTOPLAY,label:a.getLang("mail_settings_stickers_popup_autoplay_disabled")}],value:(0,N.and)(e,L.MAIL_CHAT_FLAG_DISABLE_STICKERS_POPUP_AUTOPLAY)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(A.Icon28PopUpStickerCircleFillRaspberryPink,{})}),a.getLang("mail_settings_stickers_popup_autoplay")]}),this.isAllowed(L.MAIL_CHAT_FLAG_SERVICE_CHAT)&&t&&(0,n.jsxs)(l.default,{selectable:!1,aside:(0,n.jsx)(c.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:String(L.MAIL_CHAT_FLAG_SERVICE_CHAT),options:[{value:0,label:a.getLang("mail_settings_service_simple")},{value:L.MAIL_CHAT_FLAG_SERVICE_CHAT,label:a.getLang("mail_settings_service_service")}],value:(0,N.and)(e,L.MAIL_CHAT_FLAG_SERVICE_CHAT)}),children:[(0,n.jsx)(_.ChatSettingsRoundedIcon,{children:(0,n.jsx)(b.Icon28GearCircleFillGray,{})}),a.getLang("mail_settings_service")]})]}),(0,n.jsx)(h.default,{alignment:"right",className:"ChatSettingsOptions__submitArena",children:(0,n.jsxs)(x.ButtonGroup,{gap:"s",children:[(0,n.jsx)(d.Button,{size:"m",mode:"tertiary",onClick:this.onCancel,children:a.getLang("global_cancel")}),(0,n.jsx)(d.Button,{size:"m",onClick:this.onSave,loading:this.state.loading,children:a.getLang("global_save")})]})})]})}constructor(e){super(e),this.onChange=e=>{const t=Number(e.name),{value:s}=e.selected;this.setState((({flags:e})=>({flags:(0,N.asLong)(((e,t,s)=>e&~t^s),e,t,s)})))},this.onCancel=()=>{this.setState({flags:this.props.flags}),this.props.back()},this.onSave=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onSave(this.state.flags).then((()=>{this.setState({loading:!1},this.props.afterSave)})).catch((()=>{this.setState({loading:!1,flags:this.props.flags})})))},this.setFlags=e=>{this.setState({flags:e})},this.isAllowed=e=>{const t=this.props.allowedUpdateFlags;return!t||t.includes(e)},this.state={flags:e.flags,loading:!1}}}},552419:(e,t,s)=>{"use strict";s.d(t,{default:()=>c});var n=s(785893),i=s(667294),a=s(471828),o=s(441430),r=s(259982),l=s(86894);class c extends i.Component{render(){return(0,n.jsxs)("div",{className:"ChatSettingsResetInvitationLink",children:[(0,n.jsx)("div",{className:"ChatSettingsResetInvitationLink__text",dangerouslySetInnerHTML:{__html:a.getLang("mail_chat_reset_link_warning")}}),(0,n.jsx)(r.default,{alignment:"right",children:(0,n.jsxs)(l.ButtonGroup,{gap:"s",children:[(0,n.jsx)(o.Button,{size:"m",mode:"tertiary",onClick:this.props.onCancel,children:a.getLang("global_cancel")}),(0,n.jsx)(o.Button,{size:"m",onClick:this.onConfirm,loading:this.state.loading,children:a.getLang("mail_chat_reset_link_confirm")})]})})]})}constructor(...e){super(...e),this.state={},this.onConfirm=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onConfirm().then((()=>{this.setState({loading:!1}),this.props.onCancel()})).catch((()=>this.setState({loading:!1}))))}}}},253543:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsRoundedIcon:()=>a});var n=s(785893),i=s(659397);const a=({type:e,backgroundColor:t,children:s})=>(0,n.jsx)("div",{className:(0,i.classNames)("ChatSettingsRoundedIcon",`ChatSettingsRoundedIcon--${e}`,`ChatSettingsRoundedIcon--${t}`),children:s})},781476:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsUGCStickers:()=>_});var n=s(785893),i=s(466931),a=s(304474),o=s(985037),r=s(784299),l=s(683856),c=s(780891),d=s(86894);const h=({children:e})=>(0,n.jsx)(c.AppRootProvider,{platform:d.Platform.VKCOM,children:(0,n.jsx)("div",{children:e})}),_=({peerId:e})=>{const t=(0,i.isActiveHint)(a.AvailableHelpHints.ACCOUNT_HINT_STICKERS_UGC_SETTINGS_UNSEEN,window.IM?.activeHints||[]),s=()=>{t&&((0,i.hideHelpHint)(a.AvailableHelpHints.ACCOUNT_HINT_STICKERS_UGC_SETTINGS_UNSEEN),(0,i.deleteActiveHelpHintLocally)(a.AvailableHelpHints.ACCOUNT_HINT_STICKERS_UGC_SETTINGS_UNSEEN))},c=(0,l.useCanOpenMiniApp)(),{canHideKeyboard:d}=(0,l.useUGCInKeyboardState)(e);return c?(0,n.jsx)(h,{children:(0,n.jsx)(o.ChatSettingsUGCStickersEditor,{showStickersUGCBadge:t,peerId:e,onClick:s})}):d?(0,n.jsx)(h,{children:(0,n.jsx)(r.ChatSettingsUGCStickersUser,{showStickersUGCBadge:t,peerId:e,onClick:s})}):null}},118139:(e,t,s)=>{"use strict";s.d(t,{Badge:()=>o});var n=s(785893),i=s(86894),a=s(651656);const o=()=>(0,n.jsx)("div",{className:a.default.ugcBadge,children:(0,n.jsx)(i.Badge,{mode:"new"})})},985037:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsUGCStickersEditor:()=>u});var n=s(785893),i=s(471828),a=s(990460),o=s(868521),r=s(285693),l=s(352262),c=s(728405),d=s(118139),h=s(683856),_=s(651656);const u=({showStickersUGCBadge:e,peerId:t,onClick:s})=>{const u=(0,h.useCannotManageUGCStickers)();return(0,n.jsx)(l.UGCListItem,{subheader:u&&(0,n.jsx)(a.Text,{className:_.default.secondaryText,children:i.getLang("stickers_ugc_management_restricted")}),onClick:({nativeEvent:e})=>{u?(0,o.showUGCManagementRestrictedModal)():((0,r.showUGCStickersSettings)(e,{peer_id:t,ref:"settings"}),s?.())},chevron:!u,aside:(0,n.jsxs)(n.Fragment,{children:[e&&(0,n.jsx)(d.Badge,{}),u&&(0,n.jsx)(c.Icon20InfoCircleOutline,{className:_.default.infoIcon})]})})}},784299:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsUGCStickersUser:()=>_});var n=s(785893),i=s(900798),a=s(471828),o=s(990460),r=s(352262),l=s(118139),c=s(911320),d=s(683856),h=s(651656);const _=({showStickersUGCBadge:e,peerId:t,onClick:s})=>{const{isKeyboardHidden:_}=(0,d.useUGCInKeyboardState)(t);return(0,n.jsx)(c.DropdownHideShowUGC,{peerId:t,children:(0,n.jsx)("div",{children:(0,n.jsx)(r.UGCListItem,{subheader:_&&(0,n.jsx)(o.Text,{className:h.default.secondaryText,children:a.getLang("stickers_ugc_management_stickers_hidden")}),chevron:!1,aside:(0,n.jsxs)("div",{className:h.default.userAside,children:[e&&(0,n.jsx)(l.Badge,{}),(0,n.jsx)(i.Icon16MoreVertical,{width:16,className:h.default.infoIcon})]}),onClick:s})})})}},911320:(e,t,s)=>{"use strict";s.d(t,{DropdownHideShowUGC:()=>r});var n=s(785893),i=s(924766),a=s(471828),o=s(683856);const r=({children:e,peerId:t})=>{const{isKeyboardHidden:s,toggle:r}=(0,o.useUGCInKeyboardState)(t),l=s?a.getLang("stickers_ugc_management_show_stickers"):a.getLang("stickers_ugc_management_hide_stickers"),c=s?"default":"destructive";return(0,n.jsx)(i.DropdownActionSheet,{offsetDistance:-10,offsetSkidding:-20,placement:"bottom-end",action:"click",content:(0,n.jsx)(i.DropdownActionSheet.Item,{type:c,onClick:r,children:l}),children:e})}},352262:(e,t,s)=>{"use strict";s.d(t,{UGCListItem:()=>c});var n=s(785893),i=s(32573),a=s(253543),o=s(685446),r=s(471828),l=s(651656);const c=({onClick:e,aside:t,chevron:s,subheader:c})=>(0,n.jsx)(i.default,{onClick:e,aside:t,chevron:s,children:(0,n.jsxs)("div",{className:l.default.listItem,children:[(0,n.jsx)(a.ChatSettingsRoundedIcon,{backgroundColor:"blue",children:(0,n.jsx)(o.Icon28UgcChatStickerCircleFillBlue,{className:l.default.ugcIcon})}),(0,n.jsxs)("div",{className:l.default.textWrapper,children:[r.getLang("stickers_ugc_chat_settings_menu"),c||null]})]})})},683856:(e,t,s)=>{"use strict";s.d(t,{useCanOpenMiniApp:()=>r,useCannotManageUGCStickers:()=>o,useUGCInKeyboardState:()=>l});var n=s(504190),i=s(667294),a=s(120816);const o=()=>{const{is_banned:e=!1,can_edit:t=!1}=(0,n.useStore)(a.$ugcInfo);return t&&e},r=()=>{const{is_banned:e=!1,can_edit:t=!1}=(0,n.useStore)(a.$ugcInfo);return t&&!e},l=e=>{const{can_hide_keyboard:t=!1,is_keyboard_hidden:s=!1}=(0,n.useStore)(a.$ugcInfo),o=(0,i.useCallback)((()=>{t&&(s?(0,a.showUgcFromKeyboardFx)(e):(0,a.hideUgcFromKeyboardFx)(e))}),[e,s,t]);return{canHideKeyboard:t,isKeyboardHidden:s,toggle:o}}},133019:(e,t,s)=>{"use strict";s.d(t,{onboardingHints:()=>c,showHintDefault:()=>l});var n=s(31517),i=s(184132),a=s(466931),o=s(304474);const r=e=>{const t=window.vk?.id;return!(!t||t===e)&&(i.Ranges.isUserId(e)||i.Ranges.isChatOrChannelPeer(e))},l=e=>!!window.IM.onboardingParams[e],c=[{hintId:o.AvailableHelpHints.ACCOUNT_HINT_IM_INTEGRATION_APPS_TOOLTIP_ON_PICKER,targetClass:".ms_item_more_label",callback:({target:e})=>{const t=document.createElement("span");return t.classList.add("ms_item_more_hintDot"),e.appendChild(t),t},needToShow:r},{hintId:o.AvailableHelpHints.ACCOUNT_HINT_IM_INTEGRATION_APPS_TOOLTIP_ON_PICKER,targetClass:'a[class*="app_action_mini_app"]:not(.ms_item--hidden)',callback:({hash:e,title:t,hintId:s,target:i})=>{if(!e||!t)return;const{tooltip:r}=(0,n.helpHintTooltip)(i,{content:t,helpHintHash:e,helpHintId:s,onHideRequestSent:()=>{const e=document.querySelector(".ms_item_more_hintDot");e&&(e.remove(),window.IM.activeHints=window.IM.activeHints.filter((({id:e})=>e!==o.AvailableHelpHints.ACCOUNT_HINT_IM_INTEGRATION_APPS_TOOLTIP_ON_PICKER)))}},{offset:[6,-21],align:"left",forceSide:"left",width:160,appendToParent:!0,withCloseButton:!1,cls:"feature_intro_blue_tt feature_info_tooltip helpHintTooltip__appActionTooltip"});return r.show(),r._ttel.addEventListener("click",(()=>r.hide())),(0,a.initOnboardingAutoHide)(r),r},needToShow:r}]},466931:(e,t,s)=>{"use strict";s.d(t,{deleteActiveHelpHintLocally:()=>h,destroyHintEl:()=>g,hideHelpHint:()=>d,initOnboarding:()=>C,initOnboardingAutoHide:()=>f,isActiveHint:()=>_,updateHints:()=>m});var n=s(166695),i=s(304474),a=s(133019),o=s(65718),r=s(93367);const l=e=>{const{id:t}=e;return Object.values(i.AvailableHelpHints).map((e=>String(e))).includes(t)},c=()=>new Promise(((e,t)=>{(0,n.api)("account.getHelpHints",{}).then((t=>{const s=t.items.filter(l);e(s)})).catch((e=>t(e?.message||e)))})),d=e=>{(0,n.api)("account.hideHelpHint",{hint_id:e}).catch((e=>(0,o.logError)(e,{environment:"im_help_hints_app_action_hide"})))},h=e=>{window.IM?.activeHints&&(window.IM.activeHints=window.IM.activeHints.filter((({id:t})=>t!==e)))},_=(e,t)=>t.findIndex((({id:t})=>t===e))>-1,u=(e,t,s)=>{const{hintId:n,targetClass:i,callback:o}=e,r=((e,t)=>t.find((({id:t})=>t===e)))(n,t),l=document.querySelector(i);if(!r||!l)return;const{id:c,title:d}=r,h=window.IM.onboardingParams[c]?.hash,_={target:l,hintId:c,title:d,hash:h};a.onboardingHints[s].element=o(_)},g=({element:e},t)=>{e&&((e=>e.hasOwnProperty("_ttel"))(e)?e.hide():e.remove(),a.onboardingHints[t].element=null)},p=(e,t,s)=>s?s(t):(0,a.showHintDefault)(e),m=async e=>{if(e){if(!window.IM.activeHints){const e=await c();window.IM.activeHints=e}a.onboardingHints.forEach(((t,s)=>{const{element:n,needToShow:i,hintId:a}=t,o=p(a,e,i);o&&!n?u(t,window.IM.activeHints,s):!o&&n&&g(t,s)}))}},C=e=>{window.IM.onboardingParams=e,a.onboardingHints.length>0&&c().then((e=>{window.IM.activeHints=e,a.onboardingHints.forEach(((t,s)=>{const{hintId:n}=t,i=window.IMBRIDGE?.selectedPeer(),{needToShow:a}=t;if(!i)return;p(n,i,a)&&u(t,e,s)}))})).catch((e=>{(0,o.logError)(e,{environment:"im_help_hints_app_action"})}))},f=e=>{let t,s=!1;const n=document.querySelector("._im_media_selector"),i=n?.querySelector(".ms_items_more_wrap"),a=i?.querySelector(".ms_items_more");function o(){clearTimeout(t),i&&i.classList.contains("shown")&&!s&&c()}function l(){t=setTimeout(o,3e3)}function c(){s||(e.hide(),s=!0,clearTimeout(t),n&&a&&((0,r.removeEvent)(n,"mouseover",l),(0,r.removeEvent)(a,"mousedown",c)))}n&&i&&a&&((0,r.addEvent)(n,"mouseover",l),(0,r.addEvent)(a,"mousedown",c))}},704045:(e,t,s)=>{"use strict";s.d(t,{kickUserOptimistically:()=>i});var n=s(922749);function i(e,t,s){const i=(0,n.getTab)(e,t);return i&&(0,n.isChatConvo)(i)?(i.memberIds=i.memberIds.filter((e=>e!==s)),i.adminIds=i.adminIds.filter((e=>e!==s)),i.membersCount=i.memberIds.length,Promise.resolve(e)):Promise.reject("No chat info")}},846138:(e,t,s)=>{"use strict";s.d(t,{ConvoAttaches:()=>_});var n=s(785893),i=s(149103),a=s(605168),o=s(762759),r=s(471828),l=s(973935),c=s(207739),d=s(780891);const h=({store:e,browserEnv:t,onClose:s,peerId:l})=>(0,n.jsx)(d.AppRootProvider,{children:(0,n.jsxs)(a.BaseModal,{onClose:s,disableBodyScroll:!0,className:"ConvoAttachesModal",children:[(0,n.jsx)(o.Modal.Header,{title:r.getLang("me_convo_attaches_app"),onClose:s}),(0,n.jsx)("div",{style:{width:550,height:420},children:(0,n.jsx)(i.ConvoAttachmentsApp,{store:e,env:t,peerId:c.resolveId(l),goToMessage:()=>{}})})]})});class _{renderConvoAttachesPopup(e,t,s){const i=_.getContainer(),a=()=>this.hide();i&&l.render((0,n.jsx)(h,{store:e,browserEnv:t,peerId:s,onClose:a}),i)}static getContainer(){return document.getElementById("ConvoAttaches")}hide(){if(!this.isMounted)return;const e=_.getContainer();e&&l.unmountComponentAtNode(e),this.isMounted=!1}show(e){const t=window.reforgedME?.convoAttachesContext;if(!t)return;const{store:s,browserEnv:n}=t;this.renderConvoAttachesPopup(s,n,e),this.isMounted=!0}constructor(){this.isMounted=!1}}},285693:(e,t,s)=>{"use strict";s.d(t,{StickersUGC:()=>d,showUGCStickersSettings:()=>c});var n=s(90975),i=s(30655),a=s(563313),o=s(923795),r=s(868521),l=s(513633);function c(e,t,s){(0,i.showApp)(e,o.UGC_STICKERS_APP_ID,!1,null,null,{layer:!0,urlHash:(0,l.getUGCAppHash)(t),onHide:()=>{s?.()}})}const d={showAgeRestriction:r.showAgeRestriction,showChatRestriction:r.showChatRestriction,showUGCPackInStickerPicker:e=>{e?window.StickerPickerViewer?.showPack(n.ServicePackKey.UGC,e):(0,a.logStickersError)("No html element as prop into showUGCPackInStickerPicker")}}},868521:(e,t,s)=>{"use strict";s.d(t,{showAgeRestriction:()=>c,showChatRestriction:()=>d,showUGCManagementRestrictedModal:()=>l});var n=s(785893),i=s(661587),a=s(284658),o=s(969412);const r=400;function l(){const e=(0,i.asyncComponent)((()=>Promise.all([s.e(213),s.e(73084),s.e(78192),s.e(13503)]).then(s.bind(s,358977))),(({UGCManagementRestrictedModal:e})=>e));(0,a.showMessageBoxModalSuspense)((({onClose:t})=>(0,n.jsx)(e,{onClose:t,lang:(0,o.getLangCode)()})),{width:r})}function c(){const e=(0,i.asyncComponent)((()=>Promise.all([s.e(213),s.e(73084),s.e(78192),s.e(13503)]).then(s.bind(s,358977))),(({AgeRestrictionModal:e})=>e));(0,a.showMessageBoxModalSuspense)((({onClose:t})=>(0,n.jsx)(e,{onClose:t,lang:(0,o.getLangCode)()})),{width:r})}function d(){const e=(0,i.asyncComponent)((()=>Promise.all([s.e(213),s.e(73084),s.e(78192),s.e(13503)]).then(s.bind(s,358977))),(({ChatRestrictionModal:e})=>e));(0,a.showMessageBoxModalSuspense)((({onClose:t})=>(0,n.jsx)(e,{onClose:t,lang:(0,o.getLangCode)()})),{width:r})}},834347:(e,t,s)=>{"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},n.apply(this,arguments)}s.d(t,{extends:()=>n})},906811:(e,t,s)=>{"use strict";s.d(t,{useVirtualizer:()=>c,useWindowVirtualizer:()=>d});var n=s(834347),i=s(667294),a=s(973935),o=s(945032),r="undefined"!=typeof document?i.useLayoutEffect:i.useEffect;function l(e){var t=i.useReducer((function(){return{}}),{})[1],s=(0,n.extends)({},e,{onChange:function(s,n){n?(0,a.flushSync)(t):t(),null==e.onChange||e.onChange(s,n)}}),l=i.useState((function(){return new o.Virtualizer(s)}))[0];return l.setOptions(s),i.useEffect((function(){return l._didMount()}),[]),r((function(){return l._willUpdate()})),l}function c(e){return l((0,n.extends)({observeElementRect:o.observeElementRect,observeElementOffset:o.observeElementOffset,scrollToFn:o.elementScroll},e))}function d(e){return l((0,n.extends)({getScrollElement:function(){return"undefined"!=typeof document?window:null},observeElementRect:o.observeWindowRect,observeElementOffset:o.observeWindowOffset,scrollToFn:o.windowScroll,initialOffset:"undefined"!=typeof document?window.scrollY:void 0},e))}},148849:(e,t,s)=>{"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},n.apply(this,arguments)}s.d(t,{extends:()=>n})},945032:(e,t,s)=>{"use strict";s.d(t,{Virtualizer:()=>g,defaultRangeExtractor:()=>o,elementScroll:()=>u,observeElementOffset:()=>c,observeElementRect:()=>r,observeWindowOffset:()=>d,observeWindowRect:()=>l,windowScroll:()=>_});var n=s(148849),i=s(301257),a=function(e){return e},o=function(e){for(var t=Math.max(e.startIndex-e.overscan,0),s=Math.min(e.endIndex+e.overscan,e.count-1),n=[],i=t;i<=s;i++)n.push(i);return n},r=function(e,t){var s=e.scrollElement;if(s){var n=function(e){var s=e.width,n=e.height;t({width:Math.round(s),height:Math.round(n)})};n(s.getBoundingClientRect());var i=new ResizeObserver((function(e){var t=e[0];if(null!=t&&t.borderBoxSize){var i=t.borderBoxSize[0];if(i)return void n({width:i.inlineSize,height:i.blockSize})}n(s.getBoundingClientRect())}));return i.observe(s,{box:"border-box"}),function(){i.unobserve(s)}}},l=function(e,t){var s=e.scrollElement;if(s){var n=function(){t({width:s.innerWidth,height:s.innerHeight})};return n(),s.addEventListener("resize",n,{passive:!0}),function(){s.removeEventListener("resize",n)}}},c=function(e,t){var s=e.scrollElement;if(s){var n=function(){t(s[e.options.horizontal?"scrollLeft":"scrollTop"])};return n(),s.addEventListener("scroll",n,{passive:!0}),function(){s.removeEventListener("scroll",n)}}},d=function(e,t){var s=e.scrollElement;if(s){var n=function(){t(s[e.options.horizontal?"scrollX":"scrollY"])};return n(),s.addEventListener("scroll",n,{passive:!0}),function(){s.removeEventListener("scroll",n)}}},h=function(e,t,s){if(null!=t&&t.borderBoxSize){var n=t.borderBoxSize[0];if(n)return Math.round(n[s.options.horizontal?"inlineSize":"blockSize"])}return Math.round(e.getBoundingClientRect()[s.options.horizontal?"width":"height"])},_=function(e,t,s){var n,i,a=t.adjustments,o=void 0===a?0:a,r=t.behavior,l=e+o;null==(n=s.scrollElement)||null==n.scrollTo||n.scrollTo(((i={})[s.options.horizontal?"left":"top"]=l,i.behavior=r,i))},u=function(e,t,s){var n,i,a=t.adjustments,o=void 0===a?0:a,r=t.behavior,l=e+o;null==(n=s.scrollElement)||null==n.scrollTo||n.scrollTo(((i={})[s.options.horizontal?"left":"top"]=l,i.behavior=r,i))},g=function(e){var t,s,r=this;this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(t=null,s=function(){return t||("undefined"!=typeof ResizeObserver?t=new ResizeObserver((function(e){e.forEach((function(e){r._measureElement(e.target,e)}))})):null)},{disconnect:function(){var e;return null==(e=s())?void 0:e.disconnect()},observe:function(e){var t;return null==(t=s())?void 0:t.observe(e,{box:"border-box"})},unobserve:function(e){var t;return null==(t=s())?void 0:t.unobserve(e)}}),this.range=null,this.setOptions=function(e){Object.entries(e).forEach((function(t){var s=t[0];void 0===t[1]&&delete e[s]})),r.options=(0,n.extends)({debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:a,rangeExtractor:o,onChange:function(){},measureElement:h,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1},e)},this.notify=function(e){null==r.options.onChange||r.options.onChange(r,e)},this.maybeNotify=(0,i.memo)((function(){return r.calculateRange(),[r.isScrolling,r.range?r.range.startIndex:null,r.range?r.range.endIndex:null]}),(function(e){r.notify(e)}),{key:!1,debug:function(){return r.options.debug},initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=function(){r.unsubs.filter(Boolean).forEach((function(e){return e()})),r.unsubs=[],r.scrollElement=null},this._didMount=function(){return r.measureElementCache.forEach(r.observer.observe),function(){r.observer.disconnect(),r.cleanup()}},this._willUpdate=function(){var e=r.options.getScrollElement();r.scrollElement!==e&&(r.cleanup(),r.scrollElement=e,r._scrollToOffset(r.scrollOffset,{adjustments:void 0,behavior:void 0}),r.unsubs.push(r.options.observeElementRect(r,(function(e){r.scrollRect=e,r.maybeNotify()}))),r.unsubs.push(r.options.observeElementOffset(r,(function(e){r.scrollAdjustments=0,r.scrollOffset!==e&&(null!==r.isScrollingTimeoutId&&(clearTimeout(r.isScrollingTimeoutId),r.isScrollingTimeoutId=null),r.isScrolling=!0,r.scrollDirection=r.scrollOffset<e?"forward":"backward",r.scrollOffset=e,r.maybeNotify(),r.isScrollingTimeoutId=setTimeout((function(){r.isScrollingTimeoutId=null,r.isScrolling=!1,r.scrollDirection=null,r.maybeNotify()}),r.options.scrollingDelay))}))))},this.getSize=function(){return r.scrollRect[r.options.horizontal?"width":"height"]},this.memoOptions=(0,i.memo)((function(){return[r.options.count,r.options.paddingStart,r.options.scrollMargin,r.options.getItemKey]}),(function(e,t,s,n){return r.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:s,getItemKey:n}}),{key:!1}),this.getFurthestMeasurement=function(e,t){for(var s=new Map,n=new Map,i=t-1;i>=0;i--){var a=e[i];if(!s.has(a.lane)){var o=n.get(a.lane);if(null==o||a.end>o.end?n.set(a.lane,a):a.end<o.end&&s.set(a.lane,!0),s.size===r.options.lanes)break}}return n.size===r.options.lanes?Array.from(n.values()).sort((function(e,t){return e.end-t.end}))[0]:void 0},this.getMeasurements=(0,i.memo)((function(){return[r.memoOptions(),r.itemSizeCache]}),(function(e,t){var s=e.count,n=e.paddingStart,i=e.scrollMargin,a=e.getItemKey,o=r.pendingMeasuredCacheIndexes.length>0?Math.min.apply(Math,r.pendingMeasuredCacheIndexes):0;r.pendingMeasuredCacheIndexes=[];for(var l=r.measurementsCache.slice(0,o),c=o;c<s;c++){var d=a(c),h=1===r.options.lanes?l[c-1]:r.getFurthestMeasurement(l,c),_=h?h.end:n+i,u=t.get(d),g="number"==typeof u?u:r.options.estimateSize(c),p=_+g,m=h?h.lane:c%r.options.lanes;l[c]={index:c,start:_,size:g,end:p,key:d,lane:m}}return r.measurementsCache=l,l}),{key:!1,debug:function(){return r.options.debug}}),this.calculateRange=(0,i.memo)((function(){return[r.getMeasurements(),r.getSize(),r.scrollOffset]}),(function(e,t,s){return r.range=e.length>0&&t>0?function(e){var t=e.measurements,s=e.outerSize,n=e.scrollOffset,i=t.length-1,a=function(e){return t[e].start},o=p(0,i,a,n),r=o;for(;r<i&&t[r].end<n+s;)r++;return{startIndex:o,endIndex:r}}({measurements:e,outerSize:t,scrollOffset:s}):null}),{key:!1,debug:function(){return r.options.debug}}),this.getIndexes=(0,i.memo)((function(){return[r.options.rangeExtractor,r.calculateRange(),r.options.overscan,r.options.count]}),(function(e,t,s,i){return null===t?[]:e((0,n.extends)({},t,{overscan:s,count:i}))}),{key:!1,debug:function(){return r.options.debug}}),this.indexFromElement=function(e){var t=r.options.indexAttribute,s=e.getAttribute(t);return s?parseInt(s,10):(console.warn("Missing attribute name '"+t+"={index}' on measured element."),-1)},this._measureElement=function(e,t){var s=r.measurementsCache[r.indexFromElement(e)];if(s&&e.isConnected){var n=r.measureElementCache.get(s.key);n!==e&&(n&&r.observer.unobserve(n),r.observer.observe(e),r.measureElementCache.set(s.key,e));var i=r.options.measureElement(e,t,r);r.resizeItem(s,i)}else r.measureElementCache.forEach((function(t,s){t===e&&(r.observer.unobserve(e),r.measureElementCache.delete(s))}))},this.resizeItem=function(e,t){var s,n=t-(null!=(s=r.itemSizeCache.get(e.key))?s:e.size);0!==n&&(e.start<r.scrollOffset&&r._scrollToOffset(r.scrollOffset,{adjustments:r.scrollAdjustments+=n,behavior:void 0}),r.pendingMeasuredCacheIndexes.push(e.index),r.itemSizeCache=new Map(r.itemSizeCache.set(e.key,t)),r.notify(!1))},this.measureElement=function(e){e&&r._measureElement(e,void 0)},this.getVirtualItems=(0,i.memo)((function(){return[r.getIndexes(),r.getMeasurements()]}),(function(e,t){for(var s=[],n=0,i=e.length;n<i;n++){var a=t[e[n]];s.push(a)}return s}),{key:!1,debug:function(){return r.options.debug}}),this.getVirtualItemForOffset=function(e){var t=r.getMeasurements();return(0,i.notUndefined)(t[p(0,t.length-1,(function(e){return(0,i.notUndefined)(t[e]).start}),e)])},this.getOffsetForAlignment=function(e,t){var s=r.getSize();"auto"===t&&(t=e<=r.scrollOffset?"start":e>=r.scrollOffset+s?"end":"start"),"start"===t||("end"===t?e-=s:"center"===t&&(e-=s/2));var n=r.options.horizontal?"scrollWidth":"scrollHeight",i=(r.scrollElement?"document"in r.scrollElement?r.scrollElement.document.documentElement[n]:r.scrollElement[n]:0)-r.getSize();return Math.max(Math.min(i,e),0)},this.getOffsetForIndex=function(e,t){void 0===t&&(t="auto"),e=Math.max(0,Math.min(e,r.options.count-1));var s=(0,i.notUndefined)(r.getMeasurements()[e]);if("auto"===t)if(s.end>=r.scrollOffset+r.getSize()-r.options.scrollPaddingEnd)t="end";else{if(!(s.start<=r.scrollOffset+r.options.scrollPaddingStart))return[r.scrollOffset,t];t="start"}var n="end"===t?s.end+r.options.scrollPaddingEnd:s.start-r.options.scrollPaddingStart;return[r.getOffsetForAlignment(n,t),t]},this.isDynamicMode=function(){return r.measureElementCache.size>0},this.cancelScrollToIndex=function(){null!==r.scrollToIndexTimeoutId&&(clearTimeout(r.scrollToIndexTimeoutId),r.scrollToIndexTimeoutId=null)},this.scrollToOffset=function(e,t){var s=void 0===t?{}:t,n=s.align,i=void 0===n?"start":n,a=s.behavior;r.cancelScrollToIndex(),"smooth"===a&&r.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r._scrollToOffset(r.getOffsetForAlignment(e,i),{adjustments:void 0,behavior:a})},this.scrollToIndex=function(e,t){var s=void 0===t?{}:t,n=s.align,a=void 0===n?"auto":n,o=s.behavior;e=Math.max(0,Math.min(e,r.options.count-1)),r.cancelScrollToIndex(),"smooth"===o&&r.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");var l=r.getOffsetForIndex(e,a),c=l[0],d=l[1];r._scrollToOffset(c,{adjustments:void 0,behavior:o}),"smooth"!==o&&r.isDynamicMode()&&(r.scrollToIndexTimeoutId=setTimeout((function(){if(r.scrollToIndexTimeoutId=null,r.measureElementCache.has(r.options.getItemKey(e))){var t=r.getOffsetForIndex(e,d)[0];(0,i.approxEqual)(t,r.scrollOffset)||r.scrollToIndex(e,{align:d,behavior:o})}else r.scrollToIndex(e,{align:d,behavior:o})})))},this.scrollBy=function(e,t){var s=(void 0===t?{}:t).behavior;r.cancelScrollToIndex(),"smooth"===s&&r.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r._scrollToOffset(r.scrollOffset+e,{adjustments:void 0,behavior:s})},this.getTotalSize=function(){var e;return((null==(e=r.getMeasurements()[r.options.count-1])?void 0:e.end)||r.options.paddingStart)-r.options.scrollMargin+r.options.paddingEnd},this._scrollToOffset=function(e,t){var s=t.adjustments,n=t.behavior;r.options.scrollToFn(e,{behavior:n,adjustments:s},r)},this.measure=function(){r.itemSizeCache=new Map,r.notify(!1)},this.setOptions(e),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach((function(e){r.itemSizeCache.set(e.key,e.size)})),this.maybeNotify()},p=function(e,t,s,n){for(;e<=t;){var i=(e+t)/2|0,a=s(i);if(a<n)e=i+1;else{if(!(a>n))return i;t=i-1}}return e>0?e-1:0}},301257:(e,t,s)=>{"use strict";function n(e,t,s){var n,i,a=null!=(n=s.initialDeps)?n:[];return function(){var n;s.key&&null!=s.debug&&s.debug()&&(n=Date.now());var o,r=e();if(!(r.length!==a.length||r.some((function(e,t){return a[t]!==e}))))return i;if(a=r,s.key&&null!=s.debug&&s.debug()&&(o=Date.now()),i=t.apply(void 0,r),s.key&&null!=s.debug&&s.debug()){var l=Math.round(100*(Date.now()-n))/100,c=Math.round(100*(Date.now()-o))/100,d=c/16,h=function(e,t){for(e=String(e);e.length<t;)e=" "+e;return e};console.info("%c⏱ "+h(c,5)+" /"+h(l,5)+" ms","\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl("+Math.max(0,Math.min(120-120*d,120))+"deg 100% 31%);",null==s?void 0:s.key)}return null==s||null==s.onChange||s.onChange(i),i}}function i(e,t){if(void 0===e)throw new Error("Unexpected undefined"+(t?": "+t:""));return e}s.d(t,{approxEqual:()=>a,memo:()=>n,notUndefined:()=>i});var a=function(e,t){return Math.abs(e-t)<1}}}]);try{stManager.done("dist/web/chunks/68307272.a5f2c733.js")}catch(e){}