"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[28056],{891047:(e,t,s)=>{function i(e){return new Promise(((t,s)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>s(e.error)}))}function r(e,t){const s=indexedDB.open(e);s.onupgradeneeded=()=>s.result.createObjectStore(t);const r=i(s);return(e,s)=>r.then((i=>s(i.transaction(t,e).objectStore(t))))}let a;function o(){return a||(a=r("keyval-store","keyval")),a}function n(e,t=o()){return t("readonly",(t=>i(t.get(e))))}function c(e,t,s=o()){return s("readwrite",(s=>(s.put(t,e),i(s.transaction))))}function h(e,t,s=o()){return s("readwrite",(s=>new Promise(((r,a)=>{s.get(e).onsuccess=function(){try{s.put(t(this.result),e),r(i(s.transaction))}catch(e){a(e)}}}))))}function d(e,t=o()){return t("readwrite",(t=>(t.delete(e),i(t.transaction))))}function u(e=o()){return e("readwrite",(e=>(e.clear(),i(e.transaction))))}s.d(t,{clear:()=>u,createStore:()=>r,del:()=>d,get:()=>n,set:()=>c,update:()=>h})},772920:(e,t,s)=>{s.d(t,{API:()=>u});var i=s(304939),r=s(330110),a=s(946832),o=s(826214),n=s(595548),c=s(339919),h=s(630362);const d="undefined"!=typeof window&&window.vk?.apiConfigDomains?.apiDomain||"api.vk.com";class u extends r.CallbackService{setOptions(e){this.options={...this.options,...e}}execute(e){return this.call("execute",e)}procedure(e,t){return this.call(`execute.${e}`,t)}call(e,t){return this.callWithRequest(new r.APIRequest({method:e,params:t,api:this}))}callWithRequest(e){return this.worker.enqueue(e),e.promise}getWorker(){switch(this.options.mode){case h.APIMode.PARALLEL:return new a.ParallelWorker(this);case h.APIMode.SEQUENTIAL:return new o.SequentialWorker(this)}}constructor(e,t={}){super(),this.globalParams=new Map,this.options={token:"",mode:h.APIMode.SEQUENTIAL,requestMode:h.APIRequestMode.SEQUENTIAL,requestMethod:h.APIRequestMethod.FETCH,wait:3e3,limit:3,bridge:!1,version:i.API_VERSION,baseUrl:`https://${d}`,retryLimit:3,timeout:6e4,executeCount:25,language:"ru",executeUnsupportedMethods:["photos.save","photos.saveWallPhoto","photos.saveOwnerPhoto","photos.saveMessagesPhoto","messages.setChatPhoto","photos.saveMarketPhoto","photos.saveMarketAlbumPhoto","audio.save","docs.save","photos.saveOwnerCoverPhoto","stories.save","polls.savePhoto"],...e};for(const e of n.methodGroups)this[e]=new Proxy(Object.create(null),{get:(t,s)=>(t,i)=>this.callWithRequest(new r.APIRequest({api:this,method:`${e}.${s}`,params:t,options:i}))});this.worker=this.getWorker(),this.updates=new c.Updates(this,t)}}},427966:(e,t,s)=>{s.d(t,{CaptchaType:()=>a,MINIMUM_TIME_INTERVAL_API:()=>r,POLLING_VERSION:()=>i});const i=10,r=1133;var a;!function(e){e.API="API",e.DIRECT_AUTH="DIRECT_AUTH",e.IMPLICIT_FLOW_AUTH="IMPLICIT_FLOW_AUTH",e.ACCOUNT_VERIFICATION="ACCOUNT_VERIFICATION"}(a||(a={}))},222414:(e,t,s)=>{s.d(t,{APIError:()=>a});var i=s(261311),r=s(977868);class a extends r.VKError{constructor(e){const t=Number(e.error_code);switch(super({code:t,message:`Code №${t} - ${e.error_msg}`}),this.params=e.request_params,t===i.API_ERROR_CAPTCHA&&(this.captchaSid=Number(e.captcha_sid),this.captchaImg=e.captcha_img),t){case i.API_ERROR_CAPTCHA:this.captchaSid=Number(e.captcha_sid),this.captchaImg=e.captcha_img;break;case i.API_ERROR_AUTH_VALIDATION:this.redirectUri=e.redirect_uri;break;case i.API_ERROR_NEED_CONFIRMATION:this.confirmationText=e.confirmation_text}}}},453089:(e,t,s)=>{s.d(t,{ExecuteError:()=>r});var i=s(222414);class r extends i.APIError{constructor(e){super({error_code:e.error_code,error_msg:e.error_msg,request_params:[]}),this.method=e.method}}},933524:(e,t,s)=>{s.d(t,{OAuthError:()=>r});var i=s(977868);class r extends i.VKError{constructor({error:e,error_description:t}){super({code:e,message:t})}}},9374:(e,t,s)=>{s.d(t,{UpdatesError:()=>r});var i=s(977868);class r extends i.VKError{}},977868:(e,t,s)=>{var i;s.d(t,{SharedErrorCode:()=>i,VKError:()=>r}),function(e){e.UNSUPPORTED_MODE="UNSUPPORTED_MODE",e.MISSING_CAPTCHA_HANDLER="MISSING_CAPTCHA_HANDLER",e.MISSING_TOKEN_REGENERATE_HANDLER="MISSING_TOKEN_REGENERATE_HANDLER"}(i||(i={}));class r extends Error{constructor({code:e,message:t}){super(t),this.code=e,this.name=this.constructor.name}}},433075:(e,t,s)=>{s.d(t,{CallbackService:()=>r});var i=s(977868);class r{get hasCaptchaHandler(){return void 0!==this.captchaHandler}onCaptcha(e){return this.captchaHandler=e,this}processingCaptcha(e){const{captchaHandler:t}=this;return t?new Promise(((s,i)=>{t(e,(e=>new Promise(((t,r)=>{if(e instanceof Error)return r(e),void i(e);s({key:e,validate:{resolve:t,reject:r}})}))))})):Promise.reject(new i.VKError({code:i.SharedErrorCode.MISSING_CAPTCHA_HANDLER,message:"Missing captcha handler"}))}get hasTokenRegenerateHandler(){return void 0!==this.tokenRegenerateHandler}onTokenRegenerate(e){return this.tokenRegenerateHandler=e,this}processingTokenRegenerate(){const{tokenRegenerateHandler:e}=this;return void 0===e?Promise.reject(new i.VKError({code:i.SharedErrorCode.MISSING_TOKEN_REGENERATE_HANDLER,message:"Missing token regenerate handler"})):new Promise(((t,s)=>{e((e=>new Promise(((i,r)=>{if(e instanceof Error)return r(e),void s(e);t({token:e,validate:{resolve:i,reject:r}})}))))}))}}},773455:(e,t,s)=>{s.d(t,{EventDispatcher:()=>i});class i{hasEventListener(e,t){return this.listeners.some((s=>s.type===e&&s.listener===t))}addEventListener(e,t,s={}){return this.hasEventListener(e,t)||this.listeners.push({type:e,listener:t,options:s}),this}removeEventListener(e,t){const s=this.listeners.findIndex((s=>s.type===e&&s.listener===t));return-1!==s&&this.listeners.splice(s,1),this}removeEventListeners(){return this.listeners=[],this}dispatchEvent(e){return this.listeners.filter((t=>t.type===e.type)).forEach((t=>{const{type:s,listener:i,options:{once:r}}=t;i.call(this,e),r&&this.removeEventListener(s,i)})),this}constructor(){this.listeners=[]}}},330110:(e,t,s)=>{s.d(t,{APIRequest:()=>i.APIRequest,CallbackService:()=>r.CallbackService});var i=s(262449),r=s(433075)},262449:(e,t,s)=>{s.d(t,{APIRequest:()=>n});var i=s(363476),r=s.n(i),a=s(891317),o=s(249109);class n{toString(){return(0,o.getExecuteMethod)(this.method,this.params)}get filteredParams(){const{options:{token:e,version:t,language:s}}=this.api;return Object.fromEntries([...Object.entries({...!this.isCustomMethod&&{v:t,access_token:e},lang:s,...this.params}),...this.api.globalParams.entries()].filter((([,e])=>void 0!==e)))}get isCustomMethod(){const{requestMethod:e}=this.api.options;return"function"==typeof e}async make(){const{options:{timeout:e,requestMethod:t}}=this.api;this.timeout=setTimeout((()=>this.options.abortController?.abort()),e);try{return this.isCustomMethod?await this.custom():await this[t]()}finally{clearTimeout(this.timeout)}}fetch(){const{abortController:e}=this.options,{options:{baseUrl:t}}=this.api;return fetch(new URL(`/method/${this.method}`,t),{method:"POST",signal:e?.signal,headers:{connection:"keep-alive"},body:new URLSearchParams(this.filteredParams)}).then((e=>e.json()))}bridge(){const{abortController:e}=this.options;return new Promise(((t,s)=>{e?.signal.aborted&&s(e.signal.reason),e?.signal.addEventListener("abort",(()=>{s(e.signal.reason)})),r().send("VKWebAppCallAPIMethod",{method:this.method,params:this.filteredParams}).then(t).catch((e=>{const{error_data:s}=e;t({error:s?.error_reason||s||e})}))}))}script(){const{abortController:e}=this.options,{options:{baseUrl:t}}=this.api;return new Promise(((s,i)=>{e?.signal.aborted&&i(e.signal.reason);const r=(0,a.generateId)(20),o=new URLSearchParams(this.filteredParams);o.set("callback",r);const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=new URL(`/method/${this.method}?${o}`,t).toString(),window[r]=e=>{n.remove(),delete window[r],s(e)},e?.signal.addEventListener("abort",(()=>{n.remove(),delete window[r],i(e.signal.reason)})),document.head.appendChild(n)}))}custom(){const{abortController:e}=this.options,{requestMethod:t}=this.api.options;if("function"==typeof t)return new Promise(((s,i)=>{e?.signal.aborted&&i(e.signal.reason),e?.signal.addEventListener("abort",(()=>{i(e.signal.reason)})),t(this.method,this.filteredParams).then(s).catch(i)}))}constructor({api:e,method:t,params:s={},options:i={}}){var r;this.retries=0,this.api=e,this.method=t,this.params={...s},this.options={...i},(r=this.options).abortController??(r.abortController=new AbortController),this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}},793077:(e,t,s)=>{s(667294)},413151:(e,t,s)=>{s.d(t,{API:()=>i.API,StickersQueueEventType:()=>n.StickersQueueEventType,UpdatesSource:()=>a.UpdatesSource,VKError:()=>r.VKError,VmojiQueueEventType:()=>o.VmojiQueueEventType,getRandomId:()=>c.getRandomId});var i=s(772920),r=(s(630362),s(933524),s(9374),s(453089),s(977868)),a=(s(222414),s(339919)),o=s(669146),n=s(530834),c=(s(734631),s(799285),s(994119),s(440715),s(793077),s(271826));s(338696),s(881829)},595548:(e,t,s)=>{s.d(t,{methodGroups:()=>i});const i=["account","accountVerification","actionLinks","address","adex","admin","admins","ads","adsint","adsweb","aliexpress","antispam","appWidgets","apps","articles","asr","audio","audioBooks","audioSearch","auth","authorsMarketplace","autotests","badges","bestFriends","biz","blogforce","board","bot","botsConf","bugtracker","calls","callsOk","captcha","cashout","catalog","channels","classifieds","combo","coupons","crowd","cua","database","deliveryClub","devAdmin","docs","documentation","donut","downloadedGames","ecosystem","education","educationCloud","educationEjd","educationForeign","educationParents","educationPolls","educationReport","educationUser","email","esia","exchange","exchangeRates","execute","experts","explore","externalAudioMatching","externalUsers","fave","finance","findMe","forbiddenRegistry","fortuneSquare","fortuneWheel","friends","gamesPromo","gifts","golunch","goodsOrders","groups","healthApp","healthCommon","healthCourses","healthFeed","healthLoyalty","id","identity","instManager","interests","internal","leadForms","leads","lifeEvents","likes","lovina","loyalty","loyaltyTeen","market","marusia","masks","memories","messages","microlandings","mobile","money","multiaccount","musicManager","narratives","newsfeed","nft","nftMarket","nospam","notes","notifications","odnoklassniki","onboarding","orders","pages","phones","photos","places","platform","platformConsole","podcasts","podcastsOffice","polls","prettyCards","promoCodes","questions","queue","recomSettings","reports","restore","rewardedAds","rightholders","search","secure","serverEffects","settings","shortVideo","signals","situationalSuggests","sms","social","specials","statEvents","stats","statsDashboard","status","stickers","storage","store","stories","streaming","studentsVerification","studio","superApp","superAppPromo","support","survey","tabbar","tags","textlives","tickets","tinkoff","translations","uma","users","utils","uxpolls","verification","video","videoPostcards","vkCharity","vkIdHub","vkMusic","vkRun","vkStart","vkTaxi","vkUp","vkdrive","vkstore","vmoji","voicerooms","wall","weather","widgets","widgetsIOS","widgetsKit","wishlists"]},630362:(e,t,s)=>{var i,r,a;s.d(t,{APIMode:()=>i,APIRequestMethod:()=>a,APIRequestMode:()=>r}),function(e){e.PARALLEL="parallel",e.SEQUENTIAL="sequential"}(i||(i={})),function(e){e.SEQUENTIAL="sequential",e.BURST="burst"}(r||(r={})),function(e){e.FETCH="fetch",e.SCRIPT="script",e.BRIDGE="bridge"}(a||(a={}))},530834:(e,t,s)=>{var i;s.d(t,{StickersQueueEvent:()=>r,StickersQueueEventType:()=>i}),function(e){e.UGC_USER_UPDATE="ugc_user_update",e.UGC_PACK_UPDATE="ugc_pack_update",e.UGC_OWNER_UPDATE="ugc_owner_update",e.UGC_STICKER_UPDATE="ugc_sticker_update"}(i||(i={}));class r extends CustomEvent{constructor(e,t){super(e,{detail:t})}}},552638:(e,t,s)=>{s.d(t,{handlerStickersQueueEvent:()=>c});var i=s(530834),r=s(734631),a=s(799285),o=s(994119),n=s(440715);function c(e,{data:t}){const{type:s}=t;switch(s){case i.StickersQueueEventType.UGC_PACK_UPDATE:e.dispatchEvent(new r.StickersUGCPackUpdate(t));break;case i.StickersQueueEventType.UGC_USER_UPDATE:e.dispatchEvent(new a.StickersUGCUserUpdate(t));break;case i.StickersQueueEventType.UGC_OWNER_UPDATE:e.dispatchEvent(new o.StickersUGCOwnerUpdate(t));break;case i.StickersQueueEventType.UGC_STICKER_UPDATE:e.dispatchEvent(new n.StickersUGCStickerUpdate(t))}}},994119:(e,t,s)=>{s.d(t,{StickersUGCOwnerUpdate:()=>r});var i=s(530834);class r extends i.StickersQueueEvent{constructor(e){super(i.StickersQueueEventType.UGC_OWNER_UPDATE,e)}}},734631:(e,t,s)=>{s.d(t,{StickersUGCPackUpdate:()=>r});var i=s(530834);class r extends i.StickersQueueEvent{constructor(e){super(i.StickersQueueEventType.UGC_USER_UPDATE,e)}}},440715:(e,t,s)=>{s.d(t,{StickersUGCStickerUpdate:()=>r});var i=s(530834);class r extends i.StickersQueueEvent{constructor(e){super(i.StickersQueueEventType.UGC_STICKER_UPDATE,e)}}},799285:(e,t,s)=>{s.d(t,{StickersUGCUserUpdate:()=>r});var i=s(530834);class r extends i.StickersQueueEvent{constructor(e){super(i.StickersQueueEventType.UGC_USER_UPDATE,e)}}},669146:(e,t,s)=>{var i;s.d(t,{VmojiQueueEvent:()=>r,VmojiQueueEventType:()=>i}),function(e){e.AVATAR="avatar",e.STICKERS="stickers",e.CHARACTER="character",e.STICKERS_PRINT_REQUEST="stickers_print_request"}(i||(i={}));class r extends CustomEvent{constructor(e,t){super(e,{detail:t})}}},405887:(e,t,s)=>{s.d(t,{handleVmojiQueueEvent:()=>r});var i=s(669146);function r(e,{data:t}){const{type:s,query_id:r}=t;r&&e.dispatchEvent(new i.VmojiQueueEvent(r,t)),e.dispatchEvent(new i.VmojiQueueEvent(s,t))}},339919:(e,t,s)=>{s.d(t,{Updates:()=>l,UpdatesSource:()=>i});var i,r,a,o=s(9374),n=s(773455),c=s(405887),h=s(552638),d=s(401423),u=s(427966);!function(e){e.USER="user",e.GROUP="group",e.VMOJI="vmoji",e.STICKERS="stickers"}(i||(i={})),function(e){e.CHECK="a_check",e.RELEASE="a_release"}(r||(r={})),function(e){e.NEED_RESTART="NEED_RESTART",e.POLLING_REQUEST_FAILED="POLLING_REQUEST_FAILED"}(a||(a={}));class l extends n.EventDispatcher{async start(){if(!this.started){this.started=!0;try{const e=await this.getLongPollServer();if(!e)return;const{server:t,key:s,ts:a}=e;switch(0===this.ts&&(this.ts=a),this.url=new URL(t),this.url.searchParams.set("key",s),this.url.searchParams.set("act",r.CHECK),this.url.searchParams.set("wait","25"),this.url.searchParams.set("mode",String(this.mode)),this.url.searchParams.set("version",String(u.POLLING_VERSION)),this.source){case i.VMOJI:case i.STICKERS:this.url.searchParams.set("id",String(this.userId))}this.startFetchLoop()}catch(e){throw this.started=!1,e}}}async getLongPollServer(){let e;switch(this.source){case i.GROUP:e=await this.api.groups.getLongPollServer({group_id:this.groupId});break;case i.VMOJI:case i.STICKERS:e=await this.api[this.source].subscribeToQueue().then((({base_url:e,...t})=>({server:e,...t})));break;default:return}const{server:t}=e;return e.server=`${t.startsWith("https")?"":"https://"}${t}`,e}async stop(){this.started=!1,this.restarted=0}async startFetchLoop(){try{for(;this.started;)await this.fetchUpdates()}catch(e){if(e.code!==a.NEED_RESTART&&this.restarted!==this.retryLimit)return this.restarted+=1,await(0,d.wait)(3e3),void this.startFetchLoop();for(;this.started;)try{await this.stop(),await this.start();break}catch(e){console.log(e),this.started=!0,await(0,d.wait)(this.wait)}}}async fetchUpdates(){this.url.searchParams.set("ts",String(this.ts));const e=new AbortController,t=setTimeout((()=>e.abort()),3e4);let s;try{const t=await fetch(this.url,{method:"GET",signal:e.signal,headers:{connection:"keep-alive"}});if(!t.ok)throw new o.UpdatesError({code:a.POLLING_REQUEST_FAILED,message:"Polling request failed"});s=await t.json()}finally{clearTimeout(t)}if(void 0!==s.failed){if(1===s.failed)return void(this.ts=s.ts);throw this.ts=0,new o.UpdatesError({code:a.NEED_RESTART,message:"The server has been failed"})}this.restarted=0,this.ts=s.ts,s.pts&&(this.pts=Number(s.pts)),s.updates=s.updates||s.events||[];for(const e of s.updates)this.handleUpdate(e)}handleUpdate(e){switch(this.source){case i.VMOJI:(0,c.handleVmojiQueueEvent)(this,e);break;case i.STICKERS:(0,h.handlerStickersQueueEvent)(this,e)}}constructor(e,t={}){super(),this.mode=202,this.started=!1,this.ts=0,this.pts=0,this.restarted=0,this.api=e;const{source:s,userId:i,groupId:r,wait:a,retryLimit:o}=t;this.source=s,this.userId=i,this.groupId=r,this.wait=a||3e3,this.retryLimit=o||3}}},891317:(e,t,s)=>{function i(e){const t="abcdefghijklmnopqrstuvwxyz";let s="";for(let i=0;i<e;i++)s+=t.charAt(Math.floor(26*Math.random()));return s}s.d(t,{generateId:()=>i})},881829:(e,t,s)=>{var i;s(363476);!function(e){e.WALL="wall",e.DOCS="docs",e.STATS="stats",e.VIDEO="video",e.PAGES="pages",e.NOTES="notes",e.MANAGE="manage",e.MARKET="market",e.PHOTOS="photos",e.STATUS="status",e.GROUPS="groups",e.OFFLINE="offline",e.STORIES="stories",e.FRIENDS="friends",e.MESSAGES="messages",e.APP_WIDGET="app_widget"}(i||(i={}))},24754:(e,t,s)=>{function i(e){return`return [${e.join(",")}];`}s.d(t,{getChainReturn:()=>i})},249109:(e,t,s)=>{s.d(t,{getExecuteMethod:()=>r});var i=s(435417);function r(e,t={}){return`API.${e}(${(0,i.getExecuteParams)(t)})`}},435417:(e,t,s)=>{function i(e){return JSON.stringify(e,((t,s)=>"object"==typeof s&&s!==e?String(s):s))}s.d(t,{getExecuteParams:()=>i})},338696:(e,t,s)=>{s(222414),s(933524),s(401423)},271826:(e,t,s)=>{function i(){const e=Math.pow(2,32)/2-1;return Math.floor(Math.random()*e)}s.d(t,{getRandomId:()=>i})},257950:(e,t,s)=>{function i(e,t){let s=0;t.response.forEach(((i,r)=>{const a=e[r];!1===i?(a.reject(t.errors[s]),s++):a.resolve(i)}))}s.d(t,{resolveExecuteTask:()=>i})},401423:(e,t,s)=>{function i(e){return new Promise((t=>{setTimeout(t,e)}))}s.d(t,{wait:()=>i})},946832:(e,t,s)=>{s.d(t,{ParallelWorker:()=>n});var i=s(330110),r=s(826214),a=s(24754),o=s(257950);class n extends r.SequentialWorker{async execute(){const{queue:e}=this;if(this.isAllowedMethod(e[0].method))return void super.execute();const{executeCount:t}=this.api.options,s=[];for(let i=0;i<this.queue.length&&(this.isAllowedMethod(e[i].method)||(s.push(e.splice(i,1)[0]),i-=1,!(s.length>=t)));i+=1);if(0===s.length)return;const r=new i.APIRequest({api:this.api,method:"execute",params:{code:(0,a.getChainReturn)(s.map(String))}});super.execute(r);try{(0,o.resolveExecuteTask)(s,await r.promise)}catch(e){for(const t of s)t.reject(e)}}isAllowedMethod(e){return e.startsWith("execute")||this.api.options.executeUnsupportedMethods.includes(e)}}},826214:(e,t,s)=>{s.d(t,{SequentialWorker:()=>h});var i=s(261311),r=s(659533),a=s(222414),o=s(453089),n=s(401423),c=s(427966);class h extends r.APIWorker{async execute(e){if(e||(e=this.queue.shift()),!e)return;const{method:t}=e;let s;try{s=await e.make()}catch(t){const{options:s}=this.api;return e.retries===s.limit?(e.captchaValidate?.reject(t),void e.reject(t)):(e.retries+=1,await(0,n.wait)(s.wait),void this.requeue(e))}void 0===s.error?(e.captchaValidate?.resolve(),t.startsWith("execute")?e.resolve({response:s.response,errors:(s.execute_errors||[]).map((e=>new o.ExecuteError(e)))}):e.resolve(s.response??s)):this.handleError(e,new a.APIError(s.error))}async handleError(e,t){const{code:s}=t,{options:r}=this.api;if(e.retries!==r.limit){if(e.retries+=1,s===i.API_ERROR_TOO_MANY)return this.paused?void this.requeue(e):(this.pause(),await(0,n.wait)(c.MINIMUM_TIME_INTERVAL_API),this.requeue(e),void this.resume());if(e.captchaValidate?.reject(t),e.tokenRegenerateValidate?.reject(t),s===i.API_ERROR_CAPTCHA&&this.api.hasCaptchaHandler)try{const{captchaSid:s}=t,{key:i,validate:r}=await this.api.processingCaptcha({type:c.CaptchaType.API,src:t.captchaImg,sid:s,request:e});e.captchaValidate=r,e.params.captcha_sid=s,e.params.captcha_key=i,this.requeue(e)}catch(t){e.reject(t)}else if(s===i.API_ERROR_AUTH&&this.api.hasTokenRegenerateHandler)try{const{token:t,validate:s}=await this.api.processingTokenRegenerate();this.api.options.token=t,e.tokenRegenerateValidate=s,await(0,n.wait)(c.MINIMUM_TIME_INTERVAL_API),this.requeue(e)}catch(t){e.reject(t)}else e.reject(t)}else e.reject(t)}}},659533:(e,t,s)=>{s.d(t,{APIWorker:()=>r});var i=s(427966);class r{enqueue(e){this.queue.push(e),this.immediateHeat()}requeue(e){this.queue.unshift(e),this.immediateHeat()}pause(){this.paused=!0}resume(){this.paused=!1,this.immediateHeat()}heat(){if(this.paused||this.busy||!this.queue.length)return;this.busy=!0;const{requestMode:e}=this.api.options;this[e]()}sequential(){this.execute(),setTimeout((()=>{this.busy=!1,this.immediateHeat()}),this.intervalPerRequests)}burst(){const e=Math.min(this.api.options.limit,this.queue.length);for(let t=0;t<e&&0!==this.queue.length;t+=1)this.execute();const t=Math.ceil(i.MINIMUM_TIME_INTERVAL_API-e*this.intervalPerRequests);setTimeout((()=>{this.busy=!1,this.immediateHeat()}),t<=0?i.MINIMUM_TIME_INTERVAL_API:t)}immediateHeat(){setTimeout((()=>this.heat()))}constructor(e){this.busy=!1,this.paused=!1,this.queue=[],this.api=e,this.intervalPerRequests=Math.ceil(i.MINIMUM_TIME_INTERVAL_API/this.api.options.limit)}}},506327:(e,t,s)=>{s.d(t,{AsyncAtom:()=>a});var i=s(891047),r=s(436753);class a extends r.Atom{async get(){const e=this.getKey();try{return await(0,i.get)(e,this.base.store)||this.cache||null}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}async set(e,t){const s=this.getKey();try{await(0,i.set)(s,e,this.base.store)}catch(t){console.log(`${s}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}async delete(){const e=this.getKey();delete this.cache;try{await(0,i.del)(e,this.base.store),this.base.notify(this.key)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}constructor(e){super(e);const{base:t}=e;this.base=t}}},82490:(e,t,s)=>{s.d(t,{createAsyncStore:()=>n});var i=s(891047),r=s(227897),a=s(506327);class o extends r.Store{createAtom(e){return new a.AsyncAtom({key:e,base:this})}async clear(){await(0,i.clear)(this.store),this.notify()}constructor(e){super(e);const{dbName:t,version:s}=e;try{this.store=(0,i.createStore)(`${t}-v${s}`,t)}catch{}}}function n(e){return new o(e)}},779434:(e,t,s)=>{s.d(t,{$api:()=>c,APIGate:()=>h,changeAPIOptions:()=>n});var i=s(798116),r=s(504190),a=s(643060),o=s(467702);const n=a.stickersEmojiKeyboard.createEvent(),c=a.stickersEmojiKeyboard.createStore(new o.API({})).on(n,((e,{api:t})=>t)),h=(0,r.createGate)();(0,i.forward)({from:h.state,to:n})},805280:(e,t,s)=>{var i,r;s.d(t,{AtomNameByHelpHintId:()=>n,AtomNameByPromoId:()=>h,AvatarSuggestionAtomName:()=>a,HelpHintAtomNames:()=>o,HelpHintIdTypes:()=>i,HelpHintPromoTypes:()=>r}),function(e){e.VMOJI_AVATAR_SUGGESTION="keyboard:stickers_vmoji_avatar_suggestion"}(i||(i={})),function(e){e.VMOJI_AVATAR_SUGGESTION="vmoji_avatar_suggestion_stickers_keyboard_hint"}(r||(r={}));const a="avatarSuggestion",o=[a],n={[i.VMOJI_AVATAR_SUGGESTION]:a},c="newAvatarSuggestionCounter",h={[r.VMOJI_AVATAR_SUGGESTION]:c}},467702:(e,t,s)=>{s.d(t,{API:()=>n});var i=s(413151),r=s(519785),a=s(339627),o=s(357137);class n extends i.API{constructor({onAPIRequest:e,language:t,...s}){const{userId:n}=s;super({requestMethod:e,language:t},{userId:n,source:"stickers"}),this.cache=new r.Cache({api:this,...s}),this.updates.addEventListener(i.StickersQueueEventType.UGC_OWNER_UPDATE,a.stickersUGCOwnerUpdateHandler.bind(this)),this.updates.addEventListener(i.StickersQueueEventType.UGC_STICKER_UPDATE,o.stickersUGCStickerUpdateHandler.bind(this))}}},339627:(e,t,s)=>{function i({detail:{owner_global_id:e}}){this.cache.reloadUGC(e)}s.d(t,{stickersUGCOwnerUpdateHandler:()=>i})},357137:(e,t,s)=>{s.d(t,{stickersUGCStickerUpdateHandler:()=>a});const i=new Map,r=new Set;async function a({detail:{stickers:e}}){const{peerId:t}=this.cache.options;e.forEach((e=>{if(e.owner_id!==t)return;let s=i.get(t);s||(s=[],i.set(t,s));const r=s.findIndex((t=>t.id===e.id&&t.pack_id===e.pack_id&&t.owner_id===e.owner_id));-1!==r?s[r]=e:s.push(e)})),o.call(this)}async function o(){const{peerId:e}=this.cache.options;if(!e||r.has(e))return;const t=i.get(e);if(!t?.length)return;r.add(e),i.delete(e);const s=await this.cache.ugcPacks.get();if(!s?.length)return;const a=new Map(s.map((e=>[e.id,e])));t.forEach((e=>{const{id:t,pack_id:s}=e;if(void 0===s)return;const i=a.get(s);if(!i)return;const r=i.stickers.findIndex((e=>e.id===t));-1!==r&&(i.stickers[r]=e)}));try{await this.cache.ugcPacks.set(s)}catch{}r.delete(e),o.call(this)}},126892:(e,t,s)=>{async function i(){let e=null;try{e=(await this.options.api.store.getFavoriteStickers()).items}catch{}return!!e&&(await this.favoriteStickers.set(e),!0)}s.d(t,{reloadFavoriteStickers:()=>i})},541592:(e,t,s)=>{async function i(){var e;if(this.reloading)return!0;this.setReloading(!0);const t=await this.global.get();let[s,i,r]=await Promise.all([this.options.api.store.hasNewItems({type:"stickers",version_hash:String(t?.stickers_version_hash)}).catch((()=>null)),this.stockItems.get(),this.imageConfigs.get()]);if(!s)return this.setReloading(!1),!1;(e=s).sticker_packs_version_hashes||(e.sticker_packs_version_hashes=t?.sticker_packs_version_hashes);const{stickers_version_hash:a,sticker_packs_version_hashes:o,favorite_stickers_version_hash:n,image_configs_version_hash:c,sticker_packs_chunk_size_limit:h,vmoji_promotion:d}=s;a!==t?.stickers_version_hash&&(i=null,this.stickersListAsync.clear());const u=[this.reloadStockItems({cachedStockItems:i,actualPacksHashes:o,chunkSize:h}),this.reloadUGC(),this.reloadVmoji(),this.reloadRecentStickers()];n!==t?.favorite_stickers_version_hash&&u.push(this.reloadFavoriteStickers()),r&&c===t?.image_configs_version_hash||u.push(this.reloadImageConfigs());const l=!d?.avatar_suggestion?.character_id;!l&&d?.avatar_suggestion?.character_id!==t?.vmoji_promotion?.avatar_suggestion?.character_id?u.push(this.reloadHelpHint()):l&&this.clearAllHelpHint();const p=await Promise.all(u);this.setReloading(!1);const m=-1===p.findIndex((e=>!e));return m&&s&&(this.global.set(s),this.stickersSync.notify(void 0,!0)),m}s.d(t,{reloadGlobal:()=>i})},612475:(e,t,s)=>{s.d(t,{clearAllHelpHint:()=>a,clearHelpHintById:()=>r});var i=s(805280);function r(e){this[i.AtomNameByHelpHintId[e]]?.delete()}function a(){i.HelpHintAtomNames.forEach((e=>this[e].delete()))}},60629:(e,t,s)=>{async function i(e){this.clearHelpHintById(e);try{const t=await this.options.api.account.hideHelpHint({hint_id:e});return Boolean(t)}catch(e){return!1}}s.d(t,{hideHelpHint:()=>i})},701196:(e,t,s)=>{s.d(t,{reloadHelpHint:()=>r});var i=s(805280);async function r(){let e=i.HelpHintAtomNames.slice(),t=null;try{t=await this.options.api.account.getHelpHints({categories:"vmoji_promo"})}catch{}return t?.items?(t.items.forEach((t=>{const s=t.id,r=i.AtomNameByHelpHintId[s];r in this&&(this[r]?.set(t,{notify:!0}),e=e.filter((e=>e!==r)))})),e.forEach((e=>{this[e].delete()})),!0):(this.clearAllHelpHint(),!0)}},851375:(e,t,s)=>{s.d(t,{markHelpHintAsViewed:()=>a});var i=s(805280);const r=(0,s(659397).throttle)((function(e,t,s){e.options.api.stickers.markPromoAsViewed({promo_id:t,count:s}).then((s=>{if(s){e[i.AtomNameByPromoId[t]].set(0)}}))}),3e4);function a(e){const t=this[i.AtomNameByPromoId[e]],s=(t?.get()||0)+1;t.set(s),r(this,e,s)}},764728:(e,t,s)=>{async function i(){let e=null;try{e=await this.options.api.store.getStickersImageConfigs()}catch{}return!!e&&(this.imageConfigs.set(e),!0)}s.d(t,{reloadImageConfigs:()=>i})},124841:(e,t,s)=>{async function i(){let e=null;try{e=(await this.options.api.messages.getRecentStickers()).items}catch{}return e&&this.recentStickers.set(e),!0}s.d(t,{reloadRecentStickers:()=>i})},76558:(e,t,s)=>{async function i(e){const t=await Promise.all(e.map((e=>this.stickersListAsync.createAtom(String(e)).get())));if(!t.includes(null))return t;const s=new Map,i=t.reduce(((t,i,r)=>{if(!i){const i=e[r];t.push(i),s.set(i,r)}return t}),[]);return(await this.options.api.store.getStickers({sticker_ids:String(i)})).forEach((e=>{const{sticker_id:i}=e;if(!i)return;this.stickersListAsync.createAtom(String(i)).set(e);const r=s.get(i);r&&(t[r]=e)})),t}s.d(t,{getStickers:()=>i})},704516:(e,t,s)=>{async function i({active:e}){let t=await this.stockItems.get();return t&&(t=t.sort((({product:{vmoji_avatar:e}},{product:{vmoji_avatar:t}})=>Number(Boolean(t))-Number(Boolean(e)))),e&&(t=t.filter((({product:e})=>e.active)))),t}s.d(t,{getStockItems:()=>i})},316535:(e,t,s)=>{async function i({productId:e,stickerId:t}){const s=await this.stockItems.get();let i;if(s&&(e&&(i=s.find((({product:{id:t}})=>t===e))),t&&!i&&(i=s.find((({product:{stickers:e}})=>e&&-1!==e.findIndex((({sticker_id:e})=>e===t)))))),i)return i;if(e)try{i=await this.options.api.store.getStockItemByProductId({type:"stickers",product_id:String(e)})}catch(e){i=void 0}if(i)return this.updateStockItems([i]),i;if(t)try{i=await this.options.api.store.getStockItemByStickerId({sticker_id:t})}catch(e){i=void 0}return i&&this.updateStockItems([i]),i}s.d(t,{loadStockItems:()=>i})},549976:(e,t,s)=>{s.d(t,{reloadStockItems:()=>a});var i=s(659397);const r=new Map;async function a({chunkSize:e=25,cachedStockItems:t,actualPacksHashes:s}){let a=r.get(this.stickersSync.key);a||(a=new Map,r.set(this.stickersSync.key,a));let o=t?.reduce(((e,{product:{id:t},version_hash:i})=>{const r=s?.find((({pack_id:e})=>e===t));if(!r)return e;return r.hash!==i&&e.push(t),e}),[]);const n=!o;if(n)try{const{items:e}=await this.options.api.store.getProducts({type:"stickers",filters:"active"});o=e.map((({id:e})=>e))}catch(e){o=void 0}if(!o?.length)return!0;this.stickersListAsync.clear();let c=await Promise.all((0,i.chunkArray)(o,e).map((e=>{const t=String(e);return a?.get(t)||this.options.api.store.getStockItems({type:"stickers",product_ids:t}).then((e=>(a?.set(t,e),e)))}))).then((e=>e.reduce(((e,{items:t})=>(e.push(...t),e)),[]).filter((e=>!Array.isArray(e))))).catch((()=>null));if(!c)return!1;if(t?.length){const e=new Map(c.map((e=>[e.product.id,e])));c=t=t.map((t=>e.get(t.product.id)||t))}return c&&o&&n&&(c=c.sort((({product:{id:e}},{product:{id:t}})=>Number(o?.indexOf(e))-Number(o?.indexOf(t))))),await this.stockItems.set(c),r.delete(this.stickersSync.key),!0}},366448:(e,t,s)=>{async function i(e,t){let s=await this.stockItems.get();if(s){const t=new Map(s.map((e=>{const{product:{id:t}}=e;return[t,e]})));e.forEach((e=>{const{product:{id:s}}=e;t.set(s,e)})),s=[...t.values()]}return this.stockItems.set(s||e,t)}s.d(t,{updateStockItems:()=>i})},481101:(e,t,s)=>{function i(){this.ugcInfo.delete(),this.ugcPacks.delete()}s.d(t,{clearUGC:()=>i})},258001:(e,t,s)=>{async function i(){const e=await this.ugcInfo.get();if(!e?.show_keyboard_onboarding)return!1;const{owner_id:t}=e;e.show_keyboard_onboarding=!1,this.ugcInfo.set(e);try{const e=await this.options.api.stickers.hideUGCKeyboardOnboarding({owner_id:t});return Boolean(e)}catch(e){return!1}}s.d(t,{hideUGCOnboarding:()=>i})},389414:(e,t,s)=>{s.d(t,{reloadUGC:()=>a});var i=s(688538),r=s(216608);async function a(e){if(!(0,r.isUgcStickersEnabled)())return this.clearUGC(),!0;const{peerId:t}=this.options;if(!t||!i.Ranges.isChatOrChannelPeer(t))return!0;const s=await this.ugcPacks.get();let a;try{a=(await this.options.api.stickers.getUGCPackLists({owner_ids:String(t),owner_global_ids:e})).lists[0]}catch{}if(!a)return this.ugcInfo.delete(),this.ugcPacks.delete(),!0;this.ugcInfo.set(a);const{items:o}=a;if(!o.length)return this.ugcPacks.delete(),!0;const n=s?new Map(s.map((({id:e,hash:t})=>[e,t]))):void 0,c=o.reduce(((e,{pack_id:t,hash:s})=>{const i=n?.get(t);return i!==s&&e.push(t),e}),[]);if(!c.length)return!0;let h;try{h=(await this.options.api.stickers.getUGCPacks({owner_id:t,pack_ids:String(c)})).packs}catch{}return!h||(this.ugcPacks.set(h),!0)}},789749:(e,t,s)=>{async function i(){const e=await this.global.get();e?.vmoji_promotion&&(e.vmoji_promotion.dot_color=void 0,this.global.set(e,{notify:!1}))}s.d(t,{clearVmojiPromotionDot:()=>i})},441506:(e,t,s)=>{async function i(){if(this.hasAvatar.get())return!0;try{const e=await this.options.api.vmoji.getAvatar();this.hasAvatar.set(Boolean(e.characters?.length))}catch{}return!0}s.d(t,{reloadVmoji:()=>i})},519785:(e,t,s)=>{s.d(t,{Cache:()=>y});var i=s(307614),r=s(82490),a=s(289581),o=s(481101),n=s(389414),c=s(441506),h=s(76558),d=s(60629),u=s(541592),l=s(704516),p=s(701196),m=s(316535),g=s(549976),k=s(366448),v=s(851375),E=s(258001),f=s(764728),S=s(124841),_=s(789749),A=s(126892),I=s(612475);class y{subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}get reloading(){return this.isReloading}setReloading(e){this.isReloading=e}destroy(){this.stickersSync.destroy(),this.stickersAsync.destroy(),this.stickersListAsync.destroy()}constructor(e){this.isReloading=!1,this.listeners=new Set,this.reload=u.reloadGlobal.bind(this),this.reloadVmoji=c.reloadVmoji.bind(this),this.clearVmojiPromotionDot=_.clearVmojiPromotionDot.bind(this),this.getStockItem=m.loadStockItems.bind(this),this.getStockItems=l.getStockItems.bind(this),this.updateStockItems=k.updateStockItems.bind(this),this.reloadStockItems=g.reloadStockItems.bind(this),this.reloadUGC=n.reloadUGC.bind(this),this.clearUGC=o.clearUGC.bind(this),this.hideUGCOnboarding=E.hideUGCOnboarding.bind(this),this.reloadRecentStickers=S.reloadRecentStickers.bind(this),this.reloadFavoriteStickers=A.reloadFavoriteStickers.bind(this),this.reloadImageConfigs=f.reloadImageConfigs.bind(this),this.getStickers=h.getStickers.bind(this),this.reloadHelpHint=p.reloadHelpHint.bind(this),this.clearHelpHintById=I.clearHelpHintById.bind(this),this.clearAllHelpHint=I.clearAllHelpHint.bind(this),this.hideHelpHint=d.hideHelpHint.bind(this),this.markHelpHintAsViewed=v.markHelpHintAsViewed.bind(this);const{userId:t,peerId:s}=e;this.options=e;const y=(0,i.createSyncStore)({dbName:"stickers",storeName:String(t),version:1}),w=(0,r.createAsyncStore)({dbName:"stickers",storeName:String(t),version:1}),P=(0,r.createAsyncStore)({dbName:"stickers-list",storeName:String(t),version:1});this.stickersSync=y,this.stickersAsync=w,this.stickersListAsync=P,this.global=w.createAtom("global"),this.stockItems=w.createAtom("stockItems"),this.imageConfigs=w.createAtom("imageConfigs"),this.recentStickers=w.createAtom("recentStickers"),this.favoriteStickers=w.createAtom("favoriteStickers"),this.avatarSuggestion=w.createAtom("avatarSuggestion"),this.hasAvatar=y.createAtom("hasAvatar",a.SyncAtomType.BOOLEAN),this.recentEmoji=y.createAtom("recentEmoji",a.SyncAtomType.OBJECT),this.tabbarActiveTab=y.createAtom("tabbarActiveTab",a.SyncAtomType.STRING),this.stickersActiveTab=y.createAtom("stickersActiveTab",a.SyncAtomType.NUMBER),this.newAvatarSuggestionCounter=y.createAtom("newAvatarSuggestionCounter",a.SyncAtomType.NUMBER);const b=(0,r.createAsyncStore)({dbName:"stickers-ugc",storeName:`${t}-${s}`,version:1});this.ugcAsync=b,this.ugcInfo=b.createAtom("ugcInfo"),this.ugcPacks=b.createAtom("ugcPacks"),this.getStickersImageConfigs=this.imageConfigs.get.bind(this.imageConfigs)}}},216608:(e,t,s)=>{s.d(t,{isPopUpStickersEnabled:()=>n,isPromoVmojiCounterEnabled:()=>o,isUgcStickersEnabled:()=>a});var i=s(536253);function r(e){return Boolean(i.$userEnv.getState()[e])}const a=()=>r("stickers.ugc"),o=()=>r("vmoji.promo.avatar_suggestion.promo_counter"),n=()=>r("stickers.popup")}}]);try{stManager.done("dist/web/chunks/782f47a3.36942bf9.js")}catch(e){}