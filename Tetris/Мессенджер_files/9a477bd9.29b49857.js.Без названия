"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[41674],{861184:(e,t,s)=>{s.d(t,{default:()=>n});const n={counter:"BadgeCounter-module__counter--ZG07d"}},430935:(e,t,s)=>{s.d(t,{default:()=>n});const n={wrapper:"BadgeItem-module__wrapper--UDxg1"}},838455:(e,t,s)=>{s.d(t,{default:()=>n});const n={root:"BadgeItems-module__root--MdiCD"}},565293:(e,t,s)=>{s.d(t,{default:()=>n});const n={items:"BadgesOwnerBlockSkeleton-module__items--b27KV"}},259688:(e,t,s)=>{s.d(t,{default:()=>n});const n={card:"BadgesOwnerInfoCard-module__card--1VfEo",preview:"BadgesOwnerInfoCard-module__preview--xOjSA",title:"BadgesOwnerInfoCard-module__title--J0JB9",description:"BadgesOwnerInfoCard-module__description--jpXGI",users:"BadgesOwnerInfoCard-module__users--ylWIJ"}},368079:(e,t,s)=>{s.d(t,{default:()=>n});const n={items:"BadgesOwnerInfoModal-module__items--_C8HX",counter:"BadgesOwnerInfoModal-module__counter--dcVke",layout:"BadgesOwnerInfoModal-module__layout--H96gr",body:"BadgesOwnerInfoModal-module__body--xEx7W",settings:"BadgesOwnerInfoModal-module__settings--Cxf6L",previewItems:"BadgesOwnerInfoModal-module__previewItems--wFB2n",previewItem:"BadgesOwnerInfoModal-module__previewItem--pGWtg"}},395595:(e,t,s)=>{s.d(t,{Cache:()=>i});var n,a,r=s(891047);!function(e){e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number"}(n||(n={})),function(e){e.HELP_HINTS="helpHints"}(a||(a={}));class i{getHelpHints(){return this.getItem(a.HELP_HINTS)}setHelpHints(e){return this.setItem(a.HELP_HINTS,e)}clear(){return(0,r.clear)(this.store)}async getItem(e){const t=this.buildItemKey(e),s=i.cache.get(t);return(0,r.get)(t,this.store).then((e=>e||s)).catch((()=>s))}async setItem(e,t){const s=this.buildItemKey(e);i.cache.set(s,t),await(0,r.set)(s,t,this.store).catch((()=>{}))}deleteItem(e){const t=this.buildItemKey(e);return(0,r.del)(t,this.store)}buildItemKey(e){return`${e}-${i.VERSION}-${this.userId}`}getItemSync(e,t){const s=this.buildSyncItemKey(e);try{let e=localStorage.getItem(s);if(!e)return;switch(t){case n.OBJECT:try{e=JSON.parse(e)}catch{return}break;case n.NUMBER:e=Number(e)||0;break;case n.STRING_NUMBER:e=Number(e)||e;break;case n.BOOLEAN:e=Boolean(Number(e))}return e}catch{return i.cache.get(s)}}setItemSync(e,t,s){const a=this.buildSyncItemKey(e);switch(s){case n.OBJECT:t=JSON.stringify(t);break;case n.BOOLEAN:t=String(Number(t))}try{localStorage.setItem(a,t)}catch{i.cache.set(a,t)}}buildSyncItemKey(e){return`${i.DB_NAME}_${e}_${i.VERSION}_${this.userId}`}constructor({userId:e=window.vk?.id,categories:t}={}){this.userId=e||0;let s="cache";t?.length&&(s=`${s}-${t.join("-")}`),this.store=(0,r.createStore)(i.DB_NAME,s)}}i.DB_NAME="help-hints",i.VERSION=1,i.CACHE_UPDATE_EVENT_NAME=`${i.DB_NAME}_cache_update`,i.cache=new Map},822257:(e,t,s)=>{s.d(t,{HelpHint:()=>n});class n{get id(){return this.hint.id}get title(){return this.hint.title}get description(){return this.hint.description}getResource(e){return this.hint.resources?.find((({key:t})=>t===e))?.value}constructor(e){this.hint=e}}},717731:(e,t,s)=>{s.d(t,{HelpHints:()=>d});var n=s(413151),a=s(166695),r=s(822257),i=s(395595),o=s(650640);class d{static setAPI(e){this.api=e}static setUserId(e){this.cacheOptions.userId=e,this.cache=void 0}static setCategories(e){Array.isArray(e)||(e=[e]),this.cacheOptions.categories=e,this.cache=void 0}static async get(e){return await this.reload(),this.getSync(e)}static getSync(e){const t=this.helpHints?.items.find((({id:t})=>t===e));if(t)return new r.HelpHint(t)}static show(e){return e instanceof r.HelpHint&&(e=e.id),this.api.account.showHelpHint({hint_id:e})}static async hide(e){e instanceof r.HelpHint&&(e=e.id);let t=!1;return await this.reloading,this.helpHints&&(this.helpHints.items=this.helpHints.items.filter((({id:s})=>(s===e&&(t=!0),s!==e))),this.cache?.setHelpHints(this.helpHints)),t?this.api.account.hideHelpHint({hint_id:e}):Promise.resolve()}static async getResource(e,t){const s=await this.get(e);if(s)return s.getResource(t)}static async reload(){return await this.reloading,this.cache||(this.cache=new i.Cache(this.cacheOptions)),this.reloading=new Promise((async e=>{if(!this.api.options.token&&"function"!=typeof this.api.options.requestMethod){const t=await this.getAccessToken();if(!t)return e();this.api=new n.API({token:t}),this.api.onTokenRegenerate((async t=>{const s=await this.getAccessToken();if(!s)return e();t(s)}))}if(this.helpHints=await(this.cache?.getHelpHints()),this.helpHints&&Date.now()-this.helpHints.date<o.TEN_MINUTES&&!this.isDevMode())return e();const{categories:t}=this.cacheOptions;this.helpHints=await this.api.account.getHelpHints({categories:t?String(t):void 0}).then((e=>({...e,date:Date.now()}))).catch((()=>{})),await(this.cache?.setHelpHints(this.helpHints)),this.refresh(),e()})),this.reloading}static refresh(){try{localStorage.setItem(i.Cache.CACHE_UPDATE_EVENT_NAME,""),localStorage.removeItem(i.Cache.CACHE_UPDATE_EVENT_NAME)}catch{}}static async getAccessToken(){const e=await(0,a.login)("web_token").catch((()=>{}));if(!e)return;const{access_token:t}=e;return t}}d.api=new n.API({token:""}),d.cacheOptions={},d.reloading=Promise.resolve(),d.isDevMode=()=>localStorage.getItem("help-hints-dev"),window.addEventListener("storage",(({key:e,newValue:t})=>{e===i.Cache.CACHE_UPDATE_EVENT_NAME&&null!==t&&d.reload()}))},952258:(e,t,s)=>{var n,a;s.d(t,{HelpHintId:()=>a}),function(e){e.DEFAULT="default",e.STICKERS_UGC="stickers_ugc"}(n||(n={})),function(e){e.KEYBOARD_STICKERS_VMOJI="keyboard:stickers_vmoji",e.POSTING_POST_FEED_BADGES="posting:post_feed_badges",e.POSTING_POST_BADGES_ONBOARDING="posting:post_badges_onboarding",e.POSTING_POST_FEED_BADGES_UNSEEN="posting:post_feed_badges_unseen",e.POSTING_POST_BADGES_PAGE_UNSEEN="posting:post_badges_page_unseen",e.POSTING_POST_BADGES_CATALOG_USER="posting:post_badges_catalog_user",e.POSTING_POST_BADGES_FEEDBACK_USER="posting:post_badges_feedback_user",e.POSTING_POST_BADGES_FEEDBACK_USER_UNSEEN="posting:post_badges_feedback_user_unseen",e.STICKERS_UGC_SETTINGS_UNSEEN="stickers:ugc_settings_unseen",e.STICKERS_UGC_KEYBOARD_ONBOARDING="stickers:ugc_keyboard_onboarding",e.STICKERS_UGC_APP_ONBOARDING_MODAL="stickers:ugc_app_onboarding_modal",e.STICKERS_UGC_KEYBOARD_ONBOARDING_TOOLTIP="stickers:ugc_keyboard_onboarding_tooltip"}(a||(a={}))},650640:(e,t,s)=>{s.d(t,{TEN_MINUTES:()=>n});const n=6e5},38114:(e,t,s)=>{s.d(t,{WebStatEvents:()=>i});var n=s(166695),a=s(413151),r=s(400643);const i=new class{setAPI(e){this.api=e}setUserId(e){this.userId=e}async add(e){var t,s,n,i;(await this.init(),(t=e).id??(t.id=(0,a.getRandomId)()),(s=e).prev_id??(s.prev_id=this.previousEvent?.id),(n=e).timestamp??(n.timestamp=String((0,r.nowMicroseconds)())),"undefined"!=typeof window)&&((i=e).url??(i.url=window.location.href));e.type_navgo&&this.previousNavigationEvent&&(e.type_navgo.prev_navgo_id=this.previousNavigationEvent.id,e.type_navgo.prev_navgo_timestamp=this.previousNavigationEvent.timestamp),this.previousEvent=e,e.type_navgo&&(this.previousNavigationEvent=e),this.queue.add(e),this.send()}async init(){if(this.initialized)return;if(this.initialized=!0,this.api)return;const e=await(0,n.login)("web_token").catch((()=>{}));if(!e)return void(this.initialized=!1);const{access_token:t}=e;this.api=new a.API({token:t}),this.api.onTokenRegenerate((async e=>{const t=await(0,n.login)("web_token").catch((()=>{}));if(!t)return void(this.initialized=!1);const{access_token:s}=t;e(s)}))}send(){this.api&&this.queue.size&&(this.api.statEvents.addWeb({events:JSON.stringify([...this.queue.values()]),user_id:this.userId}),this.queue.clear())}constructor(){this.userId="undefined"!=typeof window&&window.vk?.id||0,this.queue=new Set,this.initialized=!1}}},400643:(e,t,s)=>{s.d(t,{nowMicroseconds:()=>a});const n=performance.timeOrigin||performance.timing.navigationStart||Date.now();function a(){return Math.floor(1e3*(n+performance.now()))}},4483:(e,t,s)=>{s.d(t,{useUniqId:()=>r});var n=s(667294),a=s(659397);function r(){return`:r${(0,n.useRef)((0,a.getRandomString)(6)).current}:`}},593163:(e,t,s)=>{s.d(t,{getUserFullName:()=>n});const n=e=>{const{first_name:t,last_name:s}=e;return`${t} ${s}`}},714332:(e,t,s)=>{s.d(t,{BadgeCounter:()=>i});var n=s(785893),a=s(86894),r=s(861184);const i=({...e})=>(0,n.jsx)(a.Counter,{className:r.default.counter,mode:"inherit",...e})},375050:(e,t,s)=>{s.d(t,{BadgeSenderItem:()=>u});var n=s(785893),a=s(846539),r=s(493829),i=s(38114),o=s(877926),d=s(636322),c=s(629309),l=s(593163),g=s(796299);function u({entry:e,user:{id:t,first_name:s,last_name:u,domain:h,photo_100:_,photo_200:p},...b}){const B=(0,l.getUserFullName)({first_name:s,last_name:u}),w=((0,d.isRetina)()?p:_)||_||"";let m=null;return e.object_description&&(m=(0,c.parseReactWikiLinks)(e.object_description,{target:"_blank"})),m=(0,n.jsxs)(n.Fragment,{children:[m,(0,n.jsx)("br",{}),e.is_private&&o.getLang("awards_private_text")]}),(0,n.jsx)(a.RichCell,{before:(0,n.jsx)(r.Avatar,{size:100,src:w,title:B}),caption:m,href:h?`/${h}`:void 0,target:"_blank",onClick:()=>{i.WebStatEvents.add({screen:"badge",type:"type_click",type_click:{type:"type_badges_screen_item",item:{type:"badges",id:t},type_badges_screen_item:{type_badges_event:{event_name:g.BadgesEventName.OPEN_SENDER}}}})},...b,children:B})}},242535:(e,t,s)=>{s.d(t,{BadgeItem:()=>g,BadgeItemWrapper:()=>l});var n=s(785893),a=s(383147),r=s(772418),i=s(93977),o=s(796299),d=s(714332),c=s(430935);const l=({children:e})=>(0,n.jsx)("div",{className:c.default.wrapper,children:e}),g=({badge:e,counter:t,onClick:s})=>{if(!e)return null;const c=(0,i.getBadgeImage)(e.image,o.BADGE_IMAGE_SIZE_128);return(0,n.jsx)(l,{children:(0,n.jsx)(a.RichImage,{src:c,size:56,withBorder:!1,transparent:!0,onClick:()=>s(e.id),children:(0,n.jsx)(r.Image.Badge,{children:(0,n.jsx)(d.BadgeCounter,{size:"s",children:t})})})})}},393023:(e,t,s)=>{s.d(t,{BadgeItems:()=>d});var n=s(785893),a=s(667294),r=s(86894),i=s(242535),o=s(838455);const d=({counters:e,badges:t,onBadgeClick:s})=>{const d=(0,a.useMemo)((()=>(e?.filter((e=>"total"!==e.type))||[]).map((({value:e,badge_id:a})=>{if(!a)return null;const r=t.find((({id:e})=>a===e));return(0,n.jsx)(i.BadgeItem,{counter:e,badge:r,onClick:s},a)}))),[e,t,s]);return(0,n.jsx)(r.HorizontalScroll,{arrowSize:"m",children:(0,n.jsx)("div",{className:o.default.root,tabIndex:0,role:"button",children:d})})}},983756:(e,t,s)=>{s.d(t,{BadgesOwnerBlockSkeleton:()=>u});var n=s(785893),a=s(667294),r=s(902379),i=s(806660),o=s(249779),d=s(659397),c=s(242535),l=s(565293);const g=(0,d.createArray)(4),u=e=>{const t=(0,a.useMemo)((()=>g.map(((e,t)=>(0,n.jsx)(c.BadgeItemWrapper,{children:(0,n.jsx)(r.Skeleton,{width:56,height:56,circle:!0})},t)))),[56,4]);return(0,n.jsx)(i.Group,{header:(0,n.jsx)(o.Header,{children:(0,n.jsx)(r.Skeleton,{width:192})}),...e,children:(0,n.jsx)("div",{className:l.default.items,children:t})})}},712113:(e,t,s)=>{s.d(t,{BadgesOwnerInfoCard:()=>_});var n=s(785893),a=s(86894),r=s(383147),i=s(772418),o=s(990460),d=s(942205),c=s(471828),l=s(93977),g=s(796299),u=s(714332),h=s(259688);const _=({badge:e,counter:t,recentSenderUsers:s,sendersCount:_,onClick:p})=>{const b=s?.slice(0,3).map((({photo_200:e})=>String(e)));return(0,n.jsxs)(a.Tappable,{className:h.default.card,onClick:p,children:[(0,n.jsx)(r.RichImage,{className:h.default.preview,"aria-label":e.title,src:(0,l.getBadgeImage)(e.image,g.BADGE_IMAGE_SIZE_128),size:g.BADGE_IMAGE_SIZE_128,transparent:!0,withBorder:!1,children:(0,n.jsx)(i.Image.Badge,{children:(0,n.jsx)(u.BadgeCounter,{children:t})})}),(0,n.jsx)(o.Title,{className:h.default.title,level:"2",weight:"1",children:e.title}),(0,n.jsx)(o.Text,{className:h.default.description,weight:"3",children:e.description}),Boolean(s.length)&&(0,n.jsx)("div",{className:h.default.users,children:(0,n.jsx)(d.UsersStack,{size:"l",photos:b,children:c.getLang("awards_senders_count",_).replace("{count}",String(_))})})]})}},182897:(e,t,s)=>{s.d(t,{BadgesOwnerInfoModal:()=>T});var n=s(785893),a=s(667294),r=s(688538),i=s(189690),o=s(166695),d=s(38114),c=s(169447),l=s(784118),g=s(242453),u=s(480164),h=s(800856),_=s(113788),p=s(379956),b=s(383147),B=s(772418),w=s(990460),m=s(252797),I=s(60811),f=s(49169),S=s(712113),v=s(375050),E=s(410069),O=s(714332),y=s(261712),k=s(471828),N=s(93977),C=s(9376),j=s(57436),A=s(796299),L=s(963169),x=s(368079);class T extends a.Component{componentDidMount(){const{ownerId:e,eventRef:t,badgeId:s}=this.props,n=`${s?"open_badges_collection_badge":"open_badges_collection_all"}__${r.Ranges.isUserId(e)?"u":"c"}`;this.sendStatEvent(n,t),this.fetchOwnerInfo()}componentWillUnmount(){window.removeEventListener("online",this.fetchOwnerInfo),window.removeEventListener("online",this.fetchOwnerEntries)}componentDidUpdate(){const{currentBadgeId:e}=this.state;e&&!this.getBadgeEntries(e)&&this.fetchOwnerEntries()}renderHeader(){const{isOwnerInfoLoaded:e,currentBadgeId:t,isAdmin:s}=this.state,{ownerId:a}=this.props;return(0,n.jsx)(g.ModalHeader,{closeAriaLabel:k.getLang("awards_back_button"),onClose:this.props.close,before:e&&t&&(0,n.jsxs)(u.ModalHeaderButton,{"aria-label":k.getLang("awards_back_button"),onClick:()=>this.selectBadge(null),children:[(0,n.jsx)(c.Icon20ChevronLeftOutline,{}),k.getLang("awards_back_button")]}),after:s&&(0,n.jsx)(h.Link,{className:x.default.settings,href:(()=>{const e=`${location.protocol}//${window.vk.host}`;let t;return r.Ranges.isGroupId(a)?(t=new URL(`public${Math.abs(a)}`,e),t.searchParams.set("act","sections")):(t=new URL("settings",e),t.searchParams.set("act","privacy"),t.searchParams.set("hl","badges")),t.toString()})(),target:"_blank",children:(0,n.jsx)(l.Icon20GearOutline,{})}),children:e&&!t?this.renderHeaderTitle():null})}renderHeaderTitle(){const{ownerId:e}=this.props,{totalCount:t}=this.state,s=t>0?(0,n.jsx)("span",{className:x.default.counter,children:t}):null;let a="";return a=e===window.vk.id?k.getLang("awards_my_badges"):r.Ranges.isGroupId(e)?k.getLang("awards_group_block_header"):k.getLang("awards_profile_block_header"),(0,n.jsxs)(n.Fragment,{children:[a," ",s]})}renderContent(){const{counters:e,currentBadgeId:t}=this.state;return t?this.renderBadgeInfo():(0,n.jsx)("div",{className:x.default.items,children:e.map((({badge_id:e,value:t,recent_sender_ids:s,senders_count:a})=>e?(0,n.jsx)(S.BadgesOwnerInfoCard,{badge:this.getBadgeById(e),counter:t,recentSenderUsers:this.getUsersById(s||[]),sendersCount:a||0,onClick:()=>this.selectBadge(e,A.BadgesEventRef.COLLECTON_ALL)},e):((0,L.badgesLogger)("No badge_id in list in BadgesOwnerInfoModal"),null)))})}renderBadgeInfo(){const{currentBadgeId:e,counters:t}=this.state,s=this.getBadgeEntries(e||0),a=this.getBadgeById(e||0),r=t.find((t=>t.badge_id===e))?.value||0;return s?(0,n.jsxs)(C.ReexportInfiniteScroll,{hasMore:Boolean(s.next_query),loadMore:this.fetchOwnerEntries,children:[(0,n.jsx)(p.ModalHeaderCard,{before:(0,n.jsx)(b.RichImage,{"aria-label":a.title,src:(0,N.getBadgeImage)(a.image,A.BADGE_IMAGE_SIZE_100),size:A.BADGE_IMAGE_SIZE_100,withBorder:!1,transparent:!0,children:(0,n.jsx)(B.Image.Badge,{children:(0,n.jsx)(O.BadgeCounter,{children:r})})}),title:(0,n.jsx)(w.Title,{Component:"span",level:"2",weight:"2",children:a.title}),subtitle:a.description,transparent:!0}),(0,n.jsx)(m.SeparatorSpacing,{size:50}),(0,n.jsx)("div",{className:x.default.previewItems,children:s.entries?.map(((e,t)=>{const s=e.sender_id;return s?(0,n.jsx)(v.BadgeSenderItem,{className:x.default.previewItem,entry:e,user:this.getUserById(s)},t):null}))})]}):(0,n.jsx)(_.Spinner,{})}getBadgeById(e){return this.state.badges[e]}getUserById(e){return this.state.users[e]}getUsersById(e){return e.map((e=>this.getUserById(e)))}getBadgeEntries(e){return this.state.loadedBadgeEntries[e]}static convertBadges(e){return e.reduce(((e,t)=>({...e,[t.id]:t})),{})}static convertUsers(e){return e.reduce(((e,t)=>({...e,[t.id]:t})),{})}render(){const{currentBadgeId:e}=this.state,{isOwnerInfoLoaded:t}=this.state;return(0,n.jsxs)(I.ModalBox,{children:[this.renderHeader(),(0,n.jsx)(E.WithCustomScrollView,{withCustomScrollView:!e,className:x.default.layout,autoHideScrollbar:!0,children:(0,n.jsx)(f.ModalBody,{insetLevel:e?0:2,className:x.default.body,children:t?this.renderContent():(0,n.jsx)(_.Spinner,{})})})]})}constructor(e){super(e),this.sendStatEvent=(e,t,s)=>{const{ownerId:n}=this.props,a={screen:"badge",type:"type_navgo",type_navgo:{type:"type_badges_screen_item",subtype:"go",item:{type:"badges",id:s?.badgeId,owner_id:n},type_badges_screen_item:{type_badges_event:{event_name:e},type_badges_event_ref:{event_name:t}}}};d.WebStatEvents.add(a)},this.fetchOwnerInfo=()=>{window.removeEventListener("online",this.fetchOwnerInfo);const{ownerId:e}=this.props;return(0,o.api)("badges.getOwnerInfo",{owner_id:e,with_senders:1,fields:"photo_100,photo_200,domain"}).then((({owner_info:e,badges:t,users:s})=>{this.setState({isOwnerInfoLoaded:!0,totalCount:(e?.counters||[]).find((e=>e.type===j.CounterType.total))?.value||0,counters:(e?.counters||[]).filter((e=>e.type!==j.CounterType.total)),badges:T.convertBadges(t||[]),users:T.convertUsers(s||[])})})).catch((e=>{(0,y.topError)(e?.error?.error_msg||k.getLang("global_unknown_error")),(0,i.isNetworkError)(e)?window.addEventListener("online",this.fetchOwnerInfo):this.props.close()}))},this.fetchOwnerEntries=()=>{window.removeEventListener("online",this.fetchOwnerEntries);const{ownerId:e}=this.props,{loadedBadgeEntries:t,currentBadgeId:s}=this.state;if(!s)return Promise.resolve();const n=this.getBadgeEntries(s),a={fields:"photo_100,photo_200,domain"};return n?.next_query?Object.assign(a,{query:n.next_query}):Object.assign(a,{owner_id:e,badge_id:s,count:100}),(0,o.api)("badges.getOwnerEntries",a).then((({entries:e,badges:a,next_query:r,users:i})=>{this.setState({isOwnerInfoLoaded:!0,users:{...this.state.users,...T.convertUsers(i||[])},badges:{...this.state.badges,...T.convertBadges(a||[])},loadedBadgeEntries:{...t,[s]:{entries:[...n?.entries||[],...e||[]],next_query:r}}})})).catch((e=>{(0,y.topError)(e?.error?.error_msg||k.getLang("global_unknown_error")),(0,i.isNetworkError)(e)&&window.addEventListener("online",this.fetchOwnerEntries)}))},this.selectBadge=(e,t)=>{const s=r.Ranges.isUserId(this.props.ownerId);e&&this.sendStatEvent("open_badges_collection_badge__"+(s?"u":"c"),t,{badgeId:e}),this.setState({currentBadgeId:e})};const{isAdmin:t=!1,badgeId:s}=e;this.state={isOwnerInfoLoaded:!1,totalCount:0,counters:[],badges:{},users:{},currentBadgeId:s||null,loadedBadgeEntries:{},isAdmin:t}}}},533142:(e,t,s)=>{s.d(t,{GroupBadges:()=>B});var n=s(785893),a=s(667294),r=s(86894),i=s(780891),o=s(806660),d=s(249779),c=s(796299),l=s(166695),g=s(451151),u=s(471828),h=s(393023),_=s(132018),p=s(934437),b=s(963169);const B=(0,_.withErrorBoundary)((e=>{const{ownerId:t,isAdmin:s}=e,[_,B]=(0,a.useState)(),[w,m]=(0,a.useState)(c.LoadingStatus.pending);if((0,a.useEffect)((()=>{m(c.LoadingStatus.pending),(0,l.api)("badges.getOwnerInfo",{fields:String(["photo_100","photo_200","domain"]),owner_id:t}).then(B).then((()=>{m(c.LoadingStatus.loaded)})).catch((e=>{m(c.LoadingStatus.failed),(0,b.badgesLogger)("Failed badges.getOwnerInfo in GroupBadges",e)}))}),[t]),w!==c.LoadingStatus.loaded&&w!==c.LoadingStatus.failed)return(0,n.jsx)(p.BadgesOwnerBlockSkeleton,{separator:"hide"});if(!_?.badges?.length||w===c.LoadingStatus.failed)return null;const{badges:I,owner_info:f}=_,S=f?.counters?.find((e=>"total"===e.type))?.value||0,v=e=>{(0,g.initBadgesOwnerInfo)({ownerId:t,isAdmin:s,badgeId:e,eventRef:e?c.BadgesEventRef.COLLECTION_BLOCK:void 0})};return(0,n.jsx)(i.AppRootProvider,{viewWidth:r.ViewWidth.DESKTOP,children:(0,n.jsx)(o.Group,{header:(0,n.jsx)(d.Header,{indicator:S,onClick:()=>v(),children:u.getLang("awards_profile_block_header")}),separator:"hide",children:(0,n.jsx)(h.BadgeItems,{badges:I,counters:f?.counters,onBadgeClick:v})})})}))},132018:(e,t,s)=>{s.d(t,{withErrorBoundary:()=>l});var n=s(785893),a=s(667294),r=s(806660),i=s(258037),o=s(441430),d=s(471828),c=s(963169);function l(e){return t=>(0,n.jsx)(g,{children:(0,n.jsx)(e,{...t})})}class g extends a.Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){(0,c.badgesLogger)("Rendering error has happened in component GroupBadges",e)}render(){return this.state.hasError?(0,n.jsx)(r.Group,{separator:"hide",children:(0,n.jsx)(i.Placeholder,{header:d.getLang("global_error"),action:(0,n.jsx)(o.Button,{mode:"tertiary",loading:this.state.isReloading,onClick:this.onClick,children:d.getLang("global_reload")}),children:d.getLang("awards_group_block_unknown_error")})}):this.props.children}constructor(...e){super(...e),this.state={hasError:!1,isReloading:!1},this.onClick=()=>{this.setState({isReloading:!0}),window.nav.reload({force:!0})}}}},410069:(e,t,s)=>{s.d(t,{WithCustomScrollView:()=>r});var n=s(785893),a=s(715201);const r=({withCustomScrollView:e,children:t,...s})=>e?(0,n.jsx)(a.CustomScrollView,{...s,children:t}):(0,n.jsx)(n.Fragment,{children:t})},934437:(e,t,s)=>{s.r(t),s.d(t,{BadgesOwnerBlockSkeleton:()=>d.BadgesOwnerBlockSkeleton,BadgesOwnerInfo:()=>l,GroupBadges:()=>c.GroupBadges});var n=s(785893),a=s(182897),r=s(963169),i=s(284658),o=s(796299),d=s(983756),c=s(533142);const l={init({ownerId:e,isAdmin:t,badgeId:s,eventRef:d}){e?(0,i.showMessageBoxModal)((({onClose:r})=>(0,n.jsx)(a.BadgesOwnerInfoModal,{ownerId:e,isAdmin:t,close:r,badgeId:s,eventRef:d})),{width:o.BADGES_BOX_WIDTH}):(0,r.badgesLogger)(`Wrong arguments: ownerId=${e}`)}}},93977:(e,t,s)=>{s.d(t,{buildBadgesStackHtml:()=>h,buildHtmlAttributesString:()=>g,getBadgeImage:()=>l,getBadgesPlacementInPostActionStatusBarToUpdate:()=>u,isBadgesDisabledForOwner:()=>p,openHelpPage:()=>b,updateNewPostHTMLForBadges:()=>_});var n=s(636322),a=s(963169),r=s(2190),i=s(471828),o=s(796299),d=s(172613),c=s(977053);function l(e,t,s=!1){const{base_url:a,version:r}=e,i=r?`?${r}`:"";return!s&&(0,n.isRetina)()&&(t*=2),`${a}/${t}.png${i}`}const g=e=>Object.entries(e).reduce(((e,[t,s])=>{if(s){e+=` ${t}="${(0,n.escapeAttr)(String(s))}"`}return e}),""),u=(e,t,s)=>{const n={place:void 0},r=e.querySelector(`._like_wall${t}_${s}`);if(!r)return(0,a.badgesLogger)("Нет кнопки лайка"),n;const i=r.parentNode?.querySelector(".PostActionStatusBar");if(!i)return(0,a.badgesLogger)("Нет .PostActionStatusBar"),n;const o=i.querySelector(".BadgesStatusBar__badgesSendButton"),d=i.querySelector(".BadgesStack");return o||d?o?(n.element=o,n.place="button",n):(n.element=d,n.place="stack",n):((0,a.badgesLogger)('Нет ни стака значков, ни кнопки "Подарить"'),n)},h=({counters:e,badges:t,tqAttributes:s,withContainer:a,withLabel:o})=>{let d=0,l=0,u="";const h=r.colorScheme.isDarkScheme();if((e||[]).forEach((({type:e,badge_id:s,value:a})=>{if("total"===e)d=a;else if("badge"===e&&s&&l<3){l++;const e=t?.find((e=>e.id===s));if(e){const{image:t}=e,s=(0,n.isRetina)()?"stack28_light_2x.png":"stack28_light.png",a=(0,n.isRetina)()?"stack28_dark_2x.png":"stack28_dark.png",r=t.version?`?${t.version}`:"",i=`${t.base_url}/${s}${r}`,o=`${t.base_url}/${a}${r}`,d=g({src:h?o:i,class:"BadgesStackItem BadgesStack__item",alt:e.alt_text||"","data-src-light":i,"data-src-dark":o});u+=`<img ${d}>`}}})),d>0&&u){let e;e=(0,c.partConfigEnabled)("groups_one_time_donut_without_badges")?o?i.getLang("groups_have_donuts_total",d):i.getLang("groups_wkview_donuts_total",d):o?i.getLang("awards_have_gifted_badges_total",d):i.getLang("awards_wkview_badges_total",d);let t=`\n      <div class="BadgesStack__inner" ${s}>\n        <div class="BadgesStack__items">${u}</div>\n        <span class="BadgesStack__counter">${e}</span>\n      </div>\n    `;if(a){t=`\n        <div data-tooltip-container="true" id="badges_stack" class="BadgesStack" ${"data-exec='{\"BadgesStack/init\":[]}'"}>\n          ${t}\n        </div>\n      `}return t}return""},_=(e,t,s)=>{const n=s[2],[a,r]=n.split("_"),i=t?.wallTpl?.send_badge,c={};return(0,d.isBadgesEnabled)()&&i&&(e.push(i),Object.assign(c,{badges_object_id:r,badges_object_owner_id:a,badges_object_type:o.BadgesObjectType.WALL,badges_event_ref:o.BadgesEventRef.POST_BTN})),c},p=e=>{const t=e[16];try{if(""===t||JSON.parse(t)?.is_disabled)return!0}catch{return(0,a.badgesLogger)("Event from queue about IS_DISABLED_FOR_OWNER is not json"),!1}return!1},b=()=>{window.open(o.LINK_TO_HELP_FOR_AUTHORS,"_blank")}},683108:(e,t,s)=>{s.d(t,{checkPostRestrictedToSendBadge:()=>i});var n=s(881365),a=s(963169),r=s(736435);const i=(e,t)=>{const s=(0,n.getPostById)(e,t);return s?!!s.classList.contains("post--badgesRestricted")&&((0,r.renderRestrictionModal)(),!0):((0,a.badgesLogger)("Не нашли пост для показа модалки ограничения бейджиков"),!0)}},881365:(e,t,s)=>{s.d(t,{getPostById:()=>n,getReplyById:()=>a});const n=(e,t)=>{const s=`${e}_${t}`;return document.querySelector(`[data-post-id="${s}"`)},a=(e,t,s)=>e.querySelector(`#post${t}_${s}`)},9376:(e,t,s)=>{s.d(t,{ReexportInfiniteScroll:()=>n});const n=s(13602).default},230047:(e,t,s)=>{s.d(t,{initBadgesTqInteractiveHandlers:()=>b,initGroupBadgesTq:()=>B,initOpenBadgesInfoModalTq:()=>p,initStartupBadgesCheckTq:()=>m,initStartupBadgesStackTq:()=>w,tqOpenBadgesObjectInfo:()=>_});var n=s(785893),a=s(973935),r=s(234173),i=s(451151),o=s(934437),d=s(172613),c=s(618418),l=s(2190),g=s(736435),u=s(796299),h=s(97241);const _=()=>{(0,r.tq)().setInteractiveHandler("Badges/openBadgesObjectInfo",(e=>{if(!e.payload.dataAttrs)return;const{badgeId:t,objectType:s,objectOwnerId:n,objectId:a,eventRef:r}=e.payload.dataAttrs;if(!s||!n||!a)throw new Error("No required attributes in tq Badges/openBadgesObjectInfo");(0,i.initBadgesObjectInfo)({objectId:{type:Number(s),ownerId:Number(n),id:Number(a)},badgeId:Number(t),eventRef:r})}))},p=()=>{(0,h.isWidget)()||(0,r.tq)().setInteractiveHandler("Badges/openBadgesInfoModal",(e=>{if(!e.payload.dataAttrs)return;const{modalType:t}=e.payload.dataAttrs;if("restriction"===t)(0,g.renderRestrictionModal)();else(0,g.renderBadgesNotAvailableModal)()}))},b=()=>{(0,h.isWidget)()||(_(),(0,r.tq)().setInteractiveHandler("Badges/openBadgesCatalog",(e=>{if(!e.payload.dataAttrs)return;const{objectType:t,objectOwnerId:s,objectId:n,eventRef:a}=e.payload.dataAttrs;if(!t||!s||!n)throw new Error("No required attributes in tq Badges/openBadgesCatalog");(0,i.initBadgesCatalog)({objectId:{id:Number(n),type:Number(t),ownerId:Number(s)},eventRef:a})})))},B=()=>{(0,r.tq)().setStartupHandler("BadgesOwner/render_group_badges",(e=>{const{data:{owner_id:t,is_admin:s},target:r}=e.payload;r&&void 0!==t&&(0,d.isBadgesEnabled)()&&(a.render((0,n.jsx)(o.GroupBadges,{ownerId:Number(t),isAdmin:Boolean(s)}),r),(0,c.pushNavDestroy)((()=>a.unmountComponentAtNode(r))))}))},w=()=>{(0,h.isWidget)()||((0,r.tq)().setStartupHandler("BadgesStack/init",(e=>{const{target:t}=e.payload;t&&l.colorScheme.subscribe((()=>{t.querySelectorAll(".BadgesStackItem").forEach((e=>{let t=e.src;const{srcLight:s=t,srcDark:n=t}=e.dataset;t=l.colorScheme.isDarkScheme()?n:s,e.src=t}))}))})),(0,r.tq)().setStartupHandler("BadgesSendButton/init_tooltip",(e=>{const{target:t}=e.payload;t&&(0,i.loadBadgesStatusBarOnboarding)({element:t})})))},m=()=>{if((0,h.isWidget)())return;(0,r.tq)().setStartupHandler("BadgeComment/init",(({payload:{target:e,data:t}})=>{if(!e)return;const s=t.fallback_text;if(!(0,d.isBadgesRenderingEnabled)())return void((e,t)=>{const s=e.parentElement;s&&(s.innerHTML=t)})(e,s);e.classList.remove("BadgeComment--hidden");const{is_enabled_for_owner:n,badge_id:a,object_type:r,object_owner_id:i,object_id:o}=t;if(!r||!i||!o)return;const c=(0,d.isBadgesEnabled)();if(n&&c)return e.setAttribute("data-task-click","Badges/openBadgesObjectInfo"),e.setAttribute("data-object-type",r),e.setAttribute("data-object-owner-id",i),e.setAttribute("data-object-id",o),e.setAttribute("data-badge-id",a),void e.setAttribute("data-event-ref",u.BadgesEventRef.COMMENT_IMG);e.setAttribute("data-task-click","Badges/openBadgesInfoModal"),e.setAttribute("data-modal-type",c?"restriction":"not_available")}))}},451151:(e,t,s)=>{s.d(t,{initBadgesCatalog:()=>u,initBadgesObjectInfo:()=>h,initBadgesOwnerInfo:()=>_,initBadgesTqInteractiveHandlers:()=>g.initBadgesTqInteractiveHandlers,initOpenBadgesInfoModalTq:()=>g.initOpenBadgesInfoModalTq,initStartupBadgesCheckTq:()=>g.initStartupBadgesCheckTq,initStartupBadgesStackTq:()=>g.initStartupBadgesStackTq,loadBadgesStatusBarOnboarding:()=>p});var n=s(963169),a=s(659397),r=s(172613),i=s(251087),o=s(717731),d=s(952258),c=s(683108),l=s(977053),g=s(230047);const u=({objectId:e,eventRef:t,withCheckRestriction:o=!0})=>{(0,r.isBadgesEnabled)()&&(o&&(0,c.checkPostRestrictedToSendBadge)(e.ownerId,e.id)||((0,i.showBoxLoader)(),(window.BadgesCatalog?Promise.resolve():(0,a.asyncImportLoader)((()=>Promise.all([s.e(2067),s.e(20795),s.e(18669)]).then(s.bind(s,238487)))).then((({BadgesCatalog:e})=>{window.BadgesCatalog=e}))).then((()=>window.BadgesCatalog.init(e,t))).catch((e=>{(0,n.badgesLogger)("Error loading module BadgesCatalog",e)})).finally((()=>{(0,i.hideBoxLoader)()}))))},h=e=>{(0,r.isBadgesEnabled)()&&((0,i.showBoxLoader)(),(window.BadgesObjectInfo?Promise.resolve():(0,a.asyncImportLoader)((()=>Promise.all([s.e(213),s.e(2067),s.e(20795),s.e(57451),s.e(5038),s.e(19442),s.e(3876),s.e(83803)]).then(s.bind(s,265143)))).then((({BadgesObjectInfo:e})=>{window.BadgesObjectInfo=e}))).then((()=>window.BadgesObjectInfo.init(e))).catch((e=>{(0,n.badgesLogger)("Error loading module BadgesObjectInfo",e)})).finally((()=>{(0,i.hideBoxLoader)()})))},_=e=>{(0,r.isBadgesEnabled)()&&((0,i.showBoxLoader)(),(window.BadgesOwnerInfo?Promise.resolve():(0,a.asyncImportLoader)((()=>Promise.resolve().then(s.bind(s,934437)))).then((({BadgesOwnerInfo:e})=>{window.BadgesOwnerInfo=e}))).then((()=>window.BadgesOwnerInfo.init(e))).catch((e=>{(0,n.badgesLogger)("Error loading module BadgesOwnerInfo",e)})).finally((()=>{(0,i.hideBoxLoader)()})))},p=async({element:e})=>{if(!(0,r.isBadgesEnabled)())return;await o.HelpHints.get((0,l.partConfigEnabled)("groups_one_time_donut_without_badges")?"posting:post_feed_no_badges_unseen":d.HelpHintId.POSTING_POST_FEED_BADGES_UNSEEN)&&(0,a.asyncImportLoader)((()=>s.e(27772).then(s.bind(s,994683)))).then((({renderStatusBarOnboarding:t})=>{t({element:e})})).catch((e=>{(0,n.badgesLogger)("Error loading module badges_status_bar_onboarding_init",e)}))}},963169:(e,t,s)=>{s.d(t,{badgesLogger:()=>a});var n=s(65718);const a=(e,t)=>{window.vk.dev&&console.log(t),(0,n.logError)(new Error(e),{environment:"badges"})}},736435:(e,t,s)=>{s.d(t,{renderBadgesNotAvailableModal:()=>c,renderRestrictionModal:()=>d,renderTaskModal:()=>l});var n=s(785893),a=s(661587),r=s(284658),i=s(471828);const o=(0,a.asyncComponent)((()=>s.e(60456).then(s.bind(s,469446))),(({BadgesRestrictedModal:e})=>e)),d=()=>{(0,r.showMessageBoxModalSuspense)((e=>(0,n.jsx)(o,{title:i.getLang("awards_restricted_tittle"),subtitle:i.getLang("awards_restricted_subheader"),buttonText:i.getLang("awards_restricted_button"),...e})))},c=()=>{(0,r.showMessageBoxModalSuspense)((e=>(0,n.jsx)(o,{title:i.getLang("awards_not_available_tittle"),subtitle:i.getLang("awards_not_available_subheader"),buttonText:i.getLang("awards_not_available_button"),...e})))},l=e=>{const t=(0,a.asyncComponent)((()=>s.e(64369).then(s.bind(s,137121))),(({BadgesTaskModal:e})=>e));(0,r.showMessageBoxModalSuspense)((s=>(0,n.jsx)(t,{...s,...e})))}},57436:(e,t,s)=>{s.d(t,{CounterType:()=>n});const n={total:"total",badge:"badge",friends:"friends"}}}]);try{stManager.done("dist/web/chunks/9a477bd9.29b49857.js")}catch(e){}