"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[18229],{33200:(e,n,t)=>{t.d(n,{API_DEFAULT_TIMEOUT:()=>r,API_GET_FOLDERS_TYPES:()=>_,API_GET_HELP_HINTS:()=>k,API_GET_INFO_FIELDS:()=>h,API_GET_MULTI_FIELDS:()=>p,API_GROUP_FIELDS:()=>f,API_MAX_RETRY_TIMEOUT:()=>u,API_MIN_RETRY_TIMEOUT:()=>c,API_USER_FIELDS:()=>m,CALL_JOIN_LINK_URL_BASE:()=>q,CHANNELS_GLPH_TIMEOUT:()=>T,CHANNELS_PER_PAGE:()=>g,CHAT_INVITE_LINK_URL_BASE:()=>H,CLIENT_ID:()=>i,COMMENTS_PER_PAGE:()=>M,COMMENTS_REFRESH_INTERVAL:()=>d,CONVOS_PER_PAGE:()=>v,EDU_ACHIEVEMENTS_MINI_APP_ID:()=>le,EDU_HELP_CONVO_ID:()=>X,EDU_INTEGRATION_BANNER_ID:()=>he,EDU_INTEGRATION_BANNER_LIMIT:()=>pe,EDU_SYSTEM_INTEGRATION_MINI_APP_ID:()=>fe,EMPLOYEE_CARD_MINI_APP_ID:()=>x,ENGINE_VERSION:()=>s,HELPDESK_MINIAPP_ID:()=>Y,ID_VK_COM_BASE:()=>J,INVITE_TO_CHAT_VISIBLE_MESSAGES_COUNT:()=>W,ISOLATED_CALL_JOIN_LINK_URL_BASE:()=>Q,LIKE_PEERS_FIRST_LOAD:()=>P,LIKE_PEERS_PER_PAGE:()=>S,MAX_COMMENT_SIZE:()=>ce,MAX_INT32:()=>l,MAX_MESSAGES_FORWARD_LEVEL:()=>D,MAX_MESSAGE_ATTACHES:()=>V,MAX_MESSAGE_SIZE:()=>$,MAX_VIDEO_FORWARD_LEVEL:()=>L,MESSAGES_PER_PAGE:()=>C,POSTS_PER_PAGE:()=>I,POST_ADS_MINIAPP_ID:()=>ue,REACTIONS_REFRESH_INTERVAL:()=>a,SEARCH_CHANNELS_COUNT:()=>A,SEARCH_CONVOS_COUNT:()=>b,SEARCH_DEBOUNCE_MS:()=>w,SEARCH_MESSAGES_COUNT:()=>y,SEARCH_POSTS_COUNT:()=>N,SFERUM_DOMAIN:()=>re,SFERUM_RELATED_DOMAINS:()=>ae,SFERUM_VERIFICATION_LINK:()=>de,STATIC_BASE_URL:()=>o,STICKER_IMAGE_EDITOR_MINI_APP_ID:()=>F,STORAGE_APP_UNAVAILABLE_KEY:()=>ne,STORAGE_DB_NAME:()=>z,STORAGE_DEVICE_ID_KEY:()=>me,STORAGE_OWNER_ID_KEY:()=>Z,STORAGE_VIEWER_ID_KEY:()=>ee,THREAD_COMMENTS_COUNT:()=>E,TYPING_EXPIRATION_TIME:()=>R,UGC_STICKERS_APP_ID:()=>O,UGC_STICKERS_MINI_APP_ID:()=>B,VKME_APP_INSTALL_LINK:()=>j,VKME_CHAT_INVITE_LINK_URL_BASE:()=>K,VK_DOMAINS:()=>oe,VK_PAY_APP_ID:()=>G,VK_RELATED_DOMAINS:()=>se,VK_TERMS_URL:()=>te,VMOJI_CONSTRUCTOR_APP_ID:()=>U,WEB_VK_ME_DOMAIN:()=>ie});const i=7694673,o="https://vk.com",s=19,r=1e4,a=15e3,d=15e3,c=500,u=2e4,l=2**31-1,m=["id","first_name","first_name_gen","first_name_acc","last_name","last_name_gen","last_name_acc","sex","has_photo","photo_id","photo_50","photo_100","photo_200","contact_name","occupation","bdate","city","screen_name","online_info","verified","blacklisted","blacklisted_by_me","can_call","can_write_private_message","can_send_friend_request","can_invite_to_chats","friend_status","followers_count","profile_type","contacts","employee_mark","employee_working_state","is_service_account","image_status"],f=["id","name","screen_name","type","photo_id","photo_50","photo_100","members_count","member_status","verified","is_closed","can_message","online_info","deactivated","activity","ban_info","is_messages_blocked","can_post_donut","site","reposts_disabled","description","action_button","menu","role"],h=["messages_recommendation_list_hidden","show_only_not_muted_messages","messages_multiline_input","messages_auto_unarchive","messages_transcript_auto_show","business_notify","messages_show_banner_teacher_verification","conversations_bar"],p=["profile_type","photo_100","is_service_account"],k=["im:transcript_autoshow_setting","im:channels_onboarding","im:web_send_options","im:web_archive_location","im:web_return_to_previous_chat","voice_assistant:add_to_group_chat"],_=["channels"],v=20,g=20,C=30,I=20,M=50,E=2,y=20,N=20,b=100,A=25,w=500,S=30,P=6,R=5e3,T=3e4,D=2,L=4,G=7131443,O=51538586,U=7929683,F=7754294,x=7631183,B=51538586,$=4096,V=10,W=250,H="https://vk.me/join/",K="https://web.vk.me/#/join/",q="https://vk.com/call/join/",j="https://vk.me/app",Q="https://web.vk.me/#/call/join/",Y=6126832,X=-222277107,z="reforged-storage-db-v1",J="https://id.vk.com",Z="reforged-owner-id",ee="reforged-viewer-id",ne="reforged-app-unavailable",te="https://vk.com/terms",ie="web.vk.me",oe=["vk.com","vk.ru"],se=[...oe,"vk.me","vk.cc"],re="sferum.ru",ae=[re,"me.sferum.ru"],de=`https://${re}/?s=me`,ce=16384,ue=51707812,le=51751619,me="reforged-device-id",fe=51833161,he=1,pe=1},803854:(e,n,t)=>{t.d(n,{addAttach:()=>p,count:()=>M,fromAddableAttach:()=>h,generatePollBackgroundGradientStyle:()=>C,hasPublicVideo:()=>A,ids:()=>c,isAddableAttach:()=>l,isCallJoinLink:()=>v,isChatInviteLink:()=>_,isGame:()=>N,isMiniAppAvailable:()=>y,kindsCount:()=>I,last:()=>u,preview:()=>d,rearrangeAttaches:()=>g,removeAttach:()=>k,resolveMiniAppId:()=>r,resolveMiniAppStatus:()=>E});var i=t(345543),o=t(207739),s=t(33200);const r=e=>e,a=[-1,0,1,2];function d(e,n=0,t=0,i=!1){const o=["o","p","q","r"];if("Curator"===e.kind)return e.image?.find((e=>e.height>t&&e.width))||null;if("Story"===e.kind)if(e.photo)e=e.photo;else{if(!e.video)return null;e=e.video}if("Video"===e.kind||"Gift"===e.kind||"PollBackgroundPhoto"===e.kind||"VideoMessage"===e.kind||"Narrative"===e.kind||"MiniApp"===e.kind){const i="MiniApp"===e.kind?e.images:e.image;return i&&(i.find((({width:e,height:i})=>e>=n&&i>=t))||i.reduce(((e,n)=>!e||n.width*n.height>e.width*e.height?n:e)))||null}const s="Photo"===e.kind?e.sizes:e.image;return s?i?Array.from(s.entries()).find((([e,{width:i,height:s}])=>o.includes(e)&&i>=n&&s>=t))?.[1]||s.get("r")||s.get("q")||s.get("p")||s.get("o")||null:Array.from(s.entries()).find((([e,{width:i,height:s}])=>!o.includes(e)&&i>=n&&s>=t))?.[1]||s.get("w")||s.get("z")||s.get("y")||s.get("x")||s.get("m")||s.get("s")||null:null}function c(e){const n=[];for(const t of e.photos||[])n.push(`photo${t.ownerId}_${t.id}`);for(const t of e.videos||[])n.push(`video${t.ownerId}_${t.id}`);for(const t of e.audios||[])n.push(`audio${t.ownerId}_${t.id}`);for(const t of e.audioPlaylists||[])n.push(`audio_playlist${t.ownerId}_${t.id}`);e.artist&&n.push(`artist${e.artist.id}`),e.podcast&&n.push(`podcast${e.podcast.ownerId}_${e.podcast.id}`),e.market&&n.push(`market${e.market.ownerId}_${e.market.id}`),e.marketAlbum&&n.push(`market_album${e.marketAlbum.ownerId}_${e.marketAlbum.id}`);for(const t of e.docs||[])n.push(`doc${t.ownerId}_${t.id}`);e.voice&&n.push(`doc${e.voice.ownerId}_${e.voice.id}`),e.event&&n.push(`event${o.toRealId(e.event.id)}`),e.wall&&n.push(`wall${e.wall.ownerId}_${e.wall.id}`);for(const t of e.narratives||[])n.push(`narrative${t.ownerId}_${t.id}`);e.wallReply&&n.push(`wall_reply${e.wallReply.ownerId}_${e.wallReply.id}`),e.poll&&n.push(`poll${e.poll.ownerId}_${e.poll.id}`),e.story&&n.push(`story${e.story.ownerId}_${e.story.id}`),e.link&&n.push(`${e.link.url}`),e.stickerPack&&n.push(`${e.stickerPack.url}`),e.inviteLink&&n.push(`invite_link${e.inviteLink.url}`),e.donutLink&&n.push(`donut_link${e.donutLink.ownerId}`),e.widget&&n.push(`widget${e.widget.id}`),e.ugcSticker&&n.push(`ugc_sticker${e.ugcSticker.item.owner_id}_${e.ugcSticker.id}`);for(const t of e.curator||[])n.push(`curator${t.id}`);e.question&&n.push(`question${e.question.ownerId}_${e.question.id}`),e.album&&n.push(`album${e.album.ownerId}_${e.album.id}`),e.article&&n.push(`article${e.article.ownerId}_${e.article.id}_${e.article.accessKey}`),e.wallHistory&&n.push(`wall${e.wallHistory.ownerId}_${e.wallHistory.id}`);for(const t of e.miniApps||[])n.push(`mini_app${t.id}`);return n}function u(e){return 0===Object.keys(e).length?null:e.widget||e.wallReply||e.wall||e.poll||e.donutLink||e.moneyTransfer||e.moneyRequest||e.miniApps?.slice(-1)?.[0]||e.miniAppWidgets?.slice(-1)?.[0]||e.article||e.artist||e.audioPlaylists?.slice(-1)?.[0]||e.podcast||e.audios?.slice(-1)?.[0]||e.voice||e.docs?.slice(-1)?.[0]||e.narratives?.slice(-1)?.[0]||e.event||e.geo||e.story||e.marketAlbum||e.market||e.album||e.inviteLink||e.link||e.stickerPack||e.curator?.slice(-1)?.[0]||e.graffiti||e.videoMessage||e.ugcSticker||e.sticker||e.finishedCall||e.activeCall||e.gift||e.question||e.videos?.slice(-1)?.[0]||e.photos?.slice(-1)?.[0]||null}function l(e){switch(e.kind){case"Artist":case"Audio":case"Doc":case"Geo":case"Link":case"Photo":case"Poll":case"Video":case"Voice":case"StickerPack":return!0;case"ActiveCall":case"Article":case"AudioPlaylist":case"Album":case"DonutLink":case"Event":case"FinishedCall":case"Gift":case"Graffiti":case"InviteLink":case"Market":case"MarketAlbum":case"MiniApp":case"MiniAppWidget":case"MoneyRequest":case"MoneyTransfer":case"Narrative":case"Podcast":case"Question":case"Sticker":case"Story":case"UgcSticker":case"VideoMessage":case"Wall":case"WallHistory":case"WallReply":case"Widget":case"Curator":case"Unknown":return!1;default:(0,i.exhaustivenessCheck)(e)}}function m(e){switch(e.kind){case"Artist":case"Geo":case"Link":case"Poll":case"Voice":case"Market":return!0;case"Audio":case"Doc":case"Photo":case"Video":return!1;default:(0,i.exhaustivenessCheck)(e)}}function f(e){switch(e.kind){case"Photo":return"photos";case"Video":return"videos";case"Artist":return"artist";case"Audio":return"audios";case"Doc":return"docs";case"Geo":return"geo";case"Link":return"link";case"Poll":return"poll";case"Voice":return"voice";case"Market":return"market";default:(0,i.exhaustivenessCheck)(e)}}function h(e){const n=Array.isArray(e),t=n?e[0]:e;return{[f(t)]:m(t)||n?e:[e]}}function p(e,n){n.photos&&(e.photos=[...e.photos||[],...n.photos]),n.videos&&(e.videos=[...e.videos||[],...n.videos]),n.audios&&(e.audios=[...e.audios||[],...n.audios]),n.docs&&(e.docs=[...e.docs||[],...n.docs]),n.voice&&(e.voice=n.voice),n.geo&&(e.geo=n.geo),n.poll&&(e.poll=n.poll),n.market&&(e.market=n.market),n.link&&(e.link=n.link)}function k(e,n,t){switch(n.kind){case"Audio":if(!e.audios)break;const o=b(e.audios,n.id,t);o?e.audios=o:delete e.audios;break;case"AudioPlaylist":if(!e.audioPlaylists)break;const s=b(e.audioPlaylists,n.id,t);s?e.audioPlaylists=s:delete e.audioPlaylists;break;case"Podcast":e.podcast&&delete e.podcast;break;case"Doc":if(!e.docs)break;const r=b(e.docs,n.id,t);r?e.docs=r:delete e.docs;break;case"Photo":if(!e.photos)break;const a=b(e.photos,n.id,t);a?e.photos=a:delete e.photos;break;case"Video":if(!e.videos)break;const d=b(e.videos,n.id,t);d?e.videos=d:delete e.videos;break;case"Voice":e.voice&&delete e.voice;break;case"Poll":e.poll&&delete e.poll;break;case"Wall":e.wall&&delete e.wall;break;case"WallReply":e.wallReply&&delete e.wallReply;break;case"Article":e.article&&delete e.article;break;case"Link":e.link&&delete e.link;break;case"StickerPack":e.stickerPack&&delete e.stickerPack;break;case"InviteLink":e.inviteLink&&delete e.inviteLink;break;case"Geo":e.geo&&delete e.geo;break;case"MiniApp":if(!e.miniApps)break;const c=(0,i.toNonEmpty)(e.miniApps.filter((e=>e.id!==n.id)));c?e.miniApps=c:delete e.miniApps;break;case"MiniAppWidget":if(!e.miniAppWidgets)break;const u=(0,i.toNonEmpty)(e.miniAppWidgets.filter((e=>e.cmid!==n.cmid)));u?e.miniAppWidgets=u:delete e.miniAppWidgets;break;case"Story":e.story&&delete e.story;break;case"Curator":if(!e.curator)break;const l=(0,i.toNonEmpty)(e.curator.filter((e=>e.id!==n.id)));l?e.curator=l:delete e.curator;break;case"Market":e.market&&delete e.market;break;case"Narrative":if(!e.narratives)break;const m=(0,i.toNonEmpty)(e.narratives.filter((e=>e.id!==n.id)));m?e.narratives=m:delete e.narratives;break;case"Event":e.event&&delete e.event;break;case"MarketAlbum":e.marketAlbum&&delete e.marketAlbum;break;case"DonutLink":e.donutLink&&delete e.donutLink;break;case"Artist":e.artist&&delete e.artist;break;case"Album":e.album&&delete e.album;break;case"Question":break;default:(0,i.exhaustivenessCheck)(n)}}function _(e){return e.startsWith(s.CHAT_INVITE_LINK_URL_BASE)||e.startsWith(s.VKME_CHAT_INVITE_LINK_URL_BASE)}function v(e){return e.startsWith(s.CALL_JOIN_LINK_URL_BASE)}function g(e,{currentPosition:n,newPosition:t},o){switch(o){case"photos":const s=e[o];if(!s)return;const r=s[n];if(!r)return;s.splice(n,1),s.splice(t,0,r),e[o]=s;break;case"videos":const a=e[o];if(!a)return;const d=a[n];if(!d)return;a.splice(n,1),a.splice(t,0,d),e[o]=a;break;case"audios":const c=e[o];if(!c)return;const u=c[n];if(!u)return;c.splice(n,1),c.splice(t,0,u),e[o]=c;break;case"audioPlaylists":const l=e[o];if(!l)return;const m=l[n];if(!m)return;l.splice(n,1),l.splice(t,0,m),e[o]=l;break;case"docs":const f=e[o];if(!f)return;const h=f[n];if(!h)return;f.splice(n,1),f.splice(t,0,h),e[o]=f;break;case"narratives":const p=e[o];if(!p)return;const k=p[n];if(!k)return;p.splice(n,1),p.splice(t,0,k),e[o]=p;break;default:(0,i.exhaustivenessCheck)(o)}}function C(e){const n=e.angle-90,{points:t}=e,i=[];for(let e=0;e<t.length;e++){const n=t[e],o=100*e/(t.length-1);i.push(`${n} ${o}%`)}return`linear-gradient(${n}deg, ${i.join(", ")})`}function I(e){return Object.keys(e).length}function M(e){return Object.values(e).reduce(((e,n)=>e+(Array.isArray(n)?n.length:1)),0)}function E(e){return function(e){return a.includes(e)}(e)?e:-1}function y(e){return 1===e.status}function N(e){return"type"in e&&("game"===e.type||"html5_game"===e.type)}function b(e,n,t){return(0,i.toNonEmpty)(e.filter(((e,i)=>!(i===t&&n===e.id))))}function A(e){const n=u(e),t=M(e);return Boolean(1===t&&"Video"===n?.kind&&"short_video"!==n.type&&(!n.isFromMessage||n.files?.external))}},548007:(e,n,t)=>{t.d(n,{CHANNELS_BASE_PATH:()=>c,allHistoryNodes:()=>U,appendPost:()=>I,canAdmin:()=>d,cleanup:()=>b,clearMediaViewerCache:()=>G,deletePost:()=>E,findMediaViewerCacheItem:()=>x,findPostByCmid:()=>g,historyAround:()=>v,insertPosts:()=>N,isChannelId:()=>u,isEmpty:()=>h,isHidden:()=>k,isUnread:()=>p,lastPost:()=>_,merge:()=>f,readUntil:()=>A,replacePost:()=>M,resolveId:()=>l,restorePost:()=>y,safeGet:()=>F,setAdminLevel:()=>D,setArchived:()=>w,setMembership:()=>P,setMuted:()=>S,setPhotos:()=>T,setRights:()=>L,setSortId:()=>R,toRealGroupId:()=>m});var i=t(688538),o=t(345543),s=t(207739),r=t(95233),a=t(33200);function d(e){return e.adminLevel>=3}const c="/channels";function u(e){return i.Ranges.isGroupId(e)}function l(e){return u(e)||(e=0),e}function m(e){return s.toRealId(s.resolveId(e))}function f(e,n){if(e.id!==n.id)throw new Error("Channel.merge вызван на 2 разных каналах");const t=n.history;return n.history=e.history,N(n,t.confirmed),n}function h(e){return r.isEmpty(e.history)}function p(e){return e.unreadCount>0}function k(e){return e.majorSortId<=0&&e.minorSortId<=0}function _({channel:e,withPending:n}){return r.lastNode({history:e.history,withPending:n,withDeleted:!1,withFailed:!0})?.item}function v(e,n){return r.around(e.history,n)}function g(e,n){const t=r.findNodeByCmid(e.history,n);if("Node"===t.node?.kind||"DeletedNode"===t.node?.kind)return t.node}function C(e,n){return!!e.mediaViewerCache.items.find((e=>e.cmid===n))}function I(e,n,t){const i=r.findNodeByCmid(e.history,n.cmid),o=r.lastCmid(e.history);if(void 0!==o&&o>=n.cmid&&"Deleted"===i.status&&"Normal"===n.kind)return void y(e,n.cmid,n);const s=function(e,n){const t=e.history.pending.find((e=>e.item.cmid===n));void 0!==t&&r.removePending(e.history,t.item.randomId);return t}(e,n.cmid)?.item,a=s?.attaches.link;a&&(n.attaches.link?n.attaches.link={...n.attaches.link,image:n.attaches.link.image||a.image,title:n.attaches.link.title||a.title}:n.attaches.link=a),e.mediaViewerCache.hasNext=!0,r.append(e.history,n,t)}function M(e,n){C(e,n.cmid)&&G(e),r.replace(e.history,n)}function E(e,n,t){C(e,n)&&G(e),r.remove(e.history,n,t)}function y(e,n,t){r.restore(e.history,n,t),G(e)}function N(e,n){r.insert(e.history,n)}function b(e){const n=e.unreadCount>0?e.inReadCmid:void 0;r.cleanup(e.history,1.5*a.POSTS_PER_PAGE,n)}function A(e,n,t){if(void 0===t){const i=e.history.confirmed.filter((t=>"Node"===t.kind&&function(e,n){return n.cmid>e.inReadCmid}(e,t.item)&&t.item.cmid<=n)).length;t=Math.max(0,e.unreadCount-i)}e.inReadCmid=n,e.unreadCount=t}function w(e,n){e.isArchived=n,n&&(e.unreadCount=0)}function S(e,n){e.isMuted=n}function P(e,n){e.isMember=n}function R(e,n){void 0!==n.majorSortId&&(e.majorSortId=n.majorSortId),void 0!==n.minorSortId&&(e.minorSortId=n.minorSortId)}function T(e,n){e.photos.photo50=n.photo50,e.photos.photo100=n.photo100}function D(e,n){0!==n&&1!==n&&2!==n&&3!==n||(e.adminLevel=n)}function L(e,n){e.rights={...e.rights,...n}}function G(e){e.mediaViewerCache={items:[],hasPrev:!0,hasNext:!0}}function O(e){return e.history.confirmed.reduce(((e,n)=>("Node"===n.kind&&e.push(n),e)),[])}function U(e){return[...O(e),...e.history.pending]}function F(e,n){const t=e.get(n);if(t)return t;if(o.isDev)throw new Error(`Канал ${n} не найден в кэше! Обрати внимание на то как загружаются недостающие данные в сторе.`);return e.get(l(0))}function x(e,n,t){return e.mediaViewerCache.items.find((e=>n===e.id&&t===e.cmid))}},886330:(e,n,t)=>{t.d(n,{addIncognitoMembers:()=>p,addMembers:()=>u,allowMemberToWrite:()=>v,getIncognitoMember:()=>h,getMember:()=>m,isAdmin:()=>c,isMemberRestrictedToWrite:()=>_,removeIncognitoMember:()=>k,removeMember:()=>l,reset:()=>r,resolveIncognitoMemberId:()=>o,restrictMemberToWrite:()=>g,setAdmin:()=>a,setCount:()=>s,unsetAdmin:()=>d});var i=t(207739);const o=e=>e;function s(e,n){e.count=n}function r(e){e.count=0,e.adminIds=new Set,e.incognitoMembers=new Map,e.invitedIds=new Set,e.members=new Map,e.memberIds=new Set}function a(e,n){e.adminIds.add(n)}function d(e,n){e.adminIds.delete(n)}function c(e,n){return(i.isUserPeerId(n)||i.isGroupPeerId(n))&&e.adminIds.has(n)}function u(e,n,t){for(const t of n){const{peerId:n,isMessageRequest:i}=t;e.members.set(n,t),i?e.invitedIds.add(n):e.memberIds.add(n)}e.count=t||e.memberIds.size+f(e)}function l(e,n){const t=e.members.get(n);t&&(e.members.delete(n)&&(e.count=e.count-1),t.isMessageRequest?e.invitedIds.delete(n):e.memberIds.delete(n))}function m(e,n){return e.members.get(n)}function f(e){return e.incognitoMembers?[...e.incognitoMembers?.values()].filter((e=>!e.memberId)).length:0}function h(e,n){return e.incognitoMembers.get(n)}function p(e,n){e.incognitoMembers||(e.incognitoMembers=new Map),n.forEach((n=>{e.incognitoMembers?.set(n.id,n)})),e.count=e.count+f(e)}function k(e,n){const t=e.incognitoMembers?.get(n);e.incognitoMembers?.delete(n)&&!t?.memberId&&(e.count=e.count-1)}function _(e,n){return Boolean(e.members.get(n)?.isRestrictedToWrite)}function v(e,n){if(!i.isChatPeerId(n)){const t=e.members.get(n);t&&(t.isRestrictedToWrite=!1)}}function g(e,n){if(!i.isChatPeerId(n)){const t=e.members.get(n);t&&(t.isRestrictedToWrite=!0)}}},503048:(e,n,t)=>{t.d(n,{CASPER_MESSAGE_DELETE_TTL:()=>c,DEFAULT_CHAT_PERMISSIONS:()=>m,MAX_PINNED:()=>u,PEER_FLAGS:()=>l,addFolder:()=>Ve,allConfirmedHistoryNodes:()=>f,allHistoryNodes:()=>p,allQueuedMessages:()=>H,allowViewerToWrite:()=>Be,appendMessage:()=>re,appendQueuedMessage:()=>ae,canAddToFolder:()=>T,canCreateChatBasedOnCurrent:()=>I,canDelete:()=>G,canDeleteMessageForAll:()=>O,canFinishCall:()=>R,canForwardFrom:()=>A,canForwardTo:()=>w,canInviteTo:()=>S,canPin:()=>L,canReadMembers:()=>Y,canSendReactions:()=>Z,canUseMassMentions:()=>P,changeQueuedMessageEntrypoint:()=>Ee,changeUserState:()=>$e,cleanup:()=>he,clearChatDataOnLeave:()=>we,clearMediaViewerCache:()=>He,deleteMessage:()=>ue,description:()=>ze,findHistoryNodeByCmid:()=>_,findMediaViewerCacheItem:()=>Je,findMessageByCmid:()=>v,firstUnreadReactionCmid:()=>j,flowHistory:()=>k,forbidWritingForAll:()=>en,getConvoFailedMessagesCount:()=>K,getFirstUnreadMentionCmid:()=>q,getMRSenderPeerId:()=>b,hasBirthdayBanner:()=>nn,hasPeerFlag:()=>Xe,hasUnreadExpireables:()=>x,hasUnreadMentions:()=>$,hasUnreadReactions:()=>B,hideBanner:()=>Ke,hideBannerTemporarily:()=>qe,insertMessages:()=>me,isBusinessNotify:()=>N,isCasper:()=>C,isDeleted:()=>E,isEmpty:()=>V,isForbidedWritingForAll:()=>Ze,isHidden:()=>z,isInFolder:()=>J,isIncognitoChat:()=>Pe,isMR:()=>M,isMessageUnread:()=>Q,isMuted:()=>g,isNew:()=>W,isPendingMR:()=>y,isPinned:()=>D,isPromo:()=>te,isUnread:()=>U,isUnreadOut:()=>F,lastEditableMessage:()=>h,markRead:()=>pe,merge:()=>ie,pinMessage:()=>Ge,readInUntil:()=>ke,readOutUntil:()=>_e,readReactions:()=>Ce,rejectMR:()=>Fe,removeFolder:()=>We,removePending:()=>se,replaceExpiredReplies:()=>ce,replaceInviteLinks:()=>Le,replaceMessage:()=>de,replaceUnreadReactions:()=>ve,resolvePrecreatedConvoId:()=>X,restoreMessage:()=>le,restrictViewerToWrite:()=>xe,safeGet:()=>Qe,setChatPermissions:()=>Re,setConvoState:()=>Ue,setDescription:()=>Te,setPeerFlag:()=>Ye,setStickersParams:()=>De,setUnreadReaction:()=>ge,shouldShortPollReactions:()=>ee,undoTemporaryBannerHiding:()=>je,unpinMessage:()=>Oe,updateAcl:()=>Se,updateFlags:()=>be,updateIsNew:()=>Ne,updateMessageFlags:()=>Ae,updatePush:()=>oe,updateSendingFail:()=>Me,updateSortId:()=>ye});var i=t(207739),o=t(429920),s=t(345543),r=t(33200),a=t(95233),d=t(886330);const c=144e5,u=5,l={isMarkedUnread:20,isArchived:23,isBusinessNotify:13,DONT_USE_isMuted:4},m={invite:"all",change_info:"all",change_pin:"all",use_mass_mentions:"all",see_invite_link:"all",call:"all",change_style:"all",change_admins:"owner"};function f(e){return e.history.confirmed.reduce(((e,n)=>("Node"===n.kind&&e.push(n),e)),[])}function h(e){const n=f(e);for(let e=n.length-1;e>=0;e--){const t=n[e]?.item;if("Normal"===t?.kind&&o.isEditable(t,Date.now()))return t}}function p(e){return[...f(e),...e.history.pending]}function k(e,n,t,i=!1){let o=!1;return e.map(((r,a)=>{const d=e[a-1],c="DeletedNode"===r.kind?r.restorable:r.item;if(!d){const e="DeletedNode"!==r.kind&&"Normal"===c.kind&&n<c.cmid;return e&&!o&&(o=!0),{kind:"split",atUnread:e&&t,atDate:!0}}const u="DeletedNode"===d.kind?d.restorable:d.item,l=["gift","graffiti","finishedCall"],m=!(0,s.isSameDate)(u.sentAt,c.sentAt),f="Queued"!==u.kind&&"Queued"!==c.kind&&!c.isOut&&c.cmid>n&&!o;f&&!o&&(o=!0);const h=("Normal"===u.kind||i&&"Queued"===u.kind)&&("Normal"===c.kind||i&&"Queued"===c.kind)&&u.authorId===c.authorId&&!u.expireTTL&&!c.expireTTL&&!c.replyMessage&&!l.some((e=>void 0!==u.attaches[e]))&&!l.some((e=>void 0!==c.attaches[e]))&&!u.attaches.sticker,p="Expired"===u.kind&&"Expired"===c.kind;return!m&&!f&&c.sentAt-u.sentAt<=3e5&&(h||p)?{kind:"continue"}:{kind:"split",atUnread:f,atDate:m}}))}function _(e,n){return a.findNodeByCmid(e.history,n)}function v(e,n){const{node:t}=_(e,n);return"Node"===t?.kind?t.item:void 0}function g(e){return"everything"!==e.push.mode}function C(e){return("ChatConvo"===e.kind||"MessageRequestChatConvo"===e.kind)&&e.isCasper}function I(e,n){if("ChatConvo"!==e.kind)return!1;const t=d.isAdmin(e.members,n),o=e.ownerId===n,s=e.members.count>0;return!i.isFavorites(e.peerId,n)&&s&&(t||o)}function M(e){return"MessageRequestChatConvo"===e.kind||"MessageRequestUserConvo"===e.kind}function E(e){switch(e.kind){case"ChatConvo":return e.isDeleted;case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"BusinessNotify":return!1;default:(0,s.exhaustivenessCheck)(e)}}function y(e){return("MessageRequestChatConvo"===e.kind||"MessageRequestUserConvo"===e.kind)&&"pending"===e.MRStatus}function N(e){return"BusinessNotify"===e.kind}function b(e){return"MessageRequestUserConvo"===e.kind?e.peerId:e.inviterPeerId}function A(e){return!C(e)}function w(e){return"MessageRequestChatConvo"!==e.kind&&!N(e)}function S(e){return"ChatConvo"===e.kind&&e.acl.canInvite}function P(e){return"ChatConvo"===e.kind&&e.acl.canUseMassMentions}function R(e){return Boolean("ChatConvo"===e.kind&&e.activeCall?.canFinishCall&&e.activeCall.id)}function T(e){return!(M(e)||N(e)||("ContactConvo"===e.kind||"UserConvo"===e.kind)&&0===e.history.confirmed.length)}function D(e){return[4,5,6].some((n=>(e.majorSortId&1<<n)>0))}function L(e){return!(Xe(e,l.isArchived)||V(e)||M(e)||C(e))}function G(e){switch(e.kind){case"ChatConvo":return!0;case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"BusinessNotify":return!1;default:(0,s.exhaustivenessCheck)(e)}}function O(e,n,t,s){const r=i.isUserPeerId(n.authorId)||i.isGroupPeerId(n.authorId),a="ChatConvo"===e.kind&&d.isAdmin(e.members,t),c=n.authorId===t,u=!(!r||"ChatConvo"!==e.kind)&&d.isAdmin(e.members,n.authorId),l="ChatConvo"!==e.kind||"in"===e.state;if(s.vkm_admin_can_delete_message){if(a&&c)return!0;if(a&&!u)return!0}switch(!0){case Date.now()-n.sentAt>864e5:case!e.canWrite.allowed:case!l:case o.isCall(n):case i.isFavorites(e.peerId,t):return!1;case a&&!u:case c:return!0;default:return!1}}function U(e){return e.unreadCount>0||Xe(e,l.isMarkedUnread)}function F(e){if("MessageRequestChatConvo"===e.kind)return!1;const n=a.lastNode({history:e.history,withDeleted:!0,withPending:!0,withFailed:!0}),t="DeletedNode"===n?.kind?n.restorable:n?.item;return void 0!==t&&(t.isOut&&Q(e,t))}function x(e){return e.unreadExpireables.size>0}function B(e){return e.unreadReactions.size>0}function $(e){switch(e.kind){case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"BusinessNotify":return!1;case"ChatConvo":return e.unreadMentions.size>0;default:return(0,s.exhaustivenessCheck)(e)}}function V(e){return a.isEmpty(e.history)}function W(e){return e.isNew}function H(e){return e.history.pending.map((e=>e.item))}function K(e){return H(e).filter((e=>e.hasFailed)).length}function q(e){const n=Math.min(...e.unreadMentions.values());return n===1/0?void 0:o.resolveCmid(n)}function j(e){const n=Math.min(...e.unreadReactions.keys());return n===1/0?void 0:o.resolveCmid(n)}function Q(e,n){if(n.peerId!==e.peerId)throw new Error("Передано сообщение не принадлежащее беседе");return"Queued"===n.kind||(n.isOut?n.cmid>e.outReadBy:n.cmid>e.inReadBy)}function Y(e){return e.canWrite.allowed||!e.canWrite.allowed&&"no_access"!==e.canWrite.reason}function X(e){return e}function z(e){return e.majorSortId<=0&&e.minorSortId<=0&&0===e.history.pending.length}function J(e,n){return e.folderIds.has(n)}function Z(e){if(C(e)||"message_request_banner"===e.convoBanner?.name)return!1;switch(e.kind){case"UserConvo":case"GroupConvo":return e.canWrite.allowed;case"ChatConvo":return"in"===e.state&&e.acl.canSendReactions&&(e.canWrite.allowed||"forbid_writing_for_all"===e.canWrite.reason)&&!e.isGroupChannel;case"BusinessNotify":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"ContactConvo":return!1;default:(0,s.exhaustivenessCheck)(e)}}function ee(e){return!("ChatConvo"!==e.kind||!e.shouldShortPollReactions)}function ne(e,n){return!!e.mediaViewerCache.items.find((({cmid:e})=>e===n.cmid))}function te(e){return"GroupConvo"===e.kind&&e.isPromo}function ie(e,n,{invalidateHistory:t}={}){if(void 0===n)return e;if(n?.peerId!==e.peerId)throw new Error("Convo.merge вызван на 2 разных чатах");if(!t){const t=e.history;e.history=n.history,fe(e,t.confirmed),a.insert(e.history,t.confirmed)}return 0===e.majorSortId&&(e.majorSortId=n.majorSortId),"ChatConvo"===e.kind&&"ChatConvo"===n.kind&&(e.members=n.members,e.stickersParams=n.stickersParams,e.inviteLinks=n.inviteLinks),e}function oe(e,n){e.push=n}function se(e,n){a.removePending(e.history,n)}function re(e,n,t,i,o){if(n.peerId!==e.peerId)throw new Error("Передано сообщение не принадлежащее беседе");e.minorSortId<t&&(e.minorSortId=t);const r=a.lastCmid(e.history),d=void 0===r||r<n.cmid;if(!n.isOut&&d&&Q(e,n)&&(e.unreadCount++,"ChatConvo"===e.kind&&i&&e.unreadMentions.add(n.cmid),"Normal"===n.kind&&n.expireTTL&&e.unreadExpireables.add(n.cmid)),Ie(n.isOut,e),o){switch(o.kind){case"InputKeyboardUpsertEvent":e.currentKeyboard=o.keyboard;break;case"InputKeyboardDeleteEvent":delete e.currentKeyboard;break;default:return(0,s.exhaustivenessCheck)(o)}e.currentKeyboard="InputKeyboardUpsertEvent"===o.kind?o.keyboard:void 0}e.mediaViewerCache.hasNext=!0,a.append(e.history,n,"randomId"in n?n.randomId:void 0)}function ae(e,n){a.appendPending(e.history,n),Ie(n.isOut,e)}function de(e,n,t){"ChatConvo"===e.kind&&(e.unreadMentions.delete(n.cmid),t&&Q(e,n)&&e.unreadMentions.add(n.cmid)),e.unreadExpireables.delete(n.cmid),("Normal"===n.kind&&n.expireTTL||"Expired"===n.kind)&&Q(e,n)&&e.unreadExpireables.add(n.cmid),ne(e,n)&&He(e),a.replace(e.history,n)}function ce(e,n){e.history.confirmed.forEach((e=>{if("Node"!==e.kind||"Normal"!==e.item.kind)return;const{replyMessage:t}=e.item;void 0!==t&&"ForeignExpired"!==t.kind&&t.cmid===n&&(e.item.replyMessage=o.expireForeign(t))}))}function ue(e,n,t){if(!n.isOut&&Q(e,n)&&(e.unreadCount=Math.max(0,e.unreadCount-1)),"ChatConvo"===e.kind&&e.unreadMentions.delete(n.cmid),e.unreadExpireables.delete(n.cmid),e.unreadReactions.delete(n.cmid),e.inReadBy===n.cmid){const t=a.findNodeByCmid(e.history,n.cmid);if("Node"===t.status){const n=e.history.confirmed[t.index-1];void 0!==n&&"GapNode"!==n.kind&&(e.inReadBy=a.nodeCmid(n))}}ne(e,n)&&He(e),tn(e,n.cmid,!0),a.remove(e.history,n.cmid,t)}function le(e,n,t){a.restore(e.history,n.cmid,n),"Normal"===n.kind&&tn(e,n.cmid,!1),"ChatConvo"===e.kind&&t&&e.unreadMentions.add(n.cmid),He(e)}function me(e,n,t){const i=[];n.reverse().forEach(((n,s,r)=>{if(0===s&&n.cmid>1&&t.backward&&i.push({kind:"GapNode",fromCmid:o.resolveCmid(1),toCmid:o.resolveCmid(n.cmid-1)}),i.push({kind:"Node",item:n}),s===r.length-1&&t.forward){const t=a.lastCmid(e.history);void 0!==t&&n.cmid<t&&i.push({kind:"GapNode",fromCmid:o.resolveCmid(n.cmid+1),toCmid:o.resolveCmid(t)})}})),fe(e,i),0===i.length?1===e.history.confirmed.length&&"GapNode"===e.history.confirmed[0]?.kind&&(e.history.confirmed=[]):a.insert(e.history,i)}function fe(e,n){n.forEach((n=>{const t="Node"===n.kind&&"randomId"in n.item?n.item.randomId:void 0;t&&se(e,t)}))}function he(e){const n=e.unreadCount>0?e.inReadBy:void 0;a.cleanup(e.history,1.5*r.MESSAGES_PER_PAGE,n)}function pe(e){Ye(e,l.isMarkedUnread,!1)}function ke(e,n,t){if(!(e.inReadBy>n)){if(void 0===t){const i=a.lastCmid(e.history);if(i&&n>=i)t=0;else{const i=e.history.confirmed.filter((t=>{if("Node"!==t.kind)return!1;const i=t.item;return!i.isOut&&Q(e,i)&&i.cmid<=n})).length;t=Math.max(0,e.unreadCount-i)}}switch(e.inReadBy=n,e.unreadCount=t,0===t&&Ye(e,l.isMarkedUnread,!1),e.kind){case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestUserConvo":case"MessageRequestChatConvo":case"BusinessNotify":break;case"ChatConvo":for(const t of e.unreadMentions)t<=n&&e.unreadMentions.delete(t);break;default:(0,s.exhaustivenessCheck)(e)}for(const t of e.unreadExpireables)t<=n&&e.unreadExpireables.delete(t)}}function _e(e,n){e.outReadBy>=n||(e.outReadBy=n)}function ve(e,n){e.unreadReactions=n.reduce(((n,t)=>(n.set(t,e.unreadReactions.get(t)),n)),new Map)}function ge(e,n,t){e.unreadReactions.has(n)&&e.unreadReactions.set(n,t)}function Ce(e,n){e.unreadReactions.delete(n)}function Ie(e,n){e&&n.currentKeyboard?.oneTime&&delete n.currentKeyboard}function Me(e,n,t){const i=a.findPendingNode(e.history,n);void 0!==i&&o.updateFailedStatus(i.item,t)}function Ee(e,n,t){const i=a.findPendingNode(e.history,n);void 0!==i&&o.updateEntrypoint(i.item,t)}function ye(e,n){"majorSortId"in n?e.majorSortId=n.majorSortId:e.minorSortId=n.minorSortId}function Ne(e,n){e.isNew=n}function be(e,n,t){let i;switch(n){case"unset":i=e.peerFlags&~t;break;case"replace":i=t;break;case"set":i=e.peerFlags|t;break;default:(0,s.exhaustivenessCheck)(n)}e.peerFlags=i}function Ae(e,n,t,i){const s=a.findNodeByCmid(e.history,n).node;if(void 0===s||"GapNode"===s.kind)return;const{isDeleted:r,isDeletedForAll:d,isSpam:c}=o.updateFlags(s,t,i);if((r||c)&&"DeletedNode"!==s?.kind||d){ue(e,"DeletedNode"===s.kind?s.restorable:s.item,{isRestorable:!1})}}function we(e){e.state="left",e.acl={canChangeInfo:!1,canChangeInviteLink:!1,canChangePin:!1,canInvite:!1,canPromoteUsers:!1,canSeeInviteLink:!1,canModerate:!1,canCopyChat:!1,canCall:!1,canUseMassMentions:!1,canChangeServiceType:!1,canChangeStyle:!1,canSendReactions:!1},d.reset(e.members),delete e.inviteLinks}function Se(e,n){e.acl=n}function Pe(e){return Boolean(e.isIncognito)}function Re(e,n,t){e.permissions=n,e.isService=t}function Te(e,n){e.description=n}function De(e,n){e.stickersParams=n}function Le(e,n){e.inviteLinks=n}function Ge(e,n){if(e.pinnedMessage){const n=v(e,e.pinnedMessage.cmid);"Normal"===n?.kind&&o.unpinMessage(n)}e.pinnedMessage=n;const t=v(e,n.cmid);"Normal"===t?.kind&&o.pinMessage(t)}function Oe(e){const n=e.pinnedMessage;if(!n)return;delete e.pinnedMessage;const t=v(e,n.cmid);return"Normal"===t?.kind&&o.unpinMessage(t),n}function Ue(e,n){e.state=n}function Fe(e){return"UserConvo"===e.kind?{...e,kind:"MessageRequestUserConvo",MRStatus:"rejected",canWrite:{allowed:!1,reason:"mr_rejected"}}:{...e,MRStatus:"rejected",canWrite:{allowed:!1,reason:"mr_rejected"}}}function xe(e,n,t){e.canWrite={allowed:!1,reason:n,until:t}}function Be(e){e.canWrite={allowed:!0}}function $e(e,n){e.state=n}function Ve(e,n){e.folderIds.add(n)}function We(e,n){e.folderIds.delete(n)}function He(e){e.mediaViewerCache={items:[],hasPrev:!0,hasNext:!0}}function Ke(e){e.convoBanner=void 0}function qe(e){e.convoBanner&&(e.convoBanner.isTemporarilyHidden=!0)}function je(e){e.convoBanner&&(e.convoBanner.isTemporarilyHidden=!1)}function Qe(e,n){const t=e.get(n);if(t)return t;if(s.isDev)throw new Error(`Беседа ${n} не найдена в кэше! Обрати внимание на то как загружаются недостающие данные в сторе.`);return e.get(i.resolveId())}function Ye(e,n,t){e.peerFlags=t?e.peerFlags|1<<n:e.peerFlags&~(1<<n)}function Xe(e,n){return(e.peerFlags&1<<n)>0}function ze(e){switch(e.kind){case"ChatConvo":case"GroupConvo":return e.description;default:return}}function Je(e,n,t,i){return e.mediaViewerCache.items.find((e=>`${t}-${n}-${i}`==`${e.cmid}-${e.id}-${e.position}`))}function Ze(e){return"ChatConvo"===e.kind&&!!e.forbidedWritingForAll&&e.forbidedWritingForAll.value}function en(e,n,t){"ChatConvo"===e.kind&&(e.forbidedWritingForAll={value:n,until:t})}function nn(e){return"birthday"===e.convoBanner?.name}function tn(e,n,t){e.history.confirmed.forEach((e=>{"Node"===e.kind&&"Normal"===e.item.kind&&(e.item=o.updateForeignAvailableStatus(e.item,n,t))}))}},330310:(e,n,t)=>{t.d(n,{FOLDER_NAME_LIMIT:()=>a,convertFlags:()=>b,deleteFolder:()=>_,empty:()=>l,getLockId:()=>m,getSupportedTypes:()=>c,isConvoInSublist:()=>f,isLoaded:()=>u,push:()=>p,refresh:()=>k,reorderFolders:()=>E,replaceFolder:()=>M,resolveId:()=>d,setHasMore:()=>g,setName:()=>I,setSublists:()=>C,setUnreadCounters:()=>v,sorter:()=>h,updateFlags:()=>A});var i=t(503048),o=t(95233),s=t(345543),r=t(33200);const a=16;function d(e){return e}function c(e){let n=[...r.API_GET_FOLDERS_TYPES];return e.vkm_business_folder&&n.push("business"),e.vkm_channels_folder||(n=n.filter((e=>"channels"!==e))),n.join(",")}function u(e,n){return e[n].boundaryMinorId!==1/0}function l(){return[]}function m(e,n){return`folder_${e}_${n}`}function f(e,n,t){for(const i of n)if(e.sublists.has(i.type)&&i.peerIds.has(t.peerId))return!0;return!1}function h(e,n){const t=o.lastNode({history:e.history,withDeleted:!1,withPending:!0,withFailed:!1})?.item,i=o.lastNode({history:n.history,withDeleted:!1,withPending:!0,withFailed:!1})?.item;return"Queued"===t?.kind||"Queued"===i?.kind?(i?.sentAt??0)-(t?.sentAt??0):n.minorSortId!==e.minorSortId?n.minorSortId-e.minorSortId:n.peerId-e.peerId}function p(e,n,t,o,s,r){const a=e.find((e=>e.id===n));if(a){for(const s of o)if(r.vkm_new_convo_folder_logic)w(a,t,s);else{if(!i.isInFolder(s,n))continue;w(a,t,s),k(e,s)}a[t].hasMore=s,a[t].hasMore||(a[t].boundaryMinorId=0)}}function k(e,n){for(const t of e)t.all.peerIds.delete(n.peerId),t.unread.peerIds.delete(n.peerId),i.isDeleted(n)||i.isInFolder(n,t.id)&&(n.minorSortId>=t.all.boundaryMinorId&&t.all.peerIds.add(n.peerId),i.isUnread(n)&&n.minorSortId>=t.unread.boundaryMinorId&&t.unread.peerIds.add(n.peerId))}function _(e,n){const t=e.findIndex((e=>e.id===n));-1!==t&&e.splice(t,1)}function v(e,n,t,i){const o=e.find((e=>e.id===n));o&&(o.unreadCount=t,o.unreadUnmutedCount=i)}function g(e,n,t){e[n].hasMore=t}function C(e,n){e.sublists=new Set(n)}function I(e,n){e.name=n}function M(e,n){const t=e.findIndex((e=>e.id===n.id));-1!==t&&e.splice(t,1,n)}function E(e,n){e.sort(((e,t)=>n.indexOf(e.id)-n.indexOf(t.id)))}const y={default:-1,business:1,channels:2,unread:3,personal:4},N={hasSublist:0};function b(e){if("number"==typeof e){const n={};for(const t of Object.keys(N))n[t]=(e&1<<N[t])>0;const t=(14&e)>>1;let i="default";for(const e of Object.keys(y))switch(e){case"default":case"channels":case"business":case"unread":case"personal":y[e]===t&&(i=e);break;default:(0,s.exhaustivenessCheck)(e)}return{...n,type:i}}let n=0;for(const t of Object.keys(e))switch(t){case"type":y[e.type]>0&&(n|=1<<y[e.type]);break;case"hasSublist":e[t]&&(n|=1<<N[t]);break;default:(0,s.exhaustivenessCheck)(t)}return n}function A(e,n){const t=b(n);for(const n of Object.keys(t))switch(n){case"type":case"hasSublist":e[n]=t[n];break;default:(0,s.exhaustivenessCheck)(n)}}function w(e,n,t){e[n].boundaryMinorId>t.minorSortId&&(e[n].boundaryMinorId=t.minorSortId),"all"===n&&w(e,"unread",t)}},95233:(e,n,t)=>{t.d(n,{append:()=>f,appendPending:()=>k,around:()=>u,cleanup:()=>M,findClosestNodeInSlice:()=>m,findNodeByCmid:()=>c,findPendingNode:()=>l,insert:()=>E,isEmpty:()=>s,lastCmid:()=>a,lastConfirmedNode:()=>d,lastNode:()=>r,nodeCmid:()=>b,nodeSentAt:()=>A,remove:()=>p,removePending:()=>_,replace:()=>h,restore:()=>v});var i=t(345543),o=t(453934);function s(e){const{confirmed:n,pending:t}=e;return 0===n.length&&0===t.length}function r({history:e,withPending:n,withDeleted:t,withFailed:o}){const{confirmed:s,pending:r}=e;if(n)for(let e=r.length-1;e>=0;e--){const n=r[e];if(n&&(o||!n.item.hasFailed))return n}for(let e=s.length-1;e>=0;e--){const n=s[e];if(!n)throw new Error("item по индексу не существует");switch(n.kind){case"Node":return n;case"DeletedNode":if(t)return n;continue;case"GapNode":return;default:return(0,i.exhaustivenessCheck)(n)}}}function a(e){const n=d(e);if(void 0!==n)switch(n.kind){case"GapNode":return n.toCmid;case"Node":case"DeletedNode":return b(n);default:return(0,i.exhaustivenessCheck)(n)}}function d(e){const{confirmed:n}=e;return n[n.length-1]}function c(e,n){const{confirmed:t}=e,o=t.findIndex((e=>{switch(e.kind){case"GapNode":return e.fromCmid<=n&&e.toCmid>=n;case"Node":case"DeletedNode":return b(e)===n;default:return(0,i.exhaustivenessCheck)(e)}})),s=t[o];return"Node"===s?.kind?{status:"Node",node:s,index:o}:void 0===s||"DeletedNode"===s.kind?void 0!==s&&void 0!==o?{status:"Deleted",node:s,index:o}:{status:"Deleted"}:{status:"NotLoaded",node:s,index:o}}function u(e,n){const{confirmed:t,pending:i}=e,o=t[0];if(!o)return{nodes:[],pendingNodes:i.length>0?i:void 0};if("GapNode"===o.kind&&o.toCmid>=n)return;let s,r=!1,a=0,d="GapNode"===o.kind?o:{kind:"GapNode",fromCmid:Math.min(n-1,0),toCmid:Math.min(n-1,0)};for(s=a;s<t.length;s++){const e=t[s];if(!e)throw new Error("item по индексу не существует");if("GapNode"===e.kind){if(d.toCmid<n&&e.fromCmid>n){r=!0;break}a=s,d=e}else if(s===t.length-1&&d.toCmid<n){r=!0;break}}return r?t.slice(a,s+1).reduce(((e,n,t,o)=>{if("GapNode"===n.kind){if(0===t)e.topGap=n;else{if(t!==o.length-1)throw new Error("В середине результата History.around не может быть гэпов");e.bottomGap=n}return e}return e.nodes.push(n),t===o.length-1&&void 0===e.bottomGap&&i.length>0&&(e.pendingNodes=i),e}),{nodes:[]}):void 0}function l(e,n){const{pending:t}=e;return t.find((e=>e.item.randomId===n))}function m(e,n,t=!1){for(let i=0;i<e.nodes.length;i++){const o=e.nodes[i];if(!o)continue;const s=b(o),r=e.nodes[i+1],a=r&&b(r);if(0===i&&n<s||i===e.nodes.length-1&&n>s||n===s)return o;if(a&&s<n&&n<a)return t?r:o}}function f(e,n,t){const i=(0,o.castDraft)(n);void 0!==t&&_(e,t),y(e,g([{kind:"Node",item:i}],a(e)))}function h(e,n){const{confirmed:t}=e,s=(0,o.castDraft)(n),{status:r,node:a,index:d}=c(e,s.cmid);if("NotLoaded"!==r){if("Deleted"!==r)return t[d]={kind:"Node",item:s},a.item;if(i.isDev)throw new Error("Попытка заменить удаленный узел истории")}}function p(e,n,t){const{confirmed:i}=e,{status:o,node:s,index:r}=c(e,n);"NotLoaded"!==o&&"Deleted"!==o&&(t.isRestorable?"Node"===s.kind&&(i[r]={kind:"DeletedNode",isSpam:t.isSpam,restorable:s.item}):i.splice(r,1))}function k(e,n){const{pending:t}=e;t.push({kind:"PendingNode",item:(0,o.castDraft)(n)})}function _(e,n){const{pending:t}=e,i=t.findIndex((e=>e.item.randomId===n));-1!==i&&t.splice(i,1)}function v(e,n,t){const{confirmed:i}=e,{status:o,node:s,index:r}=c(e,n);if("NotLoaded"!==o&&"Node"!==o)if(void 0===t)void 0!==s&&(i[r]={kind:"Node",item:s.restorable});else{y(e,g([{kind:"Node",item:t}],a(e)))}}function g(e,n){const t=e[0],i=t&&b(t),o=e[e.length-1],s=o&&b(o);return{topGap:void 0!==i&&i>1?{kind:"GapNode",fromCmid:1,toCmid:i-1}:void 0,nodes:e,bottomGap:void 0!==n&&void 0!==s&&s<n?{kind:"GapNode",fromCmid:s+1,toCmid:n}:void 0}}const C=.2,I=.2;function M(e,n,t){const{confirmed:i}=e;if(i.length<n)return;const o=a(e);if(void 0===o)return;const s=Math.floor(n/1.5),r={confirmed:[{kind:"GapNode",fromCmid:1,toCmid:o}],pending:[]},d=void 0===o?void 0:u(e,o),c=void 0===t?void 0:u(e,t);if(void 0!==d){y(r,g(void 0===c?d.nodes.slice(-s):d.nodes.slice(-Math.floor(s*C)),o))}if(void 0!==c){const e=c.nodes.findIndex((e=>b(e)===t));if(-1!==e){const n=Math.max(e-Math.floor(s*I),0);y(r,g(c.nodes.slice(n,e+Math.floor(s*(1-I-(void 0===d?0:C)))),o))}}e.confirmed=r.confirmed}function E(e,n){if(0===n.length)return void(e.confirmed=[]);if(0===e.confirmed.length)return void(e.confirmed=(0,o.castDraft)(n));!function(e,n){const{confirmed:t}=e,i=t[t.length-1],o=n[n.length-1];if(void 0===i||void 0===o)return;const s="GapNode"===o.kind?o.toCmid:b(o),r="GapNode"===i.kind?i.toCmid:b(i);"GapNode"!==i.kind&&r>s&&("GapNode"===o.kind?o.toCmid=r:n.push({kind:"GapNode",fromCmid:s+1,toCmid:r}));s>r&&("GapNode"===i.kind?i.toCmid=s:t.push({kind:"GapNode",fromCmid:r+1,toCmid:s}))}(e,n);n.reduce(((e,t,i)=>(0===i&&"GapNode"!==t.kind&&e.push(-1),i===n.length-1&&"GapNode"!==t.kind&&e.push(n.length),"GapNode"===t.kind&&e.push(i),e)),[]).forEach(((t,i,o)=>{const s=o[i+1];if(void 0!==s){const i=n[t],o=n[s],r=n.slice(t+1,s).reduce(((e,n)=>{if("GapNode"===n.kind)throw new Error("Не может быть гэп узлов между гэпами");return e.push(n),e}),[]);if(void 0!==i&&"GapNode"!==i.kind)throw new Error("Не гэп используется как гэп");if(void 0!==o&&"GapNode"!==o.kind)throw new Error("Не гэп используется как гэп");y(e,{topGap:i,bottomGap:o,nodes:r})}}))}function y(e,n){const{confirmed:t}=e;let i,s=-1;if(void 0!==n.topGap){s=N(e,n.topGap.toCmid);const i=t[s];if(void 0!==i){("GapNode"===i.kind?i.fromCmid:b(i))>n.topGap.toCmid&&s--}"GapNode"===i?.kind&&i.fromCmid<=n.topGap.toCmid&&i.toCmid>n.topGap.toCmid&&(t.splice(s,0,{kind:"GapNode",fromCmid:i.fromCmid,toCmid:n.topGap.toCmid}),i.fromCmid=n.topGap.toCmid+1)}if(void 0!==n.bottomGap){i=N(e,n.bottomGap.fromCmid);const o=t[i];"GapNode"===o?.kind&&o.fromCmid<n.bottomGap.fromCmid&&(o.fromCmid=n.bottomGap.fromCmid)}const r=[...t.slice(0,s+1),...(0,o.castDraft)(n.nodes),...void 0!==i?t.slice(i):[]];e.confirmed=r}function N(e,n){const{confirmed:t}=e;for(let e=0;e<t.length;e++){const i=t[e],o=t[e-1];if(!i)return-1;if(0===e){if("GapNode"===i.kind?i.fromCmid>n:b(i)>n)return-1}if("GapNode"===i.kind&&n>=i.fromCmid&&n<=i.toCmid)return e;const s="GapNode"===i.kind?i.fromCmid:b(i);if(s===n)return e;if(void 0===o)continue;const r="GapNode"===o.kind?o.toCmid:b(o);if(s>n&&r<n)return e}return t.length}function b(e){switch(e.kind){case"Node":return e.item.cmid;case"DeletedNode":return e.restorable.cmid;default:(0,i.exhaustivenessCheck)(e)}}function A(e){switch(e.kind){case"Node":case"PendingNode":return e.item.sentAt;case"DeletedNode":return e.restorable.sentAt;default:(0,i.exhaustivenessCheck)(e)}}},429920:(e,n,t)=>{t.d(n,{MESSAGE_FLAGS:()=>S,canChangeMessagePlayedStatus:()=>R,checkMessageHasChanged:()=>x,convertFlags:()=>P,edit:()=>E,editFailed:()=>y,expireForeign:()=>_,getCmid:()=>c,getForceAutoPlay:()=>B,getMessageAttachmentsCount:()=>G,hasText:()=>O,isCall:()=>f,isEditable:()=>m,isMessageEdited:()=>D,isReactionsAvailable:()=>h,newQueued:()=>w,pinMessage:()=>I,removeEmptyForwards:()=>F,removeEmptyForwardsFromQueued:()=>U,resolveCmid:()=>a,resolveRandomId:()=>d,setCurrentUserReaction:()=>T,setReactions:()=>L,toForeign:()=>k,toPinned:()=>p,toPlainText:()=>u,toRawText:()=>l,unpinMessage:()=>M,updateCmid:()=>g,updateEntrypoint:()=>C,updateFailedStatus:()=>v,updateFlags:()=>N,updateForeignAvailableStatus:()=>A});var i=t(453934),o=t(803854),s=t(243860),r=t(345543);function a(e){return Number.isNaN(e)&&(e=0),!e||e<0?0:e}function d(e){return!e||e>0?0:e}function c(e){return"Normal"===e.kind?e.cmid:"Foreign"===e.kind&&"rootCmid"in e?e.rootCmid:void 0}function u(e,n){return s.toPlainText(e.chunks,n)}function l(e){return s.toRawText(e.chunks)}function m(e,n){const t=n-e.sentAt<864e5,i=e.isOut&&e.authorId===e.peerId;return(t||e.isPinned||i)&&e.isOut&&!f(e)&&!e.attaches.voice&&!e.attaches.sticker&&!e.attaches.ugcSticker&&!e.attaches.gift&&!e.attaches.graffiti&&!e.attaches.moneyTransfer&&!e.attaches.moneyRequest&&!e.attaches.videoMessage&&!e.attaches.miniAppWidgets}function f(e){return!!e.attaches.activeCall||!!e.attaches.finishedCall}function h(e){return!e.expireTTL&&!e.deleteTTL&&!(e.attaches.gift||e.attaches.activeCall||e.attaches.finishedCall)}function p(e){const{cmid:n,peerId:t,authorId:i,chunks:o,sentAt:s,forwardedMessages:r,replyMessage:a,attaches:d}=e;return{kind:"Pinned",cmid:n,peerId:t,authorId:i,chunks:o,sentAt:s,forwardedMessages:r,replyMessage:a,attaches:d,isUnavailable:!1}}function k(e){const{message:n,...t}=e,{kind:i,randomId:o,isOut:s,isImportant:r,replyMessage:a,...d}=n;return{kind:"Foreign",...d,...t}}function _(e){const{kind:n,replyMessage:t,forwardedMessages:i,chunks:o,attaches:s,updatedAt:r,expireTTL:a,deleteTTL:d,...c}=e;return{kind:"ForeignExpired",...c}}function v(e,n,t){e.hasFailed=n,e.errorCode=t}function g(e,n){e.cmid=n}function C(e,n){e.entrypoint=n}function I(e){e.isPinned=!0}function M(e){e.isPinned=!1}function E(e,{text:n,attaches:t,keepForwarded:o}){const r=(0,i.current)(e);e.chunks=s.fromClientText(n),e.attaches=t;const a=r.editing?.originalEditedMessage||r;e.editing={status:"pending",originalEditedMessage:a},o||(e.replyMessage=void 0,e.forwardedMessages=void 0)}function y(e){e.editing&&(e.editing.status="failed")}function N(e,n,t){const i="DeletedNode"===e.kind?e.restorable:e.item,o={isOut:i.isOut,isSpam:!1,isDeleted:!1,isDeletedForAll:!1,noPush:!1,DONT_USE_ME_isUnread:!1,DONT_USE_ME_isStealth:!1,DONT_USE_ME_skipUnread:!1};let s,a;switch(i.kind){case"Normal":s=P({...o,isImportant:i.isImportant,isPlayed:!!i.isPlayed,hasReactions:"Node"===e.kind&&i.reactions.size>0});break;case"Service":case"Expired":s=P({...o,isImportant:!1,isPlayed:!1,hasReactions:!1});break;default:(0,r.exhaustivenessCheck)(i)}switch(n){case"unset":a=P(s&~t);break;case"replace":a=P(t);break;case"set":a=P(s|t);break;default:(0,r.exhaustivenessCheck)(n)}const{isImportant:d,isSpam:c,isDeleted:u,isDeletedForAll:l,isPlayed:m,isOut:f,hasReactions:h,noPush:p,DONT_USE_ME_isStealth:k,DONT_USE_ME_isUnread:_,DONT_USE_ME_skipUnread:v,...g}=a;switch(i.kind){case"Normal":i.isImportant=d,i.isOut=f,i.isPlayed=m;break;case"Service":case"Expired":break;default:(0,r.exhaustivenessCheck)(i)}return{isDeleted:u,isDeletedForAll:l,isSpam:c}}function b(e,n,t){for(let i=0;i<e.length;i++){const o=e[i];o&&(o.cmid===n&&(o.isUnavailable=t),o?.forwardedMessages?.length&&b(o.forwardedMessages,n,t))}}function A(e,n,t){return e.replyMessage||e.forwardedMessages?("Foreign"===e?.replyMessage?.kind&&e.replyMessage.cmid===n&&(e.replyMessage.isUnavailable=t),e?.forwardedMessages&&b(e.forwardedMessages,n,t),e):e}function w(e,n,t){const i=d(-e.sentAt%Math.abs(r.MIN_INT_32)),o=void 0!==n?k({message:n,rootPeerId:e.peerId,rootRandomId:i}):void 0,a=t?.map((n=>k({message:n,rootPeerId:e.peerId,rootRandomId:i})));return{...e,kind:"Queued",text:e.text,chunks:s.fromClientText(e.text),hasFailed:!1,errorCode:void 0,randomId:i,replyMessage:o,forwardedMessages:a&&(0,r.isNonEmptyArray)(a)?a:void 0}}const S={DONT_USE_ME_isUnread:0,isOut:1,isImportant:3,isSpam:6,isDeleted:7,isPlayed:12,DONT_USE_ME_isStealth:16,isDeletedForAll:17,noPush:20,DONT_USE_ME_skipUnread:23,hasReactions:24};function P(e){return(0,r.getFlagValueByBitOffset)(e,S)}function R(e){if(e.isOut)return!1;return!(!e.attaches.voice&&!e.attaches.videoMessage)&&!e.isPlayed}function T(e,n){e.reactionId=n}function D(e){return!!(e.updatedAt&&!e.attaches.voice)}function L(e,n){const t=new Set(n.map((e=>e.reactionId)));Array.from(e.reactions.keys()).filter((e=>!t.has(e))).forEach((n=>e.reactions.delete(n))),n.forEach((n=>{e.reactions.set(n.reactionId,n)}))}function G(e){let n=0;return n+=o.count(e.attaches),e.replyMessage&&"ForeignExpired"!==e.replyMessage.kind&&(n+=G(e.replyMessage)),n+=e.forwardedMessages?.reduce(((e,n)=>e+G(n)),0)??0,n}function O(e){return 0!==e.chunks.length}function U(e){return e.forwardedMessages?{...e,forwardedMessages:F(e.forwardedMessages)}:e}function F(e){return e.reduce(((e,n)=>(!O(n)&&!o.kindsCount(n.attaches)&&n.forwardedMessages?e.push(...n.forwardedMessages):e.push(n),e)),[])}function x({draft:e,message:n}){return l(n)!==e.text||e.keepForwarded!==Boolean(n.replyMessage||n.forwardedMessages?.length)||!(0,r.isShallowEqual)(o.ids(e.attaches),o.ids(n.attaches))||Boolean(e.attaches.geo)!==Boolean(n.attaches.geo)}function B(e){return"forceAutoPlayMedia"in e&&e.forceAutoPlayMedia||!1}},377836:(e,n,t)=>{t.d(n,{DONUT_DURATION:()=>a,allNormalSpreadedComments:()=>g,changeCommentsCanPost:()=>M,changeCommentsOrder:()=>C,deleteComment:()=>v,findCommentByCmid:()=>k,isDonut:()=>f,isDonutPlaceholder:()=>m,isEmpty:()=>l,merge:()=>u,newPending:()=>I,replaceComment:()=>_,resolveCmid:()=>r,toRawText:()=>d,toWallAttach:()=>c});var i=t(345543),o=t(243860),s=t(207739);function r(e){return Number.isNaN(e)&&(e=0),!e||e<0?0:e}const a=[-1,1,2,3,4,5,6,7];function d(e){return o.toRawText(e.chunks)}function c(e){return{id:e.cmid,kind:"Wall",date:e.sentAt,authorId:s.resolveId(e.channelId),ownerId:s.resolveId(e.channelId),attaches:e.attaches,chunks:e.chunks,isAds:!1,isDeleted:!1,isVisibleFor:"all",views:e.views}}function u(e,n){return void 0!==n&&"Normal"===e.kind&&(e.comments={...e.comments,history:n.comments.history,oneLevelCount:n.comments.oneLevelCount,order:n.comments.order}),e}function l(e){return!(0!==e.chunks.length||Object.keys(e.attaches).find((e=>"unknown"!==e))||"Normal"===e.kind&&e.donut?.placeholder?.text)}function m(e){return Boolean(e.donut?.placeholder)}function f(e){return Boolean(e.donut?.isDonut)}function h(e,n,t){for(let i=0;i<e.length;i++){const o=e[i];if(!o)throw new Error("Wrong comment index access");const s=!t({...n,comment:o,onLevelIndex:i}),r=!s&&!h(o.replies.history,{kind:"Comment",source:o},t);if(s||r)return!1}return!0}function p(e,n){h(e.comments.history,{kind:"Post",source:e},n)}function k(e,n){let t;return p(e,(e=>e.comment.cmid!==n||(t=e.comment,!1))),t}function _(e,n){p(e,(e=>e.comment.cmid!==n.cmid||("Post"===e.kind&&(e.source.comments.history[e.onLevelIndex]=n),"Comment"===e.kind&&(e.source.replies.history[e.onLevelIndex]=n),!1)))}function v(e,n){p(e,(e=>e.comment.cmid!==n||("Post"===e.kind&&(e.source.comments.history.splice(e.onLevelIndex,1),e.source.comments.count-=1,e.source.comments.oneLevelCount-=1),"Comment"===e.kind&&(e.source.replies.history.splice(e.onLevelIndex,1),e.source.replies.count-=1),!1)))}function g(e){const n=[];return p(e,(e=>("Normal"===e.comment.kind&&n.push(e.comment),!0))),n}function C(e,n){e.comments.history=[],e.comments.order=n,e.comments.nextFrom=void 0,e.comments.prevFrom=void 0}function I(e,n){const t=function(e){if(e>=0){if(i.isDev)throw new Error("Рандом айди поста должен быть меньше 0!");return 0}return e%2**31}(-e.sentAt);return{...e,kind:"Pending",randomId:t,chunks:o.fromClientText(n),hasFailed:!1}}function M(e,n){e.comments.canPost=n,e.comments.canView=n||0!==e.comments.count}}}]);try{stManager.done("dist/web/chunks/e8b51364.1ce1ee2f.js")}catch(e){}