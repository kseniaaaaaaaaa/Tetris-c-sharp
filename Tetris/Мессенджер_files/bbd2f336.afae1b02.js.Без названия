"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[11783],{337057:(e,t,n)=>{n.d(t,{VkIndexer:()=>o});var o=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},o=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),a=o.length;a--;){var s=o[a],i="";if(s){for(var r=0;r<6;r++){var c=s.charCodeAt(r);if(c){var l=this.toTranslit[c],d=s.substr(r,1);i+=null!=l?l:d}}n[i]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),o=n.length;o--;){var a={},s=n[o],i="",r="",c="",l=s.length>1;if(s){for(var d=0;d<6;d++){var h=s.charCodeAt(d);if(h){var u=this.toTranslit[h],g=s.substr(d,1);if(i+=null!=u?u:g,l){var p=this.toLocalCase[g],m=this.toLocalTranslit[h];r+=null!=p?p:g,c+=null!=m?m:g}}}a[i]=1,l&&(a[r]=2,a[c]=3),t.push(a)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,o=0;o<6;o++){var a=e.substr(o,1)||-1;n=n[a]?n[a]:n[a]=5==o?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var o in n)if(n.hasOwnProperty(o)){for(var a=this.index,s=0;s<6;s++){var i=o.substr(s,1)||-1;if(!a[i])break;a=a[i]}if(a.length)for(var s in a)if(this.equals(a[s],e)){a.splice(s,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(a(e[0])||a(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var o=e.shift();o&&n.push(o)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var o in n)n.hasOwnProperty(o)&&this.toIndexTree(o,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),o=[],a=!1;for(var s in n)if(n.hasOwnProperty(s)){if(a&&!o)break;var i=this.localSearch(n[s],0,t);i.sort((function(e,t){return e._order-t._order})),o=a?this.intersect(o,i):i,a=!0}for(var r=o[0],c=o.length+1,l=[],d=1;d<c;d++){var h=o[d];h!=r&&(l.push(r),r=h)}return l},e.prototype.localSearch=function(e,t,n){if(!n)return[];var o={};for(var a in e)e.hasOwnProperty(a)&&(o[i=a.substr(t,1)||-1]||(o[i]={}),o[i][a]=1);if(6==t++)return n;var s=[];for(var i in o)if("-1"===i)for(var r in n)n.hasOwnProperty(r)&&s.push.apply(s,this.localSearch(o[i],t,n[r]));else{var c=this.localSearch(o[i],t,n[i]);s.push.apply(s,c)}return s},e}();function a(e){return!isNaN(e)}},957904:(e,t,n)=>{n.d(t,{Icon20MailOutline:()=>o});var o=(0,n(28178).makeIcon)("Icon20MailOutline","mail_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="mail_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M6.577 2.5h6.846c1.773 0 2.418.18 3.067.528.64.343 1.14.845 1.483 1.486.347.65.527 1.296.527 3.074v4.824c0 1.778-.18 2.424-.527 3.074a3.57 3.57 0 0 1-1.483 1.486c-.649.347-1.294.528-3.067.528H6.577c-1.773 0-2.418-.18-3.067-.528a3.57 3.57 0 0 1-1.483-1.486c-.347-.65-.527-1.296-.527-3.074V7.588c0-1.778.18-2.424.527-3.074A3.57 3.57 0 0 1 3.51 3.028c.649-.347 1.294-.528 3.067-.528M3 12.412V7.588c0-1.598.156-1.997.33-2.328l4.463 4.464c.28.28.52.52.736.703.226.192.473.363.776.462a2.25 2.25 0 0 0 1.39 0c.303-.099.55-.27.776-.462.215-.182.456-.424.736-.703L16.67 5.26c.173.331.329.73.329 2.328v4.824c0 1.663-.169 2.027-.35 2.368q-.303.567-.868.87c-.34.181-.701.35-2.36.35H6.578c-1.658 0-2.02-.169-2.359-.35a2.07 2.07 0 0 1-.867-.87C3.169 14.44 3 14.075 3 12.412M13.423 4H6.577c-1.326 0-1.823.108-2.142.244l4.398 4.399c.306.305.504.502.666.64.156.133.23.166.27.179a.75.75 0 0 0 .463 0c.04-.013.113-.046.269-.179.162-.138.36-.335.666-.64l4.398-4.399C15.245 4.108 14.75 4 13.423 4" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},415080:(e,t,n)=>{n.d(t,{Icon20PhoneOutline:()=>o});var o=(0,n(28178).makeIcon)("Icon20PhoneOutline","phone_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" id="phone_outline_20"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v20H0z" opacity=".1" /><path fill="currentColor" fill-rule="nonzero" d="m7.78 2.7.7.833c1.373 1.628 1.229 4.054-.299 5.582l-.297.296c.226.38.633.878 1.23 1.475.53.53.984.912 1.344 1.149l.13.082.298-.297c1.526-1.527 3.95-1.672 5.58-.302l.833.702c1.46 1.229 1.602 3.419.346 4.894a3.86 3.86 0 0 1-2.29 1.289l-.506.06c-3.005.292-6.037-1.16-9.094-4.217s-4.51-6.09-4.226-9.025l.06-.515a3.83 3.83 0 0 1 1.3-2.354l.168-.135c1.462-1.107 3.54-.924 4.723.484m-3.911.788c-.321.276-.562.633-.698 1.033a2.4 2.4 0 0 0-.115.552c-.343 2.548.898 5.25 3.76 8.112 2.86 2.862 5.562 4.103 8.123 3.758a2.38 2.38 0 0 0 1.571-.81c.719-.844.636-2.082-.177-2.766l-.833-.701-.142-.112c-1.02-.739-2.471-.614-3.411.326l-.597.598-.088.076a.9.9 0 0 1-.862.133c-.648-.238-1.425-.818-2.346-1.74-.923-.923-1.503-1.7-1.74-2.347a.9.9 0 0 1 .209-.95l.598-.597.129-.137c.862-.987.906-2.44.084-3.416l-.702-.834-.112-.122c-.7-.697-1.853-.735-2.651-.056" /></g></symbol>',20,20,!1,void 0)},826794:(e,t,n)=>{n.d(t,{Icon20Sync:()=>o});var o=(0,n(28178).makeIcon)("Icon20Sync","sync_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="sync_20"><clipPath id="sync_20_a"><path d="M0 0h20v20H0z" /></clipPath><g fill="currentColor" clip-path="url(#sync_20_a)"><path d="M16.25 1.5a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1 0-1.5h1.081a6.98 6.98 0 0 0-4.33-1.5 6.98 6.98 0 0 0-4.95 2.05 6.98 6.98 0 0 0-1.973 5.996c.073.483-.278.954-.766.954a.69.69 0 0 1-.69-.563A8.5 8.5 0 0 1 1.5 10c0-2.174.83-4.35 2.49-6.01A8.48 8.48 0 0 1 10 1.5c1.958 0 3.918.673 5.5 2.019V2.25a.75.75 0 0 1 .75-.75M3 14.75a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H5.669C6.935 16.5 8.467 17 10 17a6.98 6.98 0 0 0 4.95-2.05 6.98 6.98 0 0 0 1.972-5.996C16.85 8.47 17.2 8 17.688 8a.69.69 0 0 1 .69.563q.122.714.122 1.437c0 2.174-.83 4.35-2.49 6.01A8.48 8.48 0 0 1 10 18.5a8.48 8.48 0 0 1-5.5-2.019v1.269a.75.75 0 0 1-1.5 0z" /></g></symbol>',20,20,!1,void 0)},600292:(e,t,n)=>{n.d(t,{default:()=>o});const o={container:"GroupChatInvites-module__container--c5rBK"}},853634:(e,t,n)=>{function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="m7.28 4.99-.52 1.2c-.04.1-.06.14-.09.17a.28.28 0 0 1-.09.07.62.62 0 0 1-.17.04l-.75.1c-2.15.3-3.23.46-3.68.96a1.86 1.86 0 0 0-.44 1.61c.13.67.98 1.35 2.68 2.7l.27.23c.08.06.12.09.14.13a.28.28 0 0 1 .04.11c.01.05 0 .1-.02.2l-.08.44c-.48 2.5-.71 3.75-.34 4.36a1.85 1.85 0 0 0 1.5.9c.72.02 1.7-.79 3.65-2.42l.34-.28c.1-.08.15-.12.2-.14a.28.28 0 0 1 .16 0c.06.02.11.06.21.14l.34.28c1.95 1.63 2.93 2.44 3.65 2.41a1.85 1.85 0 0 0 1.5-.89c.37-.6.14-1.86-.34-4.36l-.08-.45c-.02-.1-.03-.14-.02-.19a.28.28 0 0 1 .04-.11.62.62 0 0 1 .14-.13l.27-.22c1.7-1.36 2.55-2.04 2.68-2.7a1.86 1.86 0 0 0-.44-1.62c-.45-.5-1.53-.65-3.68-.96l-.75-.1c-.09-.02-.13-.02-.17-.04a.28.28 0 0 1-.1-.07l-.08-.16-.52-1.21c-.86-2-1.3-2.99-1.9-3.29a1.85 1.85 0 0 0-1.66 0C8.57 2 8.14 3 7.28 5Z"/></svg>',name:"favorite_20"}}n.d(t,{getIcon20Favorite:()=>o})},411868:(e,t,n)=>{function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M10.4 3.13a.92.92 0 0 0-.82 0c-.05.03-.19.13-.44.6-.24.45-.52 1.09-.92 2-.16.38-.33.74-.48 1.12-.02.05-.09.2-.2.33a1.02 1.02 0 0 1-.33.25c-.16.08-.35.1-.38.1l-.68.1c-1 .14-1.69.24-2.19.35-.52.13-.66.23-.7.27a.92.92 0 0 0-.21.8c0 .05.07.22.46.59.37.35.92.8 1.7 1.42l.25.2a1.02 1.02 0 0 1 .42 1.13l-.08.41a35.03 35.03 0 0 0-.43 2.56c-.07.64 0 .82.03.86a.92.92 0 0 0 .74.44c.05 0 .24-.02.77-.39.49-.34 1.13-.87 2.03-1.62l.31-.26.15-.12c.07-.04.17-.11.32-.15a1.02 1.02 0 0 1 .55 0c.15.04.25.1.32.15l.15.12.31.26c.9.75 1.54 1.28 2.03 1.62.53.37.72.4.77.4a.92.92 0 0 0 .74-.45c.03-.04.1-.22.03-.86-.06-.6-.21-1.4-.43-2.56l-.08-.42a1.25 1.25 0 0 1-.02-.4 1.03 1.03 0 0 1 .15-.42c.1-.17.26-.28.3-.3l.24-.2c.78-.63 1.33-1.07 1.7-1.42.39-.37.45-.54.46-.59a.92.92 0 0 0-.22-.8c-.03-.04-.17-.14-.7-.27-.5-.11-1.18-.21-2.18-.35l-.7-.1c-.04 0-.2-.03-.36-.1a1.02 1.02 0 0 1-.33-.25c-.12-.14-.19-.31-.2-.34l-.48-1.1c-.4-.92-.68-1.56-.92-2-.25-.48-.4-.58-.44-.6ZM8.9 1.76a2.45 2.45 0 0 1 2.2 0c.5.25.82.73 1.1 1.24.28.51.58 1.22.96 2.09l.41.95.53.07c.94.14 1.7.24 2.28.38.56.13 1.11.32 1.49.74a2.46 2.46 0 0 1 .58 2.12c-.11.55-.5 1-.9 1.4-.43.4-1.03.89-1.78 1.48l-.11.1.04.22c.21 1.1.38 1.99.45 2.66.06.64.07 1.3-.25 1.81a2.46 2.46 0 0 1-1.99 1.18c-.6.02-1.18-.3-1.7-.67-.56-.38-1.24-.95-2.1-1.67l-.11-.09-.11.09c-.87.72-1.55 1.29-2.1 1.67-.53.37-1.1.7-1.71.67a2.46 2.46 0 0 1-2-1.18c-.3-.51-.3-1.17-.24-1.81.07-.67.24-1.55.45-2.66l.04-.23-.11-.09c-.74-.6-1.35-1.07-1.77-1.48-.42-.4-.8-.85-.9-1.4a2.46 2.46 0 0 1 .58-2.12c.37-.42.92-.61 1.48-.74.58-.14 1.34-.24 2.28-.38l.53-.07.4-.95c.39-.87.7-1.58.97-2.1.28-.5.6-.98 1.1-1.23Z" clip-rule="evenodd"/></svg>',name:"favorite_outline_20"}}n.d(t,{getIcon20FavoriteOutline:()=>o})},693360:(e,t,n)=>{function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M12.6 2.22a.75.75 0 0 0-1.27.38l-.3 1.54a.3.3 0 0 1-.09.16L8.48 6.76a.3.3 0 0 1-.19.08l-3.86.3a1.01 1.01 0 0 0-.63 1.73l2.96 2.96-4.47 4.46a1 1 0 0 0 1.42 1.42l4.46-4.47 2.97 2.96c.61.62 1.65.22 1.72-.63l.3-3.86a.3.3 0 0 1 .08-.19l2.47-2.46a.3.3 0 0 1 .15-.08l1.54-.31c.58-.12.8-.84.38-1.27L12.6 2.22Z"/></svg>',name:"pin_20"}}n.d(t,{getIcon20Pin:()=>o})},345015:(e,t,n)=>{n.d(t,{checkContactListLoaded:()=>de,mount:()=>xe});var o=n(659397),a=n(585703),s=n(372292),i=n(902947),r=n(93367),c=n(124794),l=n(251087),d=n(471828),h=n(646952),u=n(307092),g=n(798738),p=n(790513),m=n(571262),_=n(67427),C=n(266767),v=n(180768),f=n(263270),b=n(624012),I=n(682715),w=n(580423),S=n(910958),L=n(922749),A=n(199015),T=n(70689),y=n(636322),x=n(681495),k=n(226059),M=n(693360),P=n(919916),E=n(853634),R=n(411868),N=n(846138),j=n(184132),B=n(385676),F=n(368210),O=n(977584),D=n(681482),H=n(319780),U=n(808265),q=n(563567),G=n(286744),V=n(977053);const $="_im_action",z="_im_page_peer_name",K="_ui_menu",W="_im_dialog_action_wrapper",Y="_im_dialog_call_action_wrapper",Z="_im_header_icon",Q="_im_mess_actions",J="_im_page_action",X="_im_chat_verified",ee="im-page--chat-header_chat",te="im-page--chat-header_vkcomgroup",ne="_im_page_peer_name",oe="_im_chat_members",ae="_im_page_reconnect",se="._im_page_status",ie="im-page--chat-header_reconnected",re="im-page--header-action_loading";function ce(e,t,n){return!e.map((e=>{const o=(0,C.getMessage)(t,n,e);return o&&(0,v.isImportant)(o)})).reduce(((e,t)=>e&&t),!0)}function le(e,t){const n=t.get(),o=n.peer,a=n.tabs[o].pinned;return 1===e.length&&a&&e[0]===(0,C.parserMessage)(a).messageId}function de(e){return e.get().contactsList?Promise.resolve(e):e.set(g.getContactsList)}function he(e,t,n){const a=d.getLang("mail_selected_shorted",t.length);me({actions:!0},"im-page--chat-header"),(0,T.val)((0,T.geByClass1)("im-page--selected-messages"),(0,y.getTemplate)("im_selected_messages",{label:a.replace("{count}",t.length),tip:d.getLang("mail_deselect_all")}));const s=(0,C.getTab)(n,n.get().peer),i=t.some((e=>{const t=(0,C.getMessage)(n,n.get().peer,e);if(!t)return!1;const o=t.attaches[0];return!(!o||"widget"!==o.type)})),r=e.querySelector("."+Q),c=ce(t,n,n.get().peer),l=le(t,n),h=t.length>1,u=!h&&j.Ranges.isChatOrChannelPeer(s.peerId)&&(0,p.canPinMessage)(n,t[0]),g=(0,p.canForwardMessages)(n,t)&&!i,m=!h&&void 0!==t[0]&&(0,D.isUGCStickersEnabled)()&&(0,B.isMessageWithUGCSticker)(n,t[0]),_=e.querySelector(`.${J}[data-action="pin"]`),v=e.querySelector(`.${J}[data-action="star"]`),f=e.querySelector(`.${J}[data-action="respond"]`),b=e.querySelector(`.${J}[data-action="forward"]`),I=Boolean((0,C.tabIsOutgoingMessageRequest)(s)),w=Boolean((0,C.tabIsMessageRequest)(s)),S=(0,L.isBusinessNotifyPeer)(n,n.get().peer);r.className=(0,o.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!c&&!i,"im-page--mess-actions_pinned":l,"im-page--mess-actions_channel":j.Ranges.isChatOrChannelPeer(s)&&!n.get().gid,"im-page--mess-actions_multiple-selection":h,"im-page--mess-actions_no-pin-btn":!u,"im-page--mess-actions_out-mr":I,"im-page--mess-actions_in-mr":w,"im-page--mess-actions_business-notify":S,"im-page--mess-actions_no-important-btn":!(0,p.canMarkImportant)(n,t)||i,"im-page--mess-actions_no-report-to-ugc-sticker":!m,"im-page--mess-actions_no-spam":m}),_.innerHTML=l?(0,M.getIcon20Pin)().icon:(0,P.getIcon20PinOutline)().icon,v.innerHTML=c||i?(0,R.getIcon20FavoriteOutline)().icon:(0,E.getIcon20Favorite)().icon,t.length>1?k.FlatButton.setLabel(f,d.getLang("mail_forward_here")):k.FlatButton.setLabel(f,d.getLang("mail_im_mark_reply")),g?k.FlatButton.setDisabled(b,!1):k.FlatButton.setDisabled(b,!0),h&&!g||(0,L.isBusinessNotifyTab)(s)||i?k.FlatButton.setDisabled(f,!0):k.FlatButton.setDisabled(f,!1);const A=c?d.getLang("mail_im_toggle_important"):d.getLang("mail_im_toggle_important_off"),x=l?d.getLang("mail_unpin"):d.getLang("mail_pin");(0,T.attr)((0,T.geByClass1)("im-page-action_star",e),"aria-label",A),(0,T.attr)((0,T.geByClass1)("im-page-action_pin",e),"aria-label",x)}function ue(e,t,n){const o=t.get(),a=o.peer,s=o.tabs[a],i=(0,T.geByClass1)(X,e),r=(0,T.geByClass1)(p.PINNED_CONTAINER_CLASS,e),l=j.Ranges.isChatOrChannelPeer(a),d=l&&(0,C.isChannelPeer)(s),h=l&&(0,L.isBusinessNotifyTab)(s)&&(0,A.isBusinessNotifyEnabled)(t),u=o.selectedMessages&&!!o.selectedMessages.length,m=(0,c.isDialogWithYourself)(o.id,a);i.tt=!1;const _=s.is_nft_photo&&!m,v=(0,p.renderPhotosFromTab)(t,s,!1),I=_?(0,y.getTemplate)("im_simple_link",{href:d?"/club"+-s.ownerId:s.href,content:(0,y.getTemplate)("im_peer_photo_nft",{user_photo:(0,y.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:s.photo,size:30}),user_icon:s.photo_icon||"",modifier_class:"nim-peer_smaller"})}):(0,y.getTemplate)("im_simple_link",{href:d?"/club"+-s.ownerId:s.href,content:(0,y.getTemplate)("im_peer_photo",{online_class:"",owner_photo:v,modifier_class:"nim-peer_smaller"})});(0,T.val)((0,T.geByClass1)("im-page--aside-photo",e),I);const w=l&&(0,C.isChatActive)(s),S={muted:(0,y.inArray)(a,o.mutedPeers),verified:!!s.verified,verified_by_other_services:!s.verified&&!!s.verified_by_other_services,chat:l,vkcomgroup:d,actions:u,derelict:l&&!w&&!d&&!h,pinned:!1};if(l){const o=(0,C.getPinnedMessage)(t),s=function(e){const t=(0,C.getPinnedMessage)(e);if(!t||(0,f.oCacheGet)(e,t.userId))return!1;return t.userId}(t);o&&(0,b.isPinnedMessageVisibleInTab)(t,a)&&(s?t.set(g.loadChatMember.bind(null,{[a]:[s]})).then(ue.bind(null,e,t,n)):S.pinned=!0)}ge(t,s,e);const x=!s.top_banner&&r.innerHTML,k=!s.top_banner&&pe(t,e,r);let M=(0,T.geByClass1)(z,e);(0,T.removeClass)(M,p.DESELECT_ALL_CLASS),function(e,t,n){const o=n.length>0;(0,T.geByClass)(Z,e).forEach((e=>{if("star"===e.dataset.type&&(0,p.isFoldersAvailable)(t)&&((0,T.toggleClass)(e,"im-page--header-icon_shown",!o),(0,T.toggleClass)(e,"im-page--header-icon_star-active",(0,p.isImportant)(t))),"answer"===e.dataset.type&&(0,p.isFoldersAvailable)(t)&&(0,T.toggleClass)(e,"im-page--header-icon_shown",!o&&(0,p.isUnrespond)(t)),"search"===e.dataset.type&&!(0,p.isCommunityInterface)(t)){const n=t.get().peer,a=!o&&(0,p.isFullyLoadedTab)(t,n)&&(0,C.getTab)(t,n).offset&&!(0,p.isCommunityInterface)(t)&&(!(0,p.isCallToPeerAvailable)(t,n)||!(0,p.isClassicInterface)(t));(0,T.toggleClass)(e,"im-page--header-icon_shown",a)}})),Te(t)}(e,t,[]);const P=e.querySelector("._im_dialog_call_action_wrapper"),E=e.querySelector("._im_header_icon[data-type=call]");if(P&&P.classList.toggle("im-page--header-call-is-hidden",!(0,p.isCallToPeerAvailable)(t,a)||!!s.callInProgress),E&&(E.classList.toggle("im-page--header-icon_shown",(0,p.isCallToPeerAvailable)(t,a)&&!!s.callInProgress),E.classList.toggle("im-page--header-icon_call-active",!!s.callInProgress&&s.callInProgress.participants.count>0)),(0,p.isClassicInterface)(t)){let n=(0,T.geByClass1)("_im_page_back",e);(0,T.attr)(n,"href",`${(0,p.getBaseLink)(t)}?tab=${o.active_tab}`)}me(S,"im-page--chat-header"),(0,p.compensateHistoryHeightChange)(t,k,x,n)}function ge(e,t,n){const o=j.Ranges.isChatOrChannelPeer(t.peerId),a=o&&(0,C.isChannelPeer)(t),s=o&&(0,C.isChatActive)(t),r=o&&(0,C.isCasperChatTab)(t),c=o&&(0,L.isBusinessNotifyTab)(t)&&(0,A.isBusinessNotifyEnabled)(e),l=j.Ranges.isContactId(t.peerId),h=t.isDonutChat;let u="";o?u=a?(0,y.getTemplate)("im_vkcomgroup_members",{name:d.getLang("mail_im_n_vkcomgroup_members",(0,p.getAliveMembersCount)(t))}):s?(0,y.getTemplate)("im_chat_members",{name:d.getLang("mail_im_n_chat_members",(0,p.getAliveMembersCount)(t))}):"":j.Ranges.isUserIdTransitional(t.peerId)&&(u=(0,p.getLastSeenTextInHeader)(e,t.peerId));let g=[];""!==u||c||g.push("im-page--title--1line"),r&&g.push("im-page--title--casper"),h&&g.push("im-page--title--donut"),c&&g.push("im-page--title--business-notify"),g=g.join(" ");const m=l?(0,p.prepareContactName)(t.name):t.tab;let _=(0,y.getTemplate)("im_simple_name",{name:m,href:a?"/club"+-t.ownerId:t.href,mail_network_reconnect:d.getLang("mail_network_reconnect"),name_attr:(0,i.stripHTML)(m),ads_union:t.ad_union_ids_attr,online:u,more_cls:g,more_children:c?(0,y.getTemplate)("sImSimpleNameBusinessNotifyLabel",{text:d.getLang("mail_tab_business_notify")}):""});(0,T.val)((0,T.geByClass1)("im-page--title-wrapper",n),_)}function pe(e,t,n){const o=(0,C.getPinnedMessage)(e),a=n||(0,T.geByClass1)(p.PINNED_CONTAINER_CLASS,t);if((0,T.removeClass)(a,"im-page--pinned_with-bar"),o&&(0,v.isMoneyRequest)(o)){if(void 0===o.kludges.attach1_tr_amount)return;o.kludges.attach1_total_amount&&(0,T.addClass)(a,"im-page--pinned_with-bar")}const s=(0,p.renderPinnedMessage)(e);return(0,T.val)(a,s),!!s}function me(e,t){const n=(0,T.geByClass1)(t);Object.keys(e).forEach((o=>{(0,T.toggleClass)(n,`${t}_${o}`,!!e[o])}))}function _e(e,t,n,o,a,s){e.set(g.removeMessagesWithRestore.bind(null,n,a,o)).then(t().removeMessagesRestore.bind(null,n,a,o)),(0,g.removeMessageSend)(n,a,null,o,e.get(),s).then((()=>{const o=(0,C.getTab)(e,a);n.includes(o.lastmsg)&&(0,g.loadActualLastMessage)(e,a).then((()=>{t().updateConvoInList(a,e),t().updateState(a,e)}))}))}function Ce(e,t,n,o,a){const s=e.get().selectedMessages,i=(0,T.domData)(a,"action"),r=e.get().peer,c=(0,C.getTab)(e,r);let l=!0;if(!["star","delete"].includes(i)&&(0,C.tabIsOutgoingMessageRequest)(c))return fe(e,t,n);switch(i){case"delete":{let o=!(vk.id==r&&!e.get().gid)&&s.every((t=>(0,p.canMessageBeDeletedForAll)(e,(0,C.getMessage)(e,r,t))));if(o||s.length>1){l=!1;let a=(0,p.showMsgDeleteDialog)(r,s.length,o,(o=>{fe(e,t,n),a.hide(),cur.imDb.updateByKey("del_forall_checked",o),o?(0,g.removeMessageSend)(s,r,null,"deleteforall",e.get()):_e(e,t,s,i,r)}))}else _e(e,t,s,i,r);break}case"spam":(0,V.partConfigEnabled)("spam_message_types")?(0,O.showReportForm)("message",Number(r),s[0],void 0,void 0,{onReportCategorySelection:n=>{_e(e,t,s,i,r,n)},isAfterMessageSelection:!0}):_e(e,t,s,i,r);break;case"forward":if(!(0,p.canForwardMessages)(e,s))return;(0,g.processFwd)(s,r,e).then((t=>e.set(g.prepareForward.bind(null,t)))).then((()=>n().showForward(e))).catch((e=>console.error(e)));break;case"star":{const t=ce(s,e,r);e.set(g.favMessage.bind(null,s,t,r)),e.get().longpoll.push(s.map((e=>({type:t?m.SET_FLAGS:m.RESET_FLAGS,messageId:e,peerId:r,flags:m.FLAG_IMPORTANT}))));break}case"respond":{const n=e.get(),o=1===s.length;(0,g.processFwd)(s,n.peer,e).then((t=>e.set(g.forwardMessages.bind(null,t,n.tfdraft,o)))).then((()=>{t().respond(e,r)}));break}case"pin":{const n=(0,C.getLocalId)(e,s[0]);if(!(0,p.canPinMessage)(e,n))return;const o=le(s,e),a=o?g.unpinMessageOptimistic.bind(null,r):g.pinMessageOptimistic.bind(null,n,r),i=o?g.unpinMessage.bind(null,r):g.pinMessage.bind(null,n,r),c=Ae.bind(null,t,r);e.set(g.checkChatMember.bind(null,e,n,r)).then((e=>e.set(a))).then(c).then((e=>e.set(i))).then(c);break}case F.ConvoAction.REPORT_UGC_STICKER:{if(!(0,D.isUGCStickersEnabled)())return;const n=(0,C.getMessage)(e,r,s[0]);if(!n)return;const o=(0,p.getAttachIdFromMessage)(n);if(!o)return;const a=()=>{e.set(g.removeMessagesWithRestore.bind(null,s,r,i)).then(t().removeMessagesRestore.bind(null,s,r,i))};(0,O.showReportForm)("ugc_sticker",Number(r),Number(o),a)}}l&&fe(e,t,n)}function ve(e,t,n,o,a,s,i){const r=(0,T.domData)(i,"action"),c=o.querySelector(`.${W} .${K}`).parentNode,l=e.get().peer;(0,x.handleUiActionForPeer)(e,t,n,r,l,a,(e=>{17===e?.error?.error_code&&(0,u.showNotification)({title:d.getLang("mail_changes_cant_be_applied"),text:d.getLang("mail_not_confirmed_phone")})})),uiActionsMenu.toggle(c,!1),t().cancelEditing()}function fe(e,t,n){const o=e.get().selectedMessages;e.set(g.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,o))}function be(e,t,n,o){const s=(0,p.isClassicInterface)(e);let i,r;switch((0,T.domData)(o,"type")){case"star":r=[4,6],i=()=>(0,p.isImportant)(e)?d.getLang("mail_im_toggle_important_off"):d.getLang("mail_im_toggle_important");break;case"answer":r=[4,6],i=d.getLang("mail_end_conversation");break;case"search":r=s?[5,6]:[4,-9],i=d.getLang("mail_search_in_peer")}(0,a.showTooltip)(o,{text:i||"",black:1,shift:r,forcetoup:!0,appendParentCls:s?"_im_dialog_actions":"_im_mess_actions"})}function Ie(e,t,n){const o=(0,p.isClassicInterface)(e),s=(0,T.domData)(n.target,"action");"respond"!==s&&"forward"!==s&&(0,a.showTooltip)(n.target,{text:we.bind(null,e,s)||"",black:1,shift:[2,o?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function we(e,t){const n=e.get(),o=n.selectedMessages,a=n.peer;switch(t){case"pin":return le(o,e)?d.getLang("mail_unpin"):d.getLang("mail_pin");case"star":return ce(o,e,a)?d.getLang("mail_im_toggle_important"):d.getLang("mail_im_toggle_important_off");case"delete":return d.getLang("mail_delete");case"spam":return d.getLang("mail_im_mark_spam");case F.ConvoAction.REPORT_UGC_STICKER:return d.getLang("mail_im_report_ugc_sticker")}}function Se(e,t,n,o,a){const s=(0,T.domData)(a,"type"),i=e.get().peer;switch(s){case"star":e.set(g.toggleDialogImportant.bind(null,i)).then((()=>{setTimeout((()=>be(e,0,0,a)),40)}));break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(a,{fasthide:!0});break;case"answer":(0,C.getTab)(e,i)&&(e.set(g.markDialogAnswered.bind(null,e.get().peer)),(0,l.showDoneBox)(d.getLang("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([(0,_.resetPeer)()]));break;case"call":if((0,p.isCallToPeerAvailable)(e,i)){const t=(0,C.getTab)(e,i).callInProgress;t&&(0,p.joinCallFromIm)(e,i,t.join_link,!1,p.CALL_ENTRY_POINT_JOIN_HEADER)}break;case"marusia_add_to_dialog":(0,H.showGroupChatInviteBox)(-q.MARUSIA_PEER_ID)}}function Le(e,t){const n=Number(t),o=(0,p.formatTimespan)(n,!0),a=d.getLang("mail_network_waiting").replace(/{timer}/gi,o);e.querySelector(se).innerHTML=a}function Ae(e,t,n){return e().updateChatTopic(t,n),n}function Te(e){const t=e.get().peer,n=()=>(0,U.isMarusiaPeer)(e.get().peer),o=document.querySelector(".im-page--header-icon_marusia_add_to_dialog");if(o){const a=(0,U.isMarusiaPeer)(t)&&(0,p.isFullyLoadedTab)(e,t);o.classList.toggle("im-page--header-icon_shown",a),a&&(0,G.showMarusiaAddToDialogTooltip)(o,n)}}function ye(e,t,n,o){let a={};return{changeActions(t){const n=e.querySelector(`.${W} .${K}`),o=e.querySelector(`.${W}`),a=t.get().curActions||{},s=Object.keys(a).sort(((e,t)=>g.ACTION_PRIORITIES[e]-g.ACTION_PRIORITIES[t]));if(0===s.length)return void o.classList.add(re);const i=(0,y.getTemplate)("sUiActionsMenuSeparator");let r="",c=0;for(let e=0;e<s.length;e++){const t=s[e];e>0&&(c/10|0)!=(g.ACTION_PRIORITIES[t]/10|0)&&(r+=i),r+=(0,y.getTemplate)("sImUiActionMenuItem",{action:t,name:a[t].name,icon:a[t].icon,classes:"_im_action",icon_html:a[t].iconHtml}),c=g.ACTION_PRIORITIES[t]}n.innerHTML=r,o.classList.remove(re)},setNetworkWaitingStatus(t,n){a.interval&&clearInterval(a.interval);const o=(0,C.getTab)(n,(0,L.getCurrentTab)(n));o&&!(0,L.isBusinessNotifyTab)(o)&&(Le(e,t),a.timeout=t,a.interval=setInterval((()=>{a.timeout>1?(a.timeout--,Le(e,a.timeout)):(clearInterval(a.interval),a={})}),1e3))},setNetworkReconnectingStatus(t){a.interval&&clearInterval(a.interval),a={};const n=(0,C.getTab)(t,(0,L.getCurrentTab)(t));n&&!(0,L.isBusinessNotifyTab)(n)&&function(e){const t=e.querySelector(se),n=d.getLang("mail_network_reconnecting");t&&(t.innerHTML=n)}(e)},clearNetworkStatus(){a.interval&&clearInterval(a.interval),a={},e.querySelector(se).innerHTML=""},showSettings(t){const n=t.get(),a=(0,C.getTab)(t,n.peer);(0,C.isChatActive)(a)&&(0,I.mount)(e,t,o)},showForward(e){(0,w.mount)(e)},renderPeer(n){ue(e,n,t)},reRenderPinned(t){let n=(0,L.getCurrentTab)(t);n&&n.pinned&&pe(t,e)},reRenderTitle(t){const n=(0,L.getCurrentTab)(t);n&&ge(t,n,e)},renderActions(t){let n=t.get().selectedMessages||[];n.length>0&&he(e,n,t)},hideActions(t){if(!(0,p.isFullyLoadedTab)(t,t.get().peer)){(0,T.geByClass)(Z,e).forEach((e=>{(0,T.addClass)(e,re)}));const t=(0,T.geByClass1)(W,e);(0,T.addClass)(t,re);const n=(0,T.geByClass1)(Y,e);(0,T.addClass)(n,re)}},showActions(t){if((0,p.isFullyLoadedTab)(t,t.get().peer)){(0,T.geByClass)(Z,e).forEach((e=>{(0,T.removeClass)(e,re)}));const t=(0,T.geByClass1)(W,e);(0,T.removeClass)(t,re);const n=(0,T.geByClass1)(Y,e);(0,T.removeClass)(n,re)}},changedMessageSelection(n){const o=n.get(),a=o.peer;if(0===a||!o.tabs[a])return;let s=n.get().selectedMessages||[];s.length>0?he(e,s,n):ue(e,n,t)},updateLastSeen(t){!function(e,t){const n=e.get().peer,o=(0,T.geByClass1)("_im_page_peer_online",t);o&&j.Ranges.isUserIdTransitional(n)&&(0,C.getTab)(e,n)&&(0,p.applyInnerHtml)(o,(0,p.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){fe(e,t,o)},updateState(e){t().updateState.bind(null,e)},unmount(){(0,h.destroyModule)(n),(0,s.cancelStackFilter)("forward")}}}function xe(e,t,n){const{callMutations:o,bindMutations:a}=(0,h.createMutations)(ye),s=new N.ConvoAttaches(t,n),i=Ce.bind(null,t,n,o),c=ve.bind(null,t,n,o,e,s),l=fe.bind(null,t,n,o),d=(e,n)=>{const o=t.get().peer,a=(0,C.getTab)(t,o);(0,p.showVerifiedTooltip)(n,(0,L.isBusinessNotifyTab)(a)?a.ownerId:o)},u=be.bind(null,t,e),m=Ie.bind(null,t,e),v=Se.bind(null,t,e,n),f=()=>o().showSettings(t),b=n=>{const o=t.get().peer;j.Ranges.isContactId(o)&&((0,S.mount)(t,o,e),(0,r.cancelEvent)(n)),!(0,T.gpeByClass)(ee,n.target,e)||(0,T.gpeByClass)(te,n.target,e)||(0,r.checkEvent)(n)||(f(),(0,r.cancelEvent)(n))},I=()=>function(e,t){const n=()=>{t&&(t.classList.remove(ie),t.removeEventListener("mouseleave",n))};t&&(t.classList.add(ie),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),w=(0,h.createModule)({handlers:(n,o)=>{o(e,"click",J,i),o(e,"click",$,c),o(e,"click",p.DESELECT_ALL_CLASS,l),o(e,"mouseover",X,d),o(e,"mouseover",Z,u),o(e,"mouseover",J,m),o(e,"click",Z,v),o(e,"click","_im_header_link",b),o(e,"click",ne,b),o(e,"click",oe,f),o(e,"click",ae,I),o(e,"click","_im_page_back",(e=>{(0,r.checkEvent)(e)||(t.get().longpoll.push([(0,_.resetPeer)()]),(0,r.cancelEvent)(e))}))}});return j.Ranges.isZeroOwner(t.get().peer)||setTimeout((()=>{t.set(g.setActions).then(o().changeActions)})),Te(t),a(e,n,w,o)}},910958:(e,t,n)=>{n.d(t,{mount:()=>u});var o=n(785893),a=(n(667294),n(646952)),s=n(973935),i=n(75602),r=n(345015);let c=null;function l(e,t,n){const a=d();if(a){const c=t-19e8;s.render((0,o.jsx)(i.ContactPopup,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return(0,r.checkContactListLoaded)(e).then((e=>{const n=function(e,t){const n=e.get().contactsList;return n?n.find((e=>e.id===t)):null}(e,t);return Promise.resolve(n)}))}(e,c)}),a)}}function d(){return document.getElementById("ContactPopup")}function h(e,t){return{unmount:()=>function(e,t){c&&t.unsubscribe(c);const n=d();n&&s.unmountComponentAtNode(n),(0,a.destroyModule)(e)}(e,t),closeContactPopup(){const e=d();s.unmountComponentAtNode(e)}}}function u(e,t,n,o){const{bindMutations:s}=(0,a.createMutations)(h),i=s((0,a.createModule)({handlers:(e,t)=>{}}),e);return l(e,t,i),i}},286744:(e,t,n)=>{n.d(t,{showMarusiaAddToDialogTooltip:()=>l});var o=n(31517),a=n(166695),s=n(471828);const i="voice_assistant:add_to_group_chat";let r,c;function l(e,t){r||(r=(0,a.api)("account.getHelpHints",{})),r.then((n=>{if(!t())return;if(n.items.find((e=>e.id===i))){if(!c){const{tooltip:t}=(0,o.helpHintTooltip)(e,{content:s.getLang("mail_marusia_add_to_dialog_tooltip"),isServerSideHideDisabled:!0},{width:184,forceSide:"bottom",align:"right",appendToParent:!0,withCloseButton:!1,autoAdjustToViewport:!1,noAutoHideOnWindowClick:!1,onClick:()=>{t.hide()}});c=t}(0,a.api)("account.hideHelpHint",{hint_id:i}),window.requestAnimationFrame((()=>{c&&c.show()}))}})).catch(console.error)}},927549:(e,t,n)=>{n.d(t,{ChatCreation:()=>S});var o,a=n(785893),s=n(667294),i=n(471828),r=n(775456),c=n(695901),l=n(867628),d=n(432598),h=n(509764),u=n(836640),g=n(441430),p=n(697220),m=n(183341),_=n(658010),C=n(433648),v=n(677759),f=n(606408),b=n(345015),I=n(124794),w=n(604817);!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(o||(o={}));const S=({store:e,uploadAvatar:t,onClose:n,onBack:o,onCreateChat:S,onGoToConvo:L,preselectedUsers:A})=>{const[T,y]=(0,s.useState)([]),[x,k]=(0,s.useState)(0),[M,P]=(0,s.useState)(0),[E,R]=(0,s.useState)(""),[N,j]=(0,s.useState)(""),[B,F]=(0,s.useState)(void 0),[O,D]=(0,s.useState)(A?new Map(A.map((e=>[e.id,(0,d.getTokenFromUserItem)(e)]))):new Map);(0,s.useEffect)((()=>{(function(e){const t=(0,_.unpackStore)(e);return t.hintsTree.then((t=>{const n=t.list.map((([e,t,n])=>({id:+e,peerId:+e,name:t,photo:n})));return function(e,t){return(0,b.checkContactListLoaded)(e).then((e=>{const n=e.get().contactsList.filter((e=>!e.user)).sort(((e,t)=>e.id<t.id?1:-1)).map((e=>({id:(0,I.getContactPeerId)(e.id),peerId:(0,I.getContactPeerId)(e.id),name:e.name,photo:e.photo||""}))),o=n.splice(0,n.length<3?n.length:3);return[...t.slice(0,4),...o,...t.slice(4),...n]}))}(e,n)}))})(e).then((e=>{if(A){const t=A.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),n=A.concat(e.filter((e=>!t[e.peerId])));y(n)}else y(e)})).then((()=>k(1))).catch((()=>{k(4)}))}),[]);const H=(0,C.debouncedPromise)(v.searchHints,300),U=(t,n)=>H(t,n,f.HintsSearchType.FRIENDS_AND_CONTACTS,{},e.get()),q=()=>{const t=Array.from(O.keys()),n=B||void 0;return e.set((e=>(0,m.createChatAction)(e,n,t,E,M))).then((e=>{const t=e.get().next_peer;S(t),(0,w.collectChatCreateStats)(t,"create_chat__create_new")}))},G=()=>{k(3),t().then((e=>{if(e.photo&&e.photoData){const{photo:t,photoData:n}=e;j(t),F(n)}else F(void 0);k(1)})).catch((()=>{k(4)}))},V=()=>{j(""),F(void 0)};switch(x){case 2:return(0,a.jsx)(c.ChatCreationModal,{title:i.getLang("mail_chat_creation_settings"),onClose:n,onBack:()=>k(1),children:(0,a.jsx)(l.ChatSettingsContainer,{flags:M,setFlags:P,onClose:()=>k(1)})});case 1:return(0,a.jsxs)(c.ChatCreationModal,{title:i.getLang("mail_im_create_chat"),onBack:o,onClose:n,children:[(0,a.jsx)(d.UsersListContainer,{usersList:T,selectedMap:O,setSelectedMap:D,onServerSearch:U}),(0,a.jsx)(h.ConvoInfoContainer,{title:E,photo:N,selectedUserIds:Array.from(O.keys()),onTitleChange:R,onShowSettings:()=>k(2),onCreateChat:q,onUploadAvatar:G,onRemoveAvatar:V,onGoToConvo:L})]});case 4:return(0,a.jsxs)(c.ChatCreationModal,{title:i.getLang("global_error"),onClose:n,children:[(0,a.jsx)(p.ModalBody,{children:(0,a.jsx)("p",{children:i.getLang("global_error")})}),(0,a.jsx)(u.ModalFooter,{actionButtons:(0,a.jsx)(g.Button,{mode:"primary",size:"m",onClick:n,children:i.getLang("global_close")})})]});case 0:return(0,a.jsx)(r.default,{});case 3:return(0,a.jsx)(a.Fragment,{})}}},694902:(e,t,n)=>{n.d(t,{ChatCreationInfo:()=>d});var o=n(785893),a=n(587081),s=n(46885),i=n(840915),r=n(441430),c=n(471828),l=n(445310);const d=({onChangeTitle:e,onShowSettings:t,onButtonClickHandler:n,title:d,photo:h,loading:u,onUploadAvatar:g,onRemoveAvatar:p,isButtonDisabled:m,buttonText:_})=>(0,o.jsxs)("div",{className:"ChatCreationInfo",children:[(0,o.jsxs)("div",{className:"ChatCreationInfo__avatarWrapper",children:[(0,o.jsx)(a.default,{photo:h,title:d,className:"ChatCreationInfo__avatar",onClick:g}),h&&(0,o.jsx)(s.default,{text:c.getLang("mail_settings_remove_photo"),position:"t",align:"left",children:(0,o.jsx)("button",{onClick:p,className:"ChatCreationInfo__avatarRemove"})})]}),(0,o.jsx)(i.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:d,onChange:t=>e(t.target.value),placeholder:c.getLang("mail_im_chat_title_intro")}),(0,o.jsx)(s.default,{text:c.getLang("mail_chat_creation_settings_icon_tooltip"),position:"t",children:(0,o.jsx)("button",{className:"ChatCreationInfo__settings",onClick:t,"aria-label":c.getLang("mail_chat_creation_settings_icon_tooltip"),children:(0,o.jsx)(l.Icon24Settings,{})})}),(0,o.jsx)(r.Button,{size:"m",mode:"primary",disabled:m,loading:u,onClick:n,children:_})]})},695901:(e,t,n)=>{n.d(t,{ChatCreationModal:()=>r});var o=n(785893),a=n(605168),s=n(231068),i=n(471828);const r=({children:e,title:t,onClose:n,onBack:r})=>(0,o.jsxs)(a.BaseModal,{onClose:n,disableBodyScroll:!0,className:"ChatCreationModal",children:[(0,o.jsx)(s.ModalHeader,{title:t,onClose:n,backText:r?i.getLang("global_back"):void 0,onBack:r}),(0,o.jsx)("div",{className:"ChatCreationModal__content",children:e})]})},723090:(e,t,n)=>{n.d(t,{ChatCreationUserRow:()=>l});var o=n(785893),a=n(429020),s=n(32573),i=n(502423),r=n(790513),c=n(737081);const l=({data:e,onSelect:t,isSelected:n})=>{const l=e.photo?e.photo:(0,o.jsx)(c.ConversationNoPhoto,{id:e.peerId,text:(0,r.getUserInitials)(e.name),size:"34",specificType:7});return(0,o.jsx)(s.default,{"data-id":e.peerId,onClick:()=>t(e.peerId),selectable:!0,aside:(0,o.jsx)(i.ListMultiSelectControl,{isSelected:n}),children:(0,o.jsx)(a.default,{"data-id":e.peerId,size:"34",title:e.name,photo:l})})}},527737:(e,t,n)=>{n.d(t,{ChatCreationUserList:()=>i});var o=n(785893),a=n(764063),s=n(471828);const i=({usersList:e,onRemoveToken:t,onChange:n,onSelect:i,renderSuggest:r,tokens:c,query:l})=>(0,o.jsx)(a.default,{className:"ChatCreationUserList",tokens:c,removeTokenPlaceholder:s.getLang("mail_create_chat_remove_user"),onRemoveToken:t,placeholder:s.getLang("mail_search_creation"),value:l,onChange:n,onSelect:i,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:()=>{},notFoundText:s.getLang("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:r,data:e})},867628:(e,t,n)=>{n.d(t,{ChatSettingsContainer:()=>s});var o=n(785893),a=n(571175);const s=({setFlags:e,flags:t,onClose:n})=>(0,o.jsx)(a.ChatSettingsOptions,{flags:t,back:n,isChatCreation:!0,onSave:t=>(e(t),Promise.resolve()),afterSave:n})},509764:(e,t,n)=>{n.d(t,{ConvoInfoContainer:()=>r});var o=n(785893),a=n(694902),s=n(667294),i=n(471828);const r=({title:e,photo:t,selectedUserIds:n,onShowSettings:r,onTitleChange:l,onCreateChat:d,onUploadAvatar:h,onRemoveAvatar:u,onGoToConvo:g})=>{const[p,m]=(0,s.useState)(!1),[_,C]=(0,s.useState)(!c(e)),v=1===n.length&&!_&&!t,f=0!==n.length||_,b=(0,s.useCallback)((e=>{C(!c(e)),l(e)}),[]),I=!v&&!f,w=v?i.getLang("mail_im_go_to_dialog"):i.getLang("mail_im_create_chat");return(0,o.jsx)(a.ChatCreationInfo,{title:e,onResetTitle:()=>b(""),onChangeTitle:b,photo:t,onShowSettings:r,onButtonClickHandler:()=>{if(!p)if(m(!0),v){const[e]=n;g(+e)}else d().catch((()=>{m(!1)}))},loading:p,isButtonDisabled:I,onUploadAvatar:h,onRemoveAvatar:u,buttonText:w})};function c(e){return!e.trim().replace("\n","")}},432598:(e,t,n)=>{n.d(t,{UsersListContainer:()=>l,getTokenFromUserItem:()=>h});var o=n(785893),a=n(667294),s=n(527737),i=n(723090),r=n(381217),c=n(659397);const l=({usersList:e,selectedMap:t,setSelectedMap:n,onServerSearch:c})=>{const[l,u]=(0,a.useState)(""),[g,p]=(0,a.useState)(e.map((e=>e.peerId))),m=(0,a.useRef)(d(e)),_=(0,a.useCallback)((e=>e.name),[]),C=(0,a.useCallback)((e=>e.peerId),[]),v=(0,r.useIndexer)(Array.from(m.current.values()),_,C),f=(0,a.useMemo)((()=>Array.from(m.current.keys())),[m.current]),b=(0,a.useCallback)(((e,t)=>c(e,t)),[c]);(0,a.useEffect)((()=>{const e=v.search(l).map((e=>e.peerId));p(e),b(l,e).then((t=>{if(0!==l.length){const n=[],o=[];t.forEach((e=>{m.current.has(e.peerId)||(o.push(e.peerId),n.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),n.length&&(!function(e,t){const n=d(t);e.current=new Map([...Array.from(e.current.entries()),...Array.from(n.entries())])}(m,n),p([...e,...o]))}})).catch((()=>{}))}),[l]);const I=e=>{t.delete(e),n((()=>new Map(t)))},w=e=>{t.has(e)?I(e):((e=>{const o=m.current.get(e);o&&(t.set(e,h(o)),n((()=>new Map(t))))})(e),u(""))},S=(0,a.useCallback)((e=>{I(+e)}),[t]),L=(0,a.useCallback)((e=>{u(e.target.value)}),[l]),A=Array.from(t.values());return(0,o.jsx)(s.ChatCreationUserList,{query:l,tokens:A,usersList:l?g:f,onSelect:w,onChange:L,onRemoveToken:S,renderSuggest:e=>{const n=m.current.get(e);return n?(0,o.jsx)(i.ChatCreationUserRow,{data:n,onSelect:w,isSelected:t.has(e)},e):(0,o.jsx)(o.Fragment,{})}})};function d(e){return e.reduce(((e,t)=>(t.name=(0,c.decodeHTMLEntities)(t.name),e.set(t.id,t))),new Map)}function h(e){return{id:e.id.toString(),text:e.name}}},75602:(e,t,n)=>{n.d(t,{ContactPopup:()=>h});var o=n(785893),a=n(667294),s=n(605168),i=n(762759),r=n(203012),c=n(775456),l=n(471828),d=n(43129);const h=({getContactInfo:e,onClose:t})=>{const[n,h]=(0,a.useState)({kind:"loading"});switch((0,a.useEffect)((()=>{const n=e=>{(0,d.showErrorBox)(e),h({kind:"failed"}),t()};e().then((e=>{e?h({kind:"loaded",contact:e}):n(l.getLang("mail_contact_was_removed"))})).catch((()=>{n(l.getLang("global_error"))}))}),[]),n.kind){case"failed":return(0,o.jsx)(o.Fragment,{});case"loading":return(0,o.jsx)(c.default,{});case"loaded":return(0,o.jsxs)(s.BaseModal,{onClose:t,className:"ContactPopup",children:[(0,o.jsx)(i.Modal.Header,{title:l.getLang("mail_contact"),onClose:t}),(0,o.jsx)(r.ContactPopupContent,{contact:n.contact})]})}}},36351:(e,t,n)=>{n.d(t,{ContactIconRow:()=>d});var o=n(785893),a=n(415080),s=n(957904),i=n(429190),r=n(401194),c=n(826794);const l=e=>{switch(e){case"phone":return(0,o.jsx)(a.Icon20PhoneOutline,{});case"mail":return(0,o.jsx)(s.Icon20MailOutline,{});case"calendar":return(0,o.jsx)(i.Icon20CalendarOutline,{});case"location":return(0,o.jsx)(r.Icon20PlaceOutline,{});case"sync":return(0,o.jsx)(c.Icon20Sync,{})}},d=({icon:e,children:t})=>(0,o.jsxs)("div",{className:"ContactIconRow",children:[(0,o.jsx)("div",{className:"ContactIconRow__icon",children:l(e)}),(0,o.jsx)("div",{className:"ContactIconRow__text",children:t})]})},203012:(e,t,n)=>{n.d(t,{ContactPopupContent:()=>d});var o=n(785893),a=n(790513),s=n(36351),i=n(737081),r=n(22378),c=n(471828),l=n(124794);const d=({contact:e})=>{const t=(0,l.getContactPeerId)(e.id);return(0,o.jsxs)("div",{className:"ContactPopupContent",children:[(0,o.jsxs)("header",{className:"ContactPopupContent__header",children:[(0,o.jsx)("div",{className:"ContactPopupContent__photo",children:e.photo?(0,o.jsx)("img",{className:"ContactPopupContent__contactAvatarImage",src:e.photo,alt:e.name}):(0,o.jsx)(i.ConversationNoPhoto,{text:(0,a.getUserInitials)(e.name),size:"80",id:t,specificType:7},e.id)}),(0,o.jsx)("h3",{className:"ContactPopupContent__title",children:(0,o.jsx)(r.InnerHTML,{children:(0,a.prepareContactName)(e.name)})}),(0,o.jsx)("div",{className:"ContactPopupContent__meta",children:c.getLang("mail_from_contacts_list")})]}),(0,o.jsxs)("div",{className:"ContactPopupContent__info",children:[e.main_phone&&(0,o.jsx)(s.ContactIconRow,{icon:"phone",children:(0,a.formatPhoneNumber)(e.main_phone)}),e.emails[0]&&(0,o.jsx)(s.ContactIconRow,{icon:"mail",children:(0,o.jsx)("a",{href:`mailto:${e.emails[0]}`,children:e.emails[0]})})]}),e.sync_date&&(0,o.jsx)("div",{className:"ContactPopupContent__info",children:(0,o.jsx)(s.ContactIconRow,{icon:"sync",children:e.sync_date})})]})}},792591:(e,t,n)=>{n.d(t,{ConvoPicker:()=>f,convoPickerMode:()=>o});var o,a=n(785893),s=n(667294),i=n(659397),r=n(973935),c=n(112528),l=n(258037),d=n(113788),h=n(13602),u=n(215853),g=n(471828),p=n(262352),m=n(790513),_=n(32573),C=n(294113),v=n(535946);!function(e){e.DEFAULT="default",e.RADIO="radio"}(o||(o={}));const f=({searchValue:e="",isLoading:t=!1,convos:n,mode:o="default",selectedConvos:v=[],checkDisabled:f,onSearchValueChange:I,onSearchInputKeydown:w,onConvoSelect:S,onListLoadMore:L=(()=>{}),onAddClick:A,searchInputGetter:T,className:y,style:x,...k})=>{const M=(0,i.classNames)("ConvoPicker",y),P=(0,s.createRef)();let E;const[R,N]=(0,s.useState)(0),j=e=>{const t=Math.max(e-1,0);return f&&f(n[t])?j(t):t},B=e=>{const t=Math.min(e+1,n.length-1);return f&&f(n[t])?B(t):t},F=e=>{e!==R&&(N(e),(e=>{if(!E)return;const t=n[e].peerId,o=E.querySelector(`[data-id="${t}"]`);if(!(o&&o instanceof HTMLElement))return;const a=o.offsetTop,s=E.scrollTop;if(a<s)E.scrollTop=a;else{const e=E.offsetHeight,t=a+o.offsetHeight;t>s+e&&(E.scrollTop=t-e)}})(e))};(0,s.useEffect)((()=>{T&&P.current&&T(P.current)}),[]);const O=!!A&&!e,D=(O?[(0,a.jsx)(_.default,{selectable:!1,"data-id":0,children:(0,a.jsx)(C.ListAddControl,{onClick:A,size:34,children:g.getLang("mail_new_convo_from_invite")})},"add")]:[]).concat(n.map(((e,t)=>{const{peerId:n,photo:s,name:i,online:r}=e,c=!!f&&f(e);return(0,a.jsx)(p.ConvoPickerRow,{"data-id":n,peerId:n,photo:s,name:i,online:r,memberCount:(0,m.getChatMemberCount)(e),mode:o,isCasper:b(e),isSelected:v.includes(n),isActive:t===R,isDisabled:c,onClick:()=>{c||S(n)},onMouseEnter:()=>N(c?-1:t)},n)})));return(0,a.jsxs)("div",{className:M,onMouseLeave:()=>N(-1),style:x,...k,children:[(0,a.jsx)(c.BlockSearchInput,{value:e,onChange:I,onKeyDown:e=>{switch(e.which||e.keyCode){case u.ARROW_UP:F(j(R)),e.preventDefault();break;case u.ARROW_DOWN:F(B(R)),e.preventDefault();break;case u.ENTER:S(n[R].peerId),e.preventDefault()}w(e)},placeholder:g.getLang("mail_top_search"),autoFocus:!0,getRef:P},"search"),t&&(0,a.jsx)(l.Placeholder,{children:(0,a.jsx)(d.Spinner,{})}),!t&&e&&0===n.length&&(0,a.jsx)(l.Placeholder,{children:g.getLang("mail_im_search_empty_chats")}),!t&&(n.length>0||O)&&(0,a.jsx)(h.default,{virtualized:!0,className:"ConvoPicker__results",loadMore:L,hasMore:!1,ref:e=>{const t=r.findDOMNode(e);t&&t instanceof HTMLElement&&(E=t)},children:D},"results")]})};function b(e){const t=e.data?.flags;return!!t&&(t&v.MAIL_CHAT_FLAG_IS_CASPER)>0}},262352:(e,t,n)=>{n.d(t,{ConvoPickerRow:()=>p});var o=n(785893),a=n(659397),s=n(32573),i=n(429020),r=n(790513),c=n(792591),l=n(242261),d=n(737081),h=n(587081),u=n(15042),g=n(184132);const p=({peerId:e,name:t,photo:n,online:p,memberCount:m,mode:_=c.convoPickerMode.DEFAULT,isSelected:C,isDisabled:v,isActive:f,isCasper:b,className:I,...w})=>{const S=function(e,t,n,a=0){const s=g.Ranges.isContactId(e);if(Array.isArray(n))return(0,o.jsx)(l.default,{photos:n});if(s)return(0,o.jsx)(d.ConversationNoPhoto,{id:e,text:(0,r.getUserInitials)(t),size:"34",specificType:7});return(0,o.jsx)(h.default,{isOnline:!!a,isMobile:!!u.mobPlatforms[a],title:t,photo:n,onlineSize:"s"})}(e,t,n,p),L=b?`<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          ${t}\n        </span>\n      </span>`:t,A=_===c.convoPickerMode.RADIO?(0,o.jsx)("span",{className:(0,a.classNames)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":C})}):void 0,T=(0,a.classNames)("ConvoPickerRow",I,{"ConvoPickerRow--disabled":v});return(0,o.jsx)(s.default,{active:f,selectable:!v,canBeHovered:!1,chevron:_===c.convoPickerMode.DEFAULT&&!v,aside:A,className:T,...w,children:(0,o.jsx)(i.default,{ignoreDecodeHTML:!0,size:"34",title:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:L}}),photo:S,description:m,className:"ConvoPickerRow__itemContent"})})}},445373:(e,t,n)=>{n.d(t,{MessageForward:()=>y});var o=n(785893),a=n(667294),s=n(659397),i=n(251087),r=n(242453),c=n(113788),l=n(792591),d=n(798738),h=n(433648),u=n(790513),g=n(266767),p=n(922749),m=n(67427),_=n(471828),C=n(565676),v=n(12910),f=n(355797),b=n(159663),I=n(124794),w=n(427323),S=n(52373),L=n(184132);const A=(0,h.debouncedPromise)(d.searchHints,300);class T extends a.Component{componentDidMount(){this.props.updatePopup();const e={noStickers:!0,onSend:this.send};window.Emoji.init(this.input,e),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){const{store:e,closePopup:t}=this.props,{mode:n,loading:a,selected:i,found:d,sending:h}=this.state,u=(0,s.classNames)("MessageForward",{"MessageForward--form":0===n&&!!i});return(0,o.jsxs)("section",{className:u,children:[(0,o.jsx)(r.ModalHeader,{indicator:(0,g.isCommunityInterface)(e)&&(0,o.jsx)("span",{className:"MessageForward__switch",onClick:this.toggleMode,children:0===n?_.getLang("mail_forward_to_community_messages"):_.getLang("mail_forward_to_im")}),onClose:t,closeAriaLabel:_.getLang("global_close"),children:_.getLang("mail_forward_messages")}),(0,o.jsxs)("div",{className:"MessageForward__content",children:[(0,o.jsx)(l.ConvoPicker,{searchValue:this.state.value,isLoading:a,convos:d.map((t=>t||(0,g.getTab)(e,t.peerId))),mode:1===n?l.convoPickerMode.DEFAULT:l.convoPickerMode.RADIO,selectedConvos:[i],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),(0,o.jsxs)("footer",{className:"MessageForward__footer",ref:this.getFormRef,children:[(0,o.jsxs)("div",{className:"MessageForward__form _emoji_field_wrap",children:[(0,o.jsx)("div",{className:"MessageForward__input",tabIndex:0,contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:_.getLang("mail_im_enter_msg")}),(0,o.jsx)("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap",children:(0,o.jsx)("div",{ref:this.getEmojiButtonRef,"data-testid":"message-forward-emoji-smile",className:"emoji_smile _emoji_btn",title:_.getLang("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,children:(0,o.jsx)(w.Icon24SmileOutline,{})})})]}),h?(0,o.jsx)("div",{className:"MessageForward__send-spinner",children:(0,o.jsx)(c.Spinner,{})}):(0,o.jsx)("button",{className:"MessageForward__send",onClick:this.send,children:(0,o.jsx)(S.Icon24Send,{})})]},"footer")]})]})}constructor(e){super(e),this.toggleMode=()=>{const e=this.props.store;if((0,g.isCommunityInterface)(e)){const t=0===this.state.mode?1:0,n=0===t?d.searchImTopConv:d.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},(()=>n("",e.get()).then((e=>this.setSearchResults(this.filterResults(e)))).then((()=>this.searchInput.focus())).catch((e=>console.error(e)))))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});const{value:t}=e.target;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{const t=(0,g.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter((e=>{const n=e.peerId;return(!t||!L.Ranges.isGroupId(n))&&(!(t&&L.Ranges.isChatOrChannelPeer(n)&&!(0,p.doesChatTabHaveFlag)(e,1024))&&!(!t&&L.Ranges.isChatOrChannelPeer(n)&&(0,p.doesChatTabHaveFlag)(e,1024)))}))},this.onSearch=e=>{const{store:t}=this.props,n=t.get(),o=(0,g.isCommunityInterface)(t)&&0===this.state.mode,a=o?d.searchImTopConv:d.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})):a(e,n).then((t=>{const a=t.map((e=>e.peerId));return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?A(e,a,"all",{hidegid:o},n):Promise.resolve([])})).then((t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)})).catch((()=>{}))},this.emptySearch=()=>{const{store:e}=this.props,t=e.get(),n=t.dialog_tabs.all;let o={},a={};return(0,d.searchTopConv)("",t).then((s=>{s.forEach((e=>{a[e.peerId]=e}));return[t.peer].concat(n.filter((e=>e!==t.peer))).map((t=>{const n=(0,g.getTab)(e,t);return o[t]=!0,{name:a[t]&&a[t].tab||n.tab,photo:a[t]&&a[t].photo||n.photo,lastmsg:n.lastmsg,major_sort_id:n.major_sort_id,minor_sort_id:n.minor_sort_id,data:n.data,peerId:t}})).concat(s.filter((e=>!o[e.peerId]))).sort(((n,o)=>n.peerId===t.peer?-1:o.peerId===t.peer?1:(0,I.sortFn)(e,n,o)))}))},this.sendRecipient=e=>{const t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll?.push([(0,m.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),(0,C.statlogsForwardEvent)(t),(0,g.isCommunityInterface)(t)&&(0,C.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},(()=>{window.Emoji.focus(this.input)}))},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=(e,t,n=!1)=>{if(!this.unmounted)if(t){const t=e.filter((e=>!this.found[e.peerId]));t.forEach((e=>{this.found[e.peerId]=!0})),this.setState({found:[...this.state.found,...t],loading:n})}else this.found=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),this.setState({found:e,loading:n,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),window.Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),window.Emoji.hide(this.emojiButton,e)},this.send=()=>{const e=this.props.store,t=this.state.selected,n=window.Emoji.val(this.input).trim(),o=new v.ImDraft({},0),a=e.get().pendingForward;if(t&&!(0,u.isMessageTooLong)(n)){this.setState({sending:!0});const s=(0,g.isCommunityInterface)(e)&&0===this.state.mode;s||o.addAttach("mail",a?.msgIds.join(";"),a?.object||null);const r={message:n,attaches:o.dData.attaches.map((e=>[e.type,e.id]))||[]},c={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:s?a?.msgIds.join(";"):void 0}};new Promise((n=>{(0,d.loadHashes)([t],{hidegid:!0},e.get()).then((([e])=>n(e[t])))})).then((n=>e.set(d.sendMessage.bind(null,t,r,{hash:n,...c})))).then((()=>{(0,C.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),(0,i.showDoneBox)(_.getLang("mail_send3"))})).catch((e=>{this.unmounted||this.setState({sending:!1},(()=>{(0,b.showFastBox)(_.getLang("mail_error"),e)}))}))}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(window.Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})).catch((e=>console.error(e)))}}const y=(0,f.connect)(T)},663854:(e,t,n)=>{n.d(t,{UserConvoInviteContainer:()=>P});var o,a=n(785893),s=n(667294),i=n(60811),r=n(242453),c=n(49169),l=n(249580),d=n(416218),h=n(284658),u=n(792591),g=n(183341),p=n(788274),m=n(922749),_=n(159663),C=n(471828),v=n(775456),f=n(677759),b=n(877926),I=n(667042),w=n(437038),S=n(548799),L=n(372292),A=n(124794),T=n(606408),y=n(927549),x=n(663745),k=n(604817),M=n(184132);!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(o||(o={}));const P=({user:e,store:t,onClose:n,onInviteSent:o,onGoToConvo:P})=>{const[E,R]=(0,s.useState)(0),[N,j]=(0,s.useState)(!function(e){const t=e.get(),n=t.chatList||t.dialog_tabs?.all;return Boolean(n&&n.length>0)}(t)),[B,F]=(0,s.useState)(!0),[O,D]=(0,s.useState)(!1),[H,U]=(0,s.useState)(function(e){const t=e.get(),n=t.chatList||(t.dialog_tabs?.all||[]).filter(M.Ranges.isChatOrChannelPeer);if(n&&n.length>0)return n.map((t=>(0,m.getTab)(e,t)));return[]}(t)),[q,G]=(0,s.useState)(""),V=(0,s.useCallback)((e=>{G(e.target.value)}),[q]),$=(0,s.useCallback)((()=>{}),[]),z=(0,s.useRef)(null),[K,W]=(0,S.useHints)(t,H,q,{queryType:T.HintsSearchType.ALL,filterFn:e=>M.Ranges.isChatOrChannelPeer(e.peerId)});(0,s.useEffect)((()=>((0,f.loadConversations)(t.get(),p.ConvoFilters.CHATS,200).then((e=>{const t=e.items;return U((0,A.mergeConvoLists)(H,t)),t})).then((e=>{const n=e.reduce(((e,t)=>(e[t.peerId]=t,e)),{});return t.set((t=>(0,w.mergeTabs)(t,n).then((t=>(0,I.setChatList)(t,e.map((e=>e.peerId)))))))})).finally((()=>j(!1))),(0,L.cancelStackPush)("convo_invite",(()=>{})),()=>{setTimeout((()=>(0,L.cancelStackFilter)("convo_invite")),0)})),[]);const Y=a=>{D(!0),Promise.resolve().then((()=>t.set((t=>(0,g.addNewMember)(a,[e.id],B,t))))).then((()=>o(a))).then((()=>{n(),D(!1)})).catch((e=>{D(!1),(0,_.showFastBox)(C.getLang("global_error"),e)}))},Z=e.inv_name?(0,b.langStr)((0,b.langSex)(e.sex,C.getLang("mail_im_invite_user","raw")),"user",e.inv_name):C.getLang("mail_convo_invite_title");return(0,a.jsxs)(a.Fragment,{children:[0===E&&(0,a.jsx)(h.MessageBoxModal,{onDestroy:n,children:({onClose:e})=>(0,a.jsxs)(i.ModalBox,{children:[(0,a.jsx)(r.ModalHeader,{onClose:e,closeAriaLabel:C.getLang("global_close"),children:Z}),(0,a.jsx)(c.ModalBody,{insetLevel:0,children:(0,a.jsx)(u.ConvoPicker,{convos:K.map((e=>(0,m.getTab)(t,e.peerId)||e)),searchValue:q,onSearchValueChange:V,onSearchInputKeydown:$,onConvoSelect:Y,checkDisabled:e=>!e.canInvite,searchInputGetter:e=>z.current=e,isLoading:N||W&&0===K.length,style:{height:410},onAddClick:()=>R(1)})}),(0,a.jsx)(l.ModalFooter,{children:(0,a.jsx)(d.Checkbox,{noPadding:!0,stretched:!1,checked:B,onChange:e=>F(e.target.checked),children:C.getLang("mail_im_chat_add_members_show_history")})})]})}),1===E&&(0,a.jsx)(y.ChatCreation,{store:t,uploadAvatar:x.uploadConvoPhoto,onClose:n,onBack:()=>R(0),onCreateChat:e=>{o(e).then((()=>{}),(()=>{})),n(),(0,k.collectChatCreateStats)(e,"create_chat__create_invite")},onGoToConvo:e=>{P(e),n()},preselectedUsers:[{id:e.id,peerId:e.id,name:e.name,photo:e.photo}]}),O&&(0,a.jsx)(v.default,{})]})}},580423:(e,t,n)=>{n.d(t,{mount:()=>v});var o=n(785893),a=n(646952),s=n(70689),i=n(251087),r=n(973935),c=n(355797),l=n(780891),d=n(445373),h=n(798738),u=n(159663);let g;function p(){g&&g.hide()}function m(){g&&g.updateBoxCoords()}function _(){return document.querySelector("#MessageForward")}function C(e){const t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),o=(0,s.isVisible)(t);return{unmount(){const t=_();t&&r.unmountComponentAtNode(t),(0,a.destroyModule)(e)},showLoader(){(0,i.boxRefreshCoords)(n),(0,s.show)(n),o||(0,s.show)(t)},hideLoader(){(0,s.hide)(n),o||(0,s.hide)(t)}}}function v(e){const{bindMutations:t}=(0,a.createMutations)(C),n=t((0,a.createModule)({handlers:()=>{}})),s={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){const t=_();t&&r.render((0,o.jsx)(l.AppRootProvider,{children:(0,o.jsx)(c.default,{value:e,children:(0,o.jsx)(d.MessageForward,{closePopup:p,updatePopup:m})})}),t)}(e),requestAnimationFrame((()=>g.updateBoxCoords()))},onHideAttempt:()=>(e.set(h.prepareForward.bind(null,null)),e.set(h.cleanSelected),n.unmount(),!0)};return n.showLoader(),Promise.resolve().then((()=>{n.hideLoader(),g=new u.MessageBox(s).content('<div id="MessageForward"></div>').show()})),n}},434126:(e,t,n)=>{n.d(t,{mount:()=>d});var o=n(785893),a=n(646952),s=n(973935),i=n(663854),r=n(780891);function c(){const e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;const n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}function l(e){return{unmount:()=>{const t=c();t&&s.unmountComponentAtNode(t),(0,a.destroyModule)(e)}}}function d(e,t,n,d){const{bindMutations:h}=(0,a.createMutations)(l),u=h((0,a.createModule)({handlers:()=>{}}));return function(e,t,n,a,l){const d=c();s.render((0,o.jsx)(r.AppRootProvider,{children:(0,o.jsx)(i.UserConvoInviteContainer,{user:n,store:e,onClose:t.unmount,onInviteSent:a,onGoToConvo:l})}),d)}(e,u,t,n,d),u}},319780:(e,t,n)=>{n.r(t),n.d(t,{showGroupChatInviteBox:()=>S});var o=n(785893),a=n(667294),s=n(659397),i=n(86894),r=n(60811),c=n(242453),l=n(584676),d=n(329434),h=n(493829),u=n(249580),g=n(441430),p=n(900917),m=n(471828),_=n(379440),C=n(251087),v=n(159663),f=n(274851),b=n(600292),I=n(284658);class w extends a.Component{onRemoveToken(e){return e=Number(e),this.setState({selected:this.state.selected.filter((t=>t!==e))}),Promise.resolve()}onChange(e){this.isSearching=!0;const t=e.target.value;this.searchChats(t,((e,t)=>{this.abortOngoingRequest&&this.abortOngoingRequest(),this.abortOngoingRequest=e,t.then((e=>{e.forEach((e=>{this.data[e.peer_id]||this.indexer.add(e),this.data[e.peer_id]=e})),this.isSearching=!1,this.setState({found:(0,s.uniqueArray)(this.state.found.concat(e.map((e=>Number(e.peer_id)))))})})).catch((e=>{(0,_.debugLog)("cancelled promise",e)}))})),this.setState({value:t,found:(0,s.uniqueArray)(this.indexer.search(t).map((e=>Number(e.peer_id))))})}onSelect(e){let t;e=Number(e),t=this.state.selected.includes(e)?this.state.selected.filter((t=>t!==e)):this.state.selected.concat(e),t=t.slice(0,10);let n=this.state.value;return t.length!==this.state.selected.length&&(n=""),this.setState({selected:t,value:n}),Promise.resolve()}onAddBots(){this.setState({loading:!0});const e=this.state.selected;var t,n,o;(t=-this.props.groupId,n=e,o=this.props.addHash,new Promise(((e,a)=>{window.ajax.post("/al_im.php",{act:"a_add_bots_to_chat",bot_id:t,peer_ids:n.join(","),add_hash:o},{onDone(t){e(t)},onFail:e=>(a(e),!0)})}))).then((e=>{this.props.onClose(),(0,C.showDoneBox)(e)})).catch((e=>((0,v.showFastBox)(m.getLang("global_error"),e),!0))).finally((()=>{this.setState({loading:!1})}))}render(){const{selected:e,value:t}=this.state,n=Object.keys(e).length,a=""===t?this.state.defaultData:this.state.found;return(0,o.jsxs)(r.ModalBox,{children:[(0,o.jsx)(c.ModalHeader,{closeAriaLabel:m.getLang("global_close"),onClose:()=>this.props.onClose(),children:this.props.title}),(0,o.jsx)(l.Div,{className:b.default.container,children:(0,o.jsx)(d.ChipsInputCellList,{value:e.map((e=>({value:e,label:(0,s.decodeHTMLEntities)(this.data[e].name),removeAriaLabel:m.getLang("groups_invite_chat_remove")}))),onChange:e=>{this.setState({selected:e.map((e=>e.value))})},placeholder:m.getLang("groups_invite_chat_search"),inputValue:t,onInputChange:e=>{this.onChange(e)},hasScroll:!0,isEmpty:!a.length,emptyPlaceholderText:t.length?m.getLang("groups_invite_chat_not_found"):m.getLang("groups_invite_chat_no_chats"),autoFocus:!0,children:a.map((t=>{const n=this.data[t],{photo:a,name:r}=n,c=(0,s.decodeHTMLEntities)(r),l=e.includes(t);return(0,o.jsx)(i.Cell,{mode:"selectable",checked:l,onChange:()=>this.onSelect(t),before:"string"==typeof a?(0,o.jsx)(h.Avatar,{size:34,src:a}):(0,o.jsx)(h.Avatar,{size:34,initials:Array.from(c)[0],gradientColor:(0,i.calcInitialsAvatarColor)(t)}),badgeAfterTitle:n.is_casper?(0,o.jsx)(p.Icon16Ghost,{}):null,children:c},t)}))})}),(0,o.jsx)(u.ModalFooter,{actionButtons:(0,o.jsx)(g.Button,{size:"m",mode:"primary",disabled:0===n,onClick:this.onAddBots.bind(this),loading:this.state.loading,children:m.getLang("groups_invite_chat_invite")})})]})}constructor(e){super(e),this.searchChats=(0,s.debounce)(((e,t)=>{const{abort:n,promise:o}=function(e,t){let n,o;return{abort(){o.abort(),n()},promise:new Promise(((a,s)=>{n=s,o=window.ajax.post("/al_im.php",{act:"a_search_chats",q:e,group_id:t},{onDone(e){a(e)},onFail:()=>!0})}))}}(e,this.props.groupId);t(n,o)}),200),this.indexer=new f.vkIndexer([],(e=>e.name)),this.data={},e.initialData.forEach((e=>{this.data[e.peer_id]||this.indexer.add(e),this.data[e.peer_id]=e})),this.state={selected:[],value:"",loading:!1,found:[],defaultData:e.initialData.map((e=>Number(e.peer_id)))}}}const S=e=>{window.ajax.post("/al_groups.php",{act:"a_search_chats_box",group_id:e},{onDone(t){!function(e,t){(0,I.showMessageBoxModal)((n=>(0,o.jsx)(w,{...n,title:e.title,initialData:e.results.map((e=>({...e,peer_id:Number(e.peer_id)}))),addHash:e.add_hash,groupId:t})),{width:560})}((0,s.decodeHTMLEntitiesDeep)(t),e)},showProgress:()=>(0,C.showBoxLoader)(),hideProgress:()=>(0,C.hideBoxLoader)()})}},681495:(e,t,n)=>{n.d(t,{handleUiActionForPeer:()=>k});var o=n(368210),a=n(790513),s=n(798738),i=n(30655),r=n(67427),c=n(471828),l=n(159663),d=n(677759),h=n(43129),u=n(604817),g=n(307092),p=n(510697),m=n(801573),_=n(434126),C=n(624012),v=n(199015),f=n(636322),b=n(488844),I=n(76274),w=n(437038),S=n(251087),L=n(922749),A=n(571262),T=n(643668),y=n(977053),x=n(977584);function k(e,t,n,k,M,P,E=(e=>console.error("im_ui_action",{error:e},!1))){switch(k){case o.ConvoAction.CLEAR:{const n=(0,L.getTab)(e,M);let o=(0,a.showFlushChat)(n,M,(()=>{(0,a.cleanHistory)(e,o,t,s.flushHistory,M)}));break}case o.ConvoAction.MEDIA:(0,y.partConfigEnabled)("me_fc_attaches_new_modal")?P.show(M):(0,i.showWiki)({w:"history"+(0,a.convertPeerToUrl)(M)+"_photo"},null,{});break;case o.ConvoAction.CALL_AUDIO:case o.ConvoAction.CALL_VIDEO:(0,a.isCallToPeerAvailable)(e,M)&&(0,a.startCallFromIm)(e,M,k===o.ConvoAction.CALL_VIDEO,[],a.CALL_ENTRY_POINT_HEADER);break;case o.ConvoAction.CALL_APP:(0,a.isCallToPeerAvailable)(e,M)&&window.Calls?.showStartCallModal&&(0,a.startCallFromIm)(e,M,!1,[],a.CALL_ENTRY_POINT_HEADER,!0);break;case o.ConvoAction.CALL_BY_NAME:(0,a.isCallToPeerAvailable)(e,M)&&window.Calls?.showCallByNamePopup&&(0,a.startCallFromIm)(e,M,!1,[],a.CALL_ENTRY_POINT_HEADER,!1,!0);break;case o.ConvoAction.SEARCH:t().showSearch?.(e);break;case o.ConvoAction.ADD_FRIEND:{const n=e.get().tabs[M],o=(0,m.oCacheGet)(e,M);if(!n||!o)return;const a={type:"done_box",text:n.is_subscribed_to_me?c.getLang("mail_im_friend_added").replace("{name}",o.first_name_gen):(0,c.langSex)(o.sex,c.getLang("mail_im_friend_request_sent","raw")).replace("{name}",o.first_name)};e.set((e=>(0,T.setPeerSubscribedStatus)(M,!1,e))).then((()=>e.set(w.setActions))).then((()=>{(0,g.showNotification)(a),t().updateState?.(M,e),t().updateActions?.(e)})).catch(E);break}case o.ConvoAction.BLOCK_NOTIFY:case o.ConvoAction.BLOCK_COMMUNITY:e.set(s.toggleCommunityMessages.bind(null,!1,M)).then((()=>{e.get()?.longpoll?.push([(0,r.resetPeer)()]),(0,S.showDoneBox)(c.getLang("mail_community_was_blocked"))})).catch(E);break;case o.ConvoAction.ALLOW_COMMUNITY:e.set(s.toggleCommunityMessages.bind(null,!0,M)).then((()=>n().changeActions?.(e))).catch(E);break;case o.ConvoAction.BLOCK:(0,a.showBlacklistBox)(M,e).once("success",(t=>{t.delta&&((0,S.showDoneBox)(t.msg),e.get()?.longpoll?.push([(0,r.resetPeer)()]))}));break;case o.ConvoAction.UNBLOCK_USER:e.set((e=>(0,T.setPeerBanStatus)(M,!0,e))).then((()=>e.set(w.setActions))).then((()=>{(0,S.showDoneBox)(c.getLang("mail_peer_was_unblocked")),t().updateState?.(M,e),t().updateActions?.(e)})).catch(E);break;case o.ConvoAction.BLOCK_USER:{const n=(0,l.showFastBox)(c.getLang("mail_blacklist_confirm"),c.getLang("mail_blacklist_message"),c.getLang("box_yes"),(function(){n.hide(),e.set((e=>(0,T.setPeerBanStatus)(M,!1,e))).then((()=>e.set(w.setActions))).then((()=>{(0,S.showDoneBox)(c.getLang("mail_peer_was_blocked")),t().updateState?.(M,e),t().updateActions?.(e)})).catch(E)}),c.getLang("box_no"));break}case o.ConvoAction.REPORT_USER:if(window.cur.viewAsBox)return void window.cur.viewAsBox();(0,x.showReportForm)("user",M,0);break;case o.ConvoAction.LEAVE:{const n=(0,a.showLeaveDialog)(e,M,(o=>{const i=e.set(s.leaveChat.bind(null,M)).then((()=>e.set(s.unpinMessageOptimistic.bind(null,M))));o&&i.then((()=>(0,a.cleanHistory)(e,n,t,s.flushHistory,M,o))).catch(E),n.hide(),e.get()?.longpoll?.push([(0,r.resetPeer)()])}));break}case o.ConvoAction.UNREAD:(0,s.markDialogUnread)(M,e.get()).catch(E);break;case o.ConvoAction.RETURN:e.set(s.returnToChat.bind(null,M)).then((e=>e.set(s.getPinnedMessage.bind(null,M)))).then(t().updateChatTopic?.bind(null,M)).catch((e=>{(0,l.showFastBox)(c.getLang("global_error"),e),E(e)}));break;case o.ConvoAction.MUTE:case o.ConvoAction.UNMUTE:{const n=k===o.ConvoAction.MUTE;e.set((e=>(0,s.setMutedPeer)(M,n,e))).then((e=>t().updateState?.(M,e))).then((()=>e.set((e=>(0,s.toggleMutePeer)(M,n,-1,e))))).catch(E);break}case o.ConvoAction.PIN_CONVO:(0,d.pinConvoHandler)(e.get(),M).catch((e=>{(0,h.showErrorBox)(e),E(e)}));break;case o.ConvoAction.UNPIN_CONVO:(0,d.unpinConvoHandler)(e.get(),M).catch((e=>{(0,h.showErrorBox)(e),E(e)}));break;case o.ConvoAction.ON_STICKERS_POPUP_ANIMATION:e.set((e=>(0,d.toggleStickersPopupAnimation)({data:e,peerId:M,value:1}))).then((()=>e.set(w.setActions))).then((()=>{t().updateActions?.(e),t().updateState?.(M,e)})).catch(E);break;case o.ConvoAction.OFF_STICKERS_POPUP_ANIMATION:e.set((e=>(0,d.toggleStickersPopupAnimation)({data:e,peerId:M,value:0}))).then((()=>e.set(w.setActions))).then((()=>{t().updateActions?.(e),t().updateState?.(M,e)})).catch(E);break;case o.ConvoAction.CHAT_INVITE:(0,a.inviteUser)(e,M,t,s.setCreationType);break;case o.ConvoAction.USER_INVITE:{const t=(0,L.getTab)(e,M);if(t&&((0,L.isUserConvo)(t)||(0,L.isContactConvo)(t))&&t.canBeAddedToChat){(0,u.collectConvoInviteStats)(u.ConvoInviteEntryPoint.DIALOG_ACTIONS,M);const n=(0,L.isContactConvo)(t)?(0,p.makeUserFromUserConvo)(t):(0,m.oCacheGet)(e,M),o=t=>Promise.resolve(e.get().longpoll?.push([(0,r.changePeer)(t,!1,!1,!1,"convo_invite")])),a=t=>e.get().longpoll?.push([(0,r.changePeer)(t,!1,!1,!1,"convo_invite")]);n&&(0,_.mount)(e,n,o,a)}break}case o.ConvoAction.CREATE_CHAT:{const n=(0,L.getTab)(e,M),o=[[M,n?.tab]];e.set(s.setCreationType.bind(null,"chat",[])).then((()=>t().showCreation?.(e,o))).catch(E);break}case o.ConvoAction.PIN_HIDE:(0,C.pinnedMessageHide)(e,(0,v.getPeer)(e),t);break;case o.ConvoAction.PIN_UNHIDE:(0,C.pinnedMessageUnHide)(e,(0,v.getPeer)(e),t);break;case o.ConvoAction.UNPIN:(0,C.pinnedMessageUnpin)(e,(0,v.getPeer)(e),t);break;case o.ConvoAction.SETTINGS:n().showSettings?.(e);break;case o.ConvoAction.DISABLE_BUSINESS_NOTIFY:{const n=(0,L.getTab)(e,M),o=n&&(0,L.isChatConvo)(n)&&n.ownerId;if(!o)return;const a=new l.MessageBox({title:c.getLang("mail_business_notify_disable_box_title")}).content((0,f.getTemplate)("sImBusinessNotifyDisableBoxContent",{text:c.getLang("mail_business_notify_disable_box_text")})).addButton(c.getLang("mail_business_notify_disable_box_button"),(n=>{(0,b.lockButton)(n),e.set((e=>(0,w.setConvoBusinessNotifyEnabled)(e,M,!1))).then((()=>e.set(w.setActions))).then((()=>(t().updateActions?.(e),t().updateState?.(M,e),(0,I.denyMessagesFromGroup)({group_id:-o})))).then((()=>{a.hide()})).catch(E)})).show();break}case o.ConvoAction.ENABLE_BUSINESS_NOTIFY:{const n=(0,L.getTab)(e,M),o=n&&(0,L.isChatConvo)(n)&&n.ownerId;if(!o)return;e.set((e=>(0,w.setConvoBusinessNotifyEnabled)(e,M,!0))).then((()=>e.set(w.setActions))).then((()=>(t().updateActions?.(e),t().updateState?.(M,e),(0,I.allowMessagesFromGroup)({group_id:-o})))).catch(E);break}case o.ConvoAction.ARCHIVE:if(!(0,L.getTab)(e,M))break;e.set((e=>(0,s.updateFolderState)(M,o.FOLDER_MASKS[o.FOLDER_ARCHIVE],A.SET_DIRECTORIES,!0,!1,(0,h.unpackStore)(e)))).then((()=>e.set(w.setActions))).then((()=>{t().updateActions?.(e),t().removePeer?.(e,M),t().updateFolderCounters?.(e),t().addEntityToArchiveMentionsMap?.(e,M)})).then((()=>(0,I.archiveConversation)({peer_id:M}))).catch(E);break;case o.ConvoAction.UNARCHIVE:if(!(0,L.getTab)(e,M))break;e.set((e=>(0,s.updateFolderState)(M,o.FOLDER_MASKS[o.FOLDER_ARCHIVE],A.RESET_DIRECTORIES,!0,!1,(0,h.unpackStore)(e)))).then((()=>e.set(w.setActions))).then((()=>{t().updateActions?.(e),t().removePeer?.(e,M);const n=(0,h.unpackStore)(e);n.active_tab!==o.ConvoListFolder.ARCHIVE||n.dialog_tabs[o.ConvoListFolder.ARCHIVE]?.length||n?.longpoll?.push([(0,r.changeTab)(o.ConvoListFolder.ALL)])})).then((()=>(0,I.unarchiveConversation)({peer_id:M}))).catch(E);break;case o.ConvoAction.CALL_FINISH:{const t=(0,L.getTab)(e,M),n=t?.callInProgress?.call_id;t?.callInProgress?.can_finish_call&&n&&(0,I.forceCallFinish)(n).catch(E);break}}}},381217:(e,t,n)=>{n.d(t,{useIndexer:()=>s});var o=n(337057),a=n(667294);const s=(e,t,n)=>{const s=(0,a.useRef)(null);s.current=s.current?s.current:new o.VkIndexer(e,t);const i=s.current,r=(0,a.useCallback)((e=>e.reduce(((e,t)=>(e[n(t)]=!0,e)),{})),[]),[c,l]=(0,a.useState)(e),[d,h]=(0,a.useState)(r(e));return(0,a.useEffect)((()=>{const t=r(e),o=e.filter((e=>!d[n(e)])),a=c.filter((e=>!t[n(e)]));(o.length||a.length)&&(o.forEach((e=>{i.add(e)})),a.forEach((e=>{i.remove(e)})),l(e),h(t))}),[e]),i}},548799:(e,t,n)=>{n.d(t,{useHints:()=>h});var o=n(667294),a=n(433648),s=n(677759),i=n(381217),r=n(124794),c=n(606408);const l=(0,a.debouncedPromise)(s.searchHints,300),d=()=>!0;function h(e,t,n,a){const[s,h]=(0,o.useState)(t),[u,g]=(0,o.useState)(!1),p=(0,o.useRef)(n),m=(0,o.useCallback)((e=>e.name),[]),_=(0,o.useCallback)((e=>e.peerId),[]),C=(0,i.useIndexer)(t,m,_),v=(0,o.useCallback)((e=>a.filterFn?e.filter(a.filterFn):e),[a.filterFn]);return(0,o.useEffect)((()=>{if(p.current=n,n){const t=C.search(n),o=t.map((e=>e.peerId));h(v(t)),g(!0),l(n,o,a.queryType||c.HintsSearchType.ALL,a,e.get()).then((e=>{p.current===n&&(h((0,r.mergeConvoLists)(t,e,a.filterFn||d)),g(!1))})).catch((()=>{}))}else h(v(t)),g(!1)}),[n,t]),[s,u]}},663745:(e,t,n)=>{n.d(t,{uploadConvoPhoto:()=>i});var o=n(902947),a=n(251087),s=n(606408);function i(){const e=2e9+Math.round((0,o.rand)(1e6,2e6));return new Promise((t=>{window.cur.recieveCropResult=n=>{window.cur.recieveCropResult=!1,(0,s.ownerPhoto)(JSON.parse(n).data[0],e).then((e=>{const o=Array.isArray(e)?e[0]:e;t({photo:o,photoData:n}),(0,a.curBox)()?.hide(!0)}),(()=>{}))},window.Page.ownerPhoto(e),(0,a.curBox)()?.setOptions({onHideAttempt:e=>(e||t({}),!0)})}))}},788274:(e,t,n)=>{var o;n.d(t,{ConvoFilters:()=>o}),function(e){e.ALL="all",e.ARCHIVE="archive",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(o||(o={}))},977584:(e,t,n)=>{n.d(t,{ReportReasonIds:()=>u,afterCommentReportSubmit:()=>p,showReportForm:()=>g});var o=n(785893),a=n(379440),s=n(471828),i=n(684542),r=n(166695),c=n(263740),l=n(661587),d=n(284658);(0,i.initApi)();const h=window.vk;var u;function g(e,t,a,s,i,r,c,h){const u=(0,l.asyncComponent)((()=>Promise.all([n.e(2067),n.e(20795),n.e(29019)]).then(n.bind(n,177911))),(({ReportForm:e})=>e));(0,d.showMessageBoxModalSuspense)((n=>(0,o.jsx)(u,{...n,reportSource:e,reportSourceOwnerId:t,reportSourceId:a,onSubmit:s,messengerAdditionalData:r,from:c,adData:h})),{onDestroy:i})}function p(e,t,n){const o=function(e,t,n){switch(e){case"photo":return`#post${t}photo_${n}`;case"video":return`#post${t}video_${n}mv`;case"market":return`#post${t}market_${n}`}}(e,t,n);if("photo"===e){const e=document.querySelector(`${o} .dld`);null!==e&&(e.outerHTML="")}const i=document.querySelector(`${o} .reply_wrap`);null!==i?(i.style.display="none",i.outerHTML+=`<div class="dld">${s.getLang("global_report_sent")}</div>`):(0,a.debugLog)(`Unable to hide report button for ${e} comment`)}(0,r.setLoginConfig)({onCaptcha:c.handleCaptcha,domain:h?.apiConfigDomains?.loginDomain}),(0,r.setApiConfig)({onCaptcha:c.handleCaptcha,domain:h?.apiConfigDomains?.apiDomain}),function(e){e[e.NotOriginalContent=28]="NotOriginalContent"}(u||(u={}))}}]);try{stManager.done("dist/web/chunks/bbd2f336.afae1b02.js")}catch(e){}