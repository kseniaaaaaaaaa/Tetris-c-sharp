"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[12919],{24513:(e,t,n)=>{n.d(t,{BrowserEnvProvider:()=>re,ChannelsProvider:()=>W,ConvosProvider:()=>B,ConvosSearchIndexProvider:()=>me,DeviceIdProvider:()=>ke,DispatchProvider:()=>w,FeatureFlagsProvider:()=>$,HelpHintsProvider:()=>S,InsertIntoCacheProvider:()=>ue,LastSeenProvider:()=>k,OrganisersProvider:()=>K,OwnerProvider:()=>Y,PeersProvider:()=>D,ThemeStylesContextProvider:()=>fe,TypingsProvider:()=>M,VideoMessageShapesProvider:()=>ne,ViewerProvider:()=>X,isDepsShallowEqual:()=>v,matchAddEventListener:()=>E,useActualEffectCleanup:()=>p,useBrowserEnv:()=>oe,useCallbackWithCustomCompare:()=>h,useChannels:()=>G,useCombinedRefs:()=>de,useConvos:()=>T,useConvosSearchIndex:()=>_e,useDebounced:()=>_,useDeviceId:()=>ge,useDidUpdate:()=>u,useDispatch:()=>y,useFeatureFlags:()=>H,useHelpHints:()=>C,useInsertIntoCache:()=>le,useLastSeen:()=>g,useLayoutDidUpdate:()=>l,useMemoWithCustomCompare:()=>f,useOnChange:()=>m,useOrganisers:()=>j,useOwner:()=>z,usePeers:()=>U,usePixelDensity:()=>R,usePrevious:()=>c,useThemeStyles:()=>ve,useTypings:()=>x,useVideoMessageShapes:()=>ee,useViewer:()=>Q,useViewport:()=>ae});var o=n(667294),i=n(207739),r=n(460167),a=n(250122),s=n(345543),d=n(795947);function c(e){const t=(0,o.useRef)();return(0,o.useEffect)((()=>{t.current=e}),[e]),t.current}function u(e,t){const n=(0,o.useRef)(!1);(0,o.useEffect)((()=>{if(n.current)return e()}),t),(0,o.useEffect)((()=>{n.current=!0}),[])}function l(e,t){const n=(0,o.useRef)(!1);(0,o.useLayoutEffect)((()=>{if(n.current)return e()}),t),(0,o.useLayoutEffect)((()=>{n.current=!0}),[])}function p(e,t){const n=(0,o.useRef)(t);n.current=t,(0,o.useEffect)((()=>()=>{t.some(((e,t)=>e!==n.current[t]))&&e()}),[...t,e]);const i=(0,o.useRef)(e);i.current=e,(0,o.useEffect)((()=>()=>{i.current()}),[])}function m(e,t,n=!0){const[i,r]=(0,o.useState)(n?void 0:t);(void 0===i||t.some(((e,t)=>i[t]!==e)))&&(r(t),e())}function _(e,t){const[n,i]=(0,o.useState)({debounced:e,debouncedUpdatesCount:0});return(0,o.useLayoutEffect)((()=>{if(0===t)return void i((t=>({...t,debounced:e})));const n=setTimeout((()=>{i((({debouncedUpdatesCount:t})=>({debounced:e,debouncedUpdatesCount:t+1})))}),t);return()=>{clearTimeout(n)}}),[e,t]),n}function h(e,t,n){const i=(0,o.useRef)(e),r=(0,o.useRef)(t);return n(r.current,t)||(i.current=e,r.current=t),i.current}function f(e,t,n){const i=(0,o.useRef)(!1),r=(0,o.useRef)(!i.current&&e()),a=(0,o.useRef)(t);return n(a.current,t)||(r.current=e(),a.current=t),i.current=!0,r.current}function v(e,t){return t.every(((t,n)=>(0,s.isShallowEqual)(t,e[n])))}function g(e){const t=(0,o.useContext)(b);if(i.isUserPeerId(e))return t.get(e)}const b=o.createContext(new Map),k=b.Provider;function y(){const e=(0,o.useContext)(I);if(!e)throw new Error("DispatchProvider не добавлен в дерево Реакта!");return e}const I=o.createContext(null),w=I.Provider;function C(){const e=(0,o.useContext)(A);if(void 0===e)throw new Error("HelpHintsProvider не добавлен в дерево Реакта!");return e}const A=o.createContext(new Set),S=A.Provider;function x(e,t="full",n=3){const r=(0,o.useContext)(P),a=U(),{lang:s}=oe(),c=r.get(e);if(!c)return;const u=e=>"full"===t?i.name(e):i.shortName(e),l=[],p=new Set;for(const e of d.TypingVariants){const t=c[e];t&&(l.push(e),t.peerIds.forEach((e=>p.add(e))))}const m=l.length>1?"text":l[0]||"text";if(0===n)return{text:s.use(`me_typing_${m}`),type:m};const _=[];for(const e of p){const t=a.get(e);if(t&&(_.push(t),_.length===n))break}let h;const f=p.size-_.length;switch(!0){case 0===_.length&&f>0:h=s.use("me_typing_people",{num:f});break;case f>0:h=_.map(u).join(", "),h=s.use("me_typing_names_lots",{num:f,values:{names:h}});break;case _.length>1:{const e=_.length>n-1?_.slice(0,n-1).map(u).join(", "):_[0]?u(_[0]):"",t=_[_.length-1],o=t?u(t):"";h=s.use("me_typing_names_couple",{values:{before:e,after:o}});break}case 1===_.length:h=_[0]?i.name(_[0]):"";break;default:h=""}return{text:"compact"===t?h:s.use(`me_typing_${m}_named`,{num:_.length+f,values:{names:h}}),type:m}}const P=o.createContext(new Map),M=P.Provider,F=()=>window.devicePixelRatio>=1.25;function R(){const[e,t]=(0,o.useState)(F);return(0,o.useEffect)((()=>E(window.matchMedia("(resolution: 1.25dppx)"),(()=>{t(F)}))),[]),e}function E(e,t){try{return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}}catch{return e.addListener(t),()=>{e.removeListener(t)}}}function U(){return(0,o.useContext)(N)}const N=o.createContext(new Map),D=N.Provider;function T(){return(0,o.useContext)(q)}const q=o.createContext(new Map),B=q.Provider;function j(){return(0,o.useContext)(L)}const L=o.createContext(a.empty()),K=L.Provider;function G(){return(0,o.useContext)(O)}const O=o.createContext(new Map),W=O.Provider;function H(){const e=(0,o.useContext)(V);if(!e)throw new Error("FeatureFlagsProvider не добавлен в дерево Реакта!");return e}const V=o.createContext(null),$=V.Provider;function z(){const e=(0,o.useContext)(J);if(!e)throw new Error("OwnerProvider не добавлен в дерево Реакта!");return e}const J=o.createContext(null),Y=J.Provider;function Q(){const e=(0,o.useContext)(Z);if(!e)throw new Error("ViewerProvider не добавлен в дерево Реакта!");return e}const Z=o.createContext(null),X=Z.Provider;function ee(){return(0,o.useContext)(te)}const te=o.createContext(new Map),ne=te.Provider;function oe(){const e=(0,o.useContext)(ie);if(!e)throw new Error("BrowserEnvProvider не добавлен в дерево Реакта!");return e}const ie=o.createContext(null),re=ie.Provider;function ae({debounced:e=!1}){const[t,n]=(0,o.useState)(se),i=(0,o.useRef)((0,s.debounce)(n,300,!1));return(0,o.useLayoutEffect)((()=>{const t=i.current,o=()=>{e?t(se()):n(se())};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),e&&t.cancel()}}),[e]),t}function se(){return"undefined"==typeof window?[0,0]:[document.documentElement.clientWidth,document.documentElement.clientHeight]}function de(...e){const t=(0,o.useRef)(null);return o.useEffect((()=>{e.forEach((e=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}))}),[e]),t}const ce=o.createContext(null),ue=ce.Provider;function le(){const e=(0,o.useContext)(ce);if(!e)throw new Error("InsertIntoCacheProvider не добавлен в дерево Реакта!");return e}const pe=o.createContext(r.create()),me=pe.Provider;function _e(){return(0,o.useContext)(pe)}const he=o.createContext(null),fe=he.Provider;function ve(){const e=(0,o.useContext)(he);if(!e)throw new Error("ThemeStylesContextProvider не добавлен в дерево Реакта!");return e}function ge(){const e=(0,o.useContext)(be);if(!e)throw new Error("DeviceIdProvider не добавлен в дерево Реакта!");return e}const be=o.createContext(null),ke=be.Provider},590455:(e,t,n)=>{function o(e){return e}n.d(t,{resolveEventId:()=>o})},703543:(e,t,n)=>{n.d(t,{empty:()=>i,getLockId:()=>s,isLoaded:()=>d,push:()=>c,refresh:()=>u,snakeCaseId:()=>a,sorter:()=>p,updateCounters:()=>l});var o=n(548007);function i(){const e={channelIds:new Set,hasMore:!0,unreadCount:0,unreadUnmutedCount:0,totalCount:0,boundary:{channelId:o.resolveId(0),majorSortId:1/0,minorSortId:1/0}};return{all:{kind:"all",...e},unread:{kind:"unread",...e},archive:{kind:"archive",isHidden:!1,...e}}}const r={all:"all",unread:"unread",archive:"archived"};function a(e){return r[e]}function s(e){return`filter_${e}`}function d(e){return e.boundary.minorSortId!==1/0&&e.boundary.majorSortId!==1/0}function c(e,t,n,i){for(const o of n)m(e,t,o),u(e,o);e[t].hasMore=i,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0,channelId:o.resolveId(0)})}function u(e,t){e.all.channelIds.delete(t.id),e.unread.channelIds.delete(t.id),e.archive.channelIds.delete(t.id),t.isMember&&(t.isArchived?_(e.archive,t)&&e.archive.channelIds.add(t.id):(_(e.all,t)&&e.all.channelIds.add(t.id),o.isUnread(t)&&_(e.unread,t)&&e.unread.channelIds.add(t.id)))}function l(e,{unread:t,archiveTotal:n,unreadUnmuted:o}){void 0!==t&&(e.all.unreadCount=t,e.unread.unreadCount=t),void 0!==o&&(e.all.unreadUnmutedCount=o,e.unread.unreadUnmutedCount=o),void 0!==n&&(e.archive.totalCount=n)}function p(e,t){if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;const n=o.lastPost({channel:e,withPending:!0}),i=o.lastPost({channel:t,withPending:!0});return"Pending"===n?.kind||"Pending"===i?.kind?(i?.sentAt??0)-(n?.sentAt??0):t.minorSortId!==e.minorSortId?t.minorSortId-e.minorSortId:e.id-t.id}function m(e,t,n){o.isHidden(n)||(n.majorSortId<e[t].boundary.majorSortId?e[t].boundary={channelId:n.id,majorSortId:n.majorSortId,minorSortId:n.minorSortId}:n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId<e[t].boundary.minorSortId?(e[t].boundary.channelId=n.id,e[t].boundary.minorSortId=n.minorSortId):n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId===e[t].boundary.minorSortId&&(e[t].boundary.channelId=n.id),"all"===t&&m(e,"unread",n))}function _(e,t){return!o.isHidden(t)&&(!(t.majorSortId<e.boundary.majorSortId)&&(t.majorSortId>e.boundary.majorSortId||!(t.minorSortId<e.boundary.minorSortId)&&(t.minorSortId>e.boundary.minorSortId||!(t.id>e.boundary.channelId))))}},81163:(e,t,n)=>{n.d(t,{empty:()=>a,getLockId:()=>u,isLoaded:()=>c,isVisible:()=>l,push:()=>p,refresh:()=>m,snakeCaseId:()=>d,sorter:()=>h,toggleBusinessNotifyVisibility:()=>f,updateCounters:()=>_});var o=n(503048),i=n(95233),r=n(345543);function a(){const e={peerIds:new Set,hasMore:!0,unreadCount:0,unreadUnmutedCount:0,totalCount:0,boundary:{majorSortId:1/0,minorSortId:1/0}};return{all:{kind:"all",...e},unread:{kind:"unread",headerNotMutedUnread:0,...e},chats:{kind:"chats",...e},archive:{kind:"archive",hasMentions:!1,...e},messageRequest:{kind:"messageRequest",...e},businessNotify:{kind:"businessNotify",isHidden:!1,...e}}}const s={all:"all",unread:"unread",chats:"chats",messageRequest:"message_request",businessNotify:"business_notify",archive:"archive"};function d(e){return s[e]}function c(e){return e.boundary.majorSortId!==1/0&&e.boundary.minorSortId!==1/0}function u(e){return`filter_${e}`}function l(e){switch(e.kind){case"all":case"unread":case"chats":case"archive":return!0;case"messageRequest":return e.peerIds.size>0||e.hasMore;case"businessNotify":return!e.isHidden&&(e.totalCount>0||e.unreadCount>0);default:(0,r.exhaustivenessCheck)(e)}}function p(e,t,n,o){for(const o of n)v(e,t,o),m(e,o);e[t].hasMore=o,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0})}function m(e,t){switch(t.kind){case"ChatConvo":case"GroupConvo":case"UserConvo":case"ContactConvo":case"MessageRequestUserConvo":case"MessageRequestChatConvo":case"BusinessNotify":if(e.all.peerIds.delete(t.peerId),e.unread.peerIds.delete(t.peerId),e.archive.peerIds.delete(t.peerId),e.messageRequest.peerIds.delete(t.peerId),e.businessNotify.peerIds.delete(t.peerId),o.isDeleted(t))return;return o.isBusinessNotify(t)?void(g(e.businessNotify,t)&&e.businessNotify.peerIds.add(t.peerId)):o.isMR(t)?void(o.isPendingMR(t)&&g(e.messageRequest,t)&&e.messageRequest.peerIds.add(t.peerId)):o.hasPeerFlag(t,o.PEER_FLAGS.isArchived)?void(g(e.archive,t)&&e.archive.peerIds.add(t.peerId)):(g(e.all,t)&&e.all.peerIds.add(t.peerId),o.isUnread(t)&&g(e.unread,t)&&e.unread.peerIds.add(t.peerId),void("ChatConvo"===t.kind&&g(e.chats,t)&&e.chats.peerIds.add(t.peerId)));default:return(0,r.exhaustivenessCheck)(t)}}function _(e,{unread:t,unreadUnmuted:n,headerNotMutedUnread:o,archive:i,archiveTotal:r,archiveMentions:a,messageRequests:s,businessNotify:d,businessNotifyTotal:c}){void 0!==t&&(e.all.unreadCount=t,e.unread.unreadCount=t),void 0!==n&&(e.all.unreadUnmutedCount=n,e.unread.unreadUnmutedCount=n),void 0!==o&&(e.unread.headerNotMutedUnread=o),void 0!==i&&(e.archive.unreadCount=i),void 0!==a&&(e.archive.hasMentions=!!a),void 0!==r&&(e.archive.totalCount=r),void 0!==s&&(e.messageRequest.totalCount=s),void 0!==d&&(e.businessNotify.unreadCount=d),void 0!==c&&(e.businessNotify.totalCount=c)}function h(e,t){if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;const n=i.lastNode({history:e.history,withDeleted:!1,withPending:!0,withFailed:!1})?.item,o=i.lastNode({history:t.history,withDeleted:!1,withPending:!0,withFailed:!1})?.item;return"Queued"===n?.kind||"Queued"===o?.kind?(o?.sentAt??0)-(n?.sentAt??0):t.minorSortId!==e.minorSortId?t.minorSortId-e.minorSortId:t.peerId-e.peerId}function f(e,t){e.businessNotify.isHidden=!t}function v(e,t,n){o.isHidden(n)||(n.majorSortId<e[t].boundary.majorSortId?e[t].boundary={majorSortId:n.majorSortId,minorSortId:n.minorSortId}:n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId<e[t].boundary.minorSortId&&(e[t].boundary.minorSortId=n.minorSortId),"all"===t&&(v(e,"unread",n),v(e,"chats",n)))}function g(e,t){return!o.isHidden(t)&&(t.majorSortId>e.boundary.majorSortId||t.majorSortId===e.boundary.majorSortId&&t.minorSortId>=e.boundary.minorSortId)}},653586:(e,t,n)=>{function o(){return[]}n.d(t,{empty:()=>o})},250122:(e,t,n)=>{n.d(t,{canHavePinnedConvos:()=>m,empty:()=>l,filterToTab:()=>h,getId:()=>_,isEqual:()=>p,refresh:()=>c,refreshChannels:()=>u,tabToChannelFilter:()=>v,tabToFilter:()=>f});var o=n(345543),i=n(81163),r=n(924746),a=n(703543),s=n(330310),d=n(653586);function c(e,t,n){n.vkm_new_convo_folder_logic||s.refresh(e.folders,t),r.refresh(e.sublists,t),i.refresh(e.filters,t)}function u(e,t){a.refresh(e.channelFilters,t)}function l(){return{filters:i.empty(),folders:s.empty(),sublists:r.empty(),recommendedFolders:d.empty(),channelFilters:a.empty()}}function p(e,t){if(e.kind!==t.kind)return!1;switch(e.kind){case"filters":return e.filter===t.filter;case"folders":return e.id===t.id;default:(0,o.exhaustivenessCheck)(e)}}function m(e){return"filters"===e.kind}function _(e){return"filters"===e.kind?`${e.kind}__${e.filter}`:`${e.kind}__${e.id}__${e.filter}`}function h(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return}}function f(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return"all"}}function v(e){switch(e){case"archive":case"unread":return e;default:return"all"}}},907557:(e,t,n)=>{function o(e){return!Number.isNaN(e)&&e||(e=0),e}n.d(t,{resolveId:()=>o})},769126:(e,t,n)=>{function o(e){return!Number.isNaN(e)&&e||(e=0),e}n.d(t,{resolveId:()=>o})},71330:(e,t,n)=>{function o(e){return Number.isNaN(e)&&(e=0),e}n.d(t,{resolveStickerId:()=>o})},924746:(e,t,n)=>{function o(){return[]}function i(e,t){return 0==(t.peerFlags&e.filter.and^e.filter.xor)}function r(e,t){for(const n of e)n.peerIds.delete(t.peerId),i(n,t)&&n.peerIds.add(t.peerId)}n.d(t,{empty:()=>o,refresh:()=>r})},883262:(e,t,n)=>{n.d(t,{SYSTEM_STYLE_ID:()=>o,resolveAppearanceId:()=>r,resolveBackgroundId:()=>a,resolveStyleId:()=>i});const o="system";function i(e){return e}function r(e){return e}function a(e){return e}},677961:(e,t,n)=>{n.d(t,{dictionaryLatinConvert:()=>s,toLocalCase:()=>c,toTranslit:()=>d});const o={u1072:"a",u1073:"b",u1074:"v",u1075:"g",u1076:"d",u1077:"e",u1105:"yo",u1078:"zh",u1079:"z",u1080:"i",u1081:"y",u1082:"k",u1083:"l",u1084:"m",u1085:"n",u1086:"o",u1087:"p",u1088:"r",u1089:"s",u1090:"t",u1091:"u",u1092:"f",u1093:"kh",u1094:"ts",u1095:"ch",u1096:"sh",u1097:"shch",u1098:"'",u1099:"y",u1100:"'",u1101:"e",u1102:"yu",u1103:"ya"},i={...o,u1093:"h",u1097:"sh",u1098:"",u1100:"",u1105:"e"},r={u102:"а",u44:"б",u100:"в",u117:"г",u108:"д",u116:"е",u92:"ё",u59:"ж",u112:"з",u98:"и",u113:"й",u114:"к",u107:"л",u118:"м",u121:"н",u106:"о",u103:"п",u104:"р",u99:"с",u110:"т",u101:"у",u97:"ф",u91:"х",u119:"ц",u120:"ч",u105:"ш",u111:"щ",u93:"ъ",u109:"ь",u115:"ы",u39:"э",u46:"ю",u122:"я",u60:"б",u126:"ё",u58:"ж",u123:"х",u125:"ъ",u34:"э",u62:"ю",u64:'"',u35:"№",u36:";",u37:"%",u94:":",u38:"?",u63:",",u47:"."},a={yo:"ё",YO:"Ё",zh:"ж",ZH:"Ж",kh:"х",KH:"Х",ts:"ц",TS:"Ц",ch:"ч",CH:"Ч",sch:"щ",SCH:"Щ",shch:"щ",SHCH:"Щ",sh:"ш",SH:"Ш",eh:"э",EH:"Э",yu:"ю",YU:"Ю",ya:"я",YA:"Я","'":"ь",a:"а",A:"А",b:"б",B:"Б",v:"В",g:"г",G:"Г",d:"д",D:"Д",e:"е",E:"Е",z:"з",Z:"З",i:"и",I:"И",j:"й",J:"Й",k:"к",K:"К",l:"л",L:"Л",m:"м",M:"М",n:"н",N:"Н",o:"о",O:"О",p:"п",P:"Р",r:"р",R:"Р",s:"с",S:"С",t:"т",T:"Т",u:"у",U:"У",f:"ф",F:"Ф",h:"х",H:"Х",c:"ц",C:"Ц",y:"ы",Y:"Ы"};function s({value:e}){return function({dictionary:e,value:t}){return Object.entries(e).reduce(((e,[t,n])=>e.replace(new RegExp(t,"g"),n)),t)}({value:e,dictionary:a})}function d(e,t){e=e.toLowerCase().trim();const n=[o,i];return t&&n.push(r),n.reduce(((t,n)=>{const o=u(e,n);return o===e||t.includes(o)||t.push(o),t}),[])}function c(e){return u(e=e.toLowerCase().trim(),r)}function u(e,t){let n="";for(const o of e){const e=t["u"+o.codePointAt(0)];n+=void 0!==e?e:o}return n}},460167:(e,t,n)=>{n.d(t,{add:()=>s,byWords:()=>p,create:()=>a,peerWords:()=>l,search:()=>d});var o=n(677961),i=n(345543),r=n(747237);function a(){return{items:new Set,branches:{}}}function s(e,t,n){if(Array.isArray(t))t.forEach((t=>s(e,t,n)));else{const{id:o,strings:i}=n(t);(0,r.getWordsVariants)(i).forEach((t=>{let n=e;n.items.add(o),Array.from(t.trim().toLowerCase()).forEach((e=>{let t=n.branches[e];t||(t=n.branches[e]=a()),t.items.add(o),n=t}))}))}return e}function d(e,t){const n=c(e,p(t)),i=c(e,p(o.toLocalCase(t))),r=c(e,o.toTranslit(t));return new Set([...n,...i,...r])}function c(e,t){let n=null;for(const o of t){const t=u(e,o);if(n)for(const e of n)t.has(e)||n.delete(e);else n=new Set([...t])}return n||new Set}function u(e,t){let n=e;const o=t.trim().toLowerCase();for(const e of o){const t=n.branches[e];if(!t)return new Set;n=t}return n.items}function l(e){const t=[];switch(e.kind){case"Chat":t.push(...p(e.title));break;case"Group":e.screenName&&t.push(e.screenName),t.push(...p(e.name));break;case"User":e.screenName&&t.push(e.screenName),t.push(...p(e.firstName)),t.push(...p(e.lastName));break;case"Contact":t.push(...p(e.name));break;default:(0,i.exhaustivenessCheck)(e)}return t}function p(e){return e.trim().toLowerCase().split(/\s+/g)}},747237:(e,t,n)=>{n.d(t,{getWordsVariants:()=>i});var o=n(677961);function i(e){const t=[];for(const n of e){const e=n.replace(/ё/g,"е").replace(/Ё/g,"Е");e!==n&&t.push(e),o.toTranslit(n,!0).forEach((e=>{e!==n&&t.push(e)})),t.push(n)}return t}},361084:(e,t,n)=>{n.d(t,{UNKNOWN_SHAPE_ID:()=>m,apiAttachWallOwnerId:()=>z,emptyPreview:()=>p,fromApiAttach:()=>_,fromApiAudio:()=>F,fromApiConvoAttach:()=>h,fromApiDoc:()=>y,fromApiPhoto:()=>w,fromApiPoll:()=>H,fromApiPollBackgroundGradient:()=>V,fromApiVideo:()=>C,fromApiVoice:()=>R,fromApiWallAttach:()=>f,fromApiWallReplyAttach:()=>v});var o=n(204841),i=n(803854),r=n(207739),a=n(429920),s=n(243860),d=n(345543),c=n(159300),u=n(885540);const l=200,p="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjYGBg+A8AAQQBAHAgZQsAAAAASUVORK5CYII=",m=-1;function _({apiAttaches:e,messageAccessKey:t,attachPositionOffset:n}){if(0===e.length)return{};const o={},a=e=>{o.unknown=[...o.unknown||[],{data:e,kind:"Unknown"}]};let d=n;for(const n of e)switch(void 0!==d&&d++,n.type){case"photo":{if(!n.photo){a(n);break}const e=w({apiPhoto:n.photo,messageAccessKey:t,position:d});if(!e){a(n);break}o.photos=[...o.photos||[],e];break}case"audio":{if(!n.audio){a(n);break}const e=F(n.audio);o.audios=[...o.audios||[],e];break}case"video":if(!n.video){a(n);break}const e=C({apiVideo:n.video,messageAccessKey:t,position:d});if(!e){a(n);break}o.videos=[...o.videos||[],e];break;case"doc":{if(!n.doc){a(n);break}const e=y(n.doc);if(!e){a(n);break}o.docs=[...o.docs||[],e];break}case"link":{if(!n.link){a(n);break}const e=g(n.link);if(!e){a(n);break}const t=e=>e.image&&{...e,image:e.image,kind:"InviteLink"};if(i.isChatInviteLink(e.url)&&e.image){o.inviteLink=t(e);break}o.link=e;break}case"market":if(!n.market){a(n);break}o.market={kind:"Market",id:(I=n.market).id,ownerId:I.owner_id,isService:!!I.is_price_list_service,title:I.title,price:I.price.text,priceOld:I.price.old_amount_text,photo:I.thumb_photo};break;case"market_album":if(!n.market_album){a(n);break}o.marketAlbum=k(n.market_album);break;case"gift":if(!n.gift){a(n);break}const A=M(n.gift);if(!A){a(n);break}o.gift=A;break;case"event":if(!n.event){a(n);break}const S=(h=n.event,{kind:"Event",id:r.resolveRealId("Group",h.id),text:h.text,time:h.time&&1e3*h.time,address:h.address,isFavorite:h.is_favorite});o.event=S;break;case"ugc_sticker":{if(!n.ugc_sticker){a(n);break}const e=(0,c.fromApiUgcSticker)(n.ugc_sticker);if(!e){a(n);break}o.ugcSticker=e;break}case"sticker_pack_preview":{if(!n.sticker_pack_preview){a(n);break}const e=b(n.sticker_pack_preview);if(!e){a(n);break}o.stickerPack=e;break}case"sticker":{if(!n.sticker){a(n);break}const e=(0,c.fromApiSticker)(n.sticker);if(!e){a(n);break}o.sticker=e;break}case"wall":{if(!n.wall||!n.wall.from_id||!n.wall.id){a(n);break}n.wall.geo&&(n.wall.attachments=[...n.wall.attachments||[],{type:"geo",geo:n.wall.geo}]);const e=z(n.wall);if(!e){a(n);break}let t="all";1===n.wall.friends_only&&(t="friends"),1===n.wall.best_friends_only&&(t="best_friends"),o.wall={kind:"Wall",authorId:r.resolveId(n.wall.from_id),ownerId:r.resolveId(e),id:n.wall.id,date:1e3*(n.wall.date||0),chunks:s.fromServerText(n.wall.text||""),attaches:f(n.wall),isAds:"post_ads"===n.wall.post_type,views:n?.wall?.views?.count||0,isDeleted:n.wall.is_deleted||!1,donut:{isDonut:n?.wall?.donut?.is_donut,placeholder:n?.wall?.donut?.placeholder?{text:n?.wall?.donut.placeholder?.text,button:n?.wall?.donut.placeholder?.button}:void 0,duration:(0,u.fromApiDonutDuration)(n?.wall?.donut?.paid_duration)},isVisibleFor:t};break}case"wall_reply":{if(!(n.wall_reply&&n.wall_reply.from_id&&n.wall_reply.id&&n.wall_reply.post_id)){a(n);break}const e=z(n.wall_reply);if(!e){a(n);break}o.wallReply={kind:"WallReply",id:n.wall_reply.id,postId:n.wall_reply.post_id,authorId:r.resolveId(n.wall_reply.from_id),ownerId:r.resolveId(e),parentsStack:n.wall_reply.parents_stack,date:1e3*(n.wall_reply.date||0),chunks:s.fromServerText(n.wall_reply.text||""),attaches:v(n.wall_reply.attachments||[])};break}case"article":if(!n.article){a(n);break}o.article=x(n.article);break;case"poll":if(!n.poll){a(n);break}o.poll=H(n.poll);break;case"graffiti":if(!n.graffiti){a(n);break}o.graffiti={kind:"Graffiti",imageUrl:n.graffiti.url,width:n.graffiti.width,height:n.graffiti.height};break;case"audio_message":if(!n.audio_message){a(n);break}o.voice=R(n.audio_message);break;case"audio_playlist":{if(!n.audio_playlist){a(n);break}const e={kind:"AudioPlaylist",id:(_=n.audio_playlist).id,ownerId:_.owner_id,type:U[_.type],title:_.title,count:_.count,accessKey:_.access_key,plays:_.plays,year:_.year,photo:_.photo,thumbs:_.thumbs,mainArtists:_.main_artists?.map((e=>N(e))),featuredArtists:_.featured_artists?.map((e=>N(e))),audios:_.audios?.map((e=>F(e)))};o.audioPlaylists=[...o.audioPlaylists||[],e];break}case"artist":{if(!n.artist){a(n);break}const e=n.audios;o.artist=N(n.artist,e);break}case"podcast":if(!n.podcast){a(n);break}o.podcast=D(n.podcast);break;case"money_transfer":if(!n.money_transfer){a(n);break}o.moneyTransfer=T(n.money_transfer);break;case"money_request":if(!n.money_request){a(n);break}o.moneyRequest=q(n.money_request);break;case"story":if(!n.story){a(n);break}o.story={kind:"Story",id:(m=n.story).id,ownerId:m.owner_id,date:void 0!==m.date?1e3*m.date:void 0,restricted:!!m.is_restricted,expired:!!m.is_expired,expiresAt:void 0!==m.expires_at?1e3*m.expires_at:void 0,available:!!m.can_see,narrativesCount:m.narratives_count,photo:m.photo&&w({apiPhoto:m.photo}),video:m.video&&C({apiVideo:m.video})};break;case"geo":if(!n.geo||!n.geo.coordinates){a(n);break}o.geo={kind:"Geo",coordinates:n.geo.coordinates,place:n.geo.place};break;case"call":{if(!n.call){a(n);break}const e=L(n.call);if(!e){a(n);break}o.finishedCall=e;break}case"group_call_in_progress":if(!n.group_call_in_progress){a(n);break}o.activeCall={kind:"ActiveCall",initiatorId:(p=n.group_call_in_progress).initiator_id,joinLink:p.join_link,participants:{list:p.participants.list?.map(r.resolveId),count:p.participants.count||0,coverList:j(p)}};break;case"mini_app":if(!n.mini_app){a(n);break}const P=K(n.mini_app);if(!P){a(n);break}o.miniApps=[...o.miniApps||[],P];break;case"app_action":if(!n.app_action){a(n);break}const E=O(n.app_action);if(!E){a(n);break}o.miniAppWidgets=[...o.miniAppWidgets||[],E];break;case"donut_link":if(!n.donut_link){a(n);break}const B=W(n.donut_link);if(!B){a(n);break}o.donutLink=B;break;case"video_message":if(!n.video_message){a(n);break}o.videoMessage=J(n.video_message);break;case"widget":if(!n.widget){a(n);break}o.widget=Q(n.widget);break;case"narrative":if(!n.narrative){a(n);break}const G=Z(n.narrative);if(!G){a(n);break}o.narratives=[...o.narratives||[],G];break;case"question":if(!n.question){a(n);break}o.question={kind:"Question",id:(l=n.question).id,question:l.question,url:l.url||"#",ownerId:r.resolveId(l.owner_id)};break;case"album":if(!n.album){a(n);break}o.album=X(n.album);break;case"curator":{const e=n.curator,t=e?.url,i=e?.id;if(e&&t&&i){const n=ee({...e,url:t,id:i});o.curator=[...o.curator||[],n];break}a(n);break}case"group":case"link_curator":case"video_playlist":case"vkpay":a(n);break;default:n.type;a(n);break}var l,p,m,_,h,I;return o}function h(e){const t={};for(const n of e)switch(n.attachment.type){case"photo":{if(!n.attachment.photo)break;const e=w({apiPhoto:n.attachment.photo,messageAccessKey:n.attachment.photo.access_key,position:n.position});if(!e)break;const o={attach:e,cmid:a.resolveCmid(n.cmid),authorId:r.resolveId(n.from_id),date:n.date};t.photos=(t.photos||[]).concat(o);break}case"audio":{if(!n.attachment.audio)break;const e={attach:F(n.attachment.audio),cmid:a.resolveCmid(n.cmid),authorId:r.resolveId(n.from_id),date:n.date};t.audios=(t.audios||[]).concat(e);break}case"video":{if(!n.attachment.video)break;const e=C({apiVideo:n.attachment.video,messageAccessKey:n.attachment.video.access_key,position:n.position});if(!e)break;const o={attach:e,cmid:a.resolveCmid(n.cmid),authorId:r.resolveId(n.from_id),date:n.date};t.videos=(t.videos||[]).concat(o);break}case"doc":{if(!n.attachment.doc)break;const e=y(n.attachment.doc);if(!e)break;const o={attach:e,cmid:a.resolveCmid(n.cmid),authorId:r.resolveId(n.from_id),date:n.date};t.docs=(t.docs||[]).concat(o);break}case"link":{if(!n.attachment.link)break;const e=g(n.attachment.link);if(!e)break;const o={attach:e,cmid:a.resolveCmid(n.cmid),authorId:r.resolveId(n.from_id),date:n.date};t.links=(t.links||[]).concat(o);break}case"mini_app":{if(!n.attachment.mini_app)break;const e=K(n.attachment.mini_app);if(!e)break;const o={attach:e,cmid:a.resolveCmid(n.cmid),authorId:r.resolveId(n.from_id),date:n.date};t.links=(t.links||[]).concat(o);break}case"app_action":{if(!n.attachment.app_action)break;const e=O(n.attachment.app_action);if(!e)break;const o={attach:e,cmid:a.resolveCmid(n.cmid),authorId:r.resolveId(n.from_id),date:n.date};t.miniAppWidgets=(t.miniAppWidgets||[]).concat(o);break}case"audio_message":case"video_message":case"video_playlist":case"graffiti":case"market":case"wall":break;default:n.attachment.type}return t}function f(e){const{geo:t,attachments:n,copy_history:o,access_key:i}=e,a=[];t&&n?.push({type:"geo",geo:t});for(const e of n||[])switch(e.type){case"photo":case"audio":case"video":case"doc":case"link":case"mini_app":case"sticker":case"market":case"curator":case"article":case"poll":case"audio_playlist":case"album":case"artist":case"podcast":case"narrative":case"event":case"market_album":case"donut_link":case"graffiti":a.push({type:e.type,[e.type]:e[e.type]});break;case"geo":{if(!e.geo)break;const t=e.geo.coordinates?.split(" ").map((e=>parseFloat(e)));a.push({type:"geo",geo:{...e.geo,place:{title:e.geo.place?.title,address:e.geo.place?.address},coordinates:t&&t[0]&&t[1]?{latitude:t[0],longitude:t[1]}:void 0}});break}case"textlive":case"textpost":case"textpost_publish":case"posted_photo":case"note":case"app":case"page":case"situational_theme":case"group":case"photos_list":case"pretty_cards":case"video_playlist":case"clip":case"room":case"online_booking":case"market_link":break;default:e.type}const d=_({apiAttaches:a,messageAccessKey:i});if(o?.[0]&&0!==o?.[0].from_id){const e=z(o[0]);d.wallHistory={kind:"WallHistory",id:o[0].id||0,authorId:r.resolveId(o[0].from_id),ownerId:r.resolveId(e),date:1e3*(o[0].date||0),text:o[0].text||"",attaches:v(o[0].attachments||[]),chunks:s.fromServerText(o[0].text||"")}}return d}function v(e){const t=[];for(const n of e)switch(n.type){case"photo":case"audio":case"audio_playlist":case"artist":case"video":case"doc":case"curator":case"link":case"album":case"event":case"narrative":case"mini_app":case"sticker":case"market":case"graffiti":case"market_album":case"geo":t.push({type:n.type,[n.type]:n[n.type]});break;case"note":case"page":case"app":case"article":case"donut_link":case"group":case"photos_list":case"poll":case"posted_photo":case"pretty_cards":case"video_playlist":case"situational_theme":case"textlive":case"textpost":case"textpost_publish":case"podcast":case"room":case"clip":case"online_booking":case"market_link":break;default:n.type}return _({apiAttaches:t})}function g(e){let t=e.url;const n=/^https:\/\/m\.vk\.com(.+)/;if(n.test(e.url)){const o=e.url.match(n);t=o&&o[1]?o[1]:t}let o;return(e.seller_product?.owner_name||e.rating?.stars||e.rating?.reviews_count||e.seller_product?.favicon_link)&&(o={ownerName:e.seller_product?.owner_name,rating:e.rating?.stars,reviews:e.rating?.reviews_count,favicon:e.seller_product?.favicon_link}),{kind:"Link",url:t,meta:o,title:e.title??"",subtitle:e.caption||t,image:e.photo?B(e.photo.sizes||[]):void 0}}function b(e){if(!e.url)return null;const t=e.icon?.base_url,n=t?`${t}/square.png`:void 0;return{kind:"StickerPack",packId:e.id,url:e.url,title:e.title,subtitle:e.description||"",iconUrl:n}}function k(e){const t=e.photo?.sizes?B(e.photo.sizes):void 0;return{kind:"MarketAlbum",id:e.id,ownerId:e.owner_id,title:e.title,count:e.count,image:t,isMain:e.is_main,isHidden:e.is_hidden}}function y(e){if(!e.url)return;const t=!!e.preview?.photo?.sizes?.length&&B(e.preview.photo.sizes.map((e=>({...e,url:e.src}))));return{kind:"Doc",id:e.id,ownerId:e.owner_id,title:e.title,size:e.size,ext:e.ext,type:I(e.ext,e.type),date:e.date,url:e.url,isUnsafe:Boolean(e.is_unsafe),...t&&{image:t}}}const I=(e,t)=>{switch(e){case"csv":case"dat":case"ecsv":case"ods":case"tsv":case"xar":case"xl":case"xlr":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":case"xlw":return"spreadsheet";case"ppt":case"ppta":case"pptm":case"pptx":return"default";default:switch(t){case 1:return"text";case 2:return"archive";case 3:return"gif";case 4:return"image";case 5:return"audio";case 6:return"video";case 7:return"ebook";default:return"default"}}};function w({apiPhoto:e,messageAccessKey:t,position:n}){if(e.sizes)return{kind:"Photo",accessKey:e.access_key,albumId:e.album_id,id:e.id,ownerId:e.owner_id,hasTags:e.has_tags,thumbhashUrl:e.thumb_hash&&(0,o.thumbHashToDataURL)(Uint8Array.from(atob(e.thumb_hash),(e=>e.charCodeAt(0)))),sizes:B(e.sizes),originalImage:e.orig_photo?.url,messageAccessKey:t,uploadDate:1e3*e.date,vkcomWebViewToken:e.web_view_token,...n&&{position:n}}}function C({apiVideo:e,messageAccessKey:t,position:n,useFirstFrame:o}){if(!e.id||!e.owner_id)return;const i=function(e){const t=e.sort(((e,t)=>e.width-t.width)).map((e=>({width:e.width,height:e.height,url:e.url}))),[n,...o]=t;if(!n)return;return[n,...o]}(("short_video"===e.type||o?e.first_frame:e.image)||[{url:p,height:1,width:1}]);return i?{kind:"Video",accessKey:e.access_key,id:e.id,ownerId:e.owner_id,duration:e.duration,width:e.width,height:e.height,image:i,title:e.title,views:e.views||0,restriction:e.restriction&&{title:e.restriction?.title||"",alwaysShown:!!e.restriction?.always_shown,button:e.restriction?.button,canPlay:!!e.restriction?.can_play,canPreview:!!e.restriction?.can_preview,cardIcon:e.restriction?.card_icon,disclaimerType:e.restriction?.disclaimer_type,isBlur:!!e.restriction?.blur,listIcon:e.restriction?.list_icon,text:e.restriction?.text},files:"files"in e?e.files:void 0,type:e.type,messageAccessKey:t,player:e.player,platform:e.platform,canDownload:e.can_download,uploadDate:e.date&&1e3*e.date,addingDate:e.adding_date&&1e3*e.adding_date,isFromMessage:Boolean(e.is_from_message)||!1,mainArtists:e.main_artists?.map((e=>N(e))),timelineThumbs:"timeline_thumbs"in e?S(e.timeline_thumbs):void 0,videoEpisode:"episodes"in e?A(e.episodes):void 0,oneVideoId:e.ov_id||"",trackCode:e.track_code||"",videoIdFull:`${e.owner_id}_${e.id}`,...n&&{position:n}}:void 0}function A(e){if(e)return e.map((e=>({time:e.time||0,text:e.text||""})))}function S(e){if(e)return{countPerImage:e.count_per_image||0,countPerRow:e.count_per_row||0,countTotal:e.count_total||0,frameHeight:e.frame_height||0,frameWidth:e.frame_width||0,frequency:e.frequency||0,isUV:e.is_uv||!1,links:e.links||[]}}function x(e){let t,n;switch(e.state){case"available":case"banned":case"deleted":case"paid":case"protected":t=e.state;break;case void 0:t="unknown";break;default:e.state;t="unknown"}return e.photo?n=B(e.photo.sizes||[]):e.owner_photo&&(n=B([{type:"o",width:0,height:0,url:e.owner_photo}])),{kind:"Article",id:e.id||0,ownerId:e.owner_id||0,state:t,url:e.url||"",title:e.title||"",author:e.owner_name||"",meta:e.subtitle||"",image:n,accessKey:e.access_key||""}}const P={thumb:[48,96,256,512],photo:[34,68,135,270,300,600,1200],unknown:[]};function M(e){const t=function(e,t){if(!e)return;const[n,...o]=P[t].reduce(((n,o)=>{const i=e[`${t}_${o}`];return i?(n.push({url:i,width:o,height:o}),n):n}),[]);return n?[n,...o]:void 0}(e,"thumb");if(t)return{kind:"Gift",id:e.id,isStickerStyle:!!e.is_stickers_style,image:t}}function F(e){return{kind:"Audio",id:e.id,ownerId:e.owner_id,artist:e.artist,title:e.title,subtitle:e.subtitle,url:e.url,duration:e.duration,albumId:e.album_id,trackCode:e.track_code,contentRestricted:e.content_restricted,albumPartNumber:e.album_part_number,thumb:e.album?.thumb,isExplicit:e?.is_explicit,accessKey:e.access_key}}function R(e){return{kind:"Voice",duration:e.duration,id:e.id,linkMp3:e.link_mp3,linkOgg:e.link_ogg,ownerId:e.owner_id,waveform:e.waveform,isTranscriptPossible:e.duration/60/60<1,transcription:E(e)}}function E(e){switch(e.transcript_state){case"done":return{state:"done",text:e.transcript?.trim(),updatedAt:e.transcript_update_time?1e3*e.transcript_update_time:void 0};case"error":case"in_progress":return{state:e.transcript_state};case void 0:return;default:e.transcript_state;return}}const U={0:"playlist",1:"album",2:"album",3:"album",4:"album",5:"playlist"};function N(e,t){return{kind:"Artist",id:e.id,blockId:e.popular_audios_block_id,name:e.name,photo:e.photo,domain:e.domain,audios:t?.map((e=>F(e)))}}function D(e){const t=e.podcast_info?.cover?.sizes,n=t&&B(t).values(),o=n&&(0,d.toNonEmpty)([...n])||void 0;return{kind:"Podcast",id:e.id,ownerId:e.owner_id,title:e.title,image:o}}function T(e){if(e.amount)return{kind:"MoneyTransfer",id:e.id,toId:r.resolveId(e.to_id),fromId:r.resolveId(e.from_id),amount:+e.amount.amount/100,currencySign:e.amount.currency.title}}function q(e){const t=e=>e&&!isNaN(Number(e))?+e/100:void 0,n=new URLSearchParams(e.init_url);return{kind:"MoneyRequest",id:e.id,toId:r.resolveId(e.to_id),fromId:r.resolveId(e.from_id),isUserOwner:Boolean(e.user_is_owner),amount:+e.amount.amount/100,totalAmount:t(e.total_amount?.amount),transferredAmount:t(e.transferred_amount?.amount),userCount:e.users_count,currencyCode:e.amount.currency.name,currencySign:e.amount.currency.title,hash:n.get("hash")||void 0}}function B(e){return e.sort(((e,t)=>e.width-t.width)).reduce(((e,{type:t,src:n,url:o,...i})=>(void 0===o||"s"!==t&&"m"!==t&&"x"!==t&&"o"!==t&&"p"!==t&&"q"!==t&&"r"!==t&&"y"!==t&&"z"!==t&&"w"!==t||(i.width&&i.height?e.set(t,{url:o,...i}):e.set(t,{...i,url:o,width:l,height:l})),e)),new Map)}function j(e){const t=e.participants?.list;if(!t)return[];return t.reduce(((e,t)=>{const n=r.resolveAnyId(t);return(r.isUserPeerId(n)||r.isGroupPeerId(n))&&e.push(n),e}),[]).slice(0,3)}function L(e){const t=function(e){switch(e.state){case"reached":return"reached";case"canceled_by_initiator":return"canceledByInitiator";case"canceled_by_receiver":return"canceledByReceiver";default:return}}(e);if(t)return{kind:"FinishedCall",initiatorId:e.initiator_id,duration:e.duration,state:t,participants:{list:e.participants?.list?.map(r.resolveId),count:e.participants?.count||0,coverList:j(e)}}}function K(e){if(!e.app||!e.app.share_url||!e.app.webview_url)return;const t=(0,d.toNonEmpty)(e.images.map((({url:e,height:t,width:n})=>({width:n,height:t,url:e}))));if(!t)return;t.sort(((e,t)=>e.width-t.width));const n=e.app.share_url.replace(/https:\/\/[a-z0-9_\-.]+\//,""),o=n.split("#").slice(1).join("#");return{kind:"MiniApp",title:e.title,appLink:n,images:t,id:i.resolveMiniAppId(e.app.id),url:e.app.webview_url,shareUrl:e.app.share_url,hash:o,type:e.app.type,status:i.resolveMiniAppStatus(e.app.app_status),description:e.description,buttonText:e.button_text}}function G(e){const t=[];return e.forEach((e=>{const n=function(e){const{object_id:t,items:n}=e;if(t&&n&&0!==n.length)return{id:t,icon50:n[0]?.url||""}}(e);n&&t.push(n)})),t}function O(e){const{type:t,title:n,icons:o,description:r,footer:s,button_text:d,application:c}=e;if(!c||!c.webview_url||0===o.length)return;const u={...o.reduce(((e,{width:t,url:n})=>({...e,[`icon${t}`]:n||""})),{icon75:o[0]?.url||""}),id:i.resolveMiniAppId(c.id),title:c.title,webviewUrl:c.webview_url},l=s?{description:s.description,items:s.items?G(s.items):[]}:null,p=new URL(u.webviewUrl),m=p.hash??"";let _=`app${u.id}?`,h=0;return["vk_chat_id","vk_message_id","vk_ref"].forEach((e=>{const t=p.searchParams.get(e);"vk_message_id"===e&&(h=Number(t||0)),t&&(_=`${_}${e}=${t}`)})),{kind:"MiniAppWidget",type:t,title:n,description:r,buttonText:d,app:u,appLink:_,hash:m,cmid:a.resolveCmid(h),footer:l||void 0}}function W(e){const t=r.resolveId(e.owner_id);if(r.isGroupPeerId(t)&&e.action?.url&&e.button.action?.url&&e.button.title)return{kind:"DonutLink",ownerId:t,button:{action:{target:"internal",type:"open_url",url:e.button.action.url},title:e.button.title},donorsCount:e.donors.count,text:e.text,action:{target:"internal",type:"open_url",url:e.action.url}}}function H(e){return{kind:"Poll",id:e.id,ownerId:r.resolveId(e.owner_id),authorId:void 0!==e.author_id?r.resolveId(e.author_id):r.resolveId(e.owner_id),title:e.question,anonymous:!!e.anonymous,endDate:1e3*e.end_date,answers:e.answers.map((t=>({id:t.id,text:t.text,votes:t.votes,rate:t.rate,selected:!!e.answer_ids?.includes(t.id)}))),voted:!!e.answer_ids?.length,canVote:e.can_vote,canChangeVote:!e.disable_unvote,canEdit:e.can_edit,multiple:e.multiple,votes:e.votes,friends:e.friends?.map((e=>r.resolveId(e.id)))||[],backgroundGradient:V(e.background),backgroundPhoto:$(e.photo)}}function V(e){if(!e||"gradient"!==e.type)return;const{points:t,angle:n}=e;return void 0!==t&&void 0!==n?{id:e.id||0,points:t.map((e=>"#"+e.color)),angle:n}:void 0}function $(e){if(!e||!e.color||!e.images)return;const t=(0,d.toNonEmpty)(e.images.map((e=>({url:e.url,width:e.width,height:e.height}))));return t?{kind:"PollBackgroundPhoto",image:t,color:"#"+e.color}:void 0}function z({owner_id:e,source_id:t,to_id:n}){return e??t??n}function J(e){if(!e.id||!e.owner_id)return;const t=function(e){const t=e.filter((e=>!e.with_padding)).sort(((e,t)=>e.width-t.width)).map((e=>({width:e.width,height:e.height,url:e.url}))),[n,...o]=t;if(n)return[n,...o]}(e.image||[{url:"",height:0,width:0}]);return t?{kind:"VideoMessage",id:e.id,ownerId:e.owner_id,duration:e.duration,shapeId:e.shape_id||m,image:t,files:e.files,transcription:Y(e)}:void 0}function Y(e){switch(e.transcript_state){case"done":return{state:"done",text:e.transcript?.trim(),updatedAt:e.transcript_update_time?1e3*e.transcript_update_time:void 0};case"error":case"in_progress":case"uninitialized":return{state:e.transcript_state};case void 0:return;default:(0,d.exhaustivenessCheck)(e.transcript_state)}}function Q(e){if(e.item.widget_id)return{kind:"Widget",id:e.item.widget_id,data:e}}function Z(e){const t=e.cover?.cropped_sizes&&(0,d.toNonEmpty)(e.cover.cropped_sizes.map((e=>({url:e.url,width:e.width,height:e.height}))))||void 0;return{kind:"Narrative",id:e.id,title:e.title,ownerId:r.resolveId(e.owner_id),isDeleted:e.is_delete,isFavorite:e.is_favorite,canSee:e.can_see,storyIds:e.story_ids,image:t}}function X(e){const t=e.thumb?.sizes?B(e.thumb.sizes):void 0;return{kind:"Album",id:e.id,ownerId:r.resolveId(e.owner_id),created:e.created,description:e.description,size:e.size,image:t,title:e.title,updated:e.updated}}function ee(e){return{kind:"Curator",id:e.id,url:e.url,title:e.name,subtitle:e.description,image:e.photo}}},399137:(e,t,n)=>{n.d(t,{convertButtons:()=>l,fromApiKeyboard:()=>d,fromApiMessageEvent:()=>m,fromEngineKeyboard:()=>c});var o=n(659397),i=n(803854),r=n(590455),a=n(207739),s=n(33200);function d(e,t){const n=u(e.buttons,e.inline),o=a.resolveId(e.author_id||t);return e.inline?{kind:"InlineKeyboard",authorId:o,buttons:n}:{kind:"InputKeyboard",authorId:o,buttons:n,oneTime:e.one_time}}function c(e,t){if(e.inline)return e.buttons?{kind:"InlineKeyboard",buttons:u(e.buttons,e.inline),authorId:a.resolveId(e.author_id||t)}:void 0;if(!e.buttons?.length)return{kind:"InputKeyboardDeleteEvent"};return{kind:"InputKeyboardUpsertEvent",keyboard:{kind:"InputKeyboard",buttons:u(e.buttons,e.inline),authorId:a.resolveId(e.author_id||t),oneTime:e.one_time}}}function u(e,t){return e.map((e=>l(e,t)))}function l(e,t){return e.map((e=>function(e,t){const n="positive"===(r=e.color)?{mode:"primary",appearance:"positive"}:"negative"===r?{mode:"primary",appearance:"negative"}:"primary"===r?{mode:"primary"}:{mode:"secondary"};var r;switch(e.action.type){case"text":case"callback":return{type:e.action.type,label:(0,o.unescape)(e.action.label||""),payload:e.action.payload||"",...n};case"open_link":case"open_modal_view":return{type:e.action.type,link:e.action.link,label:(0,o.unescape)(e.action.label||""),payload:e.action.payload||"",...n};case"location":return{type:e.action.type,payload:e.action.payload||"",...n};case"vkpay":return{type:e.action.type,payload:e.action.payload||"",appId:(0,i.resolveMiniAppId)(s.VK_PAY_APP_ID),hash:e.action.hash||""};case"open_app":return{type:e.action.type,payload:e.action.payload||"",label:(0,o.unescape)(e.action.label||""),hash:e.action.hash||"",appId:(0,i.resolveMiniAppId)(e.action.app_id),ownerId:e.action.owner_id?a.resolveId(e.action.owner_id):void 0,...n};case"open_photo":return;default:return void e.action}}(e))).filter(p)}function p(e){return void 0!==e}const m=(e,t,n)=>{const{event_id:o,action:s,owner_id:d}=n,c=r.resolveEventId(o),u=a.resolveId(d);if(s)switch(s.type){case"show_snackbar":return{type:s.type,id:c,ownerId:u,text:s.text,title:a.name(e),photo:t.photo50,peerId:e.id};case"open_link":case"open_modal_view":return{type:s.type,id:c,ownerId:u,link:s.link,title:a.name(e),peerId:e.id};case"open_app":return{type:s.type,id:c,ownerId:u,appId:(0,i.resolveMiniAppId)(s.app_id),hash:s.hash,peerId:e.id};default:}return{type:"null",id:c,ownerId:u,peerId:e.id}}},368108:(e,t,n)=>{n.d(t,{fromApiTemplate:()=>r});var o=n(399137),i=n(361084);function r(e,t){return{kind:"carousel",elements:e.elements?.map((e=>function({buttons:e,photo:t,action:n,...r},a){const s=t?(0,i.fromApiPhoto)({apiPhoto:t,messageAccessKey:a}):null,d={buttons:e?(0,o.convertButtons)(e,!0):[],...s&&{photo:s},...r},c={...d,kind:"simple"};if(!n)return c;switch(n.type){case"open_photo":return t&&s?{...d,kind:"photo",photo:s}:c;case"open_link":case"open_modal_view":return{...d,kind:"link",link:n.link};default:return c}}(e,t)))||[]}}},482244:(e,t,n)=>{n.d(t,{fromApiChannel:()=>s});var o=n(548007),i=n(377836),r=n(243860),a=n(885540);const s=(e,t)=>{const{channel:n,last_message:s}=e,d=s&&(0,a.fromApiPost)(s).post,c={confirmed:[],pending:[]};d&&(c.confirmed=d.cmid>1?[{kind:"GapNode",fromCmid:i.resolveCmid(1),toCmid:i.resolveCmid(d.cmid-1)},{kind:"Node",item:d}]:[{kind:"Node",item:d}]);const u=!n.user_data.notification_settings.is_enabled||(n.user_data.notification_settings.disable_duration||0)>0,l=i.resolveCmid(n.user_data?.read_state?.read_up_to_cmid||0),p=t.menu?.items?.length?t.menu?.items?.map((e=>({id:e.id,title:e.title,url:e.url,cover:e.cover,counter:e.counter}))):void 0;return{kind:"Channel",id:o.resolveId(n.channel_id),unreadCount:n.user_data.read_state?.unread_count||0,isArchived:!!n.user_data?.is_archived,isMuted:u,notificationsDisabledUntil:n.user_data.notification_settings.disable_duration||0,inReadCmid:l,majorSortId:n.sort_id.major_id,minorSortId:n.sort_id.minor_id,membersCount:t.members_count||0,isMember:n.user_data.is_member,adminLevel:t.admin_level||0,photos:{photo50:t.photo_50,photo100:t.photo_100},name:t.name||"",description:r.fromServerText(t.description||""),activity:t.activity||"",isVerified:!!t.verified,screenName:t.screen_name,history:c,rights:{canSendDonut:!!t.can_post_donut,canPost:!!t.can_post},pending:{},isRepostsDisabled:Boolean(t.reposts_disabled),actionButton:{isEnabled:Boolean(t.action_button?.is_enabled),title:t.action_button?.title,type:t.action_button?.action_type,target:{appId:t.action_button?.target?.app_id,email:t.action_button?.target?.email,googleStoreURL:t.action_button?.target?.google_store_url,isInternal:t.action_button?.target?.is_internal,itunesURL:t.action_button?.target?.itunes_url,phone:t.action_button?.target?.phone,url:t.action_button?.target?.url,userId:t.action_button?.target?.user_id}},menu:p,isClosed:Boolean(t.is_closed),mediaViewerCache:{items:[],hasPrev:!0,hasNext:!0},canMessage:Boolean(t.can_message)}}},483705:(e,t,n)=>{n.d(t,{fromApiIncognitoMember:()=>r});var o=n(207739),i=n(886330);function r(e){const t=i.resolveIncognitoMemberId(e.id),n=o.resolveId(e.invited_by),r=o.resolveId(e.member_id);return{id:t,name:e.name||"",inviteDate:1e3*e.join_date,inviterId:n,...(o.isUserPeerId(r)||o.isContactPeerId(r))&&{memberId:r}}}},138398:(e,t,n)=>{n.d(t,{fromApiConvoBanner:()=>i});var o=n(243860);function i(e){return{icon:e.icon??"",name:e.name,title:e.title??"",chunks:o.fromServerText(e.text),canHide:e.can_hide||!0,buttons:(e.buttons||[]).map((e=>({callbackData:e?.callback_data??"",mode:e.layout,appearance:r(e.style),link:e?.link??"",text:e.text,hideOnAction:!!e.hide_on_action,type:e.type}))),isTemporarilyHidden:!1,cardInfo:e.card_info}}function r(e){return"destructive"===e?"negative":"regular"===e?"accent":e}},467635:(e,t,n)=>{n.d(t,{fromApiConvo:()=>p,fromLongpollPushSettings:()=>m});var o=n(207739),i=n(503048),r=n(330310),a=n(429920),s=n(883262),d=n(500955),c=n(399137),u=n(138398);const l={18:"peer_deleted",203:"disabled_by_peer",900:"peer_blacklisted_by_me",901:"peer_blacklisted",902:"peer_blacklisted",915:"disabled_by_community",916:"disabled_by_peer",917:"kicked",918:"no_access",922:"no_access",925:"no_access",932:"no_access",945:"chat_unsupported",946:"chat_unsupported",983:"restricted_to_write_in_chat",984:"spam_restriction",985:"announcements",1012:"forbid_writing_for_all"};function p(e,t){const n=t&&(0,d.fromApiMessage)(t).message,l={confirmed:[],pending:[]};n?l.confirmed=n.cmid>1?[{kind:"GapNode",fromCmid:a.resolveCmid(1),toCmid:a.resolveCmid(n.cmid-1)},{kind:"Node",item:n}]:[{kind:"Node",item:n}]:void 0!==e.last_conversation_message_id&&e.last_conversation_message_id>0?l.confirmed=[{kind:"GapNode",fromCmid:1,toCmid:e.last_conversation_message_id}]:0===e.last_conversation_message_id&&"group"===e.peer.type&&(l.confirmed=[{kind:"GapNode",fromCmid:1,toCmid:1}]);const p=e.current_keyboard&&(0,c.fromApiKeyboard)(e.current_keyboard);if("InlineKeyboard"===p?.kind)throw new Error("Не может прийти инлайн клавиатура для сообщения");const m=e.peer_flags||0,v={majorSortId:e.sort_id?.major_id||0,minorSortId:e.sort_id?.minor_id||0,unreadCount:e.unread_count||0,inReadBy:a.resolveCmid(e.in_read_cmid),outReadBy:a.resolveCmid(e.out_read_cmid),isNew:!!e.is_new,peerFlags:m,folderIds:new Set(e.folder_ids?.map(r.resolveId)||[]),canWrite:h(e),currentKeyboard:p,push:_(e.push_settings),history:l,unreadExpireables:new Set((e.expire_cmids||[]).map(a.resolveCmid)),unreadReactions:new Map((e.unread_reactions||[]).map((e=>[a.resolveCmid(e),void 0]))),convoBanner:e.conversation_bar&&(0,u.fromApiConvoBanner)(e.conversation_bar),mediaViewerCache:{items:[],hasPrev:!0,hasNext:!0},styleId:s.resolveStyleId(e.style||"system")},g=o.resolveId(e.peer.id);switch(e.peer.type){case"user":if(!o.isUserPeerId(g))return null;if(void 0!==e.message_request_data){const{status:t}=e.message_request_data;return"pending"===t||"cancelled"===t||"rejected"===t?{convo:{...v,kind:"MessageRequestUserConvo",peerId:g,MRStatus:t}}:null}return{convo:{...v,kind:"UserConvo",peerId:g}};case"chat":{if(!o.isChatPeerId(g))return null;if(!e.chat_settings)throw new Error("TODO chat convo has to has chat settings");const t=e.chat_settings.owner_id&&0!==e.chat_settings.owner_id?o.resolveId(e.chat_settings.owner_id):void 0,n=t&&(o.isUserPeerId(t)||o.isGroupPeerId(t))?t:void 0,r=new Set([t,...e.chat_settings.admin_ids||[]].map(o.resolveId)),s={count:e.chat_settings.members_count||0,members:new Map,adminIds:r,memberIds:new Set,invitedIds:new Set,incognitoMembers:new Map},c={...v,peerId:g,ownerId:n,unreadMentions:new Set((e.mention_cmids||[]).map(a.resolveCmid)),state:e.chat_settings.state,isCasper:!!e.chat_settings.is_disappearing,isCommunityChat:!!t&&o.isGroupPeerId(t),isDonut:!!e.chat_settings.is_donut,isGroupChannel:!!e.chat_settings.is_group_channel,activeCall:f(e.call_in_progress),pinnedMessage:e.chat_settings.pinned_message?(0,d.fromApiPinnedMessage)(e.chat_settings.pinned_message):void 0,acl:(y=e.chat_settings.acl,{canChangeInfo:y.can_change_info,canChangeInviteLink:y.can_change_invite_link,canChangePin:y.can_change_pin,canInvite:y.can_invite,canPromoteUsers:y.can_promote_users,canSeeInviteLink:y.can_see_invite_link,canModerate:y.can_moderate,canCopyChat:y.can_copy_chat,canCall:y.can_call,canUseMassMentions:y.can_use_mass_mentions,canChangeServiceType:Boolean(y.can_change_service_type),canChangeStyle:Boolean(y.can_change_style),canSendReactions:!0}),permissions:e.chat_settings.permissions?(k=e.chat_settings.permissions,{...i.DEFAULT_CHAT_PERMISSIONS,...k}):void 0,description:e.chat_settings.description,isService:Boolean(e.chat_settings.is_service),members:s,adminIds:r,shouldShortPollReactions:Boolean(e.chat_settings.short_poll_reactions),isIncognito:e.chat_settings.is_incognito,forbidedWritingForAll:e.chat_settings.writing_disabled?(b=e.chat_settings.writing_disabled,{value:b.value,until:b.until_ts?1e3*b.until_ts:void 0}):void 0,isDeleted:Boolean(e.chat_settings.is_deleted_for_all)},u={kind:"Chat",id:g,title:e.chat_settings?.title||"",photo50:e.chat_settings.photo?.photo_50,photo100:e.chat_settings.photo?.photo_100,photo200:e.chat_settings.photo?.photo_200,hasDefaultPhoto:e.chat_settings.photo?.is_default_photo||e.chat_settings.photo?.is_default_call_photo,canCall:e.chat_settings.acl.can_call};if(void 0!==e.message_request_data){const{status:t,inviter_id:n}=e.message_request_data;return"pending"!==t&&"rejected"!==t&&"cancelled"!==t||void 0===n?null:{convo:{...c,kind:"MessageRequestChatConvo",inviterPeerId:o.resolveId(n),MRStatus:t},peer:u}}return e.peer_flags&&0!=(e.peer_flags&1<<i.PEER_FLAGS.isBusinessNotify)?{convo:{...c,kind:"BusinessNotify"},peer:u}:{convo:{...c,kind:"ChatConvo"},peer:u}}case"group":return o.isGroupPeerId(g)?{convo:{...v,isPromo:!!e.is_promo,peerId:g,kind:"GroupConvo"}}:null;case"email":return null;case"contact":return o.isContactPeerId(g)?{convo:{...v,peerId:g,kind:"ContactConvo"}}:null;default:e.peer.type;return null}var b,k,y}function m(e){const t=Number(e[1].disabled_until);switch(t){case 0:return{mode:"everything",disabledUntil:0};case-1:return{mode:"every-mention",disabledUntil:1/0};default:return{mode:"every-mention",disabledUntil:1e3*t}}}function _(e){let t={mode:"everything",disabledUntil:0};return e?(e.disabled_forever?t={mode:"every-mention",disabledUntil:1/0}:e.disabled_until&&(t={mode:"every-mention",disabledUntil:1e3*e.disabled_until}),"everything"!==t.mode&&(e.disabled_mass_mentions&&(t={...t,mode:"direct-mention"}),e.disabled_mentions&&(t={...t,mode:"nothing"})),t):t}function h(e){return"chat"===e.peer.type&&"rejected"===e.message_request_data?.status?{allowed:!1,reason:"mr_rejected"}:e.can_write?.allowed?{allowed:!0}:{allowed:!1,reason:e.can_write?.reason&&l[e.can_write.reason]||"unknown",until:e.can_write?.until?1e3*e.can_write.until:void 0}}function f(e){if(!e)return;return{participants:{list:(e.participants.list||[]).reduce(((e,t)=>{const n=o.resolveAnyId(t);return(o.isUserPeerId(n)||o.isGroupPeerId(n))&&e.push(n),e}),[]),count:e.participants.count||0},joinLink:e.join_link,canFinishCall:Boolean(e.can_finish_call),hasLink:Boolean(e.has_link),id:e.call_id}}},234950:(e,t,n)=>{n.d(t,{fromApiFolder:()=>r,fromApiFolderRecommended:()=>s,fromEngineFolder:()=>a});var o=n(207739),i=n(330310);function r(e){const t=e.included_peer_ids?.map(o.resolveId);return{...d(t,e.included_lists),...i.convertFlags(e.flags),id:i.resolveId(e.id),name:e.name}}function a(e){const[,t,n,o]=e;return{...d(),...i.convertFlags(o),id:i.resolveId(t),name:n}}function s(e){return{name:e.name,type:e.type,description:e.description,isHidden:!!e.is_hidden}}function d(e,t){return{unreadCount:0,unreadUnmutedCount:0,peerIds:new Set(e),sublists:new Set(t||[]),all:{peerIds:new Set,boundaryMinorId:1/0,hasMore:!0},unread:{peerIds:new Set,boundaryMinorId:1/0,hasMore:!0}}}},500955:(e,t,n)=>{n.d(t,{fromApiMessage:()=>f,fromApiPinnedMessage:()=>I,fromEngineMessage:()=>v});var o=n(659397),i=n(310110),r=n(361084),a=n(429920),s=n(207739),d=n(803854),c=n(243860),u=n(907557),l=n(883262),p=n(345543),m=n(399137),_=n(368108),h=n(668214);function f(e){if(e.action)return{message:{kind:"Service",action:k({apiAction:e.action,apiAttaches:e.attachments,messageAccessKey:`mail${e.peer_id}-${e.conversation_message_id}`}),peerId:s.resolveId(e.peer_id),cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),sentAt:1e3*e.date,isOut:1===e.out,isSilent:e.is_silent,deleteTTL:void 0!==e.ttl?1e3*e.ttl:void 0},mentions:{hasDirect:!1,hasMass:!1}};const t=s.resolveId(e.peer_id);if(e.is_expired)return{message:{kind:"Expired",cmid:a.resolveCmid(e.conversation_message_id),peerId:s.resolveId(e.peer_id),authorId:s.resolveId(e.from_id),isOut:1===e.out,isSilent:e.is_silent,sentAt:1e3*e.date},mentions:{hasDirect:!1,hasMass:!1}};const n=e.keyboard&&(0,m.fromApiKeyboard)(e.keyboard);if("InputKeyboard"===n?.kind)throw new Error("Кажется из апи пришла не инлайн клавиатура для сообщения");const o=a.resolveCmid(e.conversation_message_id),i=(0,r.fromApiAttach)({apiAttaches:y(e),messageAccessKey:`mail${e.peer_id}-${e.conversation_message_id}`,attachPositionOffset:0}),l=d.count(i);return{message:{kind:"Normal",randomId:a.resolveRandomId(e.random_id),cmid:o,peerId:t,authorId:s.resolveId(e.from_id),chunks:c.fromServerText(e.text),isOut:1===e.out,isSilent:e.is_silent,isImportant:!!e.important,isUnavailable:!!e.is_unavailable,isPlayed:!!e.was_played,sentAt:1e3*e.date,updatedAt:e.update_time&&1e3*e.update_time,attaches:i,keyboard:n,forceAutoPlayMedia:e.force_autoplay_media,replyMessage:e.reply_message?g(e.reply_message,t,o,l):void 0,forwardedMessages:b(e.fwd_messages,t,o,l),expireTTL:e.expire_ttl?1e3*e.expire_ttl:void 0,deleteTTL:void 0!==e.ttl?1e3*e.ttl:void 0,isPinned:Boolean(e.is_pinned),template:e.template?(0,_.fromApiTemplate)(e.template,`mail${e.peer_id}-${e.conversation_message_id}`):void 0,reactions:e.reactions?(0,h.fromApiMessageReactions)(e.reactions):new Map,reactionId:e.reaction_id?u.resolveId(e.reaction_id):void 0},mentions:{hasDirect:e.is_mentioned_user,hasMass:!1}}}function v(e,t,n){let d,u,l,_,h,f,v,g,b,y;switch(e[0]){case 10004:[,y,u,,l,_,h,f,v,g,d]=e;break;case 10005:case 10018:[,y,u,l,_,h,f,v,g,d,b]=e;break;default:(0,p.exhaustivenessCheck)(e)}const I=s.resolveId(l),{isOut:w,isImportant:C,noPush:A,isPlayed:S}=a.convertFlags(u),x=w||s.isFavorites(I,t),P="1"===f.is_silent;let M;if(M=void 0!==f.from?s.resolveId(Number(f.from)):x?t:I,f.source_act)return{message:{kind:"Service",cmid:a.resolveCmid(y),peerId:I,authorId:M,action:k({messageAccessKey:`mail${I}-${a.resolveCmid(y)}`,apiAction:{conversation_message_id:f.source_chat_local_id?Number(f.source_chat_local_id):void 0,message:f.source_message,type:f.source_act,member_id:f.source_mid?Number(f.source_mid):void 0,text:f.source_text,old_text:f.source_old_text,style:f.source_style}}),deleteTTL:void 0!==f.ttl?1e3*Number(f.ttl):void 0,sentAt:1e3*_,isOut:x,isSilent:P},mentions:{hasDirect:!1,hasMass:!1},noPush:A};if("1"===f.is_expired)return{message:{kind:"Expired",cmid:a.resolveCmid(y),isOut:x,isSilent:P,peerId:I,authorId:M,sentAt:1e3*_},mentions:{hasDirect:!1,hasMass:!1},noPush:!0};const F={hasDirect:!1,hasMass:!1};for(const e of f.marked_users||[])if(e[0]===i.IEngine.MarkedType.Mention)switch(e[1]){case"all":F.hasMass=F.hasMass||M!==t;break;case"online":F.hasMass=F.hasMass||e[2].includes(t);break;default:F.hasDirect=e[1].includes(t)}let R,E={};if("sticker"!==v.attach1_type&&"audiomsg"!==v.attach1_kind||!v.attachments)void 0!==v.attach1_type&&(E={unknown:[{data:v,kind:"Unknown"}]});else{const e=JSON.parse(v.attachments);Array.isArray(e)&&(E=(0,r.fromApiAttach)({apiAttaches:e,messageAccessKey:`mail${I}-${y}`}))}if(void 0!==v.reply){const e=JSON.parse(v.reply),t=n(a.resolveCmid(e.conversation_message_id));t&&(R=a.toForeign({message:t,rootPeerId:I,rootCmid:a.resolveCmid(y)}))}const U=f.keyboard?(0,m.fromEngineKeyboard)(f.keyboard,M):void 0;let N,D;return"InlineKeyboard"===U?.kind?N=U:D=U,{message:{kind:"Normal",cmid:a.resolveCmid(y),randomId:a.resolveRandomId(g),peerId:I,authorId:M,chunks:c.fromServerText((0,o.unescape)(h)),isOut:x,isSilent:P,isImportant:C,isPlayed:S,isUnavailable:!1,sentAt:1e3*_,updatedAt:b?1e3*b:void 0,isPinned:Boolean(f.pinned_at),expireTTL:f.expire_ttl?1e3*Number(f.expire_ttl):void 0,deleteTTL:void 0!==f.ttl?1e3*Number(f.ttl):void 0,attaches:E,replyMessage:R,keyboard:N,reactions:new Map},mentions:F,noPush:A,keyboardEvent:D}}function g(e,t,n,o){let i;if(e.peer_id&&(i=s.resolveId(e.peer_id)),e.is_expired)return{kind:"ForeignExpired",peerId:i,rootPeerId:t,rootCmid:n,isUnavailable:!!e.is_unavailable,cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),sentAt:1e3*e.date};const u=(0,r.fromApiAttach)({apiAttaches:y(e),messageAccessKey:e.peer_id?`mail${e.peer_id}-${e.conversation_message_id}`:void 0,attachPositionOffset:o}),l=o+d.count(u);return{kind:"Foreign",peerId:i,rootPeerId:t,rootCmid:n,isUnavailable:!!e.is_unavailable,cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),chunks:c.fromServerText(e.text),sentAt:1e3*e.date,updatedAt:e.update_time&&1e3*e.update_time,attaches:u,replyMessage:e.reply_message?g(e.reply_message,t,n,l):void 0,forwardedMessages:b(e.fwd_messages,t,n,l)}}function b(e,t,n,o){if(!e||0===e.length)return;let i,r=o;for(const o of e){const e=g(o,t,n,r);if("ForeignExpired"!==e.kind&&(r+=a.getMessageAttachmentsCount(e)),"ForeignExpired"!==e.kind)i?i.push(e):i=[e];else if(p.isDev)throw new Error("Исчезающих сообщений не может быть в пересланных.")}return i}function k({apiAction:e,apiAttaches:t,messageAccessKey:n}){const i={type:"unknown"};switch(e.type){case"chat_create":return e.text?{type:e.type,title:e.text}:i;case"chat_title_update":return e.text&&e.old_text?{type:e.type,title:e.text,oldTitle:e.old_text}:i;case"chat_photo_remove":case"chat_screenshot":case"chat_group_call_started":case"chat_invite_user_by_link":case"chat_invite_user_by_call_join_link":case"chat_kick_don":case"call_transcription_failed":return{type:e.type};case"chat_pin_message":case"chat_unpin_message":return{type:e.type,cmid:a.resolveCmid(e.conversation_message_id),chunks:e.message?c.fromServerText((0,o.unescape)(e.message)):[]};case"chat_photo_update":const d=t?.find((e=>"photo"===e.type)),u=d?.photo;let p;return u&&(p=(0,r.fromApiPhoto)({apiPhoto:u,messageAccessKey:n})),{type:e.type,photo:p};case"chat_invite_user":case"chat_kick_user":case"accepted_message_request":{if(!e.member_id)return i;const t=s.resolveId(e.member_id);return s.isUserPeerId(t)||s.isGroupPeerId(t)?{type:e.type,peerId:t}:i}case"chat_invite_user_by_message_request":case"chat_invite_user_by_call":case"chat_kick_user_call_block":{if(!e.member_id)return i;const t=s.resolveId(e.member_id);return s.isUserPeerId(t)?{type:e.type,peerId:t}:i}case"conversation_style_update":case"conversation_style_update_action":return{type:e.type,styleId:e.style?l.resolveStyleId(e.style):void 0};case"custom":return e.message?{type:e.type,chunks:c.fromServerText((0,o.unescape)(e.message))}:i;default:e.type;return i}}function y({attachments:e=[],geo:t}){return t?[...e,{type:"geo",geo:t}]:e}function I(e){const t=s.resolveId(e.peer_id),n=a.resolveCmid(e.conversation_message_id);return{kind:"Pinned",cmid:n,peerId:t,authorId:s.resolveId(e.from_id),isUnavailable:!!e.is_unavailable,chunks:c.fromServerText(e.text),sentAt:1e3*e.date,forwardedMessages:e.fwd_messages?b(e.fwd_messages,t,n,0):void 0,replyMessage:e.reply_message?g(e.reply_message,t,n,0):void 0,attaches:(0,r.fromApiAttach)({apiAttaches:y(e)||[]})}}},668214:(e,t,n)=>{n.d(t,{fromApiMessageReactions:()=>r});var o=n(907557),i=n(207739);function r(e){return e.sort(((e,t)=>t.count-e.count)).reduce(((e,t)=>(e.set(o.resolveId(t.reaction_id),{reactionId:o.resolveId(t.reaction_id),count:t.count,peerIds:new Set(t.user_ids.map(i.resolveId).sort(((e,t)=>e-t)))}),e)),new Map)}},122519:(e,t,n)=>{n.d(t,{convertPlatform:()=>u,fromApiAnonym:()=>c,fromApiContact:()=>d,fromApiGroup:()=>s,fromApiUser:()=>a});var o=n(207739);const i=[6482950,6481715,6146827],r={1:"mobile",2:"mobile",3:"mobile",4:"mobile",5:"mobile",6:"other",7:"other"};function a(e){const t={0:"unfamiliar",1:"outgoingRequest",2:"incomingRequest",3:"friends"};let n="other";e.online_info?.is_mobile&&(n="mobile"),i.includes(e.online_info?.app_id||0)&&(n="vkme");const r={isOnline:!!e.online_info?.is_online,at:e.online_info?.status?e.online_info?.status:e.online_info?.last_seen?1e3*e.online_info.last_seen:"not_show",platform:n},a=o.resolveRealId("User",e.id),s=Boolean(e.blacklisted),[,d]=e.photo_id?e.photo_id.split("_"):[],c=d?parseInt(d):null;return{user:{kind:"User",id:a,firstName:e.first_name,firstNameGen:e.first_name_gen||e.first_name,firstNameAcc:e.first_name_acc||e.first_name,lastName:e.last_name,lastNameGen:e.last_name_gen||e.last_name,lastNameAcc:e.last_name_acc||e.last_name,screenName:e.screen_name,sex:void 0!==e.sex?{0:"unknown",1:"female",2:"male"}[e.sex]:"unknown",photoId:c&&!isNaN(c)?c:void 0,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,isVerified:Boolean(e.verified),isBlacklisted:s,isBlacklistedByMe:Boolean(e.blacklisted_by_me),isProfileClosed:Boolean(e.is_closed)&&!e.can_access_closed,isDeactivated:Boolean(e.deactivated),deactivationReason:e.deactivated,canCall:Boolean(e.can_call),canChangeFriendship:1===e.can_send_friend_request,canInviteToChats:!!e.can_invite_to_chats,canMessage:1===e.can_write_private_message,hasDefaultPhoto:1!==e.has_photo,followersCount:e.followers_count||0,friendship:void 0!==e.friend_status?t[e.friend_status]:t[0],mutualFriends:s?{hint:[],count:0}:void 0,contactName:e.contact_name,occupation:e.occupation,bdate:e.bdate,city:e.city,phone:e.mobile_phone,employeeMark:e.employee_mark,employeeWorkingState:e.employee_working_state&&{state:e.employee_working_state.state,ts_to:1e3*e.employee_working_state.ts_to,ts_from:1e3*e.employee_working_state.ts_from},isService:e.is_service_account||e.is_service,imageStatus:e.image_status?(u=e.image_status,{name:u.name,images:u.images.map((e=>({url:e.url,width:e.width,height:e.height})))}):void 0},lastSeen:r};var u}function s(e){const t=o.resolveRealId("Group",e.id);if(!e.type)throw new Error(`fromApiGroup содержит некорректный тип ${e.type}`);const n={0:"notMember",1:"member",2:"unsure",3:"declined",4:"outgoingRequest",5:"incomingRequest"}[e.member_status||0];return{kind:"Group",id:t,type:e.type,name:e.name,screenName:e.screen_name,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,activity:e.activity,memberCount:e.members_count||0,membership:n,isDeactivated:Boolean(e.deactivated),isVerified:1===e.verified,isClosed:Boolean(e.is_closed),canMessage:1===e.can_message,canChangeMembership:0!==e.ban_info?.end_date&&(0===e.is_closed||"member"===n||"incomingRequest"===n),mutualFriends:2===e.is_closed&&"member"!==n?{hint:[],count:0}:void 0,isBlacklistedByMe:1===e.is_messages_blocked,site:e.site,adminLevel:e.admin_level||0}}function d(e){const t=o.resolveRealId("Contact",e.id),n=o.resolveId(e.user_id);return{kind:"Contact",id:t,name:e.name,userId:n,phone:e.phone,canWrite:e.can_write,photo50:e.photo_50,lastSeen:e.last_seen_status}}function c(e){const t=o.resolveAnyId(e.id);if(o.isAnonymPeerId(t))return{id:t,kind:"Anonym",name:e.name,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,photo400:e.photo_400}}function u(e,t){let n=r[e]||"other";return i.includes(t)&&(n="vkme"),n}},885540:(e,t,n)=>{n.d(t,{fromApiDonutDuration:()=>m,fromApiPost:()=>p,fromApiSearchPost:()=>h});var o=n(377836),i=n(243860),r=n(207739),a=n(548007),s=n(907557),d=n(769126),c=n(361084),u=n(552685);const l={id:"reactions",items:[{id:0,title:"Нравится",asset:{animation_url:"https://vk.com/reaction/3-reactions-0?c_uniq_tag=83b2081a8e4adfc36ee536f5f1b4ad470174c89678369a4b9dc5547614a3955e",images:[{url:"https://vk.com/reaction/1-reactions-0-48?c_uniq_tag=e6bee176471af6e4f7ca0f57ac099847d57b8101bf07944e47b42b097a6d8455",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-0-72?c_uniq_tag=d6f55fe94c0add8f817b447cbd804768752eb996c06ef222b39eb3fd35834780",width:72,height:72}],title:{color:{foreground:{light:"FF3347",dark:"FF5C5C"},background:{light:"FFEDED",dark:"3E2526"}}},title_color:{light:"FF3347",dark:"FF5C5C"}}},{id:1,title:"Смешно",asset:{animation_url:"https://vk.com/reaction/3-reactions-1?c_uniq_tag=a47193579880c0f53dd597a15d3bd57d4827820687c73d6128df2720647b42b9",images:[{url:"https://vk.com/reaction/1-reactions-1-48?c_uniq_tag=8f5eb3a1d6a6ec81aceff211782af3c9e9a5d1c837f0bfade6965a6844786f8b",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-1-72?c_uniq_tag=c852fcad6e67059878dcf1905e3e416fd89fbc61222ead100935a6fcc1dab4c9",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:2,title:"Ого!",asset:{animation_url:"https://vk.com/reaction/3-reactions-2?c_uniq_tag=b946fcbe262642bc920331746b6eccd9f175bb17d8ef37e54d232fa35ca2c750",images:[{url:"https://vk.com/reaction/1-reactions-2-48?c_uniq_tag=2a6544dce8827d216db7ea91eafc726cd3a823f5d465ba00216901a6de2801ad",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-2-72?c_uniq_tag=5a0663f3d38dd6fbcf3e4973610d50641420631c9df30b6cf80eee0dd5c5efee",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:3,title:"Восторг",asset:{animation_url:"https://vk.com/reaction/3-reactions-3?c_uniq_tag=c6ed3add99e841dccda5479c8e21779954e61e0fba15f94a2ae16706df492123",images:[{url:"https://vk.com/reaction/1-reactions-3-48?c_uniq_tag=eda1a2c18d733b356babdeed5f52cdcc64dd59f1f69776a133fc34a5627eecee",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-3-72?c_uniq_tag=be09c5080773a9ba78984406588c7371e48073e80b842eb7c9a817f7b435379b",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:5,title:"Печаль",asset:{animation_url:"https://vk.com/reaction/3-reactions-5?c_uniq_tag=c61122c8c334154cb10ccf0e0687057bf1f0f40c2817198b2e1150df534c22c4",images:[{url:"https://vk.com/reaction/1-reactions-5-48?c_uniq_tag=31bcb230babad96120a62589c52af22811aaba54d4ed73a36cfd499d9d94102f",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-5-72?c_uniq_tag=a840d0eb581c133d97638ff5bf34f4b33f3fb8557b932cfe3516925b88e2f151",width:72,height:72}],title:{color:{foreground:{light:"4986CC",dark:"71AAEB"},background:{light:"EDF3FA",dark:"27303C"}}},title_color:{light:"4986CC",dark:"71AAEB"}}},{id:4,title:"&$#%!",asset:{animation_url:"https://vk.com/reaction/3-reactions-4?c_uniq_tag=063e6b2dd888bb5a9716cf6153f03bf9c0c9707713b857eed8fe1e4e09aea2b3",images:[{url:"https://vk.com/reaction/1-reactions-4-48?c_uniq_tag=c80e3224c299a73384c057ff065c9458dcd533d57a1458875eb98883c3a96783",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-4-72?c_uniq_tag=a0eddba1ec31f96adbb9afa2c6c14bec055b95f8d9f113bdf759fb5a9c9054f0",width:72,height:72}],title:{color:{foreground:{light:"EF5203",dark:"FA5300"},background:{light:"FDEBE8",dark:"3C2421"}}},title_color:{light:"EF5203",dark:"FA5300"}}}]};function p(e){const t={...e?.attachments?.[0]?.wall,attachments:_(e),inner_type:"wall_wallpost"},n=t?.copy_history?.[0];let p={};if(n&&0!==n.from_id){const e=(0,c.apiAttachWallOwnerId)(n),o="reply"===n.post_type;let a="all";1===n.friends_only&&(a="friends"),1===n.best_friends_only&&(a="best_friends"),p={...p,...o?{wallReply:{kind:"WallReply",id:n.id||0,postId:n.reply_post_id||0,authorId:r.resolveId(n.from_id),ownerId:r.resolveId(e),parentsStack:n.parents_stack,date:1e3*(n.date||0),chunks:i.fromServerText(n.text||""),attaches:(0,c.fromApiWallAttach)(n)}}:{wall:{kind:"Wall",isAds:"post_ads"===n.post_type,id:n.id||0,authorId:r.resolveId(n.from_id),ownerId:r.resolveId(e),date:1e3*(n.date||0),chunks:i.fromServerText(n.text||""),attaches:(0,c.fromApiWallAttach)(n),isDeleted:n.is_deleted||!1,isVisibleFor:a}}},t.copy_history=void 0}t?.attachments&&(p={...p,...(0,c.fromApiWallAttach)(t)});const h=[],f=[];return l.items.forEach((e=>{const t=(0,u.fromApiReaction)(e);t&&(h.push(t),f.push(t.id))})),{post:{topicId:t.topic_id,kind:"Normal",cmid:o.resolveCmid(e.cmid),chunks:t?.text?i.fromServerText(t.text):[],views:t?.views?.count||0,sentAt:1e3*e.time,updatedAt:e.update_time&&1e3*e.update_time,channelId:a.resolveId(e.author_id),likes:{count:t?.likes?.count||0,reactionId:Boolean(t?.likes?.user_likes)?d.resolveId(t?.reactions?.user_reaction):void 0,availableReactionIds:f,peerIds:new Set},reposts:{count:t?.reposts?.count||0,isReposted:Boolean(t?.reposts?.user_reposted)},comments:{count:t?.comments?.count||0,oneLevelCount:0,canView:Boolean(t?.comments?.can_view),canPost:Boolean(t?.comments?.can_post),history:[],order:"interesting"},attaches:p,donut:{isDonut:t.donut?.is_donut,placeholder:t.donut?.placeholder?{text:t.donut.placeholder?.text,button:t.donut.placeholder?.button}:void 0,duration:m(t.donut?.paid_duration)},signerId:t.signer_id?r.resolveId(t.signer_id):void 0,reactionId:Boolean(t?.likes?.user_likes)?s.resolveId(t?.reactions?.user_reaction):void 0,reactions:t.reactions?(v=t.reactions.items,v.sort(((e,t)=>t.count-e.count)).reduce(((e,t)=>(e.set(s.resolveId(t.id),{reactionId:s.resolveId(t.id),count:t.count}),e)),new Map)):new Map,ads:{markedAsAds:Boolean(t.marked_as_ads),erid:t.author_ad?.ad_marker,eridUrl:t.author_ad?.advertiser_info_url},canEdit:Boolean(t.can_edit)},reactions:h};var v}function m(e){return-1===e||void 0===e?-1:e/60/60/24}function _(e){const t=e?.attachments?.[0]?.wall,n=t?.geo,o=t?.attachments||[];return n?[...o,{type:"geo",geo:n}]:o}function h(e){if("ads"===e.type||"donut_wall_donate_block"===e.type)return;if(!function(e){return void 0===e.title}(e))return;const t=e.copy_history?.[0];let n={};if(t){const o=(0,c.apiAttachWallOwnerId)(t),a="reply"===t.post_type;let s="all";1===t.friends_only&&(s="friends"),1===t.best_friends_only&&(s="best_friends"),n={...n,...a?{wallReply:{kind:"WallReply",id:t.id||0,postId:t.reply_post_id||0,authorId:r.resolveId(t.from_id),ownerId:r.resolveId(o),parentsStack:t.parents_stack,date:1e3*(t.date||0),chunks:i.fromServerText(t.text||""),attaches:(0,c.fromApiWallAttach)(t)}}:{wall:{kind:"Wall",isAds:"post_ads"===t.post_type,id:t.id||0,authorId:r.resolveId(t.from_id),ownerId:r.resolveId(o),date:1e3*(t.date||0),chunks:i.fromServerText(t.text||""),attaches:(0,c.fromApiWallAttach)(t),isDeleted:t.is_deleted||!1,isVisibleFor:s,views:t.views?.count,donut:{isDonut:t.donut?.is_donut,placeholder:t.donut?.placeholder?{text:t.donut.placeholder?.text,button:t.donut.placeholder?.button}:void 0,duration:m(t.donut?.paid_duration)}}}},e.copy_history=void 0}return e?.attachments&&(n={...n,...(0,c.fromApiWallAttach)(e)}),{kind:"Normal",topicId:e.topic_id,cmid:o.resolveCmid(e.id||0),chunks:e?.text?i.fromServerText(e.text):[],views:e?.views?.count||0,sentAt:1e3*(e.date||0),updatedAt:e.edited&&1e3*e.edited,channelId:a.resolveId(e.owner_id||0),likes:{count:e?.likes?.count||0,reactionId:void 0,availableReactionIds:[],peerIds:new Set},reactions:new Map,reposts:{count:e?.reposts?.count||0,isReposted:Boolean(e?.reposts?.user_reposted)},comments:{count:e?.comments?.count||0,oneLevelCount:0,canView:Boolean(e?.comments?.can_view),canPost:Boolean(e?.comments?.can_post),history:[],order:"old"},attaches:n,donut:{isDonut:e.donut?.is_donut,placeholder:e.donut?.placeholder?{text:e.donut.placeholder?.text,button:e.donut.placeholder?.button}:void 0,duration:m(e.donut?.paid_duration)},signerId:e.signer_id?r.resolveId(e.signer_id):void 0,ads:{markedAsAds:Boolean(e.marked_as_ads),erid:e.author_ad?.ad_marker,eridUrl:e.author_ad?.advertiser_info_url},canEdit:Boolean(e.can_edit)}}},552685:(e,t,n)=>{n.d(t,{fromApiReaction:()=>i});var o=n(769126);function i(e){if(!e.asset.animation_url||!e.asset.title_color?.dark||!e.asset.title_color?.light)return;const t=e.asset.images.find((e=>48===e.height))?.url,n=e.asset.images.find((e=>72===e.height))?.url;return t&&n?{id:o.resolveId(e.id),animation:e.asset.animation_url,title:e.title,image48:t,image72:n,color:{light:e.asset.title_color?.light,dark:e.asset.title_color?.dark}}:void 0}},159300:(e,t,n)=>{n.d(t,{fromApiSticker:()=>i,fromApiStickersKeywords:()=>r,fromApiUgcSticker:()=>a,fromContextSticker:()=>s});var o=n(71330);function i(e){return{id:o.resolveStickerId(e.sticker_id),kind:"Sticker",item:e}}function r(e){return e.reduce(((e,t)=>{const n=(t.stickers||[]).map((e=>i({...e,inner_type:"base_sticker_new"}).id));for(const o of t.words)e.set(o,n);return e}),new Map)}const a=e=>({kind:"UgcSticker",id:e.id,item:e}),s=e=>e.isUGC?{id:e.id,kind:"UgcSticker",item:e.rawData}:{id:e.id,kind:"Sticker",item:e.rawData}},310110:(e,t,n)=>{var o;n.d(t,{IEngine:()=>o}),function(e){let t,n,o;!function(e){e[e.Mention=1]="Mention",e[e.ExpiringMessage=2]="ExpiringMessage"}(t=e.MarkedType||(e.MarkedType={})),function(e){e[e.CopyFlagChanged=0]="CopyFlagChanged",e[e.TitleChanged=1]="TitleChanged",e[e.AvatarChanged=2]="AvatarChanged",e[e.AdminGrated=3]="AdminGrated",e[e.FlagsChanged=4]="FlagsChanged",e[e.Pinned=5]="Pinned",e[e.UserJoined=6]="UserJoined",e[e.UserLeft=7]="UserLeft",e[e.UserKicked=8]="UserKicked",e[e.AdminKicked=9]="AdminKicked",e[e.BannerChanged=10]="BannerChanged",e[e.KeyboardChanged=11]="KeyboardChanged",e[e.MessageRequestChanged=12]="MessageRequestChanged",e[e.ContactConverted=13]="ContactConverted",e[e.BusinessNotifyDataChanged=14]="BusinessNotifyDataChanged",e[e.MessageRequestCanceled=15]="MessageRequestCanceled",e[e.MessageRequestRejected=16]="MessageRequestRejected",e[e.MessageRequestAccepted=17]="MessageRequestAccepted",e[e.ContactJoined=18]="ContactJoined",e[e.CallInProgressChanged=19]="CallInProgressChanged",e[e.DonSubscribed=20]="DonSubscribed",e[e.DonUnsubscribed=21]="DonUnsubscribed",e[e.IsNewChange=22]="IsNewChange",e[e.StyleChanged=23]="StyleChanged",e[e.DescriptionChanged=24]="DescriptionChanged",e[e.ShortPollReactionsChanged=25]="ShortPollReactionsChanged",e[e.IncognitoJoined=26]="IncognitoJoined",e[e.ConvertIncognito=27]="ConvertIncognito",e[e.IncognitoLeft=28]="IncognitoLeft"}(n=e.ChatUpdateType||(e.ChatUpdateType={})),function(e){e[e.Deleted=0]="Deleted",e[e.Accepted=1]="Accepted",e[e.Rejected=2]="Rejected",e[e.New=3]="New"}(o=e.MRStatus||(e.MRStatus={})),e.isIncompleteUpdate=function(e){switch(e[0]){case 10004:{const t=12;return e.length<t}case 10005:{const t=11;return e.length<t}case 10018:{const t=11;return e.length<t}default:return!1}}}(o||(o={}))},795947:(e,t,n)=>{n.d(t,{TypingVariants:()=>f,addConvosToFolder:()=>P,getConvosByIds:()=>M,getOwnerGroupId:()=>S,insertChannels:()=>C,insertChatMembers:()=>F,insertContactItems:()=>b,insertContacts:()=>k,insertConvos:()=>v,insertFolders:()=>y,insertIncognitoMembers:()=>A,insertPeers:()=>g,insertRecommendedFolders:()=>w,insertSublists:()=>I,removeConvosFromFolder:()=>x});var o=n(250122),i=n(503048),r=n(207739),a=n(460167),s=n(548007),d=n(330310),c=n(886330),u=n(467635),l=n(122519),p=n(234950),m=n(482244),_=n(885540),h=n(483705);const f=["text","voice","photo","video","file","videomessage"];function v(e,t,n,{dangerouslyMerge:s,shouldUpdateSortId:d,invalidateHistory:c}={}){const l=[];for(const a of t){const t="conversation"in a?(0,u.fromApiConvo)(a.conversation,a.last_message):(0,u.fromApiConvo)(a);if(!t)continue;const{convo:p,peer:m}=t,_=e.convos.get(p.peerId);if(_&&!s){l.push(_);continue}if(!_){const t="conversation"in a?r.resolveId(a.conversation.peer.id):r.resolveId(a.peer.id);(e.convosFailedMessages[t]||[]).forEach((e=>i.appendQueuedMessage(p,e)))}const h=p.majorSortId,f=i.merge(p,_,{invalidateHistory:c});d&&i.updateSortId(f,{majorSortId:h}),e.convos.set(p.peerId,f),m&&e.peers.set(m.id,m),o.refresh(e.organisers,f,n),l.push(p),"ChatConvo"===f.kind&&e.hiddenPinnedMessages.get(f.peerId)!==f.pinnedMessage?.cmid&&e.hiddenPinnedMessages.delete(f.peerId)}const p=l.filter((e=>!i.isMR(e)&&!i.isBusinessNotify(e)));return a.add(e.convosSearchIndex,p,(t=>{const n=e.peers.get(t.peerId);return{id:t.peerId,strings:n?a.peerWords(n):[]}})),l}function g(e,{apiUsers:t,apiGroups:n,apiContacts:o},{dangerouslyOverwrite:i}={}){const r=[];for(const n of t){const{user:t,lastSeen:o}=(0,l.fromApiUser)(n);e.lastSeens.set(t.id,o);const a=e.peers.get(t.id);"User"!==a?.kind||i?(e.peers.set(t.id,t),r.push(t)):r.push(a)}const a=[];for(const t of n){const n=(0,l.fromApiGroup)(t),o=e.peers.get(n.id);!o||"Group"!==o.kind||i?(e.peers.set(n.id,n),a.push(n)):a.push(o)}const s=[];for(const t of o){const n=(0,l.fromApiContact)(t),o=e.peers.get(n.id);!o||"Contact"!==o.kind||i?(e.peers.set(n.id,n),s.push(n)):s.push(o)}return{insertedUsers:r,insertedGroups:a,insertedContacts:s}}function b(e,t,n){const o=[];return g(e,{apiUsers:n,apiGroups:[],apiContacts:[]},{dangerouslyOverwrite:!0}),t.forEach((t=>{const n=r.resolveId(t);if(r.isUserPeerId(n)){const t=e.peers.get(n);if("User"!==t?.kind)return;e.contacts.items.set(n,t),o.push(n)}})),o}function k(e,t){const n=[];t.sort(((e,t)=>e.name.localeCompare(t.name)));for(const o of t){const t=(0,l.fromApiContact)(o),i=t.userId?t.userId:t.id;e.contacts.contacts.set(i,t),n.push(t)}return n}function y(e,t,{dangerouslyOverwrite:n}={}){if(n)return e.organisers.folders=t,t;const o=[];for(const n of t){e.organisers.folders.find((e=>e.id===n.id))?o.push(n):(e.organisers.folders.push(n),o.push(n))}return o}function I(e,t){const n=[];if(!t||0===t.length)return n;for(const o of t){e.organisers.sublists.find((e=>e.type===o.type))?n.push(o):(e.organisers.sublists.push(o),n.push(o))}return n}function w(e,t){const n=[];for(const o of t){const t=(0,p.fromApiFolderRecommended)(o);e.organisers.recommendedFolders.find((e=>e.type===t.type))?n.push(t):(e.organisers.recommendedFolders.push(t),n.push(t))}return n}function C(e,{apiChannels:t,apiGroups:n,dangerouslyMerge:o}){const i=[];for(const r of t){const t=n.find((e=>-e.id===r.channel.channel_id));if(!t)throw new Error("С бэка не приходит нужная группа для канала");const a=(0,m.fromApiChannel)(r,t);(r.last_message&&(0,_.fromApiPost)(r.last_message).reactions||[]).forEach((t=>{e.reactionsOld.set(t.id,t)}));let d=e.channels.get(a.id);if("ChannelRestricted"===d?.kind&&(d=void 0),d&&!o){i.push(d);continue}const c=d?s.merge(d,a):a;e.channels.set(c.id,c),i.push(c)}return i}function A(e,t){for(const n of t){const t=(0,h.fromApiIncognitoMember)(n);if(!t)continue;const o=r.resolveId(n.peer_id),i=e.convos.get(o);"ChatConvo"===i?.kind&&c.addIncognitoMembers(i.members,[t])}}function S(e){return r.isGroupPeerId(e)?r.toRealId(e):0}function x(e,t,n,o){const r=e.organisers.folders.find((e=>e.id===t));if(!r)return;let a=r.unreadCount??0,s=r.unreadUnmutedCount??0;for(const c of n)o.vkm_new_convo_folder_logic?r.peerIds.has(c.peerId)&&(r.peerIds.delete(c.peerId),c.unreadCount&&(i.isMuted(c)?a--:s--)):i.isInFolder(c,t)&&(i.removeFolder(c,t),d.refresh(e.organisers.folders,c),c.unreadCount&&(i.isMuted(c)?a--:s--));d.setUnreadCounters(e.organisers.folders,t,a,s)}function P(e,t,n,o){const r=[],a=e.organisers.folders.find((e=>e.id===t));if(!a)return;let s=a.unreadCount??0,c=a.unreadUnmutedCount??0;for(const e of n)o.vkm_new_convo_folder_logic?a.peerIds.has(e.peerId)||(a.peerIds.add(e.peerId),e.unreadCount&&(i.isMuted(e)?s++:c++)):i.isInFolder(e,t)||(i.addFolder(e,t),r.push(e),e.unreadCount&&(i.isMuted(e)?s++:c++));o.vkm_new_convo_folder_logic||(d.push(e.organisers.folders,t,"all",r,a.all.hasMore,o),d.push(e.organisers.folders,t,"unread",r.filter((e=>i.isUnread(e))),a.unread.hasMore,o)),d.setUnreadCounters(e.organisers.folders,t,s,c)}function M(e,t){return t.reduce(((t,n)=>{const o=e.convos.get(r.resolveId(n));return o&&t.push(o),t}),[])}function F(e,t){const n=(t.incognito_members||[]).reduce(((e,{id:t,name:n=""})=>e.set(t,{name:n})),new Map);for(const o of t.items){if(o.incognito_id&&0===o.member_id){const t=n.get(o.incognito_id);if(!t)continue;const i=r.resolveId(o.invited_by),a=c.resolveIncognitoMemberId(o.incognito_id),s={...t,id:a,inviterId:i,...o.join_date&&{inviteDate:1e3*o.join_date}};if(0!==o.member_id){const e=r.resolveId(o.member_id);(r.isUserPeerId(e)||r.isContactPeerId(e))&&(s.memberId=e)}e.incognitoMembers?.set(a,s);continue}const t=r.resolveId(o.member_id);if(!r.isUserPeerId(t)&&!r.isGroupPeerId(t)&&!r.isContactPeerId(t))continue;const i={canKick:Boolean(o.can_kick),isMessageRequest:Boolean(o.is_message_request),isRestrictedToWrite:Boolean(o.is_restricted_to_write),peerId:t};o.is_message_request&&o.request_date&&(i.requestDate=1e3*o.request_date),o.join_date&&(i.joinDate=1e3*o.join_date),e.members.set(t,i),e.memberIds.add(t),i.isMessageRequest&&e.invitedIds?.add(t),r.isContactPeerId(t)||o.is_admin&&e.adminIds.add(t)}}},204841:(e,t,n)=>{function o(e){let t=function(e){let{PI:t,min:n,max:o,cos:i,round:r}=Math,a=e[0]|e[1]<<8|e[2]<<16,s=e[3]|e[4]<<8,d=(63&a)/63,c=(a>>6&63)/31.5-1,u=(a>>12&63)/31.5-1,l=(a>>18&31)/31,p=a>>23,m=(s>>3&63)/63,_=(s>>9&63)/63,h=s>>15,f=o(3,h?p?5:7:7&s),v=o(3,h?7&s:p?5:7),g=p?(15&e[5])/15:1,b=(e[5]>>4)/15,k=p?6:5,y=0,I=(t,n,o)=>{let i=[];for(let r=0;r<n;r++)for(let a=r?0:1;a*n<t*(n-r);a++)i.push(((e[k+(y>>1)]>>((1&y++)<<2)&15)/7.5-1)*o);return i},w=I(f,v,l),C=I(3,3,1.25*m),A=I(3,3,1.25*_),S=p&&I(5,5,b),x=function(e){let t=e[3],n=128&e[2],o=128&e[4];return(o?n?5:7:7&t)/(o?7&t:n?5:7)}(e),P=r(x>1?32:32*x),M=r(x>1?32/x:32),F=new Uint8Array(P*M*4),R=[],E=[];for(let e=0,r=0;e<M;e++)for(let a=0;a<P;a++,r+=4){let s=d,l=c,m=u,_=g;for(let e=0,n=o(f,p?5:3);e<n;e++)R[e]=i(t/P*(a+.5)*e);for(let n=0,r=o(v,p?5:3);n<r;n++)E[n]=i(t/M*(e+.5)*n);for(let e=0,t=0;e<v;e++)for(let n=e?0:1,o=2*E[e];n*v<f*(v-e);n++,t++)s+=w[t]*R[n]*o;for(let e=0,t=0;e<3;e++)for(let n=e?0:1,o=2*E[e];n<3-e;n++,t++){let e=R[n]*o;l+=C[t]*e,m+=A[t]*e}if(p)for(let e=0,t=0;e<5;e++)for(let n=e?0:1,o=2*E[e];n<5-e;n++,t++)_+=S[t]*R[n]*o;let h=s-2/3*l,b=(3*s-h+m)/2,k=b-m;F[r]=o(0,255*n(1,b)),F[r+1]=o(0,255*n(1,k)),F[r+2]=o(0,255*n(1,h)),F[r+3]=o(0,255*n(1,_))}return{w:P,h:M,rgba:F}}(e);return function(e,t,n){let o=4*e+1,i=6+t*(5+o),r=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,255&e,0,0,t>>8,255&t,8,6,0,0,0,0,0,0,0,i>>>24,i>>16&255,i>>8&255,255&i,73,68,65,84,120,1],a=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],s=1,d=0;for(let e=0,i=0,a=o-1;e<t;e++,a+=o-1)for(r.push(e+1<t?0:1,255&o,o>>8,255&~o,o>>8^255,0),d=(d+s)%65521;i<a;i++){let e=255&n[i];r.push(e),s=(s+e)%65521,d=(d+s)%65521}r.push(d>>8,255&d,s>>8,255&s,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[e,t]of[[12,29],[37,41+i]]){let n=-1;for(let o=e;o<t;o++)n^=r[o],n=n>>>4^a[15&n],n=n>>>4^a[15&n];n=~n,r[t++]=n>>>24,r[t++]=n>>16&255,r[t++]=n>>8&255,r[t++]=255&n}return"data:image/png;base64,"+btoa(String.fromCharCode(...r))}(t.w,t.h,t.rgba)}n.d(t,{thumbHashToDataURL:()=>o})}}]);try{stManager.done("dist/web/chunks/85843858.f8b29b94.js")}catch(e){}