(()=>{"use strict";var e,t,s,a,r,n,i={7514:(e,t,s)=>{s.d(t,{createApi:()=>l,getApiWrapper:()=>o,setApiWrappers:()=>i});var a=s(464380);let r=null,n=null;const i=(e,t)=>{r=e,n=t},o=(e=!0)=>e?r:n;function l(e,t=!0){return(s,r,n)=>((0,a.debugMessage)(a.DebugMessageType.DEBUG,{type:"request",method:e}),o(t)()(e,s,n,r).then((t=>((0,a.debugMessage)(a.DebugMessageType.DEBUG,{type:"response",method:e,data:t}),t))))}},423060:(e,t,s)=>{s.d(t,{get:()=>r});var a=s(659397);const r=(e,t)=>{if(!(0,a.isString)(e)&&!(0,a.isArray)(e))return;const s=(0,a.isArray)(e)?e:e.split(".").filter(Boolean),r=s.length-1;let n=t;for(let e=0;e<s.length;e+=1){if(!(0,a.isObjectLike)(n))return;const t=n[s[e]];if(!t)return;if(e===r)return t;n=t}}},412994:(e,t,s)=>{s.d(t,{baseUserFields:()=>u,callsCheckParticipantName:()=>Ae,callsDeleteParticipantName:()=>ke,callsEditParticipantName:()=>Ce,callsGetGroupHistory:()=>z,callsGetHistory:()=>Q,callsGetJoinHistory:()=>be,callsGetParticipants:()=>ye,callsGetReactions:()=>me,callsGetUserSettings:()=>we,callsSetUserSettings:()=>ve,callsStart:()=>ae,deleteAsrTranscriptions:()=>Se,executeGetCallsSettings:()=>Ee,fetchCallsAnonymQueue:()=>Me,fetchCallsQueue:()=>F,fetchUrl:()=>H,forceCallFinish:()=>A,friendsSearch:()=>ee,getAnonymCallToken:()=>M,getAsrTranscriptions:()=>Pe,getCallAuthToken:()=>v,getCallParticipants:()=>P,getCallParticipantsApiCall:()=>R,getCallTranslationLink:()=>Be,getCallUrlLink:()=>C,getCallsHistory:()=>V,getContactCallToken:()=>T,getConversationByCall:()=>Ue,getConversationMembers:()=>y,getCurrentCalls:()=>$,getFriends:()=>Z,getGroupById:()=>I,getGroupMembers:()=>L,getGroupsForCall:()=>q,getGroupsForStreaming:()=>N,getHelpHints:()=>De,getInboundCall:()=>je,getSearchVideo:()=>de,getSettings:()=>Ie,getUpcomingLives:()=>E,getVideos:()=>U,getWatchTogetherOwnerVideos:()=>ce,getWatchTogetherRecommended:()=>le,hideHelpHint:()=>Ge,loadCallPeers:()=>h,loadCallPeersByPeerIds:()=>p,loadPrivacySettings:()=>B,loadUsers:()=>D,makeCallsAnonymQueueUrl:()=>Te,makeCallsQueueUrl:()=>W,messagesDeleteScheduledCall:()=>ie,messagesEditCall:()=>oe,messagesGetCallPreview:()=>k,messagesGetConversations:()=>te,messagesGetScheduledCalls:()=>ne,messagesSearch:()=>re,messagesSend:()=>se,photosDelete:()=>X,photosGetAllImages:()=>J,photosSaveBackgroundPhoto:()=>Y,queueSubscribe:()=>x,retryLoadCallPeers:()=>b,searchCallParticipants:()=>fe,searchChatMembers:()=>w,searchUsers:()=>O,sendVideoEdit:()=>j,userFields:()=>d,videoDelete:()=>_e,videoEditStreaming:()=>he,videoGet:()=>ue,videoGetThumbsUploadServer:()=>ge,videoLiveHeartbeat:()=>G,videoStartStreaming:()=>pe,voiceRoomsGetParticipants:()=>S});var a=s(304939),r=s(988410),n=s(7514),i=s(464380),o=s(423060),l=s(623030),c=s(337370);const d=["photo_100","photo_200","sex","screen_name","first_name_gen","is_nft","animated_avatar","custom_names_for_calls"].join(","),u=d,g=["name","photo_100","photo_200","can_upload_video","custom_names_for_calls"].join(","),p=e=>(0,n.createApi)("messages.getConversationsById")({peer_ids:e.join(","),extended:1,fields:u}),h=e=>(0,n.createApi)("messages.getConversationsById")({peer_ids:e,extended:1,fields:u});let _=0,f=[],m=[];const b=(0,r.exponentialRetry)(((e,t=50)=>(f.push(e),new Promise((e=>{m.push(e),_||(_=window.setTimeout((()=>{p(f).then((e=>{m.forEach((t=>{t(e)})),m=[]})).catch(l.handlePromiseError),f=[],_=0}),t))}))))),y=(e,t,s=0)=>{const a={peer_id:e,fields:d.concat(",can_call"),extended:1};return t&&(a.count=t,a.offset=s),(0,n.createApi)("messages.getConversationMembers")(a)},w=(e,t,s=10)=>(0,n.createApi)("messages.searchConversationMembers")({peer_id:e,q:t,count:s,fields:d.concat(",can_call"),extended:1}),v=(e,t=0)=>{(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"messages.getCallToken",data:{isDev:e,groupId:t}});const s={env:e?"development":"production"};return 0!==t&&(s.group_id=t),(0,n.createApi)("messages.getCallToken")(s,{},{version:a.API_VERSION}).then((e=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"messages.getCallToken",data:e}),e)))},C=(e,t,s=0)=>{const a={call_id:e,invalidate:t?1:0};return 0!==s&&(a.group_id=s),(0,n.createApi)("messages.getJoinLink")(a)},k=(e,t=!1,s={})=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"messages.getCallPreview",data:{link:e,fields:u,device_id:"anyId"}}),(0,n.getApiWrapper)(!t)()("messages.getCallPreview",{link:e,fields:u,device_id:"anyId",extended:1},s).then((e=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"messages.getCallPreview",data:e}),e)))),A=e=>(0,n.createApi)("messages.forceCallFinish")({call_id:e}),M=(e,t,s,a,r)=>{const o={link:e,user_id:t,name:s,secret:a,device_id:"anyId"};return(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"messages.getAnonymCallToken",data:o}),(0,n.getApiWrapper)(!1)()("messages.getAnonymCallToken",o,r).then((e=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"messages.getAnonymCallToken",data:e}),e)))},T=(e,t)=>(0,n.createApi)("messages.getContactCallToken",!1)({contact:e,env:t?"development":"production"}),P=(e,t,s,o=!1,l)=>{const c=[];let d=Array.from(new Set(t));for(;d.length;)d.length>1e3?(c.push(d.slice(0,1e3)),d=d.slice(1e3)):(c.push(d),d=[]);const g=(0,r.exponentialRetry)((function(t,r){const l=o?{call_id:e,participant_ids:r.join(","),fields:u,device_id:"anyId",secret:t.secret,user_id:s}:{call_id:e,participant_ids:r.join(","),fields:u};return(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"messages.getCallParticipants",data:l}),(0,n.getApiWrapper)(!o)()("messages.getCallParticipants",l,{version:a.API_VERSION}).then((e=>{const s={count:e.count+t.count,secret:e.secret,profiles:(t.profiles||[]).concat(e.profiles||[]),anonyms:(t.anonyms||[]).concat(e.anonyms||[]),groups:(t.groups||[]).concat(e.groups||[]),contacts:(t.contacts||[]).concat(e.contacts||[])};return(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"messages.getCallParticipants",data:s}),s}))})),p=Promise.resolve({secret:l,count:0});return c.reduce(((e,t)=>e.then((e=>g(e,t)))),p)},S=(e,t=!1,s,a,r)=>{const i=(0,n.createApi)("voicerooms.getParticipants"),o={fields:u};return t&&(o.device_id="anyId",o.secret=a,o.user_id=s),i({...o,...e},r)},I=e=>(0,n.createApi)("groups.getById")({group_ids:String(e),fields:g},{},{version:a.API_VERSION}),E=e=>(0,n.createApi)("video.getUpcomingLives")({owner_ids:e}),U=(e,t,s)=>(0,n.createApi)("video.get")({owner_id:e,videos:t,need_privacy:s}),j=(e,t,s,a,r)=>(0,n.createApi)("video.edit")({owner_id:e,video_id:t,name:s,desc:a,privacy_view:r}),D=e=>(0,n.createApi)("users.get")(e),G=e=>(0,n.createApi)("video.liveHeartbeat")(e),B=e=>(0,n.createApi)("account.getPrivacySettings")(e),q=()=>(0,n.createApi)("messages.getGroupsForCall")({count:200}),L=(e,t=0,s=10)=>{let a={fields:d.concat(",can_call_from_group"),group_id:String(e),offset:t,count:s,sort:"time_asc"};return(0,n.createApi)("groups.getMembers")(a)},O=(e,t="")=>(0,n.createApi)("users.search")({fields:d.concat(",can_call_from_group"),group_id:e,q:t});function R(e,t,s=!1,r="",o=0){let l={call_id:e,participant_ids:t.join(","),fields:u};return s&&(l={...l,device_id:"anyId",secret:r,user_id:o}),(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"messages.getCallParticipants",data:l}),(0,n.getApiWrapper)(!s)()("messages.getCallParticipants",l,{version:a.API_VERSION}).then((e=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"messages.getCallParticipant",response:e}),e)))}function N(){return(0,n.createApi)("video.getGroupsForStreaming")({})}function $(e=d){return(0,n.createApi)("messages.getCurrentCalls")({fields:e})}function x(e){return(0,n.createApi)("queue.subscribe")(e,{},{grouping:!1})}function F(e){return x({queue_ids:`calls_${e}`}).then((t=>{const{base_url:s,queues:a}=t,{key:r,timestamp:n}=a[0];return{baseUrl:s,key:r,timestamp:n,userId:e}}))}function W(e){const{baseUrl:t,key:s,userId:a,timestamp:r}=e;return`${t}?act=a_check&key=${s}&id=${a}&ts=${r}&wait=20`}function H(e){return fetch(e).then((e=>e.json()))}function V(e=5,t=0,s=0,a="all"){const r={count:e,start_from:t,fields:d+",last_name_gen",filter:a};return 0!==s&&(r.group_id=s),(0,n.createApi)("messages.getCallHistory")(r)}function Q(e=25,t,s="all"){const a={count:e,fields:d+",last_name_gen",filter:s};return t&&(a.pagination_marker=t),(0,n.createApi)("calls.getHistory")(a)}function z(e,t=25,s,a="all"){const r={group_id:e,count:t,fields:d+",last_name_gen",filter:a};return s&&(r.pagination_marker=s),(0,n.createApi)("calls.getGroupHistory")(r)}const J=(e={})=>{const t=(0,n.getApiWrapper)(!0)();return(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"photos.get",params:e}),t("photos.get",{album_id:"-166",...e}).then((e=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"photos.get",response:e}),e)))},K=e=>["error_msg","error_code"].some((t=>(0,o.get)(t,e)))?Promise.reject(e):Promise.resolve(e),Y=e=>{const t=(0,n.getApiWrapper)(!0)(),s=(0,n.getApiWrapper)(!0)();return(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"photos.getCallBackgroundsPhotoUploadServer"}),t("photos.getCallBackgroundsPhotoUploadServer",{}).then(K).then((t=>{(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"photos.getCallBackgroundsPhotoUploadServer",response:t});const s=new FormData;return s.append("file1",e,e.name),(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:`[photoUploadUrl] ${t.upload_url}`,formData:s}),fetch(t.upload_url,{method:"POST",body:s}).then((e=>e.json())).then(K)})).then((e=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:"[photoUploadUrl]",json:e}),(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"photos.saveBackgroundPhoto",json:e}),s("photos.saveBackgroundPhoto",{response_json:JSON.stringify(e)})))).then(K)},X=e=>{const t=(0,n.getApiWrapper)(!0)();return(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:"photos.delete",params:e}),t("photos.delete",e).then(K)},Z=(e=10,t=0,s="hints")=>{const a={fields:d.concat(",can_call,online_info"),count:e,offset:t,order:s,filters:"without_banned,without_deleted,without_dead"};return(0,n.createApi)("friends.get")(a)},ee=(e,t="",s=10,a=0)=>(0,n.createApi)("friends.search")({user_id:e,q:t,fields:d.concat(",can_call,online_info,photo_50"),count:s,offset:a,filters:"without_banned,without_deleted,without_dead"}),te=(e={extended:1,count:30})=>(0,n.createApi)("messages.getConversations")(e),se=(e={})=>(0,n.createApi)("messages.send")(e),ae=(0,n.createApi)("calls.start"),re=(e={})=>{const t={count:20,extended:1,...e};return(0,n.createApi)("messages.search")(t)},ne=(e={})=>(0,n.createApi)("messages.getScheduledCalls")(e),ie=e=>(0,n.createApi)("messages.deleteScheduledCall")(e),oe=e=>(0,n.createApi)("messages.editCall")(e),le=(e={},t={})=>(0,n.createApi)("video.getWatchTogetherRecommendedVideos")(e,t).then(K),ce=(e={},t={})=>(0,n.createApi)("video.getWatchTogetherOwnerVideos")(e,t).then(K),de=(e={},t)=>(e.united_video_only=1,e.extended=1,(0,n.createApi)("video.search")(e,t,{version:"5.167"}).then(K)),ue=(e,t)=>{const s={extended:1,...e};return(0,n.createApi)("video.get")(s,t)},ge=(0,n.createApi)("video.getThumbsUploadServer"),pe=(0,n.createApi)("video.startStreaming"),he=(0,n.createApi)("video.editStreaming"),_e=(0,n.createApi)("video.delete"),fe=(e,{userId:t,isAnon:s=!1,secret:r,search:o},l)=>{const c="messages.getCallParticipants",d={call_id:e,fields:u,search:o},g=s?{...d,device_id:"anyId",secret:r,user_id:t}:d;return(0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"request",method:c,params:g}),(0,n.getApiWrapper)(!s)()(c,g,{version:a.API_VERSION},l).then((e=>((0,i.debugMessage)(i.DebugMessageType.DEBUG,{type:"response",method:c,data:e}),{count:e.count,secret:e.secret,profiles:e.profiles||[],anonyms:e.anonyms||[],groups:e.groups||[]})))},me=(e={},t)=>(0,n.createApi)("calls.getReactions")(e,t),be=(e,t)=>(0,n.createApi)("calls.getCallJoinHistory")(e,t).then((e=>e.csv)),ye=(e,t)=>(e.fields=u,(0,n.createApi)("calls.getParticipants")(e,t)),we=()=>(0,n.createApi)("calls.getUserSettings")({},{},{maxRetries:0}),ve=e=>(0,n.createApi)("calls.setUserSettings")(e),Ce=e=>(0,n.createApi)("calls.editParticipantName")(e),ke=e=>(0,n.createApi)("calls.deleteParticipantName")(e),Ae=e=>(0,n.createApi)("calls.checkParticipantName")(e);function Me(e,t,s){const a={anonym_auth_user_id:e,secret:t,device_id:s};return(0,n.createApi)("calls.subscribeToQueue")(a)}function Te(e,t){const{base_url:s,queues:a}=e.queue_subscription_info,{key:r,timestamp:n}=a[0];return`${s}?act=a_check&key=${r}&id=${t}&ts=${n}&wait=20`}const Pe=(0,n.createApi)("calls.getAsrTranscriptions"),Se=((0,n.createApi)("calls.editAsrTranscription"),(0,n.createApi)("calls.deleteAsrTranscriptions"));async function Ie(){const e=await(0,n.createApi)("calls.getSettings")({}),t=Object.fromEntries(e.toggles.map((e=>[e.name,e.enabled])));return{...e,toggles:t}}async function Ee(e){const{user:t,privacySettings:s,params:a}=await async function(e){const t="calls_ip",s=`\nreturn [\n  wait(fork(\n  API.users.get({\n    user_ids: ${(0,c.vkIdToPeerId)(e)},\n    fields: '${d}',\n  })\n)),\n  wait(fork(\n  API.account.getPrivacySettings({\n    privacy_keys: '${t}',\n    need_default: 0,\n  })\n)),\n  API.calls.getSettings({}),\n];\n  `,[a,i,o]=await(0,n.createApi)("execute")({code:s}),[l]=(0,r.normalizeProfiles)(a),u=i.settings.find((e=>e.key===t)),g={callsIp:"friends"};u&&"category"in u.value&&(g.callsIp=u.value.category);const p=Object.fromEntries(o.toggles.map((e=>[e.name,e.enabled])));return{user:l,privacySettings:g,params:{...o,toggles:p}}}(e),{toggles:i,settings:o}=a;return{settings:o,toggles:i,callsCredentials:{key:o.public_key,is_dev:o.is_dev,privacySettings:s,ip_setting_enabled:o.ip_setting_enabled,me:t}}}function Ue(e,t){const s={call_id:e};return t&&(s.hall_id=t),(0,n.createApi)("calls.getConversationByCall")(s)}async function je(){const e=await(0,n.createApi)("messages.getInboundCalls")({}),[t]=e.items??[];return t??null}function De(e){return(0,n.createApi)("account.getHelpHints")({hints:e?.join(",")}).then((e=>e.items))}async function Ge(e){return(0,n.createApi)("account.hideHelpHint")({hint_id:e})}function Be(e,t){const s={call_id:e};return null!==t&&(s.hall_id=t),(0,n.createApi)("calls.getBroadcast")(s)}},184850:(e,t,s)=>{s.d(t,{fetchCallToken:()=>n});var a=s(912551);let r;async function n(e,t=!1){if(r)return r;const s=(0,a.getLocalToken)(e);return s||(r=(0,a.fetchToken)(t),r.then((t=>(0,a.saveLocalToken)(t,e))),r)}},584103:(e,t,s)=>{var a,r;s.d(t,{ECallLongpollEntityType:()=>a,ECallLongpollType:()=>r}),function(e){e.Calls="calls"}(a||(a={})),function(e){e.ScheduledCallsUpdate="scheduled_calls_update",e.CurrentCallsUpdate="current_calls_update",e.ChatInfoUpdated="chat_info_updated",e.CallAccepted="call_accepted",e.IncomingCall="incoming_call",e.CallFinished="call_finished",e.ParticipantNameChanged="participant_name_changed"}(r||(r={}))},357426:(e,t,s)=>{s.d(t,{CredentialCache:()=>r});var a=s(659397);class r{get cacheInMs(){return 60*this.CACHE_LIFE_IN_MINUTES*1e3}isActualTs(e){return null!==e&&e+this.cacheInMs>Date.now()}getActualCredentialsFromLS(){try{const e=a.localStorage.getItem(this.key);if(!e)return[];const t=JSON.parse(e);if("data"in t&&"lastUpdate"in t&&this.isActualTs(t.lastUpdate))return[t.data,t.lastUpdate]}catch(e){}return[]}put(e){this.data=e,this.lastUpdate=Date.now(),a.localStorage.setItem(this.key,JSON.stringify({data:e,lastUpdate:this.lastUpdate}))}update(e){this.data&&(this.data={...this.data,ts:e},this.lastUpdate=Date.now(),a.localStorage.setItem(this.key,JSON.stringify({data:this.data,lastUpdate:this.lastUpdate})))}get(){if(null===this.data){const[e,t]=this.getActualCredentialsFromLS();if(e&&t)return this.data=e,this.lastUpdate=t,this.data}return this.data&&!this.isActualTs(this.lastUpdate)&&this.drop(),this.data}drop(){this.data=null,this.lastUpdate=null,a.localStorage.removeItem(this.key)}constructor(e){this.data=null,this.lastUpdate=null,this.CACHE_LIFE_IN_MINUTES=5,this.id=e,this.key=`queue_credential_calls_cache_${e}`;const[t,s]=this.getActualCredentialsFromLS();t&&s&&(this.data=t,this.lastUpdate=s)}}},667297:(e,t,s)=>{s.d(t,{startQueueManager:()=>l});var a=s(412994),r=s(537313),n=s(584103),i=s(309693);const o=1;async function l({id:e,loadModule:t,credentialCache:s,debug:l,regularTransport:c,appId:d=i.CallsAppId.WEB}){const u=()=>{const i=new r.QueueManager({debug:l,noSharedWorker:c}),g=`calls_${e}_${d}_1`;i.addQueue(g,(async()=>{const t=s.get();if(t)return t;const r=await(0,a.queueSubscribe)({queue_ids:g}),{base_url:n,queues:i}=r,{key:o,timestamp:l}=i[0],c={id:e,key:o,ts:l,url:n};return s.put(c),c})),i.subscribe((async(e,a)=>{a.failed&&a.failed!==o?s.drop():(s.update(Number(a.ts)),a.failed!==o&&(!window.Calls?.handleQueueEvent&&a.events.some((e=>e.data.type===n.ECallLongpollType.IncomingCall))&&await t(),window.Calls?.handleQueueEvent&&a.events.forEach((e=>{window.Calls?.handleQueueEvent(e)}))))}),(()=>{l&&console.log("reset"),i.destroy(),u()}))};u()}},912551:(e,t,s)=>{s.d(t,{fetchToken:()=>l,getLocalToken:()=>o,saveLocalToken:()=>i});var a=s(659397),r=s(412994);const n=e=>"calls_token"+(e?`_${e}`:"");function i(e,t){a.localStorage.setItem(n(t),e)}function o(e){return a.localStorage.getItem(n(e))}async function l(e){const{token:t}=await(0,r.getCallAuthToken)(e);return t}},537313:(e,t,s)=>{s.d(t,{QueueManager:()=>n});var a=s(314364),r=s(882644);class n{addQueue(e,t){return this._transport?.addQueue(e,t),this}removeQueue(e){return this._transport?.removeQueue(e),this}subscribe(e,t){return this._transport?.subscribe(e,t),this}destroy(){this._transport?.destroy()}toggleDebug(e){this._transport?.toggleDebug(e)}constructor({debug:e,noSharedWorker:t}={}){"undefined"==typeof SharedWorker||t?this._transport=new r.RegularTransport:this._transport=new a.SharedWorkerTransport,this.toggleDebug(e)}}},882644:(e,t,s)=>{s.d(t,{RegularTransport:()=>i});var a=s(659397),r=s(101798),n=s(706333);class i{addQueue(e,t){this.credentialsGetters.set(e,t),this.longpollManager.has(e)||this.requestCredentials(e)}async requestCredentials(e){const t=this.credentialsGetters.get(e);if(t&&!this.credentialsProcessing.has(e)){this.credentialsProcessing.add(e);try{this.logger.debug(`request credentials for ${e}`);const s=await t();this.longpollManager.add(e,s)}catch(e){this.logger.error("[requestCredentials]",e)}finally{this.credentialsProcessing.delete(e)}}}removeQueue(e){this.credentialsGetters.delete(e),this.credentialsProcessing.delete(e),this.longpollManager.remove(e)}subscribe(e,t){this.onMessage=e,t&&(this.onReset=t)}toggleDebug(e){this.logger.enabled=Boolean(e)}destroy(){this.onMessage=a.noop,this.onReset=a.noop;for(let[e]of this.credentialsGetters)this.longpollManager.remove(e)}constructor(){this.credentialsGetters=new Map,this.credentialsProcessing=new Set,this.onMessage=a.noop,this.onReset=a.noop,this.logger=new r.Logger(!1,"RegularTransport"),this.callbackHandler=(e,t)=>{this.logger.debug(`response for ${e}`,t);const s=(0,a.isObjectLike)(t)&&("err"in t||"failed"in t);s&&this.longpollManager.remove(e),this.onMessage(e,t),s&&this.onReset()},this.longpollManager=new n.LongpollManager(this.callbackHandler,this.logger)}}},314364:(e,t,s)=>{s.d(t,{SharedWorkerTransport:()=>n});var a=s(172045),r=s(239392);class n{_postMessage(e){this._worker.port.postMessage(e)}_handleMessage(e){switch(this._isDebug&&"ping"!==e.data.type&&console.debug("Message received from worker\n",e.data),e.data.type){case"ping":e.data.payload===this._clientId&&(this._postMessage({type:"pong"}),this._checkKeepAlivePortInterval());break;case"longpoll-event":e.data.payload.clientId===this._clientId&&this._onMessage?.(e.data.payload.queueId,e.data.payload.data);break;case"request-credentials":e.data.payload.clientId===this._clientId&&this._requestCredentials(e.data.payload.queueId)}}_checkKeepAlivePortInterval(){this._keepAliveTimeout&&clearTimeout(this._keepAliveTimeout),this._keepAliveTimeout=setTimeout((()=>this._onReset?.()),r.TO_PORT_PING_INTERVAL+r.TO_PORT_PING_INTERVAL/2)}_setBeforeUnloadListener(){const e=()=>this.destroy();return window.addEventListener("beforeunload",e),e}async _requestCredentials(e){const t=this._credentialsGetters.get(e);if(t&&!this._credentialsProcessing.has(e)){this._credentialsProcessing.add(e);try{const s=await t();this._postMessage({type:"set-credentials",payload:{queueId:e,params:s}})}catch(e){console.error("[SharedWorkerTransport][_requestCredentials]",e)}finally{this._credentialsProcessing.delete(e)}}}destroy(){this._postMessage({type:"disconnect",payload:this._clientId}),this._worker.port.close(),window.removeEventListener("beforeunload",this._onBeforeUnloadLink),this._onMessage=null,this._onReset=null}addQueue(e,t){this._credentialsGetters.set(e,t),this._postMessage({type:"add-queue",payload:{queueId:e}})}subscribe(e,t){this._onMessage=e,this._onReset=t}removeQueue(e){this._credentialsGetters.delete(e),this._postMessage({type:"remove-queue",payload:{queueId:e}})}toggleDebug(e){const t=Boolean(e);this._isDebug=t,this._postMessage({type:"debug",payload:t})}constructor(){this._onReset=null,this._onMessage=null,this._keepAliveTimeout=null,this._isDebug=!1,this._clientId=(0,a.default)(),this._worker=new SharedWorker(new URL(self.location.origin+"/dist/"+s.u(92398),s.b)),this._onBeforeUnloadLink=this._setBeforeUnloadListener(),this._credentialsGetters=new Map,this._credentialsProcessing=new Set,this._worker.onerror=e=>console.error(e),this._worker.port.onmessage=e=>this._handleMessage(e),this._postMessage({type:"connect",payload:this._clientId}),this._worker.port.start(),this._checkKeepAlivePortInterval()}}},101798:(e,t,s)=>{s.d(t,{Logger:()=>a});class a{createMessage(e){return this.prefix?e.map(((e,t)=>0===t&&"string"==typeof e?`[${this.prefix}] ${e}`:e)):e}debug(...e){this.enabled&&console.debug(...this.createMessage(e))}log(...e){this.enabled&&console.log(...this.createMessage(e))}warn(...e){this.enabled&&console.warn(...this.createMessage(e))}error(...e){this.enabled&&console.error(...this.createMessage(e))}constructor(e,t=""){this.enabled=e,this.prefix=t}}},706333:(e,t,s)=>{s.d(t,{LongpollManager:()=>n});var a=s(659397),r=s(473058);class n{add(e,t){const s=this._queues.get(e);(s?.ts||0)<t.ts&&this._queues.set(e,{...t}),this._start()}remove(e){const t=this._queues.get(e);t&&this._retryCount.delete(t?.url),this._queues.delete(e)}has(e){return this._queues.has(e)}_start(){for(const e of this._queues.values())this._processing.has(e.url)||this._processing.set(e.url,setTimeout((()=>this._processUrl(e.url)),this._getTimeoutValue(e.url)))}_getTimeoutValue(e){const t=this._getRetryCount(e);return 1===t?4:2*t*1e3}_getRetryCount(e){return this._retryCount.get(e)??1}_increaseRetryCount(e){const t=this._getRetryCount(e)+1;return this._retryCount.set(e,t),t}_resetRetryCount(e){this._retryCount.set(e,1)}async _processUrl(e){const t=[],s=[];for(const[a,r]of this._queues.entries())r.url===e&&(t.push(a),s.push(r));if(!t.length||!s.length)return void this._processing.delete(e);let a;try{const t=(0,r.createUrl)(s,this._logger),n=await this._request(t);a=Array.isArray(n)?n:[n],this._resetRetryCount(e)}catch(s){a=[],this._increaseRetryCount(e)>=20&&t.forEach((()=>a.push(this._createFailedResponse())))}finally{this._processing.delete(e)}for(let e=0;e<a.length;++e)this._publish(t[e],a[e]),this._updateTs(t[e],a[e]);this._start()}_request(e){return fetch(e).then((e=>e.json()))}_updateTs(e,t){if(!(0,a.isObject)(t)||!("ts"in t))return;const s=this._queues.get(e),r=Number(t.ts);!(0,a.isUndefined)(s)&&s.ts<r&&(s.ts=r)}_createFailedResponse(){return{err:1,failed:1}}constructor(e,t){this._queues=new Map,this._processing=new Map,this._publish=e,this._logger=t,this._retryCount=new Map}}},473058:(e,t,s)=>{s.d(t,{createUrl:()=>r});const a=25;function r(e,t){const s=e[0].url,r=e[0].id;let n=e[0].key,i=`${e[0].ts}`;for(let a=1;a<e.length;++a){if(e[a].id!==r){const s=`Invalid userId pair: ${r}, ${e[a].id}`;throw t?.error(s),new Error(s)}if(e[a].url!==s){const r=`Invalid baseUrl pair: ${s}, ${e[a].url}`;throw t?.error(r),new Error(r)}n+=`${e[a].key}`,i+=`_${e[a].ts}`}return`${s}?act=a_check&key=${n}&id=${r}&ts=${i}&wait=${a}`}},239392:(e,t,s)=>{s.d(t,{TO_PORT_PING_INTERVAL:()=>a,TO_PORT_PING_REPLY_WAIT:()=>r});const a=1e4,r=1e3},677162:(e,t,s)=>{var a=s(802130),r=s(65718),n=s(159663),i=s(471828),o=s(740685),l=s(822338),c=s(412994),d=s(184850),u=s(166695),g=s(7514),p=s(977053),h=s(688538),_=s(667297),f=s(584103),m=s(357426);window.vk?.pe?.static_manager_dynamic_imports&&window.vk?.stDomain&&(s.p=window.vk.stDomain+"/dist/");const b=(0,p.partConfigEnabled)("calls_forbid_web_calls_for_ads_account"),y=(0,p.partConfigEnabled)("web_calls_queue_subscribe_logger"),w=(0,p.partConfigEnabled)("web_calls_enable_queue_manager_regular_transport");function v(){return new Promise((e=>{window.stManager.add([window.jsc("web/calls.js"),"calls.css"],e)}))}(async function(){if(window.Calls?.initialized)return;if(b||!h.Ranges.isUserId(window.vk.id))return;(0,g.setApiWrappers)((()=>u.api),(()=>u.api));const e=(0,d.fetchCallToken)(window.vk.id,window.vk.isCallsDevEnv),{callsCredentials:t,toggles:s,settings:a}=await(0,c.executeGetCallsSettings)(window.vk.id),p={...window.Calls?.predefinedInitArgs,callsCredentials:t,sdkToken:await e,toggles:{...s,enableSimplePiP:window.browser.safari?s.enableSimplePiPSafari:s.enableSimplePiP,videoSlotsCount:a.video_slots_count,browserWarnings:a.browser_warnings,disabledBanners:a.disabled_banners,customScreenSharePacketSize:a.custom_screen_share_packet_size,customScreenShareCongestionControlThreshold:a.custom_screen_share_congestion_control_threshold,customExternalDomain:a.custom_external_domain,noiseReductionMode:a.noise_reduction_mode,enableVmoji:!0,deviceId:a.device_id},onError:({msg:e})=>(e&&(0,r.logError)(e),e&&(0,n.showFastBox)(i.getLang("global_error"),e)),onBeforeCallStart:()=>{window.Notifier.pauseGlobalMedia()},onAfterCallFinish:()=>{window.Notifier.resumeGlobalMedia()},tabIsMaster:()=>window.Notifier.tabIsMaster(),isFriend:e=>!!window.curFastChat?.friends?.[e+"_"],removeLeftMenuItemBadge:()=>{l.leftMenu.removeBadge(o.PAGE_ID_CALLS)}};window.browser.mozilla?(window.Calls=window.Calls??{},window.Calls.initArgs=p,window.requestIdleCallback((()=>{v().then((()=>{window.Calls?.init?.(p)}))}))):function(e){if(!1===window.Calls?.initialized)return void window.Calls.init(e);const t={},s=t=>(...s)=>v().then((()=>window.Calls?.init?.(e))).then((()=>window.Calls?.[t]?.(...s)));t.call=s("call"),t.startGroupCall=s("startGroupCall"),t.startCall=s("startCall"),t.acceptCall=s("acceptCall"),t.joinCallByLink=s("joinCallByLink"),t.joinRoomByLink=s("joinRoomByLink"),t.showJoinPopup=s("showJoinPopup"),t.showCallByNamePopup=s("showCallByNamePopup"),t.showCreateCallByLinkPopup=s("showCreateCallByLinkPopup"),t.showPlanCalendarEventPopup=s("showPlanCalendarEventPopup"),t.showStartCallModal=s("showStartCallModal"),t.showHistoryScreen=s("showHistoryScreen"),t.joinOrStartCallModal=s("joinOrStartCallModal"),t.initArgs=e,window.Calls=t}(p);const C=async()=>{void 0===window.Calls?.initialized&&await v(),await(window.Calls?.init(p))},k=new m.CredentialCache(window.vk.id);if(null===k.get()){const e=await(0,c.getInboundCall)();e&&(await C(),window.Calls?.handleQueueEvent({entity_type:f.ECallLongpollEntityType.Calls,entity_id:1,data:{type:f.ECallLongpollType.IncomingCall,value:e}}))}(0,_.startQueueManager)({id:window.vk.id,loadModule:C,credentialCache:k,debug:y,regularTransport:w})})().catch(console.error);try{window.stManager.done(window.jsc("web/calls_lazy_module.js"))}catch(e){}requestIdleCallback((()=>{try{(0,a.statlogsValueEvent)("entries_requests",1,"calls_lazy_module","web")}catch{}}),{timeout:5e3})}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var s=o[e]={exports:{}};return i[e].call(s.exports,s,s.exports,l),s.exports}l.m=i,e=[],l.O=(t,s,a,r)=>{if(!s){var n=1/0;for(d=0;d<e.length;d++){for(var[s,a,r]=e[d],i=!0,o=0;o<s.length;o++)(!1&r||n>=r)&&Object.keys(l.O).every((e=>l.O[e](s[o])))?s.splice(o--,1):(i=!1,r<n&&(n=r));if(i){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,a,r]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var r=Object.create(null);l.r(r);var n={};t=t||[null,s({}),s([]),s(s)];for(var i=2&a&&e;"object"==typeof i&&!~t.indexOf(i);i=s(i))Object.getOwnPropertyNames(i).forEach((t=>n[t]=()=>e[t]));return n.default=()=>e,l.d(r,n),r},l.d=(e,t)=>{for(var s in t)l.o(t,s)&&!l.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,s)=>(l.f[s](e,t),t)),[])),l.u=e=>24817===e?"web/chunks/hls.b496ce21.js":77794===e?"web/chunks/7bdfc282.async.758ca0aa.js":40530===e?"web/chunks/5ef6139d.async.11c35c9c.js":19442===e?"web/chunks/9f7d7ed3.async.4011bfc9.js":71634===e?"web/chunks/5b5fa12c.async.df7dbdde.js":14803===e?"web/chunks/b8d79c18.async.1f2410f2.js":27370===e?"web/chunks/2c9432b5.async.5b90c7cd.js":5157===e?"web/chunks/unauth_action_box.9d309412.js":25394===e?"web/chunks/AudioLongtapModal.ab967a4b.js":75980===e?"web/chunks/menu_settings.7bdcde07.js":91815===e?"web/chunks/b66df7cc.async.98a85b3f.js":40928===e?"web/chunks/fcbd3ef2.async.877aa898.js":9914===e?"web/chunks/52fa6987.async.94be31b8.js":59727===e?"web/chunks/VideoUpload.ab749b29.js":9375===e?"web/chunks/voice_message_player.faac3006.js":28762===e?"web/chunks/speech.3083d7af.js":57468===e?"web/chunks/SilentModeForms.d5a6e099.js":28872===e?"web/chunks/feed-client-nav-skeleton.a45b822f.js":35953===e?"web/chunks/feed-client-nav-async-right-block.85b20aca.js":85059===e?"web/chunks/059ba3af.async.ee5a4200.js":88339===e?"web/chunks/aadde5b7.async.efcb9ddc.js":67724===e?"web/chunks/VideoEditorModal.eb979233.js":22854===e?"web/chunks/PublishClipToVideoModal.dae3ac0f.js":30271===e?"web/chunks/VideoUploadModal.b8d73da8.js":31286===e?"web/chunks/VideoExternalUploadModal.2c5830cb.js":969===e?"web/chunks/0dc980e6.async.18c61f90.js":92846===e?"web/chunks/ClipUploadModal.fbd8d9e4.js":59240===e?"web/chunks/performance-stats.b497cf49.js":378===e?"web/chunks/79f739a7.async.4832bf09.js":72491===e?"web/chunks/story_blocks.203f1767.js":7308===e?"web/chunks/7308.e4292e75.js":92398===e?"chunks/"+e+".18cb85f5.js":1854===e?"chunks/1854.9b4b0c68.js":18254===e?"chunks/"+e+".0ac520ae.js":"web/chunks/videoplayer-interactive.2e35aad6.js",l.miniCssF=e=>({5157:1,59727:1}[e]?"web/chunks/0c110bf9.css":25394===e?"web/chunks/6a66a172.css":75980===e?"web/chunks/5bbee2c9.css":57468===e?"web/chunks/122e7a6e.css":67724===e?"web/chunks/3c048aa6.css":22854===e?"web/chunks/70c35bc4.css":{30271:1,31286:1}[e]?"web/chunks/f89919fd.css":92846===e?"web/chunks/83ceb5be.css":72491===e?"web/chunks/de731494.css":void 0),l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a={},l.l=(e,t,s,r)=>{if(a[e])a[e].push(t);else{var n,i;if(void 0!==s)for(var o=document.getElementsByTagName("script"),c=0;c<o.length;c++){var d=o[c];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")=="vk:"+s){n=d;break}}n||(i=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,l.nc&&n.setAttribute("nonce",l.nc),n.setAttribute("data-webpack","vk:"+s),n.src=e),a[e]=[t];var u=(t,s)=>{n.onerror=n.onload=null,clearTimeout(g);var r=a[e];if(delete a[e],n.parentNode&&n.parentNode.removeChild(n),r&&r.forEach((e=>e(s))),t)return t(s)},g=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),i&&document.head.appendChild(n)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="/dist/",r=e=>new Promise(((t,s)=>{var a=l.miniCssF(e),r=l.p+a;if(((e,t)=>{for(var s=document.getElementsByTagName("link"),a=0;a<s.length;a++){var r=(i=s[a]).getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(r===e||r===t))return i}var n=document.getElementsByTagName("style");for(a=0;a<n.length;a++){var i;if((r=(i=n[a]).getAttribute("data-href"))===e||r===t)return i}})(a,r))return t();((e,t,s,a)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.onerror=r.onload=n=>{if(r.onerror=r.onload=null,"load"===n.type)s();else{var i=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=i,l.request=o,r.parentNode.removeChild(r),a(l)}},r.href=t,document.head.appendChild(r)})(e,r,t,s)})),n={21436:0},l.f.miniCss=(e,t)=>{n[e]?t.push(n[e]):0!==n[e]&&{5157:1,22854:1,25394:1,30271:1,31286:1,57468:1,59727:1,67724:1,72491:1,75980:1,92846:1}[e]&&t.push(n[e]=r(e).then((()=>{n[e]=0}),(t=>{throw delete n[e],t})))},(()=>{l.b=document.baseURI||self.location.href;var e={21436:0};l.f.j=(t,s)=>{var a=l.o(e,t)?e[t]:void 0;if(0!==a)if(a)s.push(a[2]);else{var r=new Promise(((s,r)=>a=e[t]=[s,r]));s.push(a[2]=r);var n=l.p+l.u(t),i=new Error;l.l(n,(s=>{if(l.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var r=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.src;i.message="Loading chunk "+t+" failed.\n("+r+": "+n+")",i.name="ChunkLoadError",i.type=r,i.request=n,a[1](i)}}),"chunk-"+t,t)}},l.O.j=t=>0===e[t];var t=(t,s)=>{var a,r,[n,i,o]=s,c=0;if(n.some((t=>0!==e[t]))){for(a in i)l.o(i,a)&&(l.m[a]=i[a]);if(o)var d=o(l)}for(t&&t(s);c<n.length;c++)r=n[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(d)},s=self.webpackChunkvkweb=self.webpackChunkvkweb||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var c=l.O(void 0,[213,83737,2067,20795,57451,5038,95167,96219],(()=>l(677162)));c=l.O(c)})();